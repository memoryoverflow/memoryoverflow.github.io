{"pages":[{"title":"","text":"ä¸ªäººç®€ä»‹ åˆ†äº«å¾ˆå–œæ¬¢çš„è€ç½—çš„ä¸€æ®µè¯ï¼š â€œæ¯ä¸€ä¸ªç”Ÿå‘½æ¥åˆ°ä¸–é—´éƒ½æ³¨å®šæ”¹å˜ä¸–ç•Œï¼Œåˆ«æ— é€‰æ‹©ã€‚è¦ä¹ˆå˜å¾—å¥½ä¸€ç‚¹ï¼Œè¦ä¹ˆå˜å¾—åä¸€ç‚¹ã€‚ä½ å¦‚æœèµ°è¿›ç¤¾ä¼šä¸ºäº†ç”Ÿå­˜ä¸ºäº†ä»€ä¹ˆä¸è¦è„¸çš„ç†ç”±ï¼Œå˜æˆäº†ä¸€ä¸ªæ¶å¿ƒçš„æˆå¹´äººç¤¾ä¼šä¸­çš„ä¸€å‘˜ï¼Œé‚£ä½ å°±æŠŠè¿™ä¸ªä¸–ç•Œå˜å¾—æ¶å¿ƒäº†ä¸€ç‚¹ç‚¹ã€‚å¦‚æœä½ ä¸€ç”Ÿåˆšæ­£ä¸é˜¿ï¼Œå¦‚æœä½ ä¸€ç”Ÿè€¿ç›´ï¼Œæ²¡æœ‰åšä»»ä½•æ¶å¿ƒçš„äº‹æƒ…ï¼Œæ²¡åšå¯¹åˆ«äººæœ‰å®³çš„äº‹æƒ…ï¼Œä¸€è¾ˆå­æ‹¼äº†è€å‘½å‹‰å¼ºæŠŠè‡ªå·±èº«è¾¹çš„å‡ ä¸ªäººç…§é¡¾å¥½äº†ï¼Œæ²¡æœ‰æˆåæ²¡æœ‰å‘è´¢ï¼Œæ²¡æœ‰æˆå°±ä¼Ÿå¤§çš„äº‹ä¸šï¼Œç„¶åè€¿ç€è„–å­ä¸€ç”Ÿæ­£ç›´ï¼Œåˆ°äº†ä¸ƒå…«åå²è€¿ç€è„–å­å»ä¸–äº†ã€‚ä½ è¿™ä¸€ç”Ÿæ˜¯ä¸æ˜¯æ²¡æœ‰æ”¹å˜ä¸–ç•Œï¼Ÿä½ è¿˜æ˜¯æ”¹å˜ä¸–ç•Œäº†ï¼Œä½ æŠŠè¿™ä¸ªä¸–ç•Œå˜å¾—ç¾å¥½äº†ä¸€ç‚¹ç‚¹ã€‚å› ä¸ºä¸–ç•Œä¸Šåˆå¤šäº†ä¸€ä¸ªå¥½äººã€‚â€œ å–„æ¶ç»ˆæœ‰æŠ¥,å¤©é“å¥½è½®å›ã€‚ä¸ä¿¡æŠ¬å¤´çœ‹,è‹å¤©é¥¶è¿‡è°ã€‚æ— è®ºä½•æ—¶ä½•åœ°ï¼Œæˆ‘ä»¬éƒ½è¦ä¿æŒä¸€é¢—ç§¯æä¹è§‚ã€å–„è‰¯æ„Ÿæ©çš„å¿ƒã€‚ä½†è¡Œå¥½äº‹è«é—®å‰ç¨‹ï¼Œæ°¸è¿œå¹´è½»ï¼Œæ°¸è¿œçƒ­å†…ç›ˆçœ¶ï¼Œæ°¸è¿œä¿æŒæ­£èƒ½é‡ã€‚ğŸ’ªğŸ’ªğŸ’ªğŸ’ªğŸ’ªğŸ’ªå†²é¸­ï¼ï¼ï¼ï¼ -&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;ä¸ªäººä¿¡æ¯ï¼šè®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šä»äº‹JAVAåç«¯å¼€å‘ç ç•œä¸€æšåšä¿¡ä»£ç æ”¹å˜ä¸–ç•Œ åšå®¢ä¿¡æ¯ ç½‘ç«™é‡‡ç”¨çš„Icarusä¸»é¢˜ è¿½æ±‚å°½å¯èƒ½çš„ç®€æ´ï¼Œæ¸…æ™°ï¼Œæ˜“ç”¨ã€‚ åœ¨Icarusä¸»é¢˜ä¹‹ä¸Šè¿›è¡Œäº†éƒ¨åˆ†ä¿®æ”¹ã€‚ æ›´æ–°æ—¥å¿—ï¼šâ€“2020.01.18ï¼šicarus3.0é€‚é…â€“2019.11.17ï¼šå¢åŠ æ·±è‰²ä¸»é¢˜å¼€å…³â€“2019.10.30ï¼šå»å›¾ï¼Œç²¾ç®€å¡ç‰‡â€“2019.10.22ï¼šæ”¹ç‰ˆéƒ¨åˆ†æ˜¾ç¤ºï¼Œä¼˜åŒ–é€Ÿåº¦â€“2019.10.16ï¼šæ–‡ç« åˆ—è¡¨åŠ ä¸Šè¯„è®ºæ•°æ˜¾ç¤ºâ€“2019.10.13ï¼šæ”¹ç‰ˆè¯„è®ºâ€“2019.09.25ï¼šå›¾ç‰‡ã€èµ„æºæ¥å…¥CDNå…è´¹jsDelivrã€æ–‡ç« åŠ å…¥ç½®é¡¶â€“2019.09.19ï¼šå¼€æºåšå®¢ä»£ç â€“2019.09.19ï¼šä¿®æ”¹å¸ƒå±€ï¼Œæ‹‰ä¼¸å¸ƒå±€ï¼Œæ›´å®½çš„å±•ç¤ºâ€“2019.09.18ï¼šä¿®æ”¹å‹é“¾uiä¸ºä¸€è¡Œä¸‰ä¸ªï¼Œå¹¶é€‚é…ç§»åŠ¨ç«¯ï¼Œæš—é»‘æ¨¡å¼æ–‡ç« å¢åŠ è¯„è®ºé“¾æ¥ï¼Œå¢åŠ ç•™è¨€é“¾æ¥â€“2019.09.14ï¼šå¢åŠ ç²¾ç®€nextä¸»é¢˜â€“2019.09.14ï¼šåˆ©ç”¨ä¸­ç§‹èŠ‚æ”¾å‡ï¼Œé‡åšäº†é¦–é¡µçš„çƒ­é—¨æ¨èã€åŠ ä¸ªwidgetæœ€æ–°è¯„è®ºæ¡†ã€å½’æ¡£é¡µåŠ å…¥æ–‡ç« è´¡çŒ®æ¦‚è§ˆé¢æ¿ æœ¬ç«™æ¨èç´¢å¼• åšå®¢ä¸»é¢˜ç›¸å…³ github Issue ä½œä¸ºåšå®¢å¾®å‹æ•°æ®åº“çš„åº”ç”¨ github pageç½‘ç«™cdnä¼˜åŒ–åŠ é€Ÿ åšå®¢æºç åˆ†äº« åšå®¢æ¢è‚¤çš„ä¸€ç§å®ç°æ–¹å¼æ€è·¯ åšå®¢ä¸­gitalkæœ€æ–°è¯„è®ºçš„è·å– åšå®¢å›¾ç‰‡ä¸Šä¼ picgoå·¥å…·githubå›¾ä¼ ä½¿ç”¨ å®‰è£…ã€éƒ¨åˆ†é…ç½®icarusä¸»é¢˜ä¸­æ–‡ç‰ˆ æŠ€æœ¯çŸ¥è¯†ç‚¹ Javaå¹¶å‘çŸ¥è¯†ç‚¹ æ³•å¾‹æ³•è§„ æ³•å¾‹æ³•è§„æ•°æ®åº“ ä¸­åäººæ°‘å…±å’Œå›½å›½æ——æ³• ä¸­åäººæ°‘å…±å’Œå›½å®ªæ³• ä¸­åäººæ°‘å…±å’Œå›½æ¶ˆè´¹è€…æƒç›Šä¿æŠ¤æ³• ä¸­åäººæ°‘å…±å’Œå›½åˆ‘äº‹è¯‰è®¼æ³• ä¸­åäººæ°‘å…±å’Œå›½å©šå§»æ³• ä¸­åäººåå…±å’Œå›½ç½‘ç»œå®‰å…¨æ³• ä¸­åäººæ°‘å…±å’Œå›½åŠ³åŠ¨æ³• å…¶ä»– ç½‘æ˜“äº‘éŸ³ä¹æ­Œå•åˆ†äº« è®¡åˆ’2020è®¡åˆ’ 2019.12.31 2020-GOALS è·‘ä¸¤ä¸‰åœºé©¬æ‹‰æ¾ 2019è®¡åˆ’ 2018.12.31/21:59:00-&gt;æ›´æ–°äº2019.12.31 2019-GOALS è´­ä¹°çš„ä¸“ä¸šä¹¦ç±è‡³å°‘çœ‹å®Œä¸€éï¼ˆå¹¶å‘ã€é‡æ„ã€è®¾è®¡æ¨¡å¼â€¦ï¼‰-&gt; 95% é¢å¤–ï¼š è¿½äº†å¾ˆå¤šå‰§ æ€»ç»“ï¼š æœ‰ä¼˜ç‚¹æœ‰ç¼ºç‚¹ï¼Œæ²¡åšæŒä¸‹æ¥çš„è¿˜æ˜¯å¤ªå¤šï¼Œè¿½äº†å¤ªå¤šå‰§ã€‚ä»¥åå¤šå­¦ä¹ ï¼Œå¤šæ€è€ƒï¼ æ—¶é—´è½´è®°å½•","link":"/about/index.html"},{"title":"","text":"å”è‰ºæ˜• ææ² æä¸€æ¡ gakki å›¾ç‰‡æœé›†äºäº’è”ç½‘ï¼Œä¾µæƒè¯·ç•™è¨€ï¼Œé©¬ä¸Šå¤„ç†ğŸ˜Šã€‚","link":"/album/index.html"},{"title":"","text":"ç”³è¯·å‹é“¾é¡»çŸ¥ åŸåˆ™ä¸Šåªå’ŒæŠ€æœ¯ç±»åšå®¢äº¤æ¢ï¼Œä½†ä¸åŒ…æ‹¬å«æœ‰å’Œè‰²æƒ…ã€æš´åŠ›ã€æ”¿æ²»æ•æ„Ÿçš„ç½‘ç«™ã€‚ ä¸å’Œå‰½çªƒã€ä¾µæƒã€æ— è¯šä¿¡çš„ç½‘ç«™äº¤æ¢ï¼Œä¼˜å…ˆå’Œå…·æœ‰åŸåˆ›ä½œå“çš„ç½‘ç«™äº¤æ¢ã€‚ ç”³è¯·è¯·æä¾›ï¼šç«™ç‚¹åç§°ã€ç«™ç‚¹é“¾æ¥ã€ç«™ç‚¹æè¿°ã€logoæˆ–å¤´åƒï¼ˆä¸è¦è®¾ç½®é˜²ç›—é“¾ï¼‰ã€‚ æ’åä¸åˆ†å…ˆåï¼Œåˆ·æ–°åé‡æ’ï¼Œæ›´æ–°ä¿¡æ¯åè¯·ç•™è¨€å‘ŠçŸ¥ã€‚ ä¼šå®šæœŸæ¸…ç†å¾ˆä¹…å¾ˆä¹…ä¸æ›´æ–°çš„ã€ä¸ç¬¦åˆè¦æ±‚çš„å‹é“¾ï¼Œä¸å†å¦è¡Œé€šçŸ¥ã€‚ æœ¬ç«™ä¸å­˜å‚¨å‹é“¾å›¾ç‰‡ï¼Œå¦‚æœå‹é“¾å›¾ç‰‡æ¢äº†æ— æ³•æ›´æ–°ã€‚å›¾ç‰‡è£‚äº†çš„ä¼šæ›¿æ¢æˆé»˜è®¤å›¾ï¼Œéœ€è¦æ›´æ¢çš„è¯·ç•™è¨€å‘ŠçŸ¥ã€‚ æœ¬ç«™å‹é“¾ä¿¡æ¯å¦‚ä¸‹ï¼Œç”³è¯·å‹é“¾å‰è¯·å…ˆæ·»åŠ æœ¬ç«™ä¿¡æ¯ï¼š ç½‘ç«™å›¾æ ‡ï¼šhttps://removeif.github.io/images/avatar.jpg ç½‘ç«™åç§°ï¼šRotten Code ç½‘ç«™åœ°å€ï¼šhttps://removeif.github.io ç½‘ç«™ç®€ä»‹ï¼šåç«¯å¼€å‘ï¼ŒæŠ€æœ¯åˆ†äº« åŠ è½½ä¸­ï¼Œç¨ç­‰å‡ ç§’...","link":"/friend/index.html"},{"title":"","text":"&nbsp;&nbsp;å¬å¬éŸ³ä¹ éŸ³ä¹æ’­æ”¾å™¨ç”±mePlayeræä¾›ï¼Œå¸ƒå±€å‚ç…§ç½‘å‹åšå®¢æ‰€ä½œï¼Œæ„Ÿè°¢ä½œè€…çš„è¾›å‹¤ä»˜å‡ºã€‚æ›´å¤šéŸ³ä¹åˆ†äº«è¯·æŸ¥çœ‹æ­Œå•ã€‚ &nbsp;&nbsp;çœ‹çœ‹è§†é¢‘ ->ç‚¹å‡»ä»¥ä¸‹æ¡ç›®å¼€å§‹æ’­æ”¾è§†é¢‘,å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š","link":"/media/index.html"},{"title":"éŸ³ä¹æ­Œå•æ”¶è—","text":"--- æ¸©é¦¨æç¤ºï¼šé€‰æ‹©å–œæ¬¢çš„éŸ³ä¹åŒå‡»æ’­æ”¾ï¼Œç”±äºç‰ˆæƒåŸå› éƒ¨åˆ†ä¸èƒ½æ’­æ”¾ã€‚å¦‚æœå–œæ¬¢æ­Œå•æ”¶è—ä¸€ä¸‹ï¼Œå»ç½‘æ˜“äº‘éƒ½èƒ½æ’­æ”¾å“Ÿï¼","link":"/music/index.html"},{"title":"","text":"æ¥è€Œä¸å¾€éç¤¼ä¹Ÿç•…æ‰€æ¬²è¨€ï¼Œæœ‰ç•™å¿…åº”","link":"/message/index.html"},{"title":"","text":"ç¢ç¢å¿µ tipsï¼šgithubç™»å½•åæŒ‰æ—¶é—´æ­£åºæŸ¥çœ‹ã€å¯ç‚¹èµåŠ â¤ï¸ã€æœ¬æ’ä»¶åœ°å€..ã€Œ+99æ¬¡æŸ¥çœ‹ã€ var gitalk = new Gitalk({ clientID: '46a9f3481b46ea0129d8', clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24', id: '666666', repo: 'issue_database', owner: 'removeif', admin: \"removeif\", createIssueManually: true, distractionFreeMode: false }) gitalk.render('comment-container1')","link":"/self-talking/index.html"}],"posts":[{"title":"åŠ å¯†æ–‡ç« æµ‹è¯•","text":"4630436162ade97ba2718b7d0c4b3b63480c11f21f943edd569d93952dd2b428ca40d00edd08503bde446612a9b43ffa557648f22736556fdb8df232a70f5b62381872db0244c43c00526e1a08cf52221edf34128af95f6689fc9f8038d2d384d80553865a152ddd5e6208a870af3b5c9bc83d20b2dbb9eed9bf4345fcbd80740d0d96973b857ce18daf962a01b68ae1d5fbd8ee95919ff5e4e59e2389903324d011f36e647c7bfde1d377a277b639b7845f1864318dedde1881f738423184c1eda461211d6767b7282687bd23a77a8725cebce8f83995baff71092164b22479 å—¨ï¼Œè¯·å‡†ç¡®æ— è¯¯åœ°è¾“å…¥å¯†ç æŸ¥çœ‹å“Ÿï¼ˆå¯†ç ï¼š123456ï¼‰ï¼","link":"/posts/7e709353/"},{"title":"CountDownLatchåº•å±‚å®ç°æ„æˆï¼Œä¸€æ­¥æ­¥åˆ†æ","text":"CountDownLach è®¡æ•°å™¨ CountDownLach çš„ä½¿ç”¨è¿‡ç¨‹æ–¹æ³•è°ƒç”¨ï¼Œåº•å±‚æºç å­¦ä¹ ã€‚ CountDownLachï¼š é€‚ç”¨äºï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¼€å¯å¤šä¸ªå­çº¿ç¨‹å»ç»Ÿè®¡æŸäº›ä¸åŒæ•°æ®çš„ç»“æœï¼Œç„¶åä¸»çº¿ç¨‹éœ€è¦å¯¹è¿™äº›ç»“æœè¿›è¡Œæ“ä½œçš„åœºæ™¯ã€‚ ä¸»è¦æ–¹æ³•12345678// åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„stateCountDownLach cdl = new CountDownLach(2);// é˜»å¡çº¿ç¨‹ï¼Œè¿›å…¥é˜Ÿåˆ—å€™ç€ï¼Œç­‰å¾…å”¤é†’cdl.await();// å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹cdl.countDown(); æµ‹è¯•ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354/** * &lt;p&gt; * * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-02-18 13:05 */public class JdkCountDownLatch{ // åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„ state = 5 private static final CountDownLatch cdl = new CountDownLatch(5); private static volatile int i; static class Task implements Runnable { @Override public void run() { // æ¥ä¸€ä¸ªçº¿ç¨‹ state-1 // ç›´åˆ°ä¸º 0ï¼Œcdl.await(); åé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œã€‚ cdl.countDown(); ++i; System.out.println(i); } } public static void main(String[] args) { ExecutorService service = Executors.newCachedThreadPool(); // å¼€å¯5ä¸ªçº¿ç¨‹ for (int j = 0; j &lt; 5; j++) { service.execute(new Task()); } service.shutdown(); try { // çº¿ç¨‹è¿›å¦‚é˜Ÿåˆ—ç­‰å€™ cdl.await(); System.out.println(&quot;å­çº¿ç¨‹å¤„ç†ç»“æœï¼š&quot;+i); } catch (InterruptedException e) { e.printStackTrace(); } }} åº•å±‚ä»£ç éªŒè¯æŸ¥çœ‹ new CountDownLatch(5)12345678910111213141516171819202122232425262728293031323334353637public CountDownLatch(int count) { if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;); this.sync = new Sync(count);}// å†…éƒ¨ç±» Sync ç»§æ‰¿äºAQS è°ƒç”¨AQSçš„æ–¹æ³• è®¾ç½®å€¼stateçš„å€¼private static final class Sync extends AbstractQueuedSynchronizer { private static final long serialVersionUID = 4982264981922014374L; Sync(int count) { setState(count); } int getCount() { return getState(); } // è·å–å…±äº«é” æ“ä½œ protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } // é‡Šæ”¾å…±äº«é”ï¼Œè°ƒç”¨cutDown() çš„æ—¶å€™ protected boolean tryReleaseShared(int releases) { // Decrement count; signal when transition to zero for (;;) { int c = getState(); if (c == 0) return false; int nextc = c-1; if (compareAndSetState(c, nextc)) return nextc == 0; } }} çº¿ç¨‹æ•°ä¸èƒ½ &lt; 0ï¼Œä¸€ä¸ªå†…ç½®åŒæ­¥ç±»ï¼Œç»§æ‰¿äºAQS,åŸºäºAQSçš„stateè¿›è¡Œè®¡æ•°ï¼Œç„¶åè¿›è¡Œcasæ“ä½œã€‚ cdl.await()12345678910111213141516 public void await() throws InterruptedException { sync.acquireSharedInterruptibly(1); } public final void acquireSharedInterruptibly(int arg) throws InterruptedException { if (Thread.interrupted()) throw new InterruptedException();//tryAcquireShared AQS çš„å…±äº«é”çš„æ–¹æ³•ï¼Œç„¶å CountDownLach çš„ Sync é‡å†™äº† æ­¤æ–¹æ³•ï¼Œè¿›è¡Œå†…éƒ¨çš„é€»è¾‘æ“ä½œ if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg); } tryAcquireShared(1) 1234protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } è·å– stateçš„å€¼ï¼ŒacquireSharedInterruptiblyï¼ˆï¼‰ä¸­if (tryAcquireShared(arg) &lt; 0){ doAcquireSharedInterruptibly(arg);} å¦‚æœstateå€¼ä¸ä¸º0çš„æ—¶å€™ï¼Œä»£è¡¨await()ä¹‹åçš„ä»£ç è¿˜ä¼šç»§ç»­é˜»å¡ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œã€‚å½“å‰è°ƒç”¨çš„awaitçš„çº¿ç¨‹ï¼Œå°±ä¼šæš‚æ—¶è¿›å…¥é˜Ÿåˆ—ä¸­æœ€# ä¸€çº§æ ‡é¢˜åè°ƒç”¨USAVE.park()æŒ‚èµ·ã€‚ä¸º0æ—¶å€™ï¼Œè¯´æ˜countDown çš„æ¬¡æ•°å·²ç»ç­‰äºäº†åˆå§‹åŒ–æ„é€ çš„æ—¶å€™ å‚æ•°å€¼äº†ã€‚æ­¤æ—¶å°±ä¼šä»é˜Ÿåˆ—å”¤é†’è°ƒç”¨awaitçš„çº¿ç¨‹ã€‚ cdl.countDown()sync.releaseShared(1)é‡Šæ”¾é”ï¼Œ 12345678public final boolean releaseShared(int arg) { if (tryReleaseShared(arg)) { doReleaseShared(); return true; } return false;} tryReleaseShared() æ–¹æ³•ï¼Œæ˜¯æœ¬ç±»ä¸­çš„Sysnc ä¸­çš„æ–¹æ³•ï¼Œçœ‹æ“ä½œæºç  1234567891011121314151617181920212223242526272829303132 private static final class Sync extends AbstractQueuedSynchronizer { private static final long serialVersionUID = 4982264981922014374L; Sync(int count) { setState(count); } int getCount() { return getState(); } protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } protected boolean tryReleaseShared(int releases) { // Decrement count; signal when transition to zero // ä¸€ä¸ªæ­»å¾ªç¯ for (;;) {// è·å–stateå€¼ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒä¸€æ¬¡countDownæ–¹æ³•å°±ä¼šï¼Œå¯¹state-1; int c = getState(); if (c == 0) return false; int nextc = c-1; if (compareAndSetState(c, nextc)) return nextc == 0; } } } å½“æ¯ä¸ªçº¿ç¨‹,è°ƒç”¨ä¸€æ¬¡countDown AQSçš„stateå€¼å°±ä¼šå‡1ï¼Œå¦‚æœåœ¨å‡1ä¹‹å‰ï¼Œstateå°±ä¸º0çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè¿›è¡Œé˜»å¡äº†ï¼Œæ¯”å¦‚ new CountDownLach(5) ,ä½†æ˜¯æœ‰6æ¡çº¿ç¨‹çš„æ—¶å€™ï¼Œç¬¬å…­æ¡è°ƒç”¨countDownçš„æ—¶å€™ï¼Œå°±ä¼š getState==0,ä½†æ˜¯ï¼Œè¿™ä¹‹å‰ï¼Œawaitåé¢çš„ä»£ç å·²ç»æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ ,ä¸‹é¢ä»£ç ä¸ä¼šè¿›å…¥doReleaseSharedï¼ˆï¼‰ å»å”¤é†’ä¸»çº¿ç¨‹ï¼Œç¬¬äº”å¤©çº¿ç¨‹å·²ç»å”¤é†’è¿‡äº†ã€‚ 1234if (tryReleaseShared(arg)) { doReleaseShared(); return true;} ï¼Œå¦‚æœè¿™æ—¶å€™ï¼Œç¬¬5æ¡çº¿ç¨‹æ¥è°ƒç”¨countDownçš„æ—¶å€™ï¼Œä¼šcaså»ä¿®æ”¹ï¼Œstateå€¼ï¼Œå¦‚æœstate-1=0æ—¶å€™ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ doReleaseShared() å”¤é†’é˜Ÿåˆ—ä¸­çš„ç¥çº¿ç¨‹äº†ã€‚æ­¤æ—¶awiteåé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œäº†ã€‚ æ€»ç»“ æµç¨‹å›¾ CountDownLach è®¡æ•°å™¨ CountDownLach çš„ä½¿ç”¨è¿‡ç¨‹æ–¹æ³•è°ƒç”¨ï¼Œåº•å±‚æºç å­¦ä¹ ã€‚ CountDownLachï¼š é€‚ç”¨äºï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¼€å¯å¤šä¸ªå­çº¿ç¨‹å»ç»Ÿè®¡æŸäº›ä¸åŒæ•°æ®çš„ç»“æœï¼Œç„¶åä¸»çº¿ç¨‹éœ€è¦å¯¹è¿™äº›ç»“æœè¿›è¡Œæ“ä½œçš„åœºæ™¯ã€‚ æºç æŸ¥çœ‹12345678// åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„stateCountDownLach cdl = new CountDownLach(2);// é˜»å¡çº¿ç¨‹ï¼Œè¿›å…¥é˜Ÿåˆ—å€™ç€ï¼Œç­‰å¾…å”¤é†’cdl.await();// å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹cdl.countDown(); æµ‹è¯•ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354/** * &lt;p&gt; * * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-02-18 13:05 */public class JdkCountDownLatch{ // åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„ state = 5 private static final CountDownLatch cdl = new CountDownLatch(5); private static volatile int i; static class Task implements Runnable { @Override public void run() { // æ¥ä¸€ä¸ªçº¿ç¨‹ state-1 // ç›´åˆ°ä¸º 0ï¼Œcdl.await(); åé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œã€‚ cdl.countDown(); ++i; System.out.println(i); } } public static void main(String[] args) { ExecutorService service = Executors.newCachedThreadPool(); // å¼€å¯5ä¸ªçº¿ç¨‹ for (int j = 0; j &lt; 5; j++) { service.execute(new Task()); } service.shutdown(); try { // çº¿ç¨‹è¿›å¦‚é˜Ÿåˆ—ç­‰å€™ cdl.await(); System.out.println(&quot;å­çº¿ç¨‹å¤„ç†ç»“æœï¼š&quot;+i); } catch (InterruptedException e) { e.printStackTrace(); } }} åº•å±‚ä»£ç éªŒè¯æŸ¥çœ‹ new CountDownLatch(5)12345678910111213141516171819202122232425262728293031323334353637public CountDownLatch(int count) { if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;); this.sync = new Sync(count);}// å†…éƒ¨ç±» Sync ç»§æ‰¿äºAQS è°ƒç”¨AQSçš„æ–¹æ³• è®¾ç½®å€¼stateçš„å€¼private static final class Sync extends AbstractQueuedSynchronizer { private static final long serialVersionUID = 4982264981922014374L; Sync(int count) { setState(count); } int getCount() { return getState(); } // è·å–å…±äº«é” æ“ä½œ protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } // é‡Šæ”¾å…±äº«é”ï¼Œè°ƒç”¨cutDown() çš„æ—¶å€™ protected boolean tryReleaseShared(int releases) { // Decrement count; signal when transition to zero for (;;) { int c = getState(); if (c == 0) return false; int nextc = c-1; if (compareAndSetState(c, nextc)) return nextc == 0; } }} çº¿ç¨‹æ•°ä¸èƒ½ &lt; 0ï¼Œä¸€ä¸ªå†…ç½®åŒæ­¥ç±»ï¼Œç»§æ‰¿äºAQS,åŸºäºAQSçš„stateè¿›è¡Œè®¡æ•°ï¼Œç„¶åè¿›è¡Œcasæ“ä½œã€‚ cdl.await()12345678910111213141516 public void await() throws InterruptedException { sync.acquireSharedInterruptibly(1); } public final void acquireSharedInterruptibly(int arg) throws InterruptedException { if (Thread.interrupted()) throw new InterruptedException();//tryAcquireShared AQS çš„å…±äº«é”çš„æ–¹æ³•ï¼Œç„¶å CountDownLach çš„ Sync é‡å†™äº† æ­¤æ–¹æ³•ï¼Œè¿›è¡Œå†…éƒ¨çš„é€»è¾‘æ“ä½œ if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg); } tryAcquireShared(1) 1234protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } è·å– stateçš„å€¼ï¼ŒacquireSharedInterruptiblyï¼ˆï¼‰ä¸­if (tryAcquireShared(arg) &lt; 0){ doAcquireSharedInterruptibly(arg);} å¦‚æœstateå€¼ä¸ä¸º0çš„æ—¶å€™ï¼Œä»£è¡¨await()ä¹‹åçš„ä»£ç è¿˜ä¼šç»§ç»­é˜»å¡ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œã€‚å½“å‰è°ƒç”¨çš„awaitçš„çº¿ç¨‹ï¼Œå°±ä¼šæš‚æ—¶è¿›å…¥é˜Ÿåˆ—ä¸­æœ€# ä¸€çº§æ ‡é¢˜åè°ƒç”¨USAVE.park()æŒ‚èµ·ã€‚ä¸º0æ—¶å€™ï¼Œè¯´æ˜countDown çš„æ¬¡æ•°å·²ç»ç­‰äºäº†åˆå§‹åŒ–æ„é€ çš„æ—¶å€™ å‚æ•°å€¼äº†ã€‚æ­¤æ—¶å°±ä¼šä»é˜Ÿåˆ—å”¤é†’è°ƒç”¨awaitçš„çº¿ç¨‹ã€‚ cdl.countDown()sync.releaseShared(1)é‡Šæ”¾é”ï¼Œ 12345678public final boolean releaseShared(int arg) { if (tryReleaseShared(arg)) { doReleaseShared(); return true; } return false;} tryReleaseShared() æ–¹æ³•ï¼Œæ˜¯æœ¬ç±»ä¸­çš„Sysnc ä¸­çš„æ–¹æ³•ï¼Œçœ‹æ“ä½œæºç  1234567891011121314151617181920212223242526272829303132 private static final class Sync extends AbstractQueuedSynchronizer { private static final long serialVersionUID = 4982264981922014374L; Sync(int count) { setState(count); } int getCount() { return getState(); } protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } protected boolean tryReleaseShared(int releases) { // Decrement count; signal when transition to zero // ä¸€ä¸ªæ­»å¾ªç¯ for (;;) {// è·å–stateå€¼ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒä¸€æ¬¡countDownæ–¹æ³•å°±ä¼šï¼Œå¯¹state-1; int c = getState(); if (c == 0) return false; int nextc = c-1; if (compareAndSetState(c, nextc)) return nextc == 0; } } } å½“æ¯ä¸ªçº¿ç¨‹,è°ƒç”¨ä¸€æ¬¡countDown AQSçš„stateå€¼å°±ä¼šå‡1ï¼Œå¦‚æœåœ¨å‡1ä¹‹å‰ï¼Œstateå°±ä¸º0çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè¿›è¡Œé˜»å¡äº†ï¼Œæ¯”å¦‚ new CountDownLach(5) ,ä½†æ˜¯æœ‰6æ¡çº¿ç¨‹çš„æ—¶å€™ï¼Œç¬¬å…­æ¡è°ƒç”¨countDownçš„æ—¶å€™ï¼Œå°±ä¼š getState==0,ä½†æ˜¯ï¼Œè¿™ä¹‹å‰ï¼Œawaitåé¢çš„ä»£ç å·²ç»æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ ,ä¸‹é¢ä»£ç ä¸ä¼šè¿›å…¥doReleaseSharedï¼ˆï¼‰ å»å”¤é†’ä¸»çº¿ç¨‹ï¼Œç¬¬äº”å¤©çº¿ç¨‹å·²ç»å”¤é†’è¿‡äº†ã€‚ 1234if (tryReleaseShared(arg)) { doReleaseShared(); return true;} ï¼Œå¦‚æœè¿™æ—¶å€™ï¼Œç¬¬5æ¡çº¿ç¨‹æ¥è°ƒç”¨countDownçš„æ—¶å€™ï¼Œä¼šcaså»ä¿®æ”¹ï¼Œstateå€¼ï¼Œå¦‚æœstate-1=0æ—¶å€™ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ doReleaseShared() å”¤é†’é˜Ÿåˆ—ä¸­çš„ç¥çº¿ç¨‹äº†ã€‚æ­¤æ—¶awiteåé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œäº†ã€‚ ::: hljs-center å…³æ³¨å…¬ä¼—å·:::","link":"/posts/7ac91ac6/"},{"title":"httpåè®®æ˜¯ç½‘é¡µå¼€å‘çš„å¿…å¤‡çŸ¥è¯†ï¼Œæ˜¯åŸºäºTCP&#x2F;IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ã€‚","text":"Http åè®®ç›¸å…³çŸ¥è¯†ç‚¹&emsp; httpåè®®æ˜¯ç½‘é¡µå¼€å‘çš„å¿…å¤‡çŸ¥è¯†ï¼Œæ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ã€‚ 1ã€HTTP åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼ŸHTTPåè®®æ˜¯åŸºäº å®¢æˆ·ç«¯/æœåŠ¡ç«¯ çš„æ¶æ„æ¨¡å‹ï¼›æ˜¯ä¸€ç§è¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚ 2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ1.è¯·æ±‚è¡Œ\\nè¯·æ±‚è¡ŒåŒ…æ‹¬äº†ï¼š è¯·æ±‚æ–¹æ³• url httpåè®®ç‰ˆæœ¬ ä¾‹å¦‚ï¼š 1234GET /write/edit/68 HTTP/1.1User-Agent: curl/7.16.3 libcurl/7.16.3 OpenSSL/0.9.7l zlib/1.2.3Host: www.memoryoverflow.cn....... 2.è¯·æ±‚å¤´éƒ¨è¯·æ±‚å¤´åŒ…å«çš„ä¸œè¥¿å°±å¾ˆå¤šå¯ä»¥è‡ªå®šä¹‰ï¼šè‡ªå¸¦ä¸€èˆ¬ä¼šæœ‰ date server content-type ç­‰å­—æ®µ 123456access-control-allow-credentials: trueaccess-control-allow-headers: Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers,Acceptaccess-control-allow-methods: GET, POST, PATCH, DELETE, PUT, OPTIONScontent-type: application/json;charset=UTF-8date: Sat, 28 Sep 2019 03:59:55 GMTserver: nginx/1.12.2\\nstatus: 200 3.ç©ºè¡Œç©ºè¡Œï¼Œè¯·æ±‚å¤´éƒ¨åé¢çš„ç©ºè¡Œæ˜¯å¿…é¡»çš„ï¼›å³ä½¿ç¬¬å››éƒ¨åˆ†çš„è¯·æ±‚æ•°æ®ä¸ºç©ºï¼Œä¹Ÿå¿…é¡»æœ‰ç©ºè¡Œã€‚ 4.è¯·æ±‚æ•°æ® è¯·æ±‚æ•°æ®å°±æ˜¯ï¼šå®¢æˆ·ç«¯äºæœåŠ¡ç«¯äº¤æµæ—¶å€™ï¼Œæ‰€æºå¸¦çš„å‚æ•°å†…å®¹ 1id=68&amp;type=intenet ä¸€ä¸ªHTTPçš„è¯·æ±‚ä¾‹å­ 1234POST /write/edit/68 http1.1\\nHost:www.memoryoverflow.cn\\nUser-Agent:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1;Content-Type:application/x-www-form-urlencodedConnection: Keep-Aliveid=68 HTTPå“åº”ï¼šå“åº”æŠ¥æ–‡åŒ…æ‹¬å››éƒ¨åˆ†ï¼šçŠ¶æ€è¡Œï¼Œæ¶ˆæ¯æŠ¥å¤´ ç©ºè¡Œ å“åº”å†…å®¹å¦‚å›¾æ‰€ç¤ºï¼š 3ã€HTTP å®¢æˆ·ç«¯äºæœåŠ¡ç«¯çš„äº¤æµè¿‡ç¨‹ï¼Ÿæ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ï¼›å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼Œé»˜è®¤ç«¯å£æ˜¯ 80ï¼‰â€”â€“ å»ºç«‹TCPè¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ â€”-&gt; æœåŠ¡ç«¯â€”-æ–­å¼€è¿æ¥ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰â€“&gt;å“åº”å®¢æˆ·ç«¯ï¼ŒHttp(åº”ç”¨å±‚)â€”&gt;TCP/UDP(ä¼ è¾“å±‚)â€”&gt;ç½‘ç»œå±‚ï¼ˆIPï¼‰â€”&gt; é“¾è·¯å±‚(ç½‘ç»œç¡¬ä»¶) 1.TCPçš„ä¸‰æ¬¡æ¡æ‰‹å®¢æˆ·ç«¯äºæœåŠ¡ç«¯å»ºç«‹è¿æ¥ä¹‹å‰éœ€è¦è¿›è¡Œé€šä¿¡æµ‹è¯•è¿æ¥ 2.TCPçš„å››æ¬¡æŒ¥æ‰‹å½“å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ•°æ®å¤„ç†å®Œæˆåï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€å½“å‰è¿æ¥è¯·æ±‚ç¬¬ä¸€æ¬¡ï¼šå®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼ŒFIN=1,seq=u;å®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ç¬¬äºŒæ¬¡ï¼šæœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾ä¿¡æ¯ï¼Œå“åº”ç¡®è®¤ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚ç¬¬ä¸‰æ¬¡ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾ä¿¡æ¯ï¼ŒFIN=1ï¼Œack=u+1ï¼Œï¼› ç¬¬å››æ­¤ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šç¡®è®¤æ¶ˆæ¯åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤æ¶ˆæ¯ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚ **æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ— *âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚ 4ã€å¸¸ç”¨çš„HTTPæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ POSTï¼šå¸¸ç”¨äº ä¼ è¾“æ•°æ®åˆ°æœåŠ¡ç«¯ GETï¼šä¸€èˆ¬ç”¨äº å‘æœåŠ¡å»è·å–æ¶ˆæ¯ DELETEï¼š ç”¨äºåˆ é™¤æ•°æ®/æ–‡ä»¶è¯·æ±‚ PUT:å¸¸ç”¨äºæ•°æ®ä¿®æ”¹ HEAD:ç±»ä¼¼äº GET è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´ OPTIONS:æŸ¥è¯¢ç›¸åº”URIæ”¯æŒçš„HTTPæ–¹æ³• 5ã€HTTP å¸¸è§çŠ¶æ€ç ï¼Œæœ‰å“ªäº›ï¼Ÿ 200 è¯·æ±‚æˆåŠŸ 301 èµ„æºç½‘é¡µè¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒURL 404 è¯·æ±‚çš„è·¯å¾„é”™è¯¯ï¼Œä¸å­˜åœ¨ 500 æœåŠ¡å™¨æŠ›å‡ºå¼‚å¸¸ï¼ŒæœåŠ¡å™¨é”™è¯¯ 503 æœåŠ¡å™¨ä¸å­˜åœ¨ï¼Œè¿æ¥ä¸ä¸ŠæœåŠ¡å™¨ 400 å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯ 401 æ²¡æœ‰æƒé™ï¼Œæœªè¿›è¡Œèº«ä»½è®¤è¯ 405 è¯·æ±‚æ–¹æ³•é”™è¯¯ æ¯”å¦‚ åå°æŒ‡å®šçš„HTTPæ–¹æ³•ä¸º POST ,å®¢æˆ·ç«¯å‘é€GETè¯·æ±‚ 504 ç½‘å…³é”™è¯¯ 6ã€HTTP ä¸ http æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿhttp:1.é€šä¿¡ä¸åŠ å¯†ï¼Œå†…å®¹å¯èƒ½è¢«çªƒå¬2.ä¸éªŒè¯é€šä¿¡æ–¹èº«ä»½ï¼Œå¯èƒ½é­åˆ°ä¼ªè£…3.æ— æ³•éªŒè¯æŠ¥æ–‡å®Œæ•´æ€§ï¼Œå¯èƒ½è¢«ç¯¡æ”¹http:æ˜¯ä¸€ä¸ªåŠ å¯†çš„å®‰å…¨åè®® 7ã€Httpåè®®æœ‰å“ªäº›ç‰¹å¾?1.æ— çŠ¶æ€ï¼š&emsp; HTTPåè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿« 2.æ— è¿æ¥&emsp;æ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ 3.åª’ä½“ç‹¬ç«‹&emsp;è¿™æ„å‘³ç€ï¼Œåªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çŸ¥é“å¦‚ä½•å¤„ç†çš„æ•°æ®å†…å®¹ï¼Œä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥é€šè¿‡HTTPå‘é€ã€‚å®¢æˆ·ç«¯ä»¥åŠæœåŠ¡å™¨æŒ‡å®šä½¿ç”¨é€‚åˆçš„MIME-typeå†…å®¹ç±»å‹ã€‚","link":"/posts/9c4d68f1/"},{"title":"ReentrantLockå¯é‡å…¥é”,æºç å­¦ä¹ ï¼Œåˆ†ææ‰§è¡ŒåŸç†","text":"ReentrantLock&emsp; ReentrantLock åœ¨1.6 ä¹‹å‰ï¼Œæ€§èƒ½æ¯” Synchronizedï¼Œå¥½å¾ˆå¤šï¼Œå› ä¸ºå®ç°åŒæ­¥ï¼Œä¸éœ€è¦åˆ°jvmçš„æ“ä½œç³»ç»Ÿä¸­å¤„ç†ï¼Œåœ¨javaä»£ç å±‚é¢å°±å¯ä»¥å¤„ç†æ‰ï¼Œè€ŒSynchronized æ˜¯éœ€è¦åˆ°æ“ä½œç³»ç»Ÿå¤„ç†ã€‚åœ¨1.6ä¹‹åï¼ŒSynchronized è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨æ€§ä¸Šæ²¡æœ‰å¤ªå¤šçš„å·®åˆ«ã€‚ ReentrantLockæºç å­¦ä¹ 1ã€ReentrantLock æ„é€ å‡½æ•°&emsp; æˆ‘ä»¬å¯ä»¥çœ‹æºç /jdk.chmï¼ŒçŸ¥é“ ReentrantLock æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ã€‚ ä»£ç ä¸Šçš„é”å–å†³äºç¨‹åºå‘˜çš„å‚æ•°å¤„ç†ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ï¼Œä¸å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ éå…¬å¹³é”ï¼ŒReentrantLock(true),ä½¿ç”¨çš„å°±æ˜¯å…¬å¹³é”ã€‚ åœ¨è¿™ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€è¾¹æºç ï¼Œå¯¹å®ƒçš„æ•´ä½“è¿‡ç¨‹æœ‰ä¸ªå¤§è‡´çš„äº†è§£ã€‚å…ˆçœ‹çœ‹ è¿™å‡ ä¸ªç±»æœ‰äº›ä»€ä¹ˆ åŠ é”è¿‡ç¨‹ å¦‚å›¾ï¼š ä»£ç åˆ†æ 1.1 ReentrantLock å…¬å¹³é”1.11 new ReentrantLock(true) æ„é€ static ReentrantLock lock = new ReentrantLock(true)æœ‰ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æœ‰å‚çš„ä¸€ä¸ªæ— å‚ï¼Œæ ¹æ®å‚æ•° å®åŠ›åŒ–ä¸€ä¸ªå…¬å¹³é”/éå…¬å¹³é”ã€‚ 1.12 åŠ é”è¿‡ç¨‹ new FairSync().lock()åŠ é”è¿‡ç¨‹å›¾è§£ æ¥ä¸‹æ¥çœ‹lock()æ–¹æ³• 1234567891011final void lock() { acquire(1);} public final void acquire(int arg) { if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } tryAcquire(int acquires) å°è¯•åŠ é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344protected final boolean tryAcquire(int acquires){ // å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); /** * getState() è·å–é”çš„çŠ¶æ€ï¼ŒAQSä¸­çš„ä¸€ä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡ï¼Œæ ¹æ®æ­¤å˜é‡æ¥åˆ¤æ–­é”çš„çŠ¶æ€ã€‚ * å¦‚æœ çŠ¶æ€ä¸º0ï¼Œè¯´æ˜é”æ­¤æ—¶æ˜¯è‡ªç”±çŠ¶æ€ï¼Œå¦‚æœä¸ä¸º0ï¼Œå¹¶ä¸”æ¥å–é”çš„çº¿ç¨‹ä¸ä¸ºå½“å‰çº¿ç¨‹ï¼Œ * çš„è¯ï¼Œå°±å–é”å¤±è´¥ å°±ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾… acquireQueued(addWaiter(Node.EXCLUSIVE), arg) * å¦åˆ™å°±æ˜¯ï¼ŒçŠ¶æ€++ï¼Œè¯´æ˜è‡ªæ—‹å¤šäº†ä¸€æ¬¡ */ int c = getState(); if (c == 0) { /** * hasQueuedPredecessors() * åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡ï¼Œæ˜¯å¦æœ‰çº¿ç­‰å¾…çš„çº¿ç¨‹ * compareAndSetState(0, acquires)ï¼š * å¦‚æœä¸éœ€è¦è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œåˆ™è¿›è¡ŒCASä¿®æ”¹çŠ¶æ€ä¸º1 å–é”æ“ä½œã€‚ * * setExclusiveOwnerThread(current)ï¼š * å°†è·å¾—é”çš„çº¿ç¨‹è®¾ç½®ä¸ºè‡ªå·± * * */ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { // çº¿ç¨‹é‡å…¥å–é”ï¼Œstate+1 int nextc = c + acquires; if (nextc &lt; 0) throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; } return false;} è·å¾—é”è¿”å›true,æ–¹æ³•ä¸€å±‚å±‚è¿”å›ï¼Œæ¥ç€å°±ä¼šæ‰§è¡Œ.lock()æ–¹æ³•ä¸‹çš„ä¸šåŠ¡ä»£ç ã€‚ åœ¨å¹¶å‘çš„çŠ¶å†µä¸‹å¹¶ä¸”å­˜åœ¨ç«äº‰çš„æ—¶å€™ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè·å¾—äº†é”ï¼Œåœ¨ä¸šåŠ¡æœªå®Œæˆä¹‹å‰ï¼Œé”æœªé‡Šæ”¾çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹æ¥å¼ºé”çš„æ—¶å€™ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿç­‰å€™å¹¶ä¸”ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå› ä¸ºæ˜¯å…¬å¹³é”æ‰€ä»¥å…ˆè¿›å»çš„ä¼šå…ˆè·å¾—é” hasQueuedPredecessors()æ–¹æ³•&emsp; 12345678910public final boolean hasQueuedPredecessors() { // The correctness of this depends on head being initialized // before tail and on head.next being accurate if the current // thread is first in queue. Node t = tail; // Read fields in reverse initialization order Node h = head; Node s; return h != t &amp;&amp; ((s = h.next) == null || s.thread != Thread.currentThread());} å› ä¸ºç¬¬ä¸€ä¸ªè¿›å…¥çš„æ—¶å€™ aqsä¸­çš„è¿™ä¸ª tail å’Œ head è‚¯å®šæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ h != t å¿…å®šè¿”å›falseã€‚æ‰€ä»¥ä¸åŠ é”ã€‚ çº¿ç¨‹çš„å¹¶å‘çŠ¶å†µï¼Œå¦‚æœä¸å­˜åœ¨ç«äº‰ï¼Œäº¤æ›¿æ‰§è¡Œé‚£è‚¯å®š ä¸ä¼šç”¨åˆ°AQSçš„è¿™ä¸ªé˜Ÿåˆ—æ“ 1.13 å…¥é˜Ÿè¿‡ç¨‹1ã€addWaiter(Node node)å°†èŠ‚ç‚¹åŒ…è£…æˆNode 123456789101112131415161718192021222324252627private Node addWaiter(Node mode) { Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure /** * &lt;br&gt; * å½“ç¬¬ä¸€æ¡çº¿ç¨‹å…¥é˜Ÿçš„æ—¶å€™ï¼Œä¸ä¼šèµ°è¿™ä¸ªæ–¹æ³• * å½“ç¬¬äºŒæ¡çº¿ç¨‹æ¥çš„æ—¶å€™ï¼› * å°¾éƒ¨èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå½“å‰çº¿ç¨‹åŒ…è£…çš„èŠ‚ç‚¹node.pred = pred å°±æ˜¯ä¸Šä¸€ä¸ªçº¿ç¨‹åŒ…è£…çš„Node * compareAndSetTail(pred, node) * å°† AQS çš„ tail = å½“å‰çº¿ç¨‹åŒ…è£…çš„èŠ‚ç‚¹node * node.next = å½“å‰çº¿ç¨‹åŒ…è£…çš„èŠ‚ç‚¹node * */ Node pred = tail; if (pred != null) { node.prev = pred; if (compareAndSetTail(pred, node)) { pred.next = node; return node; } } // ç¬¬ä¸€æ¡çº¿ç¨‹å…¥é˜Ÿæ—¶å€™ èµ°è¿™ä¸ªæ–¹æ³• enq(node); return node;} 2ã€enq(node)çº¿ç¨‹ç¬¬ä¸€æ¬¡å…¥é˜Ÿçš„æ—¶å€™ï¼šèµ°enq 123456789101112131415161718192021222324252627282930313233343536373839private Node enq(final Node node) { // æ­»å¾ªç¯ for (;;) { Node t = tail; // ç¬¬ä¸€æ¬¡å¾ªç¯ /** * &lt;br&gt; * ç¬¬ä¸€æ¬¡å¾ªç¯ä¸ä¼š å°¾éƒ¨èŠ‚ç‚¹å¿…ç„¶æ˜¯ç©ºçš„ã€‚ * æ‰€ä»¥åˆå§‹åŒ–ä¸€ä¸ª ä»€ä¹ˆéƒ½ä¸è£…çš„Node å¹¶ä¸”setHead * AQSçš„ head = new Node(); å¦‚æœnodeä¸ºç©ºï¼Œåœ¨acquireQueuedä¼šæŠ¥ç©ºæŒ‡é’ˆã€‚ * * æ­¤æ—¶ AQSçš„ head = tail = new Node(); * * * * å› ä¸ºæ˜¯æ­»å¾ªç¯ï¼šæ¥ç€ç¬¬äºŒæ¬¡éå† * * æ­¤æ—¶ t==null ä¸æˆç«‹ èµ° else * * node.pred = AQSçš„ head * * compareAndSetTail(t, node) * è®¾ç½® AQSçš„ tail = node(å½“å‰çº¿ç¨‹åŒ…è£…çš„node) * node.next æŒ‡å‘è‡ªå·±ï¼› * */ if (t == null) { // Must initialize if (compareAndSetHead(new Node())) tail = head; } else { node.prev = t; if (compareAndSetTail(t, node)) { t.next = node; return t; } } }} 3ã€acquireQueued 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/** * å½“çº¿ç¨‹åŒ…è£…æˆèŠ‚ç‚¹çš„æ—¶å€™å°±ä¼šè°ƒç”¨æ­¤æ–¹æ³• * @param node * @param arg * @return */final boolean acquireQueued(final Node node, int arg) { boolean failed = true; try { boolean interrupted = false; for (;;) { /** * &lt;br&gt; * * è·å–addWaiteråŒ…è£…çš„èŠ‚ç‚¹node,çš„å±± ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚ * åœ¨ ç¬¬ä¸€ä¸ªçº¿ç¨‹å…¥é˜Ÿçš„æ—¶å€™ head å·²ç»åˆå§‹åŒ–äº†ï¼Œä¸º new Node(),ç¬¬ä¸€ä¸ª * node.pred = new Node();æ­¤æ—¶ ä¸ä¼šç©ºï¼Œä¸æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼› * * ç¬¬ä¸€æ¡çº¿ç¨‹æ¥çš„æ—¶å€™ï¼Œp == head æˆç«‹ï¼Œä¼šå†æ¬¡èµ°ä¸€é tryAcquire(arg) * å¦‚æœè·å¾—é”æˆåŠŸï¼Œæ­¤æ—¶ä¿®æ”¹å¤´èŠ‚ç‚¹ ä¸º node , p.next æŒ‡å‘ä¸ºç©ºï¼Œæ­¤æ—¶ï¼Œé˜Ÿåˆ—æ²¡æœ‰æ’é˜Ÿçš„çº¿ç¨‹äº†ã€‚ * * a. ç¬¬ä¸€æ¡çº¿ç¨‹æ¥æ’é˜Ÿæ—¶å€™ * å‡å¦‚ tryAcquire(arg) ä¸æˆç«‹ï¼Œèµ° shouldParkAfterFailedAcquire * * * bã€ç¬¬äºŒæ¡çº¿ç¨‹æ¥çš„æ—¶å€™ï¼Œæ­¤æ—¶è·å–é”çš„çº¿ç¨‹è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œé˜Ÿåˆ—ä¸­å·²ç»æœ‰ä¸€æ¡äº†ï¼Œæˆ‘æ˜¯æ¥ç¬¬äºŒä¸ªæ’é˜Ÿçš„ * æ¬¡æ¡çº¿ç¨‹çš„node.pred æŒ‡å‘çš„å°±æ˜¯ ä¸Šä¸€ä¸ªå…¥é˜Ÿçš„Nodeã€‚ addWaiter()æ–¹æ³•ä¸­å¤„ç†çš„ * æ­¤æ—¶ p == head &amp;&amp; tryAcquire(arg) ä¹Ÿä¸æˆç«‹ï¼Œç»§ç»­èµ° shouldParkAfterFailedAcquire * * * */ final AbstractQueuedSynchronizer.Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC failed = false; return interrupted; } if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; } } finally { if (failed) cancelAcquire(node); }} 4ã€shouldParkAfterFailedAcquire(p, node) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { /** * &lt;br&gt; * a. å‡å¦‚ ç¬¬ä¸€æ¡çº¿æ¥æ’é˜Ÿçš„æ—¶å€™ï¼ŒtryAcquire(arg) ä¸æˆç«‹ï¼›åˆ™ pred = new Node() * æ­¤æ—¶è¿™ä¸ª waitStatus æ˜¯åˆå§‹å€¼0ï¼› * æ‰€ä»¥ compareAndSetWaitStatus(pred, ws, SIGNAL); * å°† pred çš„waitStatus ä¿®æ”¹ä¸º SIGNAL = -1 */ /** * &lt;br&gt; * b. ç¬¬äºŒæ¡çº¿ç¨‹è¿›æ¥æ’é˜Ÿçš„æ—¶å€™ï¼Œæ­¤æ—¶pred å°±æ˜¯ä¸Šä¸€ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªnode * ä¸Šä¸€æ¡nodeè¿›æ¥çš„æ—¶å€™ï¼Œpred.waitStatus å·²ç»è¢«ä¿®æ”¹ä¸º -1äº†ã€‚ * æ‰€ä»¥ ws == Node.SIGNAL æˆç«‹ è¿”å› true,parkAndCheckInterrupt() é˜»å¡å½“å‰çº¿ç¨‹ * * * * */ int ws = pred.waitStatus; if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; if (ws &gt; 0) { /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node.prev = pred = pred.prev; } while (pred.waitStatus &gt; 0); pred.next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); } return false; } 5ã€å…¥é˜ŸèŠ‚ç‚¹ æµç¨‹å›¾ 1.14 è§£é”è¿‡ç¨‹ new FairSync().lock()unlock-&gt;sync.releas(1)-&gt;tryRelease(1) 1ã€release(1) 12345678910 public final boolean release(int arg) { // å¦‚æœcas æˆåŠŸï¼Œå”¤é†’é˜Ÿåˆ—çš„ä¸­ä¸­çš„æ’é˜Ÿçº¿ç¨‹ if (tryRelease(arg)) { Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; } return false;} 2ã€tryRelease(arg) 123456789101112131415161718 protected final boolean tryRelease(int releases) {// è¯»å–state å€¼ï¼Œå‡1ï¼ŒåŠ é”çš„æ—¶å€™å¦‚æœæ²¡æœ‰è‡ªæ—‹ å°±æ˜¯1ï¼Œæœ‰è‡ªæ—‹å¤šä¸€æ¬¡ä¹Ÿå°±å¤šåŠ ä¸€æ¬¡1 int c = getState() - releases; // åˆ¤æ–­ å½“å‰çº¿ç¨‹ æ˜¯ä¸æ˜¯è‡ªå·±çš„çº¿ç¨‹ if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; // stateä¸º0 ï¼Œ æ¶ˆé™¤æŒæœ‰é”çš„çº¿ç¨‹ï¼Œä¿®æ”¹setStateçš„å€¼ if (c == 0) { free = true; setExclusiveOwnerThread(null); } setState(c); return free; } 3ã€unparkSuccessor(Node) 12345678910111213141516171819202122232425262728293031private void unparkSuccessor(Node node) { /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; if (ws &lt; 0) ä¿®æ”¹ä¸ºåˆå§‹å€¼ compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node.next; // head.next æŒ‡å‘çš„å°±æ˜¯ é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªnodeï¼› // çº¿ç¨‹ waitStatus&gt;0 çº¿ç¨‹è¢«ä¸­æ–­ ç«å–æ¶ˆäº†ï¼Œéå†æ‰¾ æœ€è¿‘ä¸€ä¸ª å”¤é†’ if (s == null || s.waitStatus &gt; 0) { s = null; // ç¬¬ä¸€ä¸ªè¢«å”¤é†’äº†ï¼Œå”¤é†’é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œéå†æŸ¥æ‰¾ æœ€å‰çš„ waitStatusä¸º&lt;= 0çš„èŠ‚ç‚¹ï¼Œå°†å…¶å”¤é†’ï¼Œè°ƒç”¨ã€‚ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; } // è§£é™¤é˜»å¡ if (s != null) LockSupport.unpark(s.thread);}","link":"/posts/84b802e7/"},{"title":"dockeréƒ¨ç½²SprignBooté¡¹ç›®,æ³¨æ„äº‹é¡¹","text":"Docker ç¬”è®° Linux CentOs ä¸‹å®‰è£… Docker1ã€å®‰è£…ä¸å¯åŠ¨å‚è€ƒåœ°å€ï¼ˆå®˜ç½‘ï¼‰ï¼›ä¾ç…§ç€ç½‘å€å³å¯å®‰è£…ã€‚ 2ã€Docker å¸¸ç”¨å‘½ä»¤ 2.1 æ‹‰å–é•œåƒé•œåƒåœ°å€ï¼šhttp://hub.docker.com/ 1&gt;docker pull é•œåƒåœ°å€ 2.2 æŸ¥çœ‹è¿è¡Œå®¹å™¨123&gt;docker ps&gt;docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åŒ…æ‹¬ä¸è¿è¡Œçš„ 2.3 è¿›å…¥å®¹å™¨1&gt;docker exec -it å®¹é½id bash 2.4 åˆ é™¤å®¹å™¨123&gt;docker rm å®¹å™¨id&gt;docker rm $(docker ps -aq) # åˆ é™¤æ‰€æœ‰å®¹å™¨&gt;docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq) #åœç”¨å¹¶åˆ é™¤å®¹å™¨ 2.5 åˆ é™¤é•œåƒ1&gt;docker rmi é•œåƒID 2.6 æŸ¥çœ‹æ‰€æœ‰çš„é•œåƒ1&gt;docker images 2.7 è¿è¡Œé•œåƒ12&gt;docker run é•œåƒåç§° # æœ€ç®€å•çš„ å‰å°è¿è¡Œ&gt;docker run -d -p æœ¬æœºç«¯å£ï¼ˆè®¿é—®ç«¯å£ï¼‰ï¼šå®¹å™¨ç«¯å£ é•œåƒåç§° -d: å®¹å™¨åå°è¿è¡Œ -p:æŒ‡å®šæœ¬æœºè®¿é—®å†…éƒ¨ç«¯å£çš„æ˜ å°„ 3ã€docker å®‰è£…tomcatè¿›å…¥ç½‘å€ http://hub.docker.com/ æœç´¢Tomcat å¤åˆ¶å‘½ä»¤ï¼š 1docker pull tomcat:jdk8 1docker images å¯åŠ¨ Tomcat: 1docker run -d -p 1010:8080 tomcat å¯åŠ¨æˆåŠŸ è®¿é—®ï¼šhttp://www.memoryoverflow.cn:1010/ è¦ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ 1docker exec -it å®¹å™¨ID bash 1docker exec -it 594014aedf68 bash è¿›å…¥ tomcat å†…éƒ¨ å¯ä»¥å¯¹ conf/server.xml æ–‡ä»¶=è¿›è¡Œä¿®æ”¹ã€‚ 4ã€docker æ„å»ºå¹¶ä¸”å‘å¸ƒè‡ªå·±çš„SpringBooté¡¹ç›® æ‰¾åˆ°ä¸€ä¸ªä½ç½® å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ æ­¤å¤„åœ¨ mkdir /usr/local/docker/demo cd /usr/local/docker/demo å»ºç«‹ä¸€ä¸ªæ–‡ä»¶Dockerfile touch Dockerfile è‡ªå·±å»ºç«‹ä¸€ä¸ªSpringBooté¡¹ç›® å†™ä¸€ä¸ªController æµ‹è¯• åœ¨ pom.xml æ–‡ä»¶ä¸­åŠ å…¥ é…ç½® 123&lt;properties&gt; &lt;docker.image.prefix&gt;springboot&lt;/docker.image.prefix&gt;&lt;/properties&gt; åœ¨è¿™ä¸­é—´åŠ å…¥ï¼š â€¦â€¦ 12345678910111213141516171819202122&lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&lt;/plugin&gt;&lt;!-- Docker maven plugin --&gt;&lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;configuration&gt; &lt;imageName&gt;${docker.image.prefix}/${project.artifactId}&lt;/imageName&gt; &lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt; &lt;resources&gt; &lt;resource&gt; &lt;targetPath&gt;/&lt;/targetPath&gt; &lt;directory&gt;${project.build.directory}&lt;/directory&gt; &lt;include&gt;${project.build.finalName}.jar&lt;/include&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/configuration&gt;&lt;/plugin&gt;&lt;!-- Docker maven plugin --&gt; ç„¶å å°†é¡¹ç›®æ‰“åŒ… æ¯”æˆ‘æˆ‘é¡¹ç›®åä¸ºï¼šdemo.jar æ¥ç€ vim Dockerfile 123456789101112# ä¾èµ–äºjdk è¿è¡Œç¯å¢ƒ,å¦‚æœè¿˜æ²¡æœ‰å®‰è£… ç¬¬ä¸€æ¬¡æ„å»ºä¼šè‡ªåŠ¨å®‰è£…FROM java:8# ä½œè€…MAINTAINER æ°¸å¥&lt;memoryoverflow@163.com&gt;#ä¸€ä¸ªç‰¹åˆ«æŒ‡å®šçš„ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®VOLUME /tmp# æ‹·è´æ–‡ä»¶å¹¶ä¸”é‡å‘½åä¸ºè‡ªå·±è¦å®šä¹‰çš„ADD demo.jar app.jar # å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥java -jar xxxx.jarï¼Œä¸ºäº†ç¼©çŸ­ Tomcat çš„å¯åŠ¨æ—¶é—´ï¼Œæ·»åŠ java.security.egdçš„ç³»ç»Ÿå±æ€§æŒ‡å‘/dev/urandomä½œä¸º ENTRYPOINTENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;] âš ï¸ æ‰“å¥½çš„é¡¹ç›®jar åŒ…è¦å’Œ Dockerfile æ–‡ä»¶åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œä¸ç„¶æ‰§è¡Œ build å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šå‡ºç° not fount jar é”™è¯¯ã€‚ æ„å»ºé•œåƒ 1docker build -t demo . demo: å°±æ˜¯é•œåƒå è‡ªå®šä¹‰ æ³¨æ„ ç©ºæ ¼ . æ„å»ºæˆåŠŸ æŸ¥çœ‹é•œåƒ 1docker images è¿è¡Œé•œåƒ 1docker run -d -p 1595:1595 demo -d: åå°è¿è¡Œ -p: ç«¯å£æ˜ å°„ å°†ç¬¬äºŒä¸ªä½ jar è¿è¡Œçš„ç«¯å£ï¼Œæ˜ å°„åˆ°ç¬¬ä¸€ä¸ªï¼Œç»™å¤–éƒ¨äº¤äº’è®¿é—®çš„ç«¯å£ demo: å°±æ˜¯build çš„ é•œåƒåå­— è¿è¡ŒæˆåŠŸï¼šæµè§ˆå™¨è®¿é—®ï¼šhttp://www.memoryoverflow.cn:1595/hello åˆ°æ­¤ é¡¹ç›®éƒ¨ç½²æˆåŠŸã€‚ æ—¥å¿—æŸ¥çœ‹ï¼š 1docker logs -f -t --tail -f å®¹å™¨Id 5ã€docker JAR é¡¹ç›®æ›´æ–°5.1 docker æ›¿æ¢ jar æ›´æ–°ã€‚ æ¥ç€ä¸Šé¢çš„demoæ“ä½œã€‚docker ps æŸ¥çœ‹å®¹å™¨id ï¼Œæ‰¾æˆ‘æˆ‘ä»¬éƒ¨ç½²çš„é¡¹ç›®ï¼ŒJar é¡¹ç›®ã€‚ æ‰§è¡Œå‘½ä»¤ï¼šps exce -it å®¹å™¨Id bash ls -l æŸ¥çœ‹é¡¹ç›®å†…éƒ¨ç»“æ„ï¼Œå®¹å™¨å†…éƒ¨çš„ç»“æ„ç›®å½•ï¼Œæ¯ä¸ªå®¹å™¨çš„ç»“æ„ï¼Œéƒ½æ˜¯ç‹¬ç«‹å¼€çš„ï¼Œä¸å®¿ä¸»æœºçš„ç»“æ„ç›®å½•ä¸å…³è”ï¼Œåœ¨é¡¹ç›®å†…æ˜¯ä¸èƒ½ç›´æ¥è®¿é—® å®¿ä¸»æœºç»“æ„ç›®å½•çš„ã€‚ æœ‰ä¸ª App.jar å°±æ˜¯Dockerfile é‡Œé¢çš„ add å‘½å è‡ªå®šä¹‰çš„ app.jar ; æœ€åå°±æ˜¯è¿è¡Œçš„è¿™ä¸€ä¸ª app.jar åªè¦æ›¿æ¢æ‰è¿™ä¸ªapp.jar ç„¶åé‡å¯ 12docker restart å®¹å™¨Id æ›¿æ¢å‘½åï¼šå°†å®¿ä¸»æœºçš„ jar æ›´æ–°æ›¿æ¢åˆ° å®¹å™¨ä¸­çš„ jar æ–‡ä»¶ 123456docker cp æ–°jarçš„è·¯å¾„ å®¹å™¨ID:å®¹å™¨ä¸­çš„ç›®å½•app.jarä¾‹å¦‚ï¼š docker cp /opt/docker/appNew.jar å®¹å™¨ID:/app.jar è¿™æ ·å­å³å¯æ›¿æ¢æ›´æ–° jar æ–‡ä»¶ï¼Œç„¶åé‡å¯å³å¯ã€‚ å³å¯æ›´æ–°é¡¹ç›®ï¼Œä½†æ˜¯è¿™æ ·å­æ›´æ–°ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé¡¹ç›®æ˜¯åœ¨çº¿ä¸Šçš„è¯ï¼Œæ›´æ–°è¿‡ç¨‹é¡¹ç›®ä¼šåœ¨å¯åŠ¨æˆåŠŸå‰æ— æ³•è®¿é—®ã€‚è¿™æ ·å­ä¼šå½±å“ç”¨æˆ·ã€‚ 5.2 docker éƒ¨ç½² + nginx æ— ç¼æ›´æ–°ä¸ºäº†èƒ½å¤Ÿå¹³æ»‘æ›´æ–°ï¼Œä¸è®©å®¢æˆ·æ‰€çŸ¥ï¼Œå¯ä»¥é€šè¿‡nginx å¤„ç†ã€‚ ä¹‹å‰å·²ç»æ‰“å¥½äº†ä¸€ä¸ª jar ç«¯å£ä¸º 1595ï¼Œç°åœ¨å°†æ›´æ–°åçš„ jar å†ç»§ç»­æ‰“ä¸€ä¸ª é•œåƒï¼Œå¹¶å°†è¯¥j a r çš„ç«¯å£æ”¹ä¸º1596ï¼Œé•œåƒåä¸º demo_1596ã€‚ ç„¶åå°±æœ‰äº†ä¸¤ä¸ª é•œåƒä¸€ä¸ªæ˜¯ demo ä¸€ä¸ªæ˜¯demo_1596 å…¶ä¸­æœ€æ–°çš„æ˜¯åè€…ã€‚ Nginx é…ç½®ç«¯å£æ‹¦æˆªï¼Œä¹‹å‰çš„é¡¹ç›® demo é¡¹ç›®ç«¯å£ä¸º 1595ï¼Œç°åœ¨å°†å…¶ç›‘å¬çš„é¡¹ç›® è½¬å‘åˆ° ip:1596ç«¯å£ä¸Šï¼Œä¿å­˜é€€å‡ºã€‚ é‡å¯æ–°çš„ jar demo_1596ã€‚ é‡å¯æˆåŠŸåï¼Œreload nginx è®©å…¶ä¿®æ”¹çš„é…ç½®ä¿¡æ¯ç”Ÿæ•ˆã€‚ç”Ÿæ•ˆåï¼Œå°±å¯ä»¥ docker stop è€çš„å®¹å™¨Idäº† 6ã€docker å®¿ä¸»æœºç›®å½•ä¸å®¹å™¨ç›®å½•ï¼Œå…±äº«ã€‚-v å®¿ä¸»æœºç›®å½•:å®¹å™¨ä¸­çš„ç›®å½• 12docker run -d -p 8080:80 -v /home/file:/home/file app","link":"/posts/b742af1/"},{"title":"github å…‹éš†é€Ÿåº¦æ…¢ï¼Ÿæ€ä¹ˆè§£å†³ï¼Œä¸‰æ­¥ï¼Œé€Ÿåº¦è¾¾åˆ° Mib&#x2F;s","text":"github å…‹éš†dubboæºç çš„é€Ÿåº¦ï¼š ä¸‰æ­¥ä¹‹åæˆ‘ä»¬å†çœ‹çœ‹é€Ÿåº¦ ç¬¬ä¸€æ­¥ï¼šâ€‹ githubä¸Šæ‰¾åˆ°æƒ³è¦å…‹éš†çš„é¡¹ç›®ï¼Œç„¶åå…ˆfuck ä¸€ä¸‹ï¼Œå¯¹ä¸èµ·è¯´é”™äº†ï¼Œæ˜¯forkä¸€ä¸‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š fork ä¹‹åï¼Œè¿›å…¥è‡ªå·±çš„ä»“åº“çœ‹çœ‹ï¼Œåƒè¿™æ ·ï¼š ç¬¬äºŒæ­¥ï¼šâ€‹ åˆ°é©¬äº‘ä¸Šï¼Œæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œä¸ï¼Œæ˜¯ç äº‘â€“giteeã€‚æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œåƒè¿™æ ·ï¼š ä¸€ä¸ªdubboçš„æºç ï¼Œå€’å…¥åˆ°giteeä»“åº“10ç§’é’Ÿå°±æå®šã€‚ å¯¼å…¥ååœ¨è‡ªå·±çš„ä»“åº“ä¸­çœ‹çœ‹ï¼Œåƒè¿™æ ·ï¼š ç¬¬ä¸‰æ­¥ï¼šâ€‹ å¤åˆ¶æˆ‘ä»¬çš„ gitee ä¸Šçš„å…‹éš†åœ°å€ï¼š æ‰§è¡Œå‘½ä»¤ï¼š 1git clone https://gitee.com/lyj08/dubbo.git \bç°åœ¨\bå†çœ‹çœ‹å…‹éš†åˆ°å¤šå°‘äº†ï¼š å…¶å® 10åˆ†é’Ÿè¿‡å»äº†ï¼Œæ‰ä¸‹è½½é‚£ä¹ˆä¸€ç‚¹ç‚¹ï¼Œæœ‰æ—¶å€™è¿˜å¤±è´¥ï¼š çœ‹çœ‹è¿™ä¸ªgitee çš„é€Ÿåº¦ï¼š è¿™ä¸ªé€Ÿåº¦ï¼Œæ ¹æ®ä½ çš„ç½‘é€Ÿå†³å®šï¼š æœ€åä¸‰æ­¥æå®šï¼š github forké¡¹ç›®ã€‚ gitee æ–°å»ºä»“åº“ï¼Œä»github forkçš„åœ°å€ï¼Œå¯¼å…¥åˆ°giteeä¸­ã€‚ git clone giteeæ–°å»ºçš„åœ°å€ã€‚ å®‰å“ä¸­ï¼Œæ²¡æœ‰Spring?ä¸å­˜åœ¨çš„ã€‚ å¸¦ä½ åœ¨å®‰å“ä¸­å†™ä¸€ä¸ªIOCã€DIæ¡†æ¶ï¼Œå®ç°Spring çš„ä¾èµ–æ³¨å…¥ã€‚ å¹¶å‘å·¥å…·CountDownLatchæ˜¯å¦‚ä½•å®ç°é˜»å¡çš„ï¼Ÿ æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ŒMybatisçš„Mapper/Daoä¸ºä»€ä¹ˆå´å¯ä»¥@Autowiredæ³¨å…¥ï¼Ÿ MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼","link":"/posts/e4924e28/"},{"title":"æ‰‹æŠŠæ‰‹æ•™ä½ ï¼Œgitlab-ci&amp;gitlab-runner,å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œä¸ä¼šä¸è¦é’±ï¼Œä¼šä¹Ÿä¸è¦é’±ã€‚","text":"å‰è¨€Gitlab-ci å¯ä»¥ç®€åŒ–çš„é¡¹ç›®éƒ¨ç½²æ“ä½œï¼Œè®²ç©¶è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚åªéœ€è¦åŠ¨åŠ¨æ‰‹æŒ‡ï¼Œåœ¨ä½ çš„ç»ˆç«¯æ•²ä¸‹ 1git commit -m 'update' å³å¯æ›´æ–°ä»“åº“ä»£ç å¹¶ä¸”ç›´æ¥å‘å¸ƒåˆ°çº¿ä¸Šå»ã€‚ 1ã€æœ¬æœºç¯å¢ƒ Centos 7 Docker version 19.03.5 Gitlab-ce â€“version lastest æœ€æ–° Nginx ç‰ˆæœ¬ä¸é‡è¦ Gitlab-runner version 12.8 é™¤æ­¤ä¹‹å¤–ï¼šè¿˜éœ€è¦åœ¨éƒ¨ç½²çš„æœåŠ¡ä¸Šï¼Œå¤„ç†å¥½ å…å¯†ç ç™»é™†ã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè‡ªç„¶ä¸éœ€è¦æ‰‹åŠ¨æ“ã€‚åšå¥½å…å¯†ç™»é™†ï¼Œå°±å¯ä»¥å°†æ‰“åŒ…çš„distæ–‡ä»¶å¤¹ scp åˆ°æœåŠ¡å™¨ä¸Šçš„nginx æŒ‡å®šè·¯å¾„ï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚ 2ã€å®‰è£…è¯´æ˜2.1 nginx é…ç½®nginx å®‰è£…è¿‡ç¨‹ä¹Ÿç•¥è¿‡ã€‚vim nginx.conf,è¿›è¡Œä¿®æ”¹ã€‚ Nginx é…ç½®è·¯å¾„,è½¬å‘ï¼›ç„¶å éƒ¨ç½²è„šæœ¬ è¦å°† æ‰“åŒ…å¥½çš„dist æ–‡ä»¶å¤¹ï¼Œå¤åˆ¶åˆ°éƒ¨ç½²çš„æœåŠ¡å™¨ä¸Š/opt/project/web/æ­¤æ–‡ä»¶å¤¹ä¸‹ã€‚ nginx -s reload 2.2 éƒ¨ç½²çš„æœåŠ¡å™¨è¦åšssh å…å¯†ç ç™»é™† ç™»é™† è¦å°†é¡¹ç›®å‘å¸ƒçš„æœåŠ¡å™¨ä¸Šã€‚ è·Ÿç›®å½•ä¸‹å¤„ç† 12s sh-keygen -t rsa# è¾“å…¥åä¸€ç›´å›è½¦ é»˜è®¤æ“ä½œå³å¯ï¼Œä¸åŠ å¯†ï¼Œä¸æ”¹å˜ç”Ÿæˆæ–‡ä»¶çš„ä½ç½® æ‹·è´å…¬é’¥åˆ°è®¤è¯æ–‡ä»¶-å‘½ä»¤ï¼šcat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys Ssh localhost çœ‹çœ‹æœ‰æ²¡æœ‰æˆåŠŸ ssh-copy-id root@éƒ¨ç½²çš„æœåŠ¡å™¨ip æ­¤å¤„æˆ‘æ˜¯éƒ¨ç½²ç¯å¢ƒï¼Œå’Œ gitlab-runner ç¯å¢ƒåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸¤å°ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹æœ‰å³å¯é…ç½®å¯ä»¥ã€‚ scp çš„æ—¶å€™ æˆ‘å†™çš„æ˜¯ 122ç«¯å£ï¼Œè¿™æ˜¯æˆ‘çš„ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰æ”¹è¿‡ï¼Œé»˜è®¤æ˜¯22 1ssh-copy-id root@thisforyou.cn 2.3 åœ¨è‡ªå·±çš„gitlabä»“åº“ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¾‹å¦‚æœ¬æœºæµ‹è¯•çš„ã€‚ ä»“åº“ï¼š çº¿ä¸‹ç¯å¢ƒï¼š 2.3 ç¯å¢ƒå®‰è£…æœ¬æ–‡é‡ç‚¹åœ¨äº gitlab-runnnerçš„é›†æˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ‰€ä»¥dockerçš„å®‰è£…ï¼Œgitlabçš„å®‰è£…ï¼Œnginx çš„å®‰è£…è¿‡ç¨‹è·³è¿‡ã€‚ å½“ä½ çœ‹åˆ°æ­¤æ–‡çš„æ—¶å€™ï¼Œè¿™äº›ç¯å¢ƒç›¸ä¿¡ä½ ä¹Ÿåº”è¯¥æœ‰äº†ã€‚ä¸»è¦æ˜¯ gitlab-runnerçš„é…ç½®é—®é¢˜ã€‚ 2.21 åŸºäºDockerå®‰è£… gitlab-runner1ã€å®‰è£… ç›®å‰æˆ‘å®‰è£…çš„æ—¶å€™æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼š ç‰ˆæœ¬é€‰æ‹©ï¼Œç§»æ­¥â€”&gt; 1docker pull gitlab/gitlab-runner å¯åŠ¨å‘½ä»¤ï¼š æˆ‘è¿™æ˜¯ä¸€ä¸ªè„šæœ¬ 123456path=/usr/local/software/docker/gitlab-runnerdocker stop gitlab-runner &amp;&amp; docker rm gitlab-runnerdocker run -d --name gitlab-runner \\ --restart always \\ -v /usr/local/software/docker/gitlab-runner/config/gitlab-runner:/etc/gitlab-runner \\ 430012f3776d -v:å°†é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Š 430012f3776d: é•œåƒID å¯åŠ¨æˆåŠŸåï¼Œå¦‚æœ /usr/local/software/docker/gitlab-runner/config/gitlab-runner ä¸‹æ²¡æœ‰ é…ç½®æ–‡ä»¶ config.toml æ–‡ä»¶çš„è¯ã€‚ å…ˆåœæ‰ docker stop gitlab-runner &amp;&amp; docker rm gitlab-runner ç›´æ¥æ‰§è¡Œï¼š docker run -d gitlab-runner 430012f3776d ç„¶åå°†å®¹å™¨ä¸­çš„æ•°æ®å¤åˆ¶å‡ºæ¥ï¼šdocker cp gitlab-runner /etc/gitlab-runner :/usr/local/software/docker/gitlab-runner/config å†æ¬¡ æ‰§è¡Œå¯åŠ¨è„šæœ¬ã€‚ æˆ–è€…ç­‰ä¼šï¼Œåˆ°æ³¨å†Œçš„é‚£ä¸€æ­¥ä¹Ÿä¼šç”Ÿæˆçš„ã€‚ 2ã€å…ˆåˆ°ä»“åº“æ‹¿åˆ°Token 3ã€æ³¨å†Œ è¿›å…¥å®¹å™¨ï¼š 1docker exec -it gitlab-runner bash è¾“å…¥ 1gitlab-runner register Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/): è¾“å…¥ä½ çš„gi tlabè®¿é—®åœ°å€ï¼Œä¸Šä¸€æ­¥æœ‰è¯´åˆ° Please enter the gitlab-ci token for this runner: è®¿é—®token,å¦‚ä½•è·å–ä¸Šä¸€æ­¥æœ‰è¯´åˆ° Please enter the gitlab-ci description for this runner: è¾“å…¥æè¿°ï¼Œè‡ªå®šä¹‰ Please enter the gitlab-ci tags for this runner (comma separated): tags,åœ¨åé¢å†™è„šæœ¬çš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼Œè¯·å…ˆå†™ä¸Šï¼Œæˆ‘æ­¤å¤„åˆ†ä¸¤ä¸ªï¼Œæ˜¯åœ¨å†™è„šæœ¬çš„æ—¶å€™ï¼Œä¹Ÿåˆ†æ¥ä¸ª job æ¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿå¯¹åº”ä¸¤ä¸ªã€‚éå¿…è¦çš„ï¼Œgitlabä»“åº“ä¸Šå¯ä»¥è®¾ç½®ï¼Œæ˜¯ä¸æ˜¯è¦å¡«å†™ï¼Œtagsæ ‡ç­¾ä¸Šè¿è¡Œã€‚æ˜¯å¯ä»¥é™åˆ¶ Please enter the executor: docker+machine, custom, docker, virtualbox, ssh, docker-ssh+machine, kubernetes, docker-ssh, parallels, shell: è¿™é‡Œæ¯”è¾ƒé‡è¦ï¼Œåšjavaå¼€å‘çš„ï¼Œä¸»è¦è¿˜æ˜¯ä½¿ç”¨ sshã€shellã€Dockerå¤šï¼Œè‡³äºå…¶å®ƒé‚£äº›ä¸ªæš‚ä¸æã€‚ æ­¤å¤„æ„å»ºçš„æ˜¯ï¼Œvueé¡¹ç›®ï¼Œvueé¡¹ç›®æ‰€éœ€çš„æ˜¯ node ç¯å¢ƒã€‚å› ä¸ºè¿™ä¸ª gitlab-runneræ˜¯åŸºäºDockerå®‰è£…çš„ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼Œä½ çš„æœåŠ¡å™¨ä¸Šçš„ node , git éƒ½æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œå¦‚æœæ­¤æ—¶ï¼Œé€‰æ‹©çš„æ˜¯ shell æˆ–è€… ssh,çš„è¯ï¼Œåè¾¹å†™æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ npm run build å°±ä¼šæŠ¥ npm not found,å› ä¸ºæˆ‘çš„gitlab-runneræ˜¯Dockerè£…çš„ï¼Œæ‰€ä»¥æ²¡æœ‰é›†æˆï¼Œå…¶å®ƒç¯å¢ƒã€‚æ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒ ä¸º Docker ,å¯ä»¥å¾ˆå¥½çš„ç®¡ç†ä¾èµ–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±åšä¸€ä¸ªé•œåƒï¼Œå°†æ‰€éœ€ä¾èµ–æ”¾ä¸€èµ·ã€‚ ä¸­æ–‡å®˜ç½‘è¯´æ˜ Please enter the default Docker image (e.g. ruby:2.6): é€‰æ‹©äº†Docker æ‰§è¡Œï¼Œé‚£å°±éœ€è¦å†™ä¸Š éœ€è¦çš„docker é•œåƒï¼Œæ­¤å¤„éœ€è¦nodeç¯å¢ƒï¼Œå°±ç›´æ¥å¡«å†™ï¼šnode å³å¯ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šç‰ˆæœ¬å¥½ã€‚æ­¤å¤„ä¹Ÿå¯ä»¥é€šè¿‡ï¼Œè‡ªå·±å†™ä¸€ä¸ªDockerfileï¼Œåˆ¶ä½œä¸€ä¸ªå®¹å™¨ã€‚å°†ç¯å¢ƒä¾èµ–éƒ½å†™ä¸ŠDockerfileé‡Œã€‚ 4ã€æ­¤æ—¶æ˜¯å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼Œå›åˆ°gitlabä»“åº“çœ‹çœ‹ å·²ç»æˆåŠŸäº†ã€‚è¿™é‡Œç‚¹å‡»è¿›å»å¯ä»¥ä¿®æ”¹ä¸€äº›å±æ€§æ“ä½œ 5ã€ç¼–å†™è„šæœ¬ ç¼–å†™è„šæœ¬è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ç¼–å†™ï¼› 12345678910111213141516171819202122232425262728293031323334353637383940414243# å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹ä¸æ˜ç™½å…ˆä¸è¦ç´§ï¼Œå…ˆçœ‹æ˜ç™½å®ƒçš„å…³ç³»å…ˆ# ymlæ ¼å¼ç¼–å†™## stagesï¼šé€šä¿—è®²ï¼šå°±æ˜¯å°†é¡¹ç›®ï¼Œä»æ‰“åŒ…éƒ¨ç½²ï¼Œåˆ†å‡ ä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œå°±åˆ†ä¸¤ä¸ªæ­¥éª¤ï¼Œä¸€ä¸ª build,æ‰“åŒ…ç¼–è¯‘ï¼Œ deployï¼šéƒ¨ç½²## å¦‚æœæœ‰æ›´å¤šæ­¥éª¤å°±å†™ä¸Šï¼Œæ¯”å¦‚ å…ˆ clean build test deploy ï¼›å¦‚Javaçš„é¡¹ç›®ï¼š å…ˆ mvn clean , mvn test ,mvn package# image: node # å°±æ˜¯æ‰€ä¾èµ–çš„ç¯å¢ƒ åœ¨ gitrunner-cliæ³¨å†Œçš„æ—¶å€™ï¼Œå·²ç»å†™äº†æ­¤å¤„å¯ä»¥çœç•¥ä¸å†™stages: - build - deploy before_script: - 'which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )' - eval $(ssh-agent -s) - ssh-add &lt;(echo &quot;$SSH_KEY&quot;) - mkdir -p ~/.ssh - '[[ -f /.dockerenv ]] &amp;&amp; echo -e &quot;Host *\\n\\tStrictHostKeyChecking no\\n\\n&quot; &gt; ~/.ssh/config' # ç¬¬ä¸€æ­¥æ‰“åŒ…ï¼Œ build: # build:è¿™ä¸ªåç§°è‡ªå®šä¹‰ stage: buil # è¿™ä¸€ä¸ªstageï¼šçš„å€¼å°±æ˜¯ä¸Šé¢çš„ stagesä¸‹çš„ç¬¬ä¸€ä¸ª build tags: # tag åœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œæœ‰æåˆ°è¿‡ï¼Œåˆ†ä¸¤æ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯ buil,æ‰€ä»¥è¿™é‡Œä¹Ÿå¯¹åº”ä¸Šï¼Œæ³¨å†Œçš„æ—¶å€™æ˜¯è‡ªå®šä¹‰çš„åç§° - buil script: # è¿™ä¸ªå°±æ˜¯ æ“ä½œå‘½ä»¤ æˆ–è€…å†™è„šæœ¬è·¯å¾„ - npm install -g cnpm --registry=https://registry.npm.taobao.org # åˆ‡æ¢cnpm æå‡é€Ÿåº¦ - echo `pwd` # æˆ‘åªæ˜¯è¾“å‡ºä¸‹è§‚å¯Ÿå†™è·¯å¾„ - cnpm install # å®‰è£… nodemodus - cnpm run build # æ‰“åŒ…ç”Ÿæˆ dist æ–‡ä»¶å¤¹ # ç¼“å­˜ï¼Œå› ä¸ºæ˜¯å®¹å™¨æ‰§è¡Œï¼Œæ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šé‡æ–°æ‰“åŒ…ï¼Œç¼“å­˜èµ·æ¥å°±ä¸éœ€è¦å®‰è£…ä¸€æ¬¡ cache: paths: - node_modules/ - dist/ # ç¬¬äºŒä¸ªä»»åŠ¡ å°±æ˜¯ ä¸“ä¸šè¯è¯­ job ,ç¬¬ä¸€ä¸ªæ˜¯å…ˆ build ,è¿™ä¸ªè·Ÿä¸Šé¢çš„buildä¸€æ ·åç§°è‡ªå®šä¹‰ deploy: stage: deploy # è¿™ä¸€ä¸ªstageï¼šçš„å€¼å°±æ˜¯ä¸Šé¢çš„ stagesä¸‹çš„ç¬¬ä¸€ä¸ª deploy tags: - deploy # tag åœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œæœ‰æåˆ°è¿‡ï¼Œåˆ†ä¸¤æ­¥éª¤ï¼Œç¬¬äºŒä¸ªä¸ªæ˜¯ deploy,æ‰€ä»¥è¿™é‡Œä¹Ÿå¯¹åº”ä¸Šï¼Œæ³¨å†Œçš„æ—¶å€™æ˜¯è‡ªå®šä¹‰çš„åç§° script: - pwd # ä¹Ÿè¾“å‡ºä¸‹è·¯å¾„ - mv dist vue-ci # ä¿®æ”¹æ–‡ä»¶å¤¹åå­—ï¼Œå¯¹åº”ä¸Šnginx é…ç½®çš„ è·¯å¾„åå­—ï¼Œä¸ç„¶nginx æ— æ³•æ­£ç¡®è½¬å‘ - scp -R 122 -r /dist/ root@thisforyou.cn:/opt/project # å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶ä¸Šåˆ°å‘å¸ƒé¡¹ç›®çš„æœåŠ¡å™¨ä¸­çš„ã€‚æ”¾åˆ°nginxèƒ½è®¿é—®åˆ°çš„æ–‡ä»¶å¤¹ä¸‹ # æˆ‘å†™çš„æ˜¯ 122ç«¯å£ï¼Œè¿™æ˜¯æˆ‘çš„ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰æ”¹è¿‡ï¼Œé»˜è®¤æ˜¯22 ,scp ä¸éœ€è¦ å†™ `â€”R 122` è„šæœ¬å†™å¥½äº†ï¼Œå°±å°†æ­¤æ–‡ä»¶æ›´æ–°åˆ°gitlabçš„ä»“åº“ä¸Šå»å§ï¼Œgit pushä¹‹åï¼Œå°±ä¼šæ‰§è¡Œæ­¤è„šæœ¬æ–‡ä»¶äº†ï¼Œç„¶åè¿›å…¥æµè§ˆå™¨æŸ¥çœ‹è¿‡ç¨‹æœ‰æ²¡æœ‰é—®é¢˜ã€‚ âš ï¸yamlè¯­æ³•æ£€æµ‹ï¼šhttp://ä½ çš„gitlabè®¿é—®åœ°å€/è´¦æˆ·/vue-ci/-/ci/lint æœ¬æ–‡æ­£ç¡®çš„è¯­æ³• 1234567891011121314151617181920212223242526272829303132stages: - build - deploybefore_script: - 'which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )' - eval $(ssh-agent -s) - ssh-add &lt;(echo &quot;$SSH_KEY&quot;) - mkdir -p ~/.ssh - '[[ -f /.dockerenv ]] &amp;&amp; echo -e &quot;Host *\\n\\tStrictHostKeyChecking no\\n\\n&quot; &gt; ~/.ssh/config'build: stage: build tags: - buil script: - npm install -g cnpm --registry=https://registry.npm.taobao.org - echo `pwd` - cnpm install - cnpm run buildcache: paths: - node_modules/ - dist/deploy: stage: deploy tags: - deploy script: - pwd - ls -l - mv dist vue-ci - scp -P 122 -r vue-ci root@thisforyou.cn:/opt/project/web before_script: å°±æ˜¯åœ¨æ‰§è¡Œè„šæœ¬æˆ–è€…å‘½ä»¤å‰ï¼Œå…ˆæ‰§è¡Œçš„æ“çºµã€‚æ¯”å¦‚éœ€è¦é¢„å…ˆå¤„ç†ï¼Œç¯å¢ƒé—®é¢˜ï¼Œæ­¤å¤„æ˜¯è¦å’‹dock erå†…é…ç½®å¥½ä¸æœåŠ¡å™¨çš„å…å¯†ç™»é™†ã€‚ -ssh-add &lt;(echo â€œ$SSH_KEYâ€)ï¼š $SSH_KEYï¼Œè¿™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œéœ€è¦åˆ°gitlab-ci é¡µé¢é‡Œé¢è®¾ç½®ã€‚ cat /root/.ssh/id_rsa æŸ¥çœ‹å¯†é’¥ï¼Œè®°ä¸‹æ¥,å¡«åˆ°ä¸‹é¢å»ã€‚ æŸ¥çœ‹ç»“æœï¼š è¿›å…¥ç¬¬ä¸€ä¸ªjob build: è¿™å›¾ç‰‡å·²ç»ä¸æ˜¯ç¬¬ä¸€æ¬¡buildäº†ï¼Œå‰é¢æœ‰å¥½å‡ æ¬¡æµ‹è¯•ï¼Œå› ä¸ºè„šæœ¬çš„é”™ tags:buil å†™é”™äº† buid, æ³¨å†Œçš„æ—¶å€™ï¼Œæƒ³å†™çš„æ˜¯ build å´å†™æˆäº† buil ã€‚ åœ¨é€”ä¸­ï¼Œæ˜¯ç¬¬å·²ç»æœ‰äº†nodemodulsçš„ç¼“å­˜äº†ã€‚ ç¬¬ä¸€æ¬¡build: ç¬¬äºŒæ¬¡build,çº æ­£è„šæœ¬åã€‚ buildæˆåŠŸäº†ã€‚ ç¬¬ä¸€ä¸ªjob,æˆåŠŸï¼Œç°åœ¨çœ‹çœ‹ç¬¬äºŒä¸ªï¼Œdeploy job çœ‹çœ‹æœåŠ¡å™¨ä¸Šçœ‹çœ‹ çœ‹å·²ç»æœ‰äº†ï¼š å…ˆæµè§ˆå™¨çœ‹çœ‹æˆåŠŸäº†æ²¡æœ‰ï¼š è¿”å›ä¸Šä¸€é¡µçœ‹ï¼Œæ­¥éª¤ç»“æœï¼š ç°åœ¨å·²ç»éƒ¨ç½²æˆåŠŸï¼› å…ˆè·‘æµç¨‹è·‘é€šå†æ¥çœ‹ï¼›é…ç½®æ–‡ä»¶å‚æ•°è¯¦è§£ï¼š å€¼ æ˜¯å¦å¿…é¡» æè¿° script å¿…é¡» å®šä¹‰ç”±Runneræ‰§è¡Œçš„shellè„šæœ¬æˆ–å‘½ä»¤ extends éå¿…é¡» å®šä¹‰æ­¤ä½œä¸šå°†ç»§æ‰¿çš„é…ç½®æ¡ç›® image éå¿…é¡» éœ€è¦ä½¿ç”¨çš„dockeré•œåƒï¼Œè¯·æŸ¥é˜…è¯¥æ–‡æ¡£ services éå¿…é¡» å®šä¹‰æ‰€éœ€çš„dockeræœåŠ¡ï¼Œè¯·æŸ¥é˜…è¯¥æ–‡æ¡£ stage éå¿…é¡» å®šä¹‰ä¸€ä¸ªå·¥ä½œåœºæ™¯é˜¶æ®µï¼Œé»˜è®¤æ˜¯test type éå¿…é¡» stageçš„åˆ«å,ä¸èµæˆä½¿ç”¨ variables éå¿…é¡» åœ¨jobçº§åˆ«ä¸Šå®šä¹‰çš„å˜é‡ only éå¿…é¡» å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œä»»åŠ¡ jobsä¸‹çš„é…ç½®ï¼Œonly: - master è¿™ä¸ªé…ç½®çš„æ˜¯åœ¨ä»“åº“çš„å“ªä¸ªåˆ†æ”¯ä¸Šæ‰§è¡Œçš„ã€‚ except éå¿…é¡» å®šä¹‰jobæ‰€ä¸é€‚ç”¨çš„gitåˆ†æ”¯ tags éå¿…é¡» å®šä¹‰jobæ‰€é€‚ç”¨çš„runnerï¼Œtagsä¸ºrunneræ ‡ç­¾ allow_failure éå¿…é¡» å…è®¸ä»»åŠ¡å¤±è´¥ï¼Œä½†æ˜¯å¦‚æœå¤±è´¥ï¼Œå°†ä¸ä¼šæ”¹å˜æäº¤çŠ¶æ€ when éå¿…é¡» å®šä¹‰äº†jobä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œå¯ä»¥æ˜¯on_successã€on_failureã€alwayså’Œmanual dependencies éå¿…é¡» å®šä¹‰äº†è¯¥jobä¾èµ–å“ªä¸€ä¸ªjobï¼Œå¦‚æœè®¾ç½®è¯¥é¡¹ï¼Œå¯ä»¥é€šè¿‡artifactsè®¾ç½® artifacts éå¿…é¡» å·¥ä»¶ï¼Œåœ¨ä¾èµ–é¡¹ä¹‹é—´ä¼ é€’çš„ä¸œè¥¿ï¼Œç±»ä¼¼cacheï¼Œä½†åŸç†ä¸cacheä¸åŒ cache éå¿…é¡» å®šä¹‰éœ€è¦è¢«ç¼“å­˜çš„æ–‡ä»¶ã€æ–‡ä»¶å¤¹åˆ—è¡¨ before_script éå¿…é¡» è¦†ç›–åœ¨ä½œä¸šä¹‹å‰æ‰§è¡Œçš„è„šæœ¬æˆ–å‘½ä»¤ after_script éå¿…é¡» è¦†ç›–åœ¨ä½œä¸šä¹‹åæ‰§è¡Œçš„è„šæœ¬æˆ–å‘½ä»¤ environment éå¿…é¡» å®šä¹‰è®©jobå®Œæˆéƒ¨ç½²çš„ç¯å¢ƒåç§° coverage éå¿…é¡» å®šä¹‰jobè®¾ç½®ä»£ç è¦†ç›–ç‡ retry éå¿…é¡» å®šä¹‰jobå¤±è´¥åçš„è‡ªåŠ¨é‡è¯•æ¬¡æ•° ä¸åŒçš„é¡¹ç›®éœ€è¦ä¸åŒçš„é…ç½® Gitlab-ci æ›´å¤šçš„åŠŸèƒ½ï¼Œç­‰ä½ æ¥æ·±ç©¶ï½ ä¸­æ–‡å®˜ç½‘è¯´æ˜","link":"/posts/86deff97/"},{"title":"javaåå°„é‡ä¸­ä¹‹é‡ï¼Œé«˜çº§ç¼–ç¨‹ï¼ˆä½ ä¼šé€ è½®å­å—ï¼Œé€ è½®å­ï¼Œå¿…å¤‡çŸ¥è¯†ï¼Œä½ æ‡‚å¤šå°‘?ï¼‰","text":"::: hljs-center åå°„çš„ä½¿ç”¨::: java å¼€å‘ä¸­ ä»»ä½•çš„ä¸€ä¸ªæ¡†æ¶ éƒ½ç¦»ä¸å¼€å‘å°„æœºåˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ æ¡†æ¶Mybatisã€Springâ€¦ å‡ ä¹æ‰€æœ‰å°è£…çš„ æ¡†æ¶ä¸­éƒ½ç¦»ä¸å¼€å®ƒï¼Œæƒ³è¦åšæ¶æ„ï¼Œåšå·¥å…·ã€å†™ä¸€ä¸ª starter éƒ½ç¦»ä¸å¼€åå°„æœºåˆ¶ã€‚ æ‰€ä»¥è¯´åœ¨å¼€å‘ä¸­ï¼Œåå°„æœºåˆ¶è¿ç”¨å¾—å½“å¯ä»¥çœä¸‹å¾ˆå¤šä»£ç ã€‚æ¥ä¸‹æ¥ä¸ªäººå­¦ä¹ çš„è§è§£è·å–å½“å‰ç±»çš„ç›¸å…³ä¿¡æ¯ åå°„æœºåˆ¶ &emsp; åå°„åº”è¯¥æ˜¯ JVMè¯»å–ç›¸åº”ç±»çš„ å­—èŠ‚ç æ–‡ä»¶ï¼›åœ¨ç±»çš„è¿è¡ŒçŠ¶æ€ä¸­ï¼Œé€šè¿‡å­—èŠ‚ç æ–‡ä»¶ä¹Ÿå°±æ˜¯.classæ–‡ä»¶ï¼Œè·å–å½“å‰ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ æˆå‘˜å˜é‡ï¼Œç§æœ‰ã€å…±æœ‰çš„æ–¹æ³•ã€æ„é€ å‡½æ•°ã€ä»¥åŠç›¸å…³çš„æ³¨è§£ç­‰ã€‚ åå°„çš„ä¸‰ç§æ–¹å¼ å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³• User.class å¯¹äºä»»æ„ä¸€ä¸ªç±»çš„å…¨è·¯å¾„åï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³• class.forName(&quot;com.baidu.User&quot;) å¯¹äºä»»æ„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ (new User()).getClass() åå°„ä¹‹æ„é€ æ–¹æ³•1.getConstructor(Class&lt;?&gt;â€¦ parameterTypes)&emsp; åå°„æœ‰ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±é‡‡ç”¨å…¶ä¸­ä¸€ç§ (new User()).getClass()é€šè¿‡ åå°„ æ‹¿åˆ°Userçš„æ„é€ å™¨ å®ä¾‹åŒ– ä¸€ä¸ªuser, ä¸€ä¸ªå®ä½“ç±» User.java 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class User{ private Integer id; private String name; public User() { } public User(Integer id) { this.id = id; } public User(Integer id, String name) { this.id = id; this.name = name; } public User(String name) { this.name = name; } public Integer getId() { return id; } public void setId(Integer id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } @Override public String toString() { return &quot;User{&quot; + &quot;id=&quot; + id + &quot;, name=&quot; + name + â€œ '}'; } main() æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132 public static void main(String[] args) { User user = new User(); System.out.println(&quot;new User():&quot; + user); Class&lt;? extends User&gt; aClass = user.getClass(); try { Constructor&lt;? extends User&gt; constructor = aClass.getConstructor(Integer.class, String.class); try { User newUser = constructor.newInstance(1, &quot;å¼ ä¸‰&quot;); System.out.println(&quot;åå°„æ„é€ åˆ°çš„ newUser:&quot;+newUser); } catch (InstantiationException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (InvocationTargetException e) { e.printStackTrace(); } } catch (NoSuchMethodException e) { e.printStackTrace(); } }} è¾“å‡ºç»“æœï¼š 12new User():User{id=null, name='null'}åå°„æ‹¿åˆ°çš„ newUser:User{id=1, name='å¼ ä¸‰'} 2.getConstructors();è·å–å½“å‰ç±»çš„æ‰€æœ‰publicæ„é€ å™¨è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ User.class è·å–å­—èŠ‚ç æ–‡ä»¶ 123456Class&lt;User&gt; aClass = User.class;Constructor&lt;?&gt;[] constructors = aClass.getConstructors();for (Constructor&lt;?&gt; constructor : constructors){ System.out.println(constructor);} è¾“å‡ºç»“æœï¼š å…±æœ‰å››ä¸ªæ„é€ å™¨ï¼Œæ¯ä¸ªæ„é€ å™¨çš„å‚æ•°ï¼Œéƒ½ä¸ä¸€æ ·ï¼Œè¦è·å–æŒ‡å®šçš„æ„é€ å™¨ï¼Œå°±ä½¿ç”¨getConstructor(Class&lt;?&gt;... parameterTypes) 12345public reflect.User(java.lang.String)public reflect.User(java.lang.Integer,java.lang.String)public reflect.User(java.lang.Integer)public reflect.User() getDeclaredConstructors() è·å–ç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³• publicã€private åå°„ä¹‹è·å–ç±»ç›¸å…³æ–¹æ³• æ–¹æ³• è¯´æ˜ getMethod(String name, Classâ€¦&lt;?&gt; parameterTypes) è·å–æŸä¸ªæ–¹æ³• getMethods() è·å–æ‰€æœ‰çš„publicæ–¹æ³• getDeclaredMethod(String name, Classâ€¦&lt;?&gt; parameterTypes) è·å–æ‰€æœ‰çš„publicçš„æŸä¸ªæ–¹æ³• getDeclaredMethods() è·å–æ‰€æœ‰çš„public privateçš„æ–¹æ³• 1.getMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)name:æ–¹æ³•åç§°ï¼›parameterTypes:å½“å‰æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼›æ¯”å¦‚æˆ‘è·å– setName() è¿™ä¸ªæ–¹æ³•,ç„¶åè°ƒç”¨ä»–setä¸€ä¸ªå€¼ 1234567Class&lt;User&gt; aClass = User.class;Method method = aClass.getMethod(&quot;setName&quot;, String.class);Constructor&lt;User&gt; constructor = aClass.getConstructor();User user = constructor.newInstance();System.out.println(&quot;setå€¼å‰ï¼š&quot; + user);method.invoke(user, &quot;åº“é‡Œ&quot;);System.out.println(&quot;setå€¼åï¼š&quot; + user); è¾“å‡ºç»“æœï¼š 123setå€¼å‰ï¼šUser{id=null, name='null'}setå€¼åï¼šUser{id=null, name='åº“é‡Œ'} åå°„ä¹‹è·å–ç±»å±æ€§ æ–¹æ³• è¯´æ˜ getField(String name) è·å¾—å…·ä½“çš„publicå±æ€§å¯¹è±¡ getFields() è·å¾—æ‰€æœ‰publicçš„å±æ€§å¯¹è±¡ getDeclaredField(String name) è·å–æŸä¸ªå±æ€§ getDeclaredFields() è·å–æ‰€æœ‰çš„public privateçš„æ–¹æ³• 1.getField(String name)getField(String name) æ–¹æ³• è·å–ç§æœ‰å±æ€§æ˜¯æŠ›å‡º æ‰¾ä¸åˆ°å±æ€§å¼‚å¸¸çš„ã€‚å› ä¸ºå½“å‰æ–¹æ³•æ˜¯ è·å–public ä¿®é¥°çš„å±æ€§ã€‚ name å±æ€§æ˜¯privateä¿®é¥°çš„ã€‚ 2.getDeclaredField(String name)\\ngetDeclaredField(String name) èƒ½è·å–æ‰€æœ‰å±æ€§è¾“å‡ºæ­£ç¡®ç»“æœã€‚ æ–¹æ³• è¯´æ˜ getAnnotation(Class annotationClass) è¿”å›è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„å…¬æœ‰æ³¨è§£å¯¹è±¡ getAnnotations() è¿”å›è¯¥ç±»æ‰€æœ‰çš„å…¬æœ‰æ³¨è§£å¯¹è±¡ getDeclaredAnnotation(Class annotationClass) è¿”å›è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„æ‰€æœ‰æ³¨è§£å¯¹è±¡ getDeclaredAnnotations() è¿”å›è¯¥ç±»æ‰€æœ‰çš„æ³¨è§£å¯¹è±¡ åå°„ä¹‹è·å–ç±»ä¸­ç›¸å…³æ³¨è§£1.ç±»æ³¨è§£ ClassAnotation.java123456789101112131415/** * &lt;p&gt; * ä¸€ä¸ªç±»æ³¨è§£ * &lt;/p&gt; * * @author æ°¸å¥ * @since 2019-09-19 21:30 */ @Documented@Retention(RetentionPolicy.RUNTIME)\\n@Target({ElementType.TYPE})public @interface ClassAnotation{ String desrc() default &quot;&quot;;} 1.getAnnotation(Class annotationClass)æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£ç”¨æ¥è¯´æ˜è¿™ä¸ªç±»æ˜¯å¹²ä»€ä¹ˆçš„ï¼ŒæŠŠå®ƒæ”¾åœ¨ç±»ä¸Šé¢å» ç„¶åæˆ‘ä»¬ é€šè¿‡åå°„è·å–è¿™ä¸ªæ³¨è§£ç›¸å…³ä¿¡æ¯ 2.FileAnnotation.java123456@Documented@Retention(RetentionPolicy.RUNTIME)\\n@Target({ElementType.FIELD})public @interface FileAnnotation{ String desrc() default &quot;&quot;;} æ¨¡æ‹Ÿæ¨¡æ‹Ÿä¿®æ”¹åŠ äº†æ³¨è§£çš„å±æ€§å€¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243public static void main(String[] args) throws IllegalAccessException{ /** * å‡å¦‚ æˆ‘åœ¨åš user æ’å…¥æ“ä½œçš„æ—¶å€™ï¼Œid è¿™ä¸ªä¸»é”®çš„ ç”Ÿæˆç­–ç•¥ æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„id * æ¯”å¦‚ uuid ä¹‹ç±»çš„ ã€‚ æˆ‘ä»¬è¿™ä¸ªæ—¶å€™ åœ¨éœ€è¦çš„ç±» éœ€è¦çš„å­—æ®µä¸Š åŠ ä¸Šæˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£ * * åšä¸åŒçš„æ“ä½œï¼› * * è¿™ä¸ªæˆ‘è¿™ä¸ªuser id ä¸æ˜¯è‡ªå¢çš„ æ˜¯æˆ‘è‡ªå®šä¹‰çš„ä¸»é”® * * æˆ‘åœ¨ æ’å…¥çš„æ—¶å€™ å°±ä¸éœ€è¦è‡ªå·± setId(12328428342);äº† é€šè¿‡åå°„ ç»Ÿä¸€å¤„ç† * * æˆ–è€… åˆ›å»ºæ—¶é—´ æ›´æ–°æ—¶é—´è¿™ç§æ“ä½œï¼Œæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦æ‰‹åŠ¨æ“ä½œ çƒ¦æ­»äººäº†ã€‚ * * è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç”¨åå°„æ¥å¤„ç† åœ¨mybatis ä¸­ å°±å¯ä»¥ä½¿ç”¨æ‹¦æˆªå™¨ æ¥ä¿®æ”¹å‚æ•°å€¼ ã€‚ * * * æ­¤å¤„æ¨¡æ‹Ÿä¸€ä¸‹ id çš„å¤„ç† * */ User user = new User(&quot;å¼ ä¸‰&quot;); Class&lt;? extends User&gt; aClass = user.getClass(); // è·å–æ‰€æœ‰çš„å±æ€§ Field[] fields = aClass.getDeclaredFields(); System.out.println(&quot;ç»™ id set å€¼å‰ï¼š&quot;+user); // çœ‹çœ‹å“ªä¸ªå±æ€§ åŠ äº† æˆ‘çš„æ³¨è§£ for (Field field : fields) { FileAnnotation annotation = field.getAnnotation(FileAnnotation.class); if (annotation != null) { // è¿™æ˜¯id å±æ€§ æˆ‘éœ€è¦set å€¼ String desrc = annotation.desrc(); String fieldName = field.getName(); System.out.println(&quot;å±æ€§ï¼š&quot; + fieldName + &quot; åŠ äº† FileAnnotation&quot;); System.out.println(desrc); field.setAccessible(true); field.set(user,100000); System.out.println(&quot;ç»™ id set å€¼åï¼š&quot;+ user); // ç»§ç»­æ’å…¥æ“ä½œ } }} è¾“å‡ºç»“æœï¼š 12ç»™ id set å€¼å‰ï¼šUser{id=null, name='å¼ ä¸‰'}å±æ€§ï¼šid åŠ äº† FileAnnotationè¿™æ˜¯ä¸€ä¸ªä¸»é”®ç»™ id set å€¼åï¼šUser{id=100000, name='å¼ ä¸‰'} å…¶å® Spring æ¡†æ¶çš„ @Autowired @Bean ç­‰æ³¨è§£ éƒ½æ˜¯åŸºäºåå°„æœºåˆ¶çš„ï¼›ä¾èµ–æ³¨å…¥ä¹Ÿæ˜¯è¿™ä¸ªåŸç†ï¼Œä¸ä¿¡æˆ‘å°±ç®€å•ç»™ä½ è¯•è¯•çœ‹ï¼› @Autowired æ³¨è§£æ€ä¹ˆæ³¨å…¥ä¸€ä¸ªå¯¹åƒçš„ã€‚ 3.åå°„å®ç° @Autowired ä¾èµ–æ³¨å…¥1.å»ºä¸€ä¸ªserviceAppleService.java å’Œ @Autowired è¿™ä¸ªæ³¨è§£ä¸æ˜¯Springä¸­çš„é‚£ä¸ª æ˜¯æˆ‘ä»¬è‡ªå·±çš„å“¦ 2.@Autowired 3.åŠ å…¥åˆ° User å±æ€§ä¸­ 4.main æ–¹æ³•æ¨¡æ‹Ÿ Spring å¯åŠ¨ å°† AppleService å®ä¾‹æ³¨å…¥åˆ°Userä¸­çš„ appleService ä¸­ï¼Œå†è°ƒç”¨ eat() çš„æ–¹æ³• 12345678910111213141516171819202122232425262728public static void main(String[] args) throws IllegalAccessException, NoSuchMethodException, InvocationTargetException, InstantiationException{ User user = new User(&quot;å¼ ä¸‰&quot;); Class&lt;? extends User&gt; aClass = user.getClass(); // è·å–æ‰€æœ‰çš„å±æ€§ Field[] fields = aClass.getDeclaredFields(); // çœ‹çœ‹å“ªä¸ªå±æ€§ åŠ äº† æˆ‘çš„æ³¨è§£ for (Field field : fields) { Autowired annotation = field.getAnnotation(Autowired.class); if (annotation != null) { // è·å¾—è¿™ä¸ªå±æ€§äº†å§ Class&lt;? extends Field&gt; appClass = field.getClass(); // è·å–å±æ€§çš„ç±»å‹ Class&lt;?&gt; type = field.getType(); // æ„é€  Constructor&lt;?&gt; constructor = type.getConstructor(); // new ä¸€ä¸ªå®ä¾‹ Object appleService = constructor.newInstance(); // èµ‹å€¼ ä¾èµ–æ³¨å…¥ field.setAccessible(true); field.set(user,appleService); // ç„¶åæˆ‘ä»¬è°ƒç”¨ getAppleService() æ¥è°ƒç”¨å®ƒçš„ eat()æ–¹æ³• user.getAppleService().eat(); } }} è¾“å‡ºç»“æœï¼š 1åƒè‹¹æœ **çœ‹å§ æˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥å°±å®Œæˆäº†å§ï¼Œå…¶å®Springçš„ä¾èµ–æ³¨å…¥å°±æ˜¯ç”¨çš„åå°„ï¼Œå‰é¢è¯´äº†ï¼Œä¼˜ç§€çš„æ¡†æ¶ ç¦»ä¸å¼€åå°„æœºåˆ¶ã€‚é‡ç‚¹å­¦ä¹  åå°„å“¦ï¼Œæ¯”å¦‚æœ‰æ¯”å¦‚ mybatis çš„ ç»“æœé›†æ˜ å°„å¤„ç†â€¦; æ²¡æœ‰åå°„å°±æ²¡æœ‰è¿™ä¹ˆä¼˜ç§€çš„æ¡†æ¶ã€‚å…³äºSpring ä¾èµ–æ³¨å…¥ æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œå¾€åæˆ‘ä¹Ÿä¼šæ ¹æ®è‡ªå·±çš„è§è§£ï¼Œå†™åšå®¢ mybatis çš„è¿œç¦»åˆ†æ æºç ä¹Ÿçœ‹è¿‡äº†ï¼Œå¯ä»¥çœ‹æˆ‘çš„åšå®¢","link":"/posts/undefined/"},{"title":"MyBatis -- Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼","text":"MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼å¾ˆå¤šäººåˆšåˆšå¼€å§‹å­¦mybatisçš„æ—¶å€™ï¼Œå¸¸å¸¸åœ¨åšselectã€updateã€deleteã€insertçš„æ—¶å€™ï¼Œä¼šé‡åˆ°ç±»ä¼¼è¿™ç§ï¼Œ Invalid bound statement (not found)ï¼šâ€¦. çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼š å½“ç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥åˆ°è¿™è‚¯å®šæ˜¯ï¼Œå‘½åç©ºé—´é…ç½®é”™äº†ï¼Œæˆ–è€…æ˜¯ï¼Œdao æ¥å£çš„çš„ æ–¹æ³•ï¼Œå’Œ mapperæ–‡ä»¶çš„æ–¹æ³•æ²¡æœ‰å¯¹åº”ä¸Šã€‚ è¿™æ”¹æ­£è¿‡æ¥å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼› ä½†æ˜¯ mybatis æ˜¯æ€ä¹ˆé€šè¿‡Dao/mapperæ¥å£çš„æ–¹æ³•ï¼Œæ‰¾åˆ°å¯¹åº”çš„ xml èŠ‚ç‚¹ sql å—ï¼Ÿ æ¥åˆ†æä¸€ä¸‹è¿™å…¶ä¸­çš„å› ä¸ºæ‰€ä»¥ï¼ŒæŠ½ä¸å‰¥èŒ§ã€‚ è¿‡ç¨‹çœ‹ä¸æ˜ç™½ç›´æ¥çœ‹æ€»ç»“å³å¯ğŸ˜‚ï¼š é¦–å…ˆ å…ˆä»‹ç»å‡ ä¸ªç±»ï¼š Configuration.java mybatis å…¨å±€éƒ½å›´ç»•ç€å®ƒè½¬ï¼Œå› ä¸ºå®ƒå‡ ä¹æ¶µç›–mybatisçš„æ‰€æœ‰åˆå§‹åŒ–åè¦å­˜å‚¨çš„ä¿¡æ¯ã€‚ Map&lt;String, MappedStatement&gt; mappedStatementsï¼š è¿™ä¸ª map å°±æ˜¯åœ¨å¯åŠ¨é¡¹ç›®æ—¶å€™ï¼Œæ‰«æxmlæ–‡ä»¶å¯¹xml èŠ‚ç‚¹ï¼ˆselectã€updateã€deleteã€insertï¼‰è§£æå°è£…æˆMappedStatementå¯¹è±¡ä¸­çš„ã€‚ Key:å°±æ˜¯ å‘½åç©ºé—´+æ–¹æ³•åï¼Œvalue:å°±æ˜¯è§£æåä¸€ä¸ªxml èŠ‚ç‚¹ä¿¡æ¯ã€‚ MappedStatementï¼š ä¸€ä¸ªMappedStatementå¯¹åº”ä¸€æ¡ xml ä¸­çš„ ä¸€ä¸ªèŠ‚ç‚¹ æ¯”å¦‚ï¼š 1234&lt;select id=&quot;findById&quot; parameterType=&quot;int&quot; resultMap=&quot;BaseResultMap&quot; useCache=&quot;true&quot; timeout=&quot;&quot; resultSets=&quot;&quot; flushCache=&quot;&quot;&gt; select &lt;include refid=&quot;Base_Column_List&quot;/&gt; from tb_city where id =#{id}&lt;/select&gt; åœ¨åˆå§‹åŒ–è¿‡ç¨‹å°±ä¼šè§£æ xml å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯å°è£…æˆ MappedStatement å¯¹è±¡ï¼š ä¾‹å¦‚ï¼š id â€“å¯¹åº”çš„å°±æ˜¯xml ä¸­çš„ èŠ‚ç‚¹id å¦‚ï¼šä¸Šé¢çš„ select è¯­å¥çš„ id=â€findByIdâ€,å…¶å®ƒçš„å±æ€§ä¹Ÿä¼šä¸€ä¸€å¯¹åº”èŠ‚ç‚¹ä¸­é…ç½®çš„ã€‚ä¼šå°†å…¥å‚ ç»“æœé›†éƒ½è§£æå°è£…åˆ°å…¶ä¸­ resultMapsâ€¦ è¿˜æœ‰sqlç±»å‹â€¦.. 123456789101112131415161718192021222324// å±æ€§ private String resource; private Configuration configuration; private String id; private Integer fetchSize; private Integer timeout; private StatementType statementType; private ResultSetType resultSetType; private SqlSource sqlSource; private Cache cache; private ParameterMap parameterMap; private List&lt;ResultMap&gt; resultMaps; private boolean flushCacheRequired; private boolean useCache; private boolean resultOrdered; private SqlCommandType sqlCommandType; private KeyGenerator keyGenerator; private String[] keyProperties; private String[] keyColumns; private boolean hasNestedResultMaps; private String databaseId; private Log statementLog; private LanguageDriver lang; private String[] resultSets; MybatisMapperProxy.java Mybatis Dao/Mapperæ¥å£çš„åŠ¨æ€ä»£ç†ç±»ï¼Œæ‰€æœ‰è°ƒç”¨mapper æ¥å£çš„æ–¹æ³•ï¼Œå…¥å£å³åœ¨è¿™ï¼Œæ–­ç‚¹ä»è¿™å¼€å§‹ã€‚ MapperMethod.java åœ¨ä»£ç†ç±»MybatisMapperProxy.java ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œinvoke æ–¹æ³•æœ€åè°ƒç”¨çš„æ˜¯ï¼ŒMapperMethodã€‚excute()æ–¹æ³•ï¼› 1234567// å±æ€§// å†…éƒ¨ç±»ï¼Œåœ¨è·å–MapperMethodä¹‹å‰ï¼Œä¼šå…ˆ new SqlCommand åˆå§‹å¥½ï¼Œsqlç±»å‹ ä¾‹å¦‚ï¼šæ˜¯insertè¿˜æ˜¯selecprivate final SqlCommand command; // å°è£…äº†æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ è¿”å›ç±»å‹ä¿¡æ¯,// åœ¨è·å–MapperMethodä¹‹å‰ï¼Œä¼šå…ˆ new MethodSignature,å¯¹mapperæ¥å£çš„æ–¹æ³•ä¿¡æ¯è¿›è¡Œå°è£… private final MethodSignature method; çŸ¥å…¶æ‰€ä»¥ç„¶CityMapper.XML 123456789101112131415161718192021222324252627&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;mapper namespace=&quot;generator.test.demo.core.mapper.CityMapper&quot;&gt; &lt;select id=&quot;findById&quot; parameterType=&quot;int&quot; resultMap=&quot;BaseResultMap&quot;&gt; select &lt;include refid=&quot;Base_Column_List&quot;/&gt; from tb_city where id =#{id} &lt;/select&gt; &lt;!-- é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ --&gt; &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;generator.test.demo.core.entity.City&quot;&gt; &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt; &lt;result column=&quot;city_name&quot; property=&quot;cityName&quot;/&gt; &lt;result column=&quot;city_code&quot; property=&quot;cityCode&quot;/&gt; &lt;/resultMap&gt; &lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ— --&gt; &lt;sql id=&quot;Base_Column_List&quot;&gt; id, city_name, city_code &lt;/sql&gt; &lt;/mapper&gt; CityMapper.java XML è§£æå°† sql èŠ‚ç‚¹å°è£…æˆ MappedStatmentXML è§£æå°† sql èŠ‚ç‚¹å°è£…æˆ MappedStatment ä¸­ï¼Œå¹¶å°†å…¶ å­˜åˆ° Configuration å¯¹è±¡çš„çš„ mappedStatements s Mapå±æ€§ä¸­ï¼›å¹¶ä¸”ä»¥keyä¸º å‘½åç©ºé—´+æ–¹æ³•Id ä¹Ÿå°±æ˜¯ mapperæ¥å£çš„ æ‰€åœ¨å…¨é™å®šå+æ–¹æ³•åï¼› ä¸‹å›¾æ˜¯ XML çš„è§£ææµç¨‹ï¼šæ­¤å¤„æˆ‘ä»¬åªçœ‹ï¼ŒMappedStatment å‘½åç©ºé—´çš„ç”Ÿæˆ çœ‹çœ‹è¿™ä¸ª MappedStatement çš„ getId() æ˜¯ä»€ä¹ˆå€¼ï¼š debbug çœ‹åˆ°çš„æ˜¯ ä¸Šé¢çš„ CityMapper.xml æ–‡ä»¶çš„ namespace+findById (select èŠ‚ç‚¹çš„Idç»„æˆï¼‰; ä¹Ÿå°±æ˜¯ç­‰äº ä¸Šé¢çš„ CityMapper.java å›¾ç‰‡çš„ 1+2+3+4 ç»„æˆï¼› å¢åˆ æ”¹è°ƒç”¨è¿‡ç¨‹ å‰é¢å·²ç»åˆ†æäº†ï¼ŒMappedStatement å¯¹åƒçš„ç”Ÿæˆäº†ï¼Œå°±æ˜¯åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹è§£æ xmlæ–‡ä»¶ï¼Œå°†æ¯ä¸ª xmlçš„çš„å¢åˆ æ”¹èŠ‚ç‚¹ï¼Œå°è£…æˆ MappedStatement å­˜åˆ° Configuration ä¸­çš„map å¯¹è±¡ä¸­ã€‚ å¹¶ä¸”ä»¥ï¼škey:å‘½åç©ºé—´+ sqlæ ‡ç­¾Idç»„æˆã€‚ å› ä¸ºæ˜¯è¿™æ ·ï¼Œæ‰€ä»¥é‚£æ ·,è¿™æ ·æ˜¯é‚£æ ·ï¼Ÿ åœ¨mybatisä¸­ï¼Œåœ¨æ¯ä¸ªxml ä¸­ï¼Œæ¯ä¸ªsqlçš„idæ˜¯å”¯ä¸€çš„ï¼Œmapperæ¥å£çš„æ–¹æ³•ä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹ä¸ç”¨æ”¹å‡ºç°ä¸¤ä¸ª sql id ç›¸åŒçš„æ–¹æ³•ã€‚ æ—¢ç„¶å­˜çš„æ˜¯ä¸€ä¸ª Mapå¯¹è±¡ï¼Œé‚£æ‹¿çš„æ—¶å€™ï¼Œè‚¯å®šä¹Ÿæ˜¯é€šè¿‡ key æ¥æ‹¿å°±æ˜¯ MappedStatement Idçš„å€¼ï¼› å‰é¢è®²åˆ°äº†ä»£ç†å¯¹åƒ MybatisMapperProxy.javaï¼Œæ‰€æœ‰mybatis çš„mapperæ¥å£ç»è¿‡ä»–çš„ invokeæ–¹æ³•ï¼›æ‰€ä»¥æ–­ç‚¹è¿›å…¥è¿™é‡Œçœ‹ï¼› findById è¿›æ¥äº†ï¼š cachedMapperMethod(mentod)è¿™ä¸ªæ–¹æ³•æ˜¯ä¼˜åŒ–äº†ï¼Œå…ˆé‡ç¼“å­˜æ–¹æ³•æ‹¿ MybatisMapperMethod å¯¹è±¡ï¼Œå¦‚æœæ‹¿ä¸åˆ°å°± new ä¸€ä¸ª æ·»åŠ åˆ°ç¼“å­˜ä¸­ 123private MybatisMapperMethod cachedMapperMethod(Method method) { return methodCache.computeIfAbsent(method, k -&gt; new MybatisMapperMethod(mapperInterface, method, sqlSession.getConfiguration()));} å…³é”®æ­¥éª¤åœ¨ new MybatisMapperMethod(mapperInterface, method, sqlSession.getConfiguration()));ä¸­ 12345public MybatisMapperMethod(Class&lt;?&gt; mapperInterface, Method method, Configuration config) { // SqlCommand å‰é¢æœ‰ä»‹ç» this.command = new MapperMethod.SqlCommand(config, mapperInterface, method); this.method = new MapperMethod.MethodSignature(config, mapperInterface, method); } new MapperMethod.SqlCommand 123456789101112131415161718192021222324252627public SqlCommand(Configuration configuration, Class&lt;?&gt; mapperInterface, Method method) { // invoke æ–¹æ³•ä¸­æ‹¿åˆ°äº†æ‰§è¡Œçš„æ–¹æ³•å¯¹è±¡ ä»è€Œ æ‹¿åˆ° æ–¹æ³•å // è¿˜æœ‰çš„å°±æ˜¯ ä»£ç†ç±»çš„ class final String methodName = method.getName(); final Class&lt;?&gt; declaringClass = method.getDeclaringClass(); // åœ¨è¿™é‡Œè·å– MappedStatement å¯¹è±¡ MappedStatement ms = resolveMappedStatement(mapperInterface, methodName, declaringClass, configuration); if (ms == null) { if (method.getAnnotation(Flush.class) != null) { name = null; type = SqlCommandType.FLUSH; } else { // æŠ›å‡ºå¼‚å¸¸ throw new BindingException(&quot;Invalid bound statement (not found): &quot; + mapperInterface.getName() + &quot;.&quot; + methodName); } } else { name = ms.getId(); type = ms.getSqlCommandType(); if (type == SqlCommandType.UNKNOWN) { throw new BindingException(&quot;Unknown execution method for: &quot; + name); } } } resolveMappedStatement() å…³é”®æ–¹æ³• è·å–mapperæ¥å£çš„å…¨é™å®šåï¼šmapperInterface.getName() æ‹¼æ¥ä¸Š æ–¹æ³•åï¼› è¿™æ—¶å€™å°±å¯ä»¥å°±å¯ä»¥ä» configuration ä¸­æ‹¿åˆ°äº† MappedStatementå¯¹è±¡äº†ï¼›è¿”å›ç©ºçš„æ—¶å€™ï¼ŒSqlCommad æ„é€ å‡½æ•°å°±æŠ›å‡ºäº† å¼‚å¸¸äº†ã€‚ åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼š configuration.addMappedStatement(statement); åœ¨å¢åˆ æ”¹æŸ¥çš„æ—¶å€™è°ƒç”¨ï¼š configuration.getMappedStatement(statementId); è¿™è¿‡ç¨‹å°±æ˜¯ Invalid bound statement (not found) å¼‚å¸¸çš„ æ‰€ä»¥ç„¶æ¥äº†ã€‚ æ€»ç»“ï¼šInvalid bound statement (not foundï¼‰çš„äº§ç”Ÿçš„åŸå› å°±æ˜¯ï¼Œxmlçš„å‘½åç©ºé—´+sqlèŠ‚ç‚¹çš„id å¯¹åº”ä¸ä¸Šï¼ŒMapperæ¥å£çš„å…¨é™å®šå+å½“å‰è°ƒç”¨çš„æ–¹æ³•åï¼› è§£å†³åŠæ³•å°±æ˜¯ï¼š æ£€æŸ¥ xml çš„ namespace çš„å€¼æ˜¯ä¸å¯¹åº”ä¸Šäº† å’Œ sqlèŠ‚ç‚¹çš„å€¼ï¼Œæˆ–è€… xml æ˜¯å¦è¢«æ‰«æåˆ°äº†ï¼› Invalid bound statement (not found) çš„åŸç†ï¼š åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œæ‰«æxmlæ–‡ä»¶å¤¹ä¸‹çš„ mapper.xmlæ–‡ä»¶ï¼Œå¯¹ xml çš„ sql èŠ‚ç‚¹è¿›è¡Œè§£æï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯å°è£…åˆ° MapperStaementå¯¹è±¡ä¸­ï¼Œç„¶å put è¿›å»åˆ° Configuration å¯¹è±¡ä¸­çš„ Map&lt;String, MappedStatement&gt; mappedStatements å±æ€§ä¸­ï¼›ke y:å‘½åç©ºé—´+sqlèŠ‚ç‚¹idã€‚åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä»£ç†å¯¹åƒ MybatisMapperProxy ä¸­invokeæ–¹æ³• æ‹¿åˆ°å½“å‰ mapper.java å¯¹åƒçš„class.getName()å…¨é™å®šåï¼Œå’Œæ–¹æ³•å æ‹¼æ¥æˆ statementId å»configuration.getMappedStatement(id)ä¸­è·å– MappedStatement å¯¹åƒã€‚ åœ¨ç»§ç»­è·Ÿè¸ªä¸‹å»ï¼Œå°±æ˜¯åˆ°äº† åˆ†æ”¯ï¼Œé€šè¿‡ SqlCommad åˆ¤æ–­ å½“å‰æ˜¯å¢è¿˜æ˜¯åˆ  è¿˜æ˜¯æŸ¥è¿˜æ˜¯æ”¹äº†â€¦â€¦â€¦.. ::: hljs-center æ‰“å®Œæ”¶å·¥å…³æ³¨å…¬ä¼—å·:::","link":"/posts/7c99dfb8/"},{"title":"mybatisä½¿ç”¨å­˜å‚¨è¿‡ç¨‹","text":"1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º&emsp; åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨ 12345CREATE PROCEDURE name([IN å‚æ•°1 INT,OUT å‚æ•°2,OUT])BEGIN -- ä¸šåŠ¡é€»è¾‘ END; CREATE PROCEDURE: åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„sqlè¯­æ³• name: å­˜å‚¨è¿‡ç¨‹çš„åå­— è‡ªå®šä¹‰ (): æ‹¬å·å°±æ˜¯å‚æ•°ï¼Œå‚æ•°æ ¼å¼1ã€IN ä»£è¡¨å…¥å‚ OUT ä»£è¡¨ è¾“å‡ºå‚æ•°ï¼ŒINTOUTï¼šè¾“å…¥ä¹Ÿè¾“å‡º2ã€å‚æ•°1 å‚æ•°name3ã€INT ç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨ å…¥å‚ æˆ–è€… å‡ºå‚çš„ç±»å‹ï¼Œå†™çš„æ˜¯æ•°æ®åº“çš„ç±»å‹ã€‚4ã€bengin â€” end; ä¸­é—´å°±æ˜¯ è¦å°è£…çš„ä¸šåŠ¡é€»è¾‘ã€‚ &emsp; ä¾‹å­ï¼š &emsp; ä½¿ç”¨ navicat è½¯ä»¶æ“ä½œ 12345678910111213141516CREATE PROCEDURE pp(OUT roleId INT,OUT cityId INT,IN ciName VARCHAR(64))BEGIN -- æ’å…¥ ä¸€æ¡æ•°æ® INSERT INTO tb_city (cityName) VALUES(ciName); -- è·å–æœ€æ–°Id SELECT max(tb_city.id) INTO cityId FROM tb_city; INSERT INTO tb_role (name,city_id) VALUES(&quot;superman&quot;,cityId); SELECT max(tb_role.id) INTO roleId FROM tb_role; SELECT roleId; SELECT cityId;END; 2ã€å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨&emsp; call å­˜å‚¨è¿‡ç¨‹çš„åå­—(å‚æ•°) ä»¥ä¸Šé¢ä¸ºä¾‹å­ call pp(@roleId,@cityId,&quot;å¹¿å·&quot;); ç»“æœï¼š ä¸¤ä¸ªç»“æœ æ˜¯è¾“å‡ºçš„ 3ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹12DROP PROCEDURE å­˜å‚¨è¿‡ç¨‹åå­—;DROP PROCEDURE IF EXISTS è¿‡ç¨‹; 4ã€æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çŠ¶æ€æŸ¥çœ‹çŠ¶æ€SHOW PROCEDURE STATUS LIKE 'pp' æŸ¥çœ‹å®šä¹‰SHOW CREATE PROCEDURE pp 6ã€äº‹åŠ¡ä½¿ç”¨&emsp; ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸ºäº† å°è£…ä½ ä¸šåŠ¡é€»è¾‘åˆ°ä¸€å¥—sqlä¸­ï¼Œå‡å°‘ç½‘ç»œçš„å¼€é”€ï¼Œææ‰§è¡Œé€Ÿåº¦ã€‚ä½†æ˜¯ä¸€ç³»åˆ—çš„è¡¨æ“ä½œï¼Œå¿…å®šè¦ä¿è¯åŸå­æ€§ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ Mysqläº‹åŠ¡æ“ä½œè¯­å¥ï¼š START TRANSACTION: å¼€å§‹äº‹åŠ¡ï¼Œautocommitè®¾ä¸º0ï¼Œå¦‚æœå·²ç»æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿è¡Œï¼Œåˆ™ä¼šè§¦å‘ä¸€ä¸ªéšè—çš„COMMIT COMMITï¼šæäº¤äº‹åŠ¡ï¼Œä¿å­˜æ›´æ”¹ã€‚ ROLLBACKï¼šå›æ»šæœ¬äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ”¹ï¼Œç„¶åç»“æŸäº‹åŠ¡ã€‚ SAVEPOINT savepoint_nameï¼šåˆ›å»ºä¸€ä¸ªsavepointè¯†åˆ«ç¬¦æ¥ROLLBACK TO SAVEPOINTã€‚ ROLLBACK TO SAVEPOINT savepoint_nameï¼šå›æ»šåˆ°ä»savepoint_nameå¼€å§‹å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ”¹ï¼Œè¿™æ ·å°±å…è®¸å›æ»šäº‹åŠ¡ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¿è¯æ›´æ”¹çš„ä¸€ä¸ªå­é›†è¢«æäº¤ ã€‚ SET TRANSACTIONï¼šå…è®¸è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚ LOCK TABLESï¼šå…è®¸æ˜¾å¼çš„é”ä½ä¸€ä¸ªæˆ–å¤šä¸ªtableï¼Œä¼šéšå¼çš„å…³é—­å½“å‰æ‰“å¼€çš„äº‹åŠ¡ï¼Œå»ºè®®åœ¨æ‰§è¡ŒLOCK TABLESè¯­å¥ä¹‹å‰æ˜¾å¼çš„commitæˆ–rollbackã€‚æˆ‘ä»¬ä¸€èˆ¬æ‰€ä»¥ä¸€èˆ¬åœ¨äº‹åŠ¡ä»£ç é‡Œä¸ä¼šä½¿ç”¨LOCK TABLES ä¾‹å­1:&emsp; ä½¿ç”¨ set autocommit=0; è®¾ç½® äº‹åŠ¡ä¸è‡ªåŠ¨æäº¤ï¼›è¿˜ç”¨ä¸Šé¢çš„ä¾‹å­ï¼ŒåŠ ä¸Šäº‹åŠ¡æµ‹è¯•ï¼š åˆ›å»ºï¼š 1234567891011121314151617181920212223CREATE PROCEDURE pp(OUT roleId INT,OUT cityId INT,IN ciName VARCHAR(64)) BEGIN set autocommit=0; INSERT INTO tb_city (cityName) VALUES(&quot;å¹¿å·&quot;); SELECT max(tb_city.id) INTO cityId FROM tb_city; INSERT INTO tb_role (name,city_id) VALUES(&quot;superman&quot;,cityId); SELECT max(tb_role.id) INTO roleId FROM tb_role; SELECT roleId; SELECT cityId; -- è¿™æ¡è¯­å¥ä¼šæŠ¥é”™ INSERT INTO tb_city (cityName) VALUES(ciName); COMMIT;END; å¯¹ä¸¤å¼ è¡¨è¿›è¡Œæ“ä½œï¼Œå½“å‰ä¸¤å¼ è¡¨éƒ½æ˜¯ç©ºè¡¨ã€‚)) å…¶ä¸­cityè¡¨çš„cityName å­—æ®µé•¿åº¦è®¾ä¸º 2ï¼› è°ƒç”¨ï¼šcall pp(@roleId,@cityId,&quot;æ·±åœ³å¸‚&quot;); çœ‹ç»“æœï¼š æ·±åœ³å¸‚ï¼š å­—æ®µè¶…å‡ºé•¿åº¦ï¼› çœ‹çœ‹å‰é¢ä¸¤å¼ è¡¨æœ‰æ²¡æœ‰æ’å…¥æ•°æ®ã€‚ è‚¯å®šæ˜¯æ²¡æœ‰çš„ï¼Œäº‹åŠ¡æ²¡æœ‰æäº¤ã€‚ äº‹åŠ¡ç¬¬äºŒç§æ–¹å¼ START TRANSACTION; 1234567891011121314151617181920212223CREATE PROCEDURE pp(OUT roleId INT,OUT cityId INT,IN ciName VARCHAR(64)) BEGIN START TRANSACTION; INSERT INTO tb_city (cityName) VALUES(&quot;å¹¿å·&quot;); SELECT max(tb_city.id) INTO cityId FROM tb_city; INSERT INTO tb_role (name,city_id) VALUES(&quot;superman&quot;,cityId); SELECT max(tb_role.id) INTO roleId FROM tb_role; SELECT roleId; SELECT cityId; -- è¿™æ¡è¯­å¥ä¼šæŠ¥é”™ INSERT INTO tb_city (cityName) VALUES(ciName); COMMIT;END; äº‹åŠ¡ç¬¬ä¸‰ç§ï¼š 1234567891011121314151617181920CREATE PROCEDURE pp()BEGIN declare t_error int default 0; -- æ ‡å¿—æ‰§è¡Œå‡ºé”™ declare continue handler for sqlexception set t_error=1; -- å‡ºé”™ç»§ç»­æ‰§è¡Œ å¹¶ä¸”è®¾é”™è¯¯æ ‡å¿—ä¸º1 START TRANSACTION; -- å¼€å¯äº‹ç‰© INSERT INTO tb_city (cityName) VALUES(&quot;ç æµ·&quot;); INSERT INTO tb_role (name) VALUES(&quot;superman&quot;); INSERT INTO tb_city (cityName) VALUES(&quot;æ¹›æ±Ÿ23&quot;); if t_error=1 THEN ROLLBACK; -- äº‹ç‰©å›æ»š ELSE COMMIT; END IF;END; 7ã€å˜é‡çš„ä½¿ç”¨12345678910CREATE PROCEDURE bianliang()BEGIN declare count int; -- å®šä¹‰å˜é‡ select count; -- æŸ¥è¯¢ ç»“æœ null set count = 10; -- èµ‹å€¼ select count; -- ç»“æœ 10END; call bianliang(); 8ã€if-else-ifæ ¹æ®æ’å…¥id æ¥åˆ¤æ–­æ˜¯å¦æ’å…¥æˆåŠŸ 1234567891011121314151617181920 CREATE PROCEDURE bianliang()BEGIN declare count int; -- å®šä¹‰å˜é‡ declare lastId int; SELECT MAX(tb_city.id) INTO count from tb_city; INSERT INTO tb_city (cityName) VALUES(&quot;ä½›å±±&quot;); SELECT MAX(tb_city.id) INTO lastId from tb_city; if (lastId&gt;count) THEN SELECT 'æ·»åŠ æˆåŠŸ'; ELSE SELECT 'æ“ä½œå¤±è´¥'; END IF; END; ç»“æœ 9ã€ while Â·Â·Â·Â· end whileæ‰¹é‡æ’å…¥æ•°æ® 1234567891011CREATE PROCEDURE whiles()BEGIN declare var int; set var =0; WHILE var&lt;5 DO INSERT INTO tb_city (cityName) VALUES(&quot;æ¹›æ±Ÿ&quot;); set var=var+1; END WHILE;END; ç»“æœï¼š","link":"/posts/baa6fbb5/"},{"title":"æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ŒMybatisçš„Mapper&#x2F;Daoä¸ºä»€ä¹ˆå´å¯ä»¥@Autowiredæ³¨å…¥ï¼Ÿ","text":"å¯¹äºæˆ‘ä»¬ java æ¥è¯´ï¼Œæ¥å£æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–çš„ã€‚è€Œä¸”æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯publicçš„ã€‚ å¯æ˜¯ä¸ºä»€ä¹ˆ Mybaits çš„mapper æ¥å£ï¼Œå¯ä»¥ç›´æ¥ @Autowired æ³¨å…¥ ä½¿ç”¨ï¼Ÿ æ¥ä¸‹æ¥çœ‹çœ‹Mybatis æ˜¯å¦‚ä½•åšçš„ã€‚ åŸºäºSpringBoot çš„ @MapperScan æ³¨è§£å…¥æ‰‹ï¼Œåˆ†æã€‚ å¸¦ç€é—®é¢˜åˆ†æä»£ç ï¼š Mybatis çš„mapperæ¥å£ï¼Œæ˜¯æ€ä¹ˆè¢«æ‰«æçš„ï¼Ÿ mapperæ¥å£æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨@Autowiredæ³¨å…¥ï¼Ÿ @MapperScan1234567891011121314151617181920212223@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.TYPE)@Documented@Import(MapperScannerRegistrar.class)@Repeatable(MapperScans.class)public @interface MapperScan { // åœ¨ä½¿ç”¨MapperScanä¸­ï¼Œæ‰«æåŒ…çš„è·¯å¾„ã€‚ // å¡«å†™çš„æ˜¯ mapper æ¥å£æ‰€åœ¨åŒ…åï¼Œå¯¹è¯¥valueå€¼ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‰«æ String[] value() default {}; String[] basePackages() default {}; Class&lt;?&gt;[] basePackageClasses() default {}; Class&lt;? extends BeanNameGenerator&gt; nameGenerator() default BeanNameGenerator.class; Class&lt;? extends Annotation&gt; annotationClass() default Annotation.class; Class&lt;?&gt; markerInterface() default Class.class; String sqlSessionTemplateRef() default &quot;&quot;; String sqlSessionFactoryRef() default &quot;&quot;; Class&lt;? extends MapperFactoryBean&gt; factoryBean() default MapperFactoryBean.class;} 12345678910@SpringBootApplication@MapperScan(&quot;cn.thisforyou.core.blog.mapper&quot;)public class App{ public static void main( String[] args ) { System.out.println( &quot;Hello World!&quot; ); SpringApplication.run(App.class,args); }} åœ¨SpringBootä¸­ä½¿ç”¨mybatis,é‚£å®ƒçš„å…¥å£å°±åœ¨ @MapperScanä¸­ã€‚@MapperScanæ³¨è§£ï¼Œæ˜¯åœ¨SpringBootçš„å¯åŠ¨ç±»ä¸­ã€‚ @MapperScanä¸­æœ‰ä¸ª @Import æ³¨è§£ã€‚ @Import æ³¨è§£ï¼Œå¯ä»¥åŠ è½½æŸä¸ªç±»ï¼Œæ”¾åˆ°Springçš„IOCä¸­ç®¡ç†åœ¨Springä¸­ï¼Œè¦å°†Beanæ”¾åˆ°IOCå®¹å™¨ä¸­ç®¡ç†çš„è¯ï¼Œæœ‰å‡ ç§æ–¹å¼ã€‚ @Import æ­¤ç§æ–¹æ³• @Configuration ä¸ @Bean æ³¨è§£ç»“åˆä½¿ç”¨ @Controller @Service @Repository @Component @ComponentScan æ‰«æã€‚ é‡å†™BeanFactoryPostProcessor çš„postProcessBeanFactory()æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®ç°Beançš„æ³¨å…¥ MapperScannerRegistraré€šè¿‡@Import æ³¨è§£ï¼Œå°†MapperScannerRegistrar æ³¨å…¥åˆ°äº†IOCå®¹å™¨ä¸­ï¼Œè€ŒMapperScannerRegistrarå®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼ŒImportBeanDefinitionRegistrar, ResourceLoaderAware ImportBeanDefinitionRegistrar åœ¨Springéœ€è¦é…åˆ@Imporä½¿ç”¨ï¼ŒåŠ è½½å®ƒçš„å®ç°ç±»ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸»è¦è´Ÿè´£Bean çš„åŠ¨æ€æ³¨å…¥çš„ã€‚ 1234public interface ImportBeanDefinitionRegistrar { public void registerBeanDefinitions( AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry);} è¿™ä¸ªæ–¹æ³•å¯ä»¥æ‹¿åˆ° Springçš„æ³¨å†Œå¯¹è±¡ BeanDefinitionRegistry è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæä¾›äº†å¥½6ã€7ä¸ªæ–¹æ³• 12345678910111213141516171819202122public interface BeanDefinitionRegistry extends AliasRegistry { // æ³¨å†Œ BeanDefinition void registerBeanDefinition(String var1, BeanDefinition var2) throws BeanDefinitionStoreException; // ç§»é™¤ BeanDefinition void removeBeanDefinition(String var1) throws NoSuchBeanDefinitionException; // æ ¹æ®name è·å–ä¸€ä¸ª BeanDefinition BeanDefinition getBeanDefinition(String var1) throws NoSuchBeanDefinitionException; // åˆ¤æ–­ æ˜¯å¦å­˜åœ¨ boolean containsBeanDefinition(String var1); // BeanDefinition çš„é€‚é‡ String[] getBeanDefinitionNames(); int getBeanDefinitionCount(); // æ˜¯å¦ä½¿ç”¨ä¸­ boolean isBeanNameInUse(String var1); } BeanDefinition:æ˜¯Springå¯¹Beanè§£æä¸ºï¼ŒSpringå†…éƒ¨çš„ BeanDefinition ç»“æ„ï¼Œæ˜¯å¯¹ç±»çš„æ•°æ®åŒ…è£…ï¼Œç±»å…¨é™å®šåï¼Œæ˜¯å¦æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¦æ˜¯æ‡’åŠ è½½çš„ï¼Œæ³¨å…¥æ–¹å¼æ˜¯ä»€ä¹ˆâ€¦ registerBeanDefinitions æ³¨å†Œæ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556@Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, org.springframework.beans.factory.support.BeanDefinitionRegistry registry) { // æ‹¿åˆ°æ³¨è§£ï¼Œç›®çš„æ˜¯æ‹¿åˆ°æ³¨è§£é‡Œçš„å±æ€§å€¼ï¼Œæ‹¿åˆ°å€¼åè¿›è¡Œæ‰«æï¼Œå¹¶ä¸”å¯¹ç»“æœè¿›è¡Œä¸€ä¸ªè½¬æ¢ AnnotationAttributes AnnotationAttributes mapperScanAttrs = AnnotationAttributes .fromMap(importingClassMetadata.getAnnotationAttributes(MapperScan.class.getName())); if (mapperScanAttrs != null) { registerBeanDefinitions(mapperScanAttrs, registry); } } /** * å¯¹ MapperScan çš„å±æ€§å€¼è¿›è¡Œä¸€ä¸ªè§£æå¤„ç† * @param annoAttrs * @param registry */ void registerBeanDefinitions(AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry) { /** * * ğŸŒŸ * è¿™æ˜¯Mybatisçš„ä¸€ä¸ªæ‰«æå™¨ * ä¹Ÿæ˜¯ ç»§æ‰¿äº† Springçš„æ‰«æå™¨ ClassPathBeanDefinitionScanner */ ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry); // this check is needed in Spring 3.1 Optional.ofNullable(resourceLoader).ifPresent(scanner::setResourceLoader); // ........ /** * è¯»å–åŒ…mapperåŒ…ä¸‹çš„è·¯å¾„ å’Œ è¦æ‰«æçš„ä¸€ç»„ mapper.class */ List&lt;String&gt; basePackages = new ArrayList&lt;&gt;(); basePackages.addAll( Arrays.stream(annoAttrs.getStringArray(&quot;value&quot;)) .filter(StringUtils::hasText) .collect(Collectors.toList())); basePackages.addAll( Arrays.stream(annoAttrs.getStringArray(&quot;basePackages&quot;)) .filter(StringUtils::hasText) .collect(Collectors.toList())); basePackages.addAll( Arrays.stream(annoAttrs.getClassArray(&quot;basePackageClasses&quot;)) .map(ClassUtils::getPackageName) .collect(Collectors.toList())); // ğŸŒŸè¿™æ˜¯è‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼Œä¸Springçš„é»˜è®¤æœºåˆ¶ä¸åŒ scanner.registerFilters(); // ğŸŒŸè°ƒç”¨æ‰«æå™¨ å¯¹åŒ…è·¯å¾„è¿›è¡Œæ‰«æ scanner.doScan(StringUtils.toStringArray(basePackages)); } æ‰«æå™¨ ClassPathMapperScannerclassPathMapperScanner æ˜¯mybatisçš„ä¸€ä¸ªç±»ï¼Œç»§æ‰¿äº† ClassPathBeanDefinitionScannerï¼Œé‡å†™äº†doScanæ–¹æ³•ï¼›ç„¶åä¹Ÿè°ƒç”¨äº† å®ƒçš„çš„æ‰«ææ–¹æ³•ã€‚å¹¶ä¸”å®šä¹‰äº†æ‰«æè§„åˆ™ï¼Œè¿˜æœ‰ä¸€äº›Beançš„è¿‡æ»¤ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªåŒ…ä¸‹ï¼Œä¸å•å•æœ‰ mapper æ¥å£çš„ç±»ï¼Œæˆ‘ä»¬çš„@MapperScanä¸»è¦å¤„ç†çš„æ˜¯ mapper æ¥å£ï¼Œæ‰€ä»¥å°†å…¶æ’é™¤: æ’é™¤æ‰éæ¥å£çš„ç±» 1234@Override protected boolean isCandidateComponent(AnnotatedBeanDefinition beanDefinition) { return beanDefinition.getMetadata().isInterface() &amp;&amp; beanDefinition.getMetadata().isIndependent(); } æ‰«æå™¨ ClassPathMapperScanner çš„doScanæ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„doScanæ–¹æ³•ï¼Œå¹¶ä¸”ä¹Ÿè°ƒç”¨äº†å®ƒçš„æ–¹æ³•ï¼Œé€šè¿‡çˆ¶ç±»çš„æ‰«æç»“æœï¼Œå°±å°† è¯¥åŒ…ä¸‹çš„æ‰€æœ‰ Mapperæ¥å£ï¼Œè§£ææˆäº† BeanDefinitionHolderï¼Œæ”¾åˆ°äº† seté›†åˆä¸­ã€‚ 12345678910111213@Overridepublic Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages) { Set&lt;BeanDefinitionHolder&gt; beanDefinitions = super.doScan(basePackages); if (beanDefinitions.isEmpty()) { LOGGER.warn(() -&gt; &quot;No MyBatis mapper was found in '&quot; + Arrays.toString(basePackages) + &quot;' package. Please check your configuration.&quot;); } else { // å¯¹æ‰«æç»“æœè¿›è¡Œå¤„ç†ï¼Œå¦‚æœä¸å¤„ç†çš„è¯ï¼Œè¿™ä¸ªæ¥å£å°±å½“ä½œäº† // ä¸€ä¸ªæ™®é€šçš„Beanæ³¨å…¥IOCäº†ï¼Œåœ¨å¼•å…¥è°ƒç”¨ï¼Œå°±ä¼šå‡ºç°é”™è¯¯äº†ã€‚ processBeanDefinitions(beanDefinitions); } return beanDefinitions;} BeanDefinitionHolderï¼šæ˜¯BeanDefinitionçš„æŒæœ‰è€…ï¼ŒåŒ…å«äº†Be naçš„ åå­—ï¼Œå’ŒBeançš„åˆ«åï¼Œä¹ŸåŒ…å«äº†BeanDefinitionã€‚ processBeanDefinitions å¤„ç†BeanDefinitionçš„BeanClass12345678910111213141516171819private void processBeanDefinitions(Set&lt;BeanDefinitionHolder&gt; beanDefinitions) { GenericBeanDefinition definition; // å¾ªç¯éå†ï¼Œä¸€ä¸ªä¸ªä¿®æ”¹ for (BeanDefinitionHolder holder : beanDefinitions) { definition = (GenericBeanDefinition) holder.getBeanDefinition(); String beanClassName = definition.getBeanClassName(); definition.getConstructorArgumentValues().addGenericArgumentValue(beanClassName); // å…³é”®æ­¥éª¤ï¼š è¿™å°† GenericBeanDefinition çš„BeanClass ä¿®æ”¹æˆäº†mapperFactoryBeanClassï¼› // æ‰«æç»“æœ è¿™ä¸ªbeanClass å°±æ˜¯ mapper.class definition.setBeanClass(this.mapperFactoryBeanClass); definition.getPropertyValues().add(&quot;addToConfig&quot;, this.addToConfig); // ......... } } } æˆ‘ä»¬çŸ¥é“Spring ä¸­æœ‰ä¸¤ç§Bean,ä¸€ç§æ˜¯ æ™®é€šçš„Bean,å¦ä¸€ç§å°±æ˜¯ FactoryBeanï¼Œå¦‚æœæ˜¯FactoryBeanåœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨å®ƒçš„ getObjectæ–¹æ³•è·å–å¯¹è±¡ã€‚ FactoryBean æ˜¯ä¸€ä¸ªæ¥å£ï¼šmybatisçš„ MapperFactoryBean å®ç°äº†å®ƒï¼› 123456789101112131415public interface FactoryBean&lt;T&gt; { // è·å–å¯¹åƒ @Nullable T getObject() throws Exception; // ç±»å‹ @Nullable Class&lt;?&gt; getObjectType(); // é»˜è®¤æ˜¯å•ä¾‹Bean default boolean isSingleton() { return true; }} MapperFactoryBeanï¼š MapperFactoryBean æœ‰ä¸¤ä¸ªå±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ª 1private Class&lt;T&gt; mapperInterface; è¿™ä¸ªå°±æ˜¯mapperæ¥å£çš„class,çœ‹å®ƒé‡å†™çš„getObject()æ–¹æ³•ï¼› 1234@Overridepublic T getObject() throws Exception { return getSqlSession().getMapper(this.mapperInterface);} æ˜¯ç”±å®ƒçš„SqlSessionçš„å…·ä½“ç±»å»è°ƒç”¨ å…¨å±€çš„é…ç½®æ–‡ä»¶ Configuration å¯¹è±¡ä¸­çš„ä¸€ä¸ªMapperRegisterå¯¹è±¡çš„ä¸€ä¸ªgetMapperæ–¹æ³•ï¼Œç„¶åæ ¹æ®classä» MapperRegister ä¸­çš„å±æ€§Map -&gt; knownMappers æ‹¿åˆ° MapperProxyFactoryä»£ç†å·¥å‚ï¼Œé€šè¿‡newInstanceæ–¹æ³•ä»£ç†ç”Ÿæˆå¯¹åƒï¼› 123456789101112131415161718public class MapperProxyFactory&lt;T&gt; { private final Class&lt;T&gt; mapperInterface; private final Map&lt;Method, MapperMethod&gt; methodCache = new ConcurrentHashMap&lt;&gt;(); // ........ // -------- @SuppressWarnings(&quot;unchecked&quot;) protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) { return (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), new Class[] { mapperInterface }, mapperProxy); } public T newInstance(SqlSession sqlSession) { final MapperProxy&lt;T&gt; mapperProxy = new MapperProxy&lt;&gt;(sqlSession, mapperInterface, methodCache); return newInstance(mapperProxy); }} è¿™å°±å®Œæˆäº†ä¸€ä¸ªå¯¹ mapperæ¥å£çš„å¤„ç†ã€‚ åœ¨myBatisçš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šå°†æ‰«æçš„mapperä¿¡æ¯è¿›è¡Œå°è£…ï¼Œæ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šåœ¨ Configuration ä¸­ï¼› æ¯”å¦‚ï¼šä¸€ä¸ª mapper æ¥å£ 1234package cn.thisforyou.blog.core.mapper;public interface PayMapper{ pay(String outNo)} å¯¹æ¥å£è¿›è¡Œè§£æï¼Œæ‹¿åˆ° Class: PayMapper.class ç„¶å è°ƒç”¨ MapperRegistryçš„ addMapperæ–¹æ³• åŒ…è£…æˆä¸€ä¸ªä»£ç†å¯¹åƒ MapperProxyFactory æ”¾åˆ°mapä¸­ï¼Œå°±æ˜¯ key-&gt; PayMapper.class,vaue:new MapperProxyFactory(class)ï¼› åœ¨æ³¨å…¥çš„æ—¶å€™ï¼Œå°±ä¼šgetObect()æ–¹æ³•ï¼Œæœ€åå°±è°ƒç”¨äº†MapperProxyFactory.newInstanceç”Ÿæˆä»£ç†å¯¹åƒã€‚ MapperRegistry åœ¨ Configurationå¯¹è±¡ä¸­ï¼› æœ€åï¼šmapperçš„@Autowired æ³¨å…¥çš„å…¶å®å°±æ˜¯ MapperFactoryBean é€šè¿‡å®ƒçš„getObjectæ–¹æ³•ï¼Œä»£ç†ç”Ÿæˆæ¥å£å¯¹è±¡ã€‚ æ€»ç»“ï¼š Mybatis çš„mapperæ¥å£ï¼Œæ˜¯æ€ä¹ˆè¢«æ‰«æçš„ï¼Ÿ Mybatis é€šè¿‡æ³¨è§£@MapperScan ä¸‹çš„@Importæ³¨è§£åŠ è½½ï¼ŒMapperScannerRegistrarç±»ï¼Œæ­¤ç±»ç»§æ‰¿äº†ImportBeanDefinitionRegistrarç±»,å¯¹beançš„æ³¨å†Œå¤„ç†ï¼Œåœ¨æ³¨å†Œä¹‹å‰ ä¼šæ‹¿åˆ° @MapperScan çš„ å‚æ•°å€¼ï¼Œmapper åŒ…è·¯å¾„ï¼Œç„¶åè°ƒç”¨new ClassPathMapperScanner(registry) ç±»å»æ‰«æï¼ŒClassPathMapperScanner extends ClassPathBeanDefinitionScanner,é‡å†™doScanæ–¹æ³•ï¼Œå®šä¹‰æ‰«æè§„åˆ™ï¼Œå¯¹æ‰«æç»“æœè¿›è¡Œæ›´æ”¹ BeanDefinition çš„beanClass è¿›è¡Œæ›¿æ¢æˆ MapperFactoryBeanClass; mapperæ¥å£æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨@Autowiredæ³¨å…¥ï¼Ÿ mapperæ¥å£æ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œæ˜¯é€šè¿‡ FactoryBean çš„æ–¹å¼æ³¨å…¥åˆ° IOC ä¸­ï¼Œé€šè¿‡è°ƒç”¨getObjectæ–¹æ³•ç”Ÿæˆä»£ç†å¯¹åƒ @Autowiredçš„ï¼›","link":"/posts/92011cd1/"},{"title":"mysqlä¸»ä»åŒæ­¥ï¼ˆä¸€ä¸»ä¸€ä»æ­å»ºï¼‰","text":"ä¸»æœåŠ¡å™¨|è§’è‰²|ä¸»æœº|ç‰ˆæœ¬||-|-|-||ä¸»æœåŠ¡å™¨|centos 7 106.14.226.138|5.7.11||ä»æœåŠ¡å™¨ï¼ˆdockerå®‰è£…çš„mysqlï¼‰|centos 7 thisforyou.cn| 5.7.28| 1ã€ä¸»æœåŠ¡å™¨:é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼šç¼–è¾‘ä¸»æ•°æ®è‹¦çš„é…ç½®æ–‡ä»¶my.cnf vim /etc/my.cnf 1234567891011[mysqld]basedir=/usr/local/mysqldatadir=/usr/local/mysql/dataport=3306# åœ¨åŸæœ‰åŸºç¡€ä¸Šå¢åŠ server_id=1log_bin=/usr/local/mysql/mysql-binlog_bin_index=/usr/local/mysql/mysql-bin-indexbinlog_format=mixed å‚æ•°è§£é‡Š server-idï¼šç”¨æ¥æ ‡è¯†ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ log_binï¼šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œmysqlç”¨æˆ·å¯¹è¯¥è·¯å¾„å¿…é¡»å…·æœ‰è¯»å†™æƒé™. log_bin_indexï¼šäºŒè¿›åˆ¶æ–‡ä»¶çš„ç´¢å¼•è·¯å¾„ï¼Œmysqlç”¨æˆ·å¯¹è¯¥è·¯å¾„å¿…é¡»å…·æœ‰è¯»å†™æƒé™. binlog_formatï¼šè¡¨ç¤ºäºŒè¿›åˆ¶æ—¥å¿—å†…å®¹çš„è®°å½•æ–¹å¼ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼š aã€row:åŸºäºè¡Œè®°å½•çš„æ–¹å¼ï¼ŒMySQLä¼šå°†çœŸå®å‘ç”Ÿå˜åŒ–çš„è¡Œè®°å½•è¿›æ—¥å¿—ï¼Œæ‰€ä»¥å¦‚æœæœ‰updateæ›´æ–°å…¨è¡¨çš„æ“ä½œï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¼šå˜å¾—éå¸¸å¤§ã€‚é€šå¸¸ç”¨äºSQLè¯­å¥å¤æ‚ä½†æ˜¯å½±å“çš„è¡Œæ¯”è¾ƒå°‘çš„åœºæ™¯ bã€statement:åŸºäºè¯­å¥çš„æ–¹å¼ï¼ŒMySQLä¼šå°†å¯¼è‡´æ•°æ®å‘ç”Ÿå˜åŒ–çš„SQLè¯­å¥è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€‚ç”¨äºä¸€æ¡è¯­å¥å½±å“å¾ˆå¤šè¡Œçš„åœºæ™¯ï¼Œä½†æ˜¯æ³¨æ„å½“åœ¨ä¸»åº“ä¸Šä½¿ç”¨åˆ°äº†UUIDï¼ŒSYSDATEï¼ŒFOUND_ROWSå‡½æ•°æ—¶ï¼Œä½¿ç”¨statementæ–¹å¼çš„å¤åˆ¶ä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µï¼› cã€mixed:æ··åˆè®°å½•æ¨¡å¼ï¼ŒMySQLä¼šè‡ªåŠ¨è¿›è¡Œåˆ¤æ–­å…·ä½“æ˜¯ä½¿ç”¨rowæ ¼å¼è¿˜æ˜¯statementæ ¼å¼ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½ä½¿ç”¨mixedï¼Œç”±MySQLæ¥è¿›è¡Œåˆ¤æ–­ log_binã€log_bin_index æ‰€åœ¨è·¯å¾„æˆè¯»å†™æƒé™ chown 777 /usr/local/mysql/ é‡å¯æ•°æ®åº“ï¼Œé…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚/etc/init.d/mysql restart ç™»é™†æ•°æ®åº“ æŸ¥çœ‹ binlogçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹show master status \\G è®°ä¸‹æ¥File:è¿™ä¸ªæ–‡ä»¶åç§°éœ€è¦åœ¨ä»æœåŠ¡å™¨ä¸Šç”¨åˆ°position: ä¹Ÿéœ€è¦ 2ã€å°†ä¸»æ•°æ®åº“ä¸Šçš„åº“ï¼ŒåŒæ­¥ä¸€ä»½åˆ°ä»æ•°æ®åº“ä¸Šã€‚ 3ã€ä»æœåŠ¡å™¨:ä¿®æ”¹ä¸Šçš„mysqlé…ç½®æ–‡ä»¶ã€‚mysqlå·²ç»å®‰è£…ï¼Œé…ç½®æ–‡ä»¶ä¸€æŒ‚è½½åˆ°å®¿ä¸»æœºç›®å½•ä¸­ã€‚ ä¿®æ”¹vim mysql.conf.d/mysqld.cnf 12345678910111213141516[mysqld]port = 3307pid-file = /var/run/mysqld/mysqld.pidsocket = /var/run/mysqld/mysqld.sockdatadir = /var/lib/mysqlmax_connections=200character-set-server=utf8max_allowed_packet=1024Mlog-error = /var/log/mysql/error.logprevent assorted security riskssymbolic-links=0# æ–°å¢server-id=2relay_log=/var/lib/mysql/mysql-replay-binrelay_log_index=/var/lib/mysql/mysql-replay-bin-index relay_logã€relay_log_index: è·¯å¾„æ˜¯å®¹å™¨ä¸­çš„ç›®å½• relay_logï¼š å°±æ˜¯ä»æœåŠ¡å™¨ä¸Šçš„binlogäºŒè¿›åˆ¶æ–‡ä»¶,å†…å®¹æ¥è‡ªäºï¼Œä¸»æœåŠ¡å™¨ä¸Šçš„bin_log å†…å®¹ã€‚ é…ç½®å¥½åé‡å¯mysql docker restart mysql/å®¹å™¨id è¿›å…¥mysqlå®¹å™¨docker exec -it mysql/å®¹å™¨id bash å¯ä»¥çœ‹çœ‹ /var/lib/mysql/ æ˜¯ä¸æ˜¯å¤šäº† mysql-replay-bin.0000*;ç³»åˆ—æ–‡ä»¶ ç™»é™†mysqlï¼Œå¹¶å¼€å¯ä¸»ä»æœåŠ¡mysql -uroot -p # ç™»é™† 123456789101112131415161718&gt;CHANGE MASTER TO master_host='106.14.226.138',master_port=3306,master_user='root',master_password='123',master_log_file='mysql-bin.000004',master_log_pos =1590; # master_host: ä¸»æ•°æ®åº“çš„ä¸»æœº# master_user: ä¸»æ•°æ®çš„ç™»é™†å¯†ç ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯rootè´¦æˆ·ï¼‰# master_password: å¯†ç # master_log_file: binlogäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‰é¢åœ¨ä¸»æ•°æ®çœ‹ä¸Šçœ‹åˆ°çš„ã€‚`show master status \\G` å¯çœ‹# master_log_pos: äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ç‚¹ `show master status \\G` å¯çœ‹ã€‚# æ•²ä¸‹å›è½¦# å¼€å¯slave&gt; start slave;&gt; SHOW SLAVE STATUS \\G å¦‚ä¸‹å›¾ï¼š âš ï¸ï¼šSlave_IO_Runningä¸ºYesè¡¨ç¤ºä¸»ä»åŒæ­¥æˆåŠŸï¼Œå¦‚æœä¸ºConnectingâ€¦ï¼Œç­‰å¾…ä¸€ä¼šå†çœ‹çœ‹ï¼Œå¦‚æœä¸ºNoï¼Œè¡¨ç¤ºåŒæ­¥å¤±è´¥ï¼›âš ï¸ï¼šå¤±è´¥çš„åŸå› æœ‰è‚¯èƒ½æ˜¯ï¼Œè´¦å·å¯†ç ä¸å¯¹ï¼Œä¸»æ•°æ®çœ‹çš„ç«¯å£ï¼Œæ²¡æœ‰å¤–æ”¾ï¼Œä¸å…è®¸å…¶ä»–ipç™»é™†ï¼Œæˆ–è€…è´¦å·æ²¡æœ‰æƒé™â€¦ æ­¤æ—¶ï¼Œå¯ä»¥å»ä¸»æ•°æ®åº“å½•å–ä¸€æ¡æ•°æ®æµ‹è¯•çœ‹çœ‹æ˜¯å¦æˆåŠŸï¼ å‚è€ƒï¼šhttps://segmentfault.com/a/1190000015282191","link":"/posts/c357a4cf/"},{"title":"ä½¿ç”¨Docker å¿«é€Ÿå®‰è£… NextCloud ä¸ªäººç§æœ‰äº‘ç›˜ å¹¶ä¸”è¿æ¥ Mysql æ•°æ®åº“ï¼Œç½‘é€Ÿè¶…å¿«","text":"1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£â€‹ å‚è€ƒï¼šcentos å®˜ç½‘å®‰è£…æ•™ç¨‹ 2ã€mysqlå®‰è£… å®‰è£…å‚è€ƒï¼šdockerHub æ•™ç¨‹ 1docker pull mysql # æ‹‰å–é•œåƒ 1docker images # æŸ¥çœ‹åç§°/é•œåƒid 1docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d é•œåƒid è¿è¡Œmysql å¹¶ä¸”è®¾ç½®è®¿é—®ç«¯å£ï¼š3306ï¼Œå®¹å™¨åç§°ï¼šmysql ,ç®¡ç†å‘˜å¯†ç ï¼š123456 é…ç½®ä¸€ä¸ªè´¦æˆ·å’Œæƒé™ç»™ nextcloud ç½‘ç›˜ä½¿ç”¨/ ä¹Ÿå¯ä»¥ä¸åˆ›å»ºç”¨æˆ·ï¼Œä½¿ç”¨root,åˆ›å»ºä¸ªæ•°æ®è£¤å³å¯ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿˜æ˜¯å•ç‹¬åˆ†é…æƒé™çš„å¥½ã€‚ 1docker exec -it å®¹å™¨åç§°/å®¹å™¨id bash ç™»é™†mysql 1mysql -uroot -p æ¥ç€è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š123456 å›è½¦ åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ 1CREATE DATABASE nextcloud; åˆ›å»ºä¸€ä¸ªç”¨æˆ· 1CREATE USER 'nextcloud'@'%' IDENTIFIED BY '123456'; åˆ›å»ºä¸€ä¸ªç”¨æˆ· åç§°ä¸ºï¼šnextcloudï¼›â€˜%â€™ï¼šä»£è¡¨ä¸é™ipç™»é™†ï¼Œè¿œç¨‹ç™»é™†; å¯†ç ä¸ºï¼š123456ã€‚ æˆæƒ 1GRANT ALL ON nextcloud.* TO nextcloud@'%' IDENTIFIED BY '123456'; ç»™è¿™ä¸ªç”¨æˆ· nextcloud æˆäºˆ è¿™ä¸ªæ•°æ®åº“ nextcloud.* æ‰€æœ‰çš„æƒé™ï¼Œè¿œç¨‹ç™»é™†ï¼Œå¯†ç ä¸º 123456ï¼› 2ã€NextCloud å®˜ç½‘ nextcloudå®˜ç½‘ è¿›å…¥å®˜ç½‘å…ˆçœ‹æ•™ç¨‹ï¼š ç¬¬ä¸€æ­¥ä¸‹è½½é•œåƒï¼š 1docker pull rootlogin/nextcloud åˆ›å»ºä¸€ä¸ªç›®å½•å°†é•œåƒçš„æ•°æ®æŒ‚è½½åˆ°å®¿ä¸»æœºä¸­ åœ¨æœåŠ¡å™¨ä¸Šï¼Œè‡ªå·±æ‰¾ä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚æˆ‘çš„ï¼Œ/usr/local/software/docker/ 1mkdir -p /usr/local/software/docker/nextcloud/data ç¼–å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬ 12cd /usr/local/software/docker/nextcloud/ &amp;&amp; vim start.sh ç„¶åå¡«å†™å¦‚ä¸‹å†…å®¹ï¼š 1234567docker stop nextcloud &amp;&amp; docker rm nextclouddocker run -d -p 9989:80 --name nextcloud \\ --privileged=true \\ --restart=always \\ --link mysql:next_cloud_db \\ # è¿™ä¸€è¡Œå‰é¢çš„ `mysql` æ˜¯ mysql å®¹å™¨çš„åç§°ï¼Œå†’å·åçš„ è‡ªå®šä¹‰çš„ - v /usr/local/software/docker/nextcloud/data:/data \\ # æ•°æ®æŒ‚è½½åˆ°å®¿ä¸»æœºä¸­ rootlogin/nextcloud å°†80ç«¯å£æ˜ å°„ä¸ºå¤–éƒ¨è®¿é—®ç«¯å£ 9989ï¼š ç«¯å£è‡ªå®šä¹‰ï¼› å¦‚æœæœåŠ¡å™¨é˜²ç«å¢™æ²¡æœ‰å…³ï¼Œå¼€æ”¾ç«¯å£ï¼Œä¸ç„¶æ— æ³•è®¿é—®ï¼š 1firewall-cmd --zone=public --add-port=9989/tcp --permanent &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --zone=public --list-ports å¼€æ”¾ç«¯å£ï¼Œå¹¶ä¸”reload é˜²ç«å¢™ä½¿å…¶ç”Ÿæ•ˆï¼ŒæŸ¥çœ‹å·²å¼€æ”¾ç«¯å£ã€‚ å¯åŠ¨nextcloud 1cd /usr/local/software/docker/nextcloud/ &amp;&amp; sh start.sh 1docker ps # æ£€æµ‹å¯åŠ¨æ˜¯å¦æˆåŠŸ æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼šhttp://æœåŠ¡å™¨ip:9989 è¿›å…¥é¡µé¢åï¼Œéœ€è¦å¡«å†™è´¦æˆ·æ–°ç”¨æˆ·è´¦æˆ·å¯†ç ï¼šè¿˜æœ‰æ•°æ®åº“ æŒ‰å›¾ç‰‡å¡«å†™å³å¯ï¼Œå¡«å†™å®Œæˆç‚¹å‡» å®‰è£…å®Œæˆï¼Œç­‰å¾…ä¸ª1ï½2æ—¶é—´ï¼ŒæˆåŠŸä¹‹åï¼Œå°±ä¼šç›´æ¥è¿›å…¥ä¸»é¡µé¢ï¼› æ­¤å¤„ï¼Œåœ¨ç”¨æˆ·æˆæƒçš„æ—¶å€™ï¼Œæœ€å¥½ç›´æ¥å¡«å†™ All ä¸è¦ä¸€ä¸ªä¸ªå†™ï¼Œå®¹æ˜“æ¼æ‰æƒé™ï¼Œä»¥å…å¸¦æ¥ï¼Œåˆ›å»ºæ•°æ®åº“çš„çš„æ—¶å€™ï¼ŒæŠ¥æ²¡æœ‰æƒé™çš„é”™è¯¯ã€‚ å¤§åŠŸå‘Šæˆã€‚ çœ‹çœ‹mysqlæ•°æ®è£¤æœ‰å¤šå°‘ä¸œè¥¿ï¼š çœ‹ oc_usersè¡¨ä¸­ä¼šæœ‰ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯†ç æ˜¯åŠ è¿‡å¯†çš„ï¼› é…ç½®æ–‡ä»¶åœ¨ï¼š/usr/local/software/docker/nextcloud/data ä¸­ï¼Œéœ€è¦ä¿®æ”¹åœ¨é‚£é‡Œæ”¹å³å¯ï¼› ::: hljs-center å…³æ³¨å…¬ä¼—å·æ¯å¤©ä¸ºä½ åˆ†äº« æ›´å¤šå†…å®¹ :::","link":"/posts/f01f8482/"},{"title":"åå°„å®æˆ˜ï¼ŒåŸºäºæ³¨è§£çš„å½¢å¼ï¼Œå¸¦ä½ å®ç°ç±»ä¼¼jpaçš„æ­£å‘ç”Ÿæˆæ•°æ®åº“è¡¨çš„starter","text":"::: hljs-left åå°„-å®æˆ˜::: ==è„±ç¦»å®æˆ˜çš„è®²è§£ éƒ½æ˜¯ æµæ°“ï¼Œæˆ‘ä»¬å³å°†è¿›è¡Œåå°„çš„å®æˆ˜== æˆ‘ä»¬å°†å®ç°ä¸€ä¸ª æ ¹æ® å®ä½“ bean åŠ ä¸Šæˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£ æ­£å‘ç”Ÿæˆå‘åº“é‡Œ ç”Ÿæˆå¯¹åº”çš„è¡¨çš„ä¸€ä¸ª starter (SpringBoot ) æˆ‘ä»¬çš„é¡¹ç›®å¾—å…ˆå¼•å…¥ä¾èµ– mysql é©±åŠ¨: 123456&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt;&lt;/dependency&gt; 1ã€å»ºç«‹å¥½æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆSpringBootï¼‰ demo-test æ˜¯æµ‹è¯•é¡¹ç›®\\nforward-generation-starter å°±æ˜¯ä¸€ä¸ªè‡ªå·±é€ çš„ä¸€ä¸ªstarter,æ‰“äº†ä¸€ä¸ªjar å¯ä»¥è‡ªè¡Œå¼•å…¥ 2ã€è‡ªå®šä¹‰æ³¨è§£è¯´æ˜ @EnableAutoForwardGeneration æ˜¯å¦å¼€å¯ä¸»åŠ¨ç”Ÿæˆè¡¨æ“ä½œ æ”¾åœ¨Appå¯åŠ¨ç±»é‡Œé¢ OnOff() true:å¼€å¯ï¼Œfalse:ä¸å¼€å¯ 1234567891011121314151617/** * &lt;br&gt; * å¼€å¯æ­£å‘ç”Ÿæˆæ“ä½œ * @author æ°¸å¥ * @since 2019/5/7 14:21 */ @Retention(RetentionPolicy.RUNTIME) @Target(ElementType.TYPE) @Documented\\n@Import(RegisterScaner.class) public @interface EnableAutoForwardGeneration { // æŒ‡å®šå®ä½“ç±»æ‰€åœ¨çš„åŒ… String entityPackages(); // æ˜¯å¦å¼€å¯è¡¨è‡ªåŠ¨ç”Ÿæˆ boolean OnOff() default true; } 2.@LColumn åˆ—å±æ€§æ³¨è§£ 12345678910111213141516171819202122232425262728293031323334353637/** * &lt;br&gt; * åˆ—æ³¨è§£ * @author æ°¸å¥ * @since 2019/5/7 14:37 */ @Retention(RetentionPolicy.RUNTIME) @Target(ElementType.FIELD) @Documented public @interface LColumn { /** * &lt;br&gt; * åˆ—é•¿åº¦ String ç±»å‹çš„é»˜è®¤ä¸º */ int width() default 0; /** * &lt;br&gt; * æŒ‡å®šæ•°æ®åº“ç±»å‹ */ ColumnType type() default ColumnType.FIELDTYPE; /** * &lt;br&gt; * åˆ—æ˜¯å¦é»˜è®¤ä¸ºç©º */ boolean isNull() default true; /** * &lt;br&gt; * æ˜¯å¦æœ‰é»˜è®¤å€¼ */ String defaultValue() default &quot;&quot;; /** * &lt;br&gt; * æ³¨é‡Š */ String comment() default &quot;&quot;; } 3.@LIncrement 1234567891011121314/** * &lt;br&gt; * æ˜¯å¦è‡ªå¢ * @author æ°¸å¥ * @since 2019/5/7 15:01 */@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.FIELD)@Documentedpublic @interface LIncrement{ IdType type() default IdType.NONE; } 4.@LNotTableField æ’é™¤éè¡¨ä¸­å­—æ®µ 123456789101112/** * &lt;br&gt; * æ’é™¤éè¡¨ä¸­å­—æ®µ * @author æ°¸å¥ * @since 2019/5/7 15:09 */ @Retention(RetentionPolicy.RUNTIME) @Target(ElementType.FIELD) @Documented\\npublic @interface LNotTableField { } 5.LTable å®ä½“æ³¨è§£ æŒ‡å®šè¡¨å 12345678910111213/** * &lt;br&gt; * å®ä½“æ³¨è§£ æŒ‡å®šè¡¨åå¦åˆ™è½¬ä¸‹åˆ’çº¿ * @author æ°¸å¥ * @since 2019/5/7 15:23 */ @Retention(RetentionPolicy.RUNTIME) @Target(ElementType.TYPE) @Documented\\npublic @interface LTable { String name() default &quot;&quot;; } 6.@LTableId ä¸»é”®æ³¨è§£ 123456789101112/** * &lt;br&gt; * ä¸»é”®æ³¨è§£ * @author æ°¸å¥ * @since 2019/5/7 14:36 */ @Retention(RetentionPolicy.RUNTIME) @Target(ElementType.FIELD) @Documented public @interface LTableId\\n{ IdType type() default IdType.NONE; } 3ã€æ³¨è§£ä½¿ç”¨ä¾‹å­å®ä½“ä¸Šçš„æ³¨è§£ 123456789101112131415161718192021/** * &lt;br&gt; * * @author æ°¸å¥ * @since 2019/5/7 17:31 */ @LTable(name = &quot;tb_user&quot;) public class User extends BaseEntity { @LTableId(type = IdType.AUTO) @LColumn(width = 11,type = ColumnType.INT,isNull = false,comment = &quot;ä¸»é”®&quot;) private Integer id; @LColumn(width = 64,isNull = true,comment = &quot;å§“å&quot;,type = ColumnType.VARCHAR) private String name; @LColumn(width = 0,isNull = true,comment = &quot;å‡ºç”Ÿæ—¥æœŸ&quot;) private Date birthDay; @LNotTableField private Company company; // get set çœç•¥ } App å¯åŠ¨ç±»åŠ ä¸Šæ³¨è§£ 123456789@SpringBootApplication@EnableAutoForwardGeneration(entityPackages=&quot;com.example.demo.entity&quot;,OnOff = true)public class DemoApplication{ public static void main(String[] args) { SpringApplication.run(DemoApplication.class, args); }} application.yml é…ç½® 12345678spring: datasource: driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://127.0.0.1:3307/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8 username: root password: tiger #update åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šæ›´æ–°,createï¼šåˆ é™¤åŸæ¥çš„è¡¨ æ ¹æ®å®ä½“ä¿¡æ¯é‡æ–°å»º ddl-auto: create 4ã€æ€è·¯&emsp;å…¶å®æˆ‘æ˜¯å­¦ mybatisçš„åˆå§‹åŒ–è¿‡ç¨‹çš„ï¼Œä¹‹å‰æœ‰çœ‹è¿‡mybatis æºç ï¼Œmybatis ä¹Ÿæ˜¯åˆ©ç”¨Springçš„æ‰«ææ¥å£ å»æ‰«æçš„ mappeer.java æ–‡ä»¶ï¼›mybatis mappeæ¥å£æ‰«æ &emsp;ä½¿ç”¨SpringBoot è‡ªå®šä¹‰ä¸€ä¸ªstarter,åˆ©ç”¨Springçš„ClassPathBeanDefinitionScanner.java çš„ doScanæ‰«ææ¥å£ï¼Œè‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŠ äº†@LTable æ³¨è§£çš„å®ä½“ï¼› &emsp;åœ¨starter ä¸­çš„LyjAutoConfigure å®ç°äº InitializingBean.java ä¸­çš„afterPropertiesSet æ–¹æ³•ï¼Œåœ¨åˆå§‹åŒ–beançš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ConfigurableListableBeanFactory.java ä¸­çš„æ–¹æ³• getBeansWithAnnotation(Class&lt;? extends Annotation&gt; var1) æ‹¿åˆ°åŠ äº†æˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£çš„beanäº†ã€‚ 12345678910111213141516171819202122232425262728@Overridepublic void afterPropertiesSet(){ // è·å–è‡ªå®šä¹‰ç±»æ³¨è§£çš„ç±» List&lt;Class&lt;?&gt;&gt; classes = new ArrayList&lt;&gt;(); Map&lt;String, Object&gt; map = beanFactory.getBeansWithAnnotation(LTable.class); for (Map.Entry&lt;String, Object&gt; entry : map.entrySet()) { classes.add(entry.getValue().getClass()); } if (classes.size()&lt;=0){ return; } ConfigureEntityTable configureEntity = new ConfigureEntityTable(); configureEntity.setProperties(this.mySqlProperties); // è§£æå®ä½“ EntityParserHandler parserHandler = new EntityParserHandler(configureEntity); parserHandler.parser(classes); // è¯»å–æ•°æ®åº“ä¸­çš„è¡¨ä¿¡æ¯ TableParserHandler tableParserHandler = new TableParserHandler(configureEntity,ddlExecutor); tableParserHandler.parser(); DataBaseServiceHandler serviceHandler = new DataBaseServiceHandler(this.ddlExecutor,configureEntity); serviceHandler.excute(); logger.info(&quot;è¡¨å·²æ›´æ–°--------&gt;&quot;);} æ‹¿åˆ°äº†æˆ‘ä»¬çš„beançš„ä¿¡æ¯ï¼Œè¿™ä¼šå°±å¯ä»¥é€šè¿‡åå°„ï¼Œå»è¯»å–ç±»çš„ç›¸å…³ä¿¡æ¯äº†ï¼Œæ¯”å¦‚ ç±»ä¸Šçš„æ³¨è§£å•Šï¼Œå±æ€§æ³¨è§£å•Šï¼Œç­‰ã€‚è¿™ä¼šå°±å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯ï¼Œå±æ€§åï¼Œè½¬é©¼å³°ï¼Œå’ŒåŠ ä¸Šæ³¨è§£çš„ä¸€äº›é…ç½®å€¼ï¼Œå°±å¯ä»¥ç”Ÿæˆ æˆ‘ä»¬çš„DDlè¯­å¥äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ è¿ä¸Šæ•°æ®åº“äº† æ‰§è¡Œæˆ‘ä»¬çš„sqlè¯­å¥å»è§è¡¨äº†ã€‚ âš ï¸ åªæ˜¯ä¸€ä¸ªdemo ï¼Œå¯¹åå°„çš„å®è·µæ“ä½œé¡¹ç›®æºç  github æºç ","link":"/posts/740692cb/"},{"title":"å¦‚ä½•å°†ç§æœ‰jar,ä¸Šä¼ åˆ°è‡ªå·±çš„nexusç§æœé‡Œé¢å»ï¼Ÿ","text":"å»ºç«‹ä¸€ä¸ªStarterä¾‹å¦‚æˆ‘çš„ä¸€ä¸ª ç±»ä¼¼ jpa é‚£æ ·çš„æ­£å‘å·¥å…·ç”Ÿæˆstarter ä¸»è¦é…ç½® pom.xmlåœ¨pomæ–‡ä»¶ä¸­åŠ å…¥ ä¸ dependencies æ ‡ç­¾åŒçº§ 12345678910&lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;releases&lt;/id&gt; &lt;url&gt;http://thisforyou.cn:28081/repository/maven-releases/&lt;/url&gt; &lt;/repository&gt; &lt;snapshotRepository&gt; &lt;id&gt;snapshots&lt;/id&gt; &lt;url&gt;http://thisforyou.cn:28081/repository/maven-snapshots/&lt;/url&gt; &lt;/snapshotRepository&gt; &lt;/distributionManagement&gt; âš ï¸1.idæ ‡ç­¾ï¼šéšä¾¿èµ·ï¼Œä½†æ˜¯mavenä»“åº“ä¸­çš„serversèŠ‚ç‚¹éœ€è¦ä¸è¿™ä¸ªä¸€è‡³2.urlï¼šå°±æ˜¯ä½ çš„ä»“åº“åœ°å€ï¼šhttp://thisforyou.cn:28081/repository/maven-releaseså¦‚ä¸‹å›¾æ‰€ç¤ºï¼šä¸¤ä¸ªurl:ä¸€ä¸ªæ˜¯ç‰ˆæœ¬å¸¦-SNAPSHOT çš„ä¸€ä¸ªæ˜¯ä¸å¸¦çš„ maven-releasesï¼šå¦‚æœä½ çš„starterä¸versionä¸å¸¦SNAPSHOTï¼Œå°±ä¼šä¸Šä¼ åˆ°è¿™ä¸ªä»“åº“ä¸­ï¼Œä»£è¡¨çš„æ˜¯æ­£å¼ç¨³å®šå‘å¸ƒç‰ˆæœ¬ã€‚maven-snapshotsï¼šå¸¦SNAPSHOTï¼Œå°±æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œå¼€å‘ä¸­çš„ã€‚ ä¸Šé¢è¿™ä¸¤ä¸ªä»“åº“æ˜¯è¦å¯¹åº” nexusä¸Šçš„ä¸ç„¶æ‰“åŒ…ä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ æ‰¾ä¸åˆ°å¯¹åº”çš„ä»“åº“çš„ã€‚ pomæ–‡ä»¶é…ç½®å¥½åï¼Œå°±ç›´æ¥clean ç„¶å deploy; æŸ¥çœ‹ä»“åº“æ˜¯å¦å·²ç»ä¸Šä¼ äº†ï¼š ç‚¹å‡»è¿›å»çœ‹çœ‹ï¼Œmaven-public ä¼šåŒ…å«ä¸¤ä¸ª ä¸€ä¸ª ä¸å¸¦SNAPSHOTï¼Œä¸€ä¸ªå¸¦çš„ï¼Œå¦‚æœä¸¤ä¸ªéƒ½ä¸Šä¼ äº†ï¼Œå°±ä¼šæœ‰ä¸¤ä¸ªã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™çš„ maven çš„ settings.xmlé…ç½® å†™maven-publicå°±å¥½äº†ã€‚ maven settings.xmlé…ç½®servers èŠ‚ç‚¹æ‰¾åˆ°æˆ‘ä»¬çš„æœ¬åœ°å¼€å‘çš„mavené…ç½®æ–‡ä»¶ï¼Œ conf/settiings.xml æ‰“å¼€ç¼–è¾‘ä»–ï¼šæ‰¾åˆ° servers èŠ‚ç‚¹ï¼š å¡«å†™å¦‚ä¸‹ä¿¡æ¯è®°ä½è¿™ä¸ª *id è¦ä¸ pom.xml é‚£é‡Œçš„ idä¸€è‡³*username å°±æ˜¯ä½ çš„è´¦å·*password å°±æ˜¯å¯†ç  é…ç½®å¥½ä¸¤ä¸ªï¼šä¸€ä¸ªå¿«ç…§çš„ ä¸€ä¸ª ç¨³å®šç‰ˆæœ¬çš„ã€‚ mirrors èŠ‚ç‚¹id:éšä¾¿å†™name:éšä¾¿å†™url:å¡«å†™nexusçš„maven-publicåœ°å€å³å¯ ä»ç§æœæ‹‰å–æˆ‘ä»¬çš„jaråŒ…æ‰“å¼€å¦å¤–ä¸€ä¸ªé¡¹ç›®ï¼šå¡«å†™å¥½ï¼Œåˆ·æ–°ä¸€ä¸‹å³å¯ Starter æºç ","link":"/posts/7bc7c52/"},{"title":"å°†jaråŒ…åšæˆç³»ç»ŸæœåŠ¡-linux","text":"SpringBootçš„é¡¹ç›®éƒ¨ç½²æœ‰å¥½å‡ ç§ï¼Œæœ‰dockeræ–¹å¼ï¼Œæœ‰waråŒ…é€šè¿‡tomcatéƒ¨ç½²æ–¹å¼ï¼Œä¹Ÿæœ‰ java -jar çš„éƒ¨ç½²æ–¹å¼ã€‚ æœ¬æ–‡ æ˜¯åŸºäº java -jar æ¥å¯åŠ¨éƒ¨ç½²é¡¹ç›®ï¼Œåšæˆç³»ç»ŸæœåŠ¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ 1ã€è„šæœ¬ç¼–å†™ç›®å½•ï¼š/opt/project jaråŒ…å’Œå¯åŠ¨åœæ­¢è„šæœ¬éƒ½åŸºäºè¿™é‡Œæ“ä½œï¼Œ ä¸€ä¸‹çš„æ“ä½œå‘½ä»¤ éƒ½åŸºäº è¿™ä¸ªå‘½ä»¤ ä¹‹å cd /opt/project å°†é¡¹ç›®æ‰“å¥½çš„jaråŒ…ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨çš„æŸä¸ªè·¯å¾„ä¸­ï¼Œæ¯”å¦‚ï¼š/opt/project/boot-test.jar åœ¨æœ¬ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª å¯åŠ¨è„šæœ¬ start.sh ç¼–å†™å¯åŠ¨è„šæœ¬ 12345#!bin/shsource /etc/profile# å¯åŠ¨å‘½ä»¤ nohup&gt;/opt/project/log java -jar /opt/project/jar/boot-test.jar 2&gt;&amp; 1 &amp; åœæ­¢è„šæœ¬ stop.sh 12345#!bin/shpid=$(ps -ef | grep boot-test.jar | grep -v grep | awk '{print $2}')kill -9 $pidecho $pid æ–‡ä»¶æˆæƒ å¦‚æœè„šæœ¬ä¸æˆæ‰§è¡Œæƒé™ä¼šå‡ºç° 203 çš„é”™è¯¯ 123chmod +x start.shchmod +x stop.shchmod +x boot-test.jar ç¼–å†™æœåŠ¡æ–‡ä»¶ vim /etc/systemd/system/boot-test.serivce å¡«å†™å†…å®¹ï¼š 123456789101112131415161718[Unit]Description=blog-serviceAfter=network.target[Service]Type=forkingExecStart=/opt/project/blog/start.shExecStop=/opt/project/stop.shPrivateTmp=true[Install] WantedBy=multi-user.target 2ã€ç‰¹åˆ«æ³¨æ„ 203 é”™è¯¯åŸå› : start.sh å’Œ stop.sh ä¸æˆäºˆæ‰§è¡Œæƒé™ã€‚ è§£å†³ï¼šchmod +x start.sh &amp;&amp; chmod +x stop.sh è„šæœ¬å¤´éƒ¨æ²¡æœ‰å†™ #!bin/shã€‚vim åŠ ä¸Šå³å¯ jaråŒ…æ²¡æœ‰æ‰§è¡Œæƒé™ã€‚ chmod +x boot-test.jar å…¶å®ƒé”™è¯¯åŸå› ï¼š ä¾‹å¦‚æ‰§è¡Œå®Œå¯åŠ¨å‘½ä»¤ï¼ŒåæŸ¥çœ‹çŠ¶æ€ systemctl status boot-test.service å¯åŠ¨å‘½é¢˜æç¤ºæˆ status=0/SUCCESS ä½†æ˜¯å¤±è´¥ã€‚ è¿™ç§æƒ…å†µå¯èƒ½æ˜¯ï¼šæ‰§è¡Œçš„ jaråŒ…æ‰€éœ€è¦çš„ç¯å¢ƒæ²¡æœ‰ã€‚æ— æ³•å¯åŠ¨ï¼ŒjaråŒ…æ‰€éœ€è¦çš„ç¯å¢ƒæ˜¯ javaç¯å¢ƒã€‚ è§£å†³åŠæ³•ï¼š åœ¨å¯åŠ¨è„šæœ¬ çš„ #!bin/sh ä¸‹é¢åŠ ä¸Š ç¯å¢ƒå˜é‡ source /etc/profile æ­¤å‘½ä»¤å‰ææ˜¯ Javaå·²ç»åœ¨è¿™æ–‡ä»¶ä¸­é…ç½®äº†ç¯å¢ƒå˜é‡ï¼›æˆ–è€… export 123export JAVA_HOME=/usr/local/software/java/jdkexport PATH=$JAVA_HOME/bin:$PATH:/opt/project/Hexo/node_modules/.bin:$PATH åœ¨/etc/systemd/system/boot-test.serviceä¸­åŠ å…¥ç¯å¢ƒå˜é‡ã€‚æ›´å¤šé…ç½® ç§»æ­¥ System.service é…ç½®è¯¦æƒ…è¯´æ˜ äºŒè€…é€‰ä¸€å³å¯ã€‚ 3ã€è®¾ç½®å¼€æœºè‡ªå¯systemctl enable boot-test å¯åŠ¨ï¼šsystem start boot-test æŸ¥çœ‹çŠ¶æ€ï¼šsystem stop boot-test","link":"/posts/180c3fe2/"},{"title":"æ ¹æ®ArrayListåŸç†ï¼Œå®ç°ä¸€ä¸ªè‡ªå·±çš„ArrayList ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚","text":"æ‰‹å†™â—†ArrayList &emsp; åœ¨å‰é¢ä¸€ç« ä¸­ï¼Œåˆ†æäº†ArrayListçš„å®ç°åŸç†ï¼Œç°åœ¨æ ¹æ®å®ƒçš„æ€è·¯ï¼Œè‡ªå·±é€ ä¸€ä¸ªArrayList å±æ€§12345678910 //é»˜è®¤åˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦ private static final int DEFAULT_CAPACITY = 10; //å®šä¹‰ä¸€ä¸ªæ•°ç»„ private Object[] elementData;//ç©ºæ•°ç»„ private static final Object[] EMPTY_ELEMENTDATA = {}; //æœ€å¤§å®¹é‡ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; //æ•°ç»„å®é™…å¤§å° private int size; æ„é€ 12345678910111213141516171819/** * é»˜è®¤æ„é€ å‡½æ•° æ•°ç»„é•¿åº¦ä¸º10 **/ public MyArrayList() { this.size = 0; this.elementData = EMPTY_ELEMENTDATA; } /** * å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œå¦‚æœæ•°ç»„å°äº0åˆ™æŠ›å¼‚å¸¸ */ public MyArrayList(int initialCapacity) { if (initialCapacity &lt; 0) { throw new IllegalArgumentException(&quot;åˆå§‹å®¹é‡ä¸èƒ½å°äº0 &quot; + initialCapacity); } this.elementData = new Object[initialCapacity]; } public int size() { return size; } add(T t)123456789101112131415161718192021222324252627282930/** * æ·»åŠ æ–¹æ³• * 1.æ·»åŠ ä¹‹å‰æ£€æŸ¥æ•°ç»„å®¹é‡æ˜¯å¦å¤Ÿç”¨ * 2.å¦‚æœä¸å¤Ÿç”¨åˆ™å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹,æ‰©å®¹ä¸ºåŸæ¥é•¿åº¦çš„1.5å€ * */ public void add(T t) { ensureCapacityInternal(size + 1); elementData[size++] = t; } /** * * æŒ‡å®šä½ç½®æ’å…¥ *1.å…ˆæ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ * 2.æ˜¯å¦æ˜¯å¦éœ€è¦æ‰©å®¹ * 3.æŒ‡å®šä½ç½®åè¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€åç§»åŠ¨ä¸€ä½ * æ’å…¥å’Œåˆ é™¤æ•ˆç‡ä½ä¸‹ */ public void add(int index, T t) { //1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ rangeCheckForAdd(index); //2.æ˜¯å¦æ‰©å®¹ ensureCapacityInternal(size + 1); //ç§»ä½ for (int i = size(); i &gt; index; i--) { elementData[i] = elementData[i - 1]; } elementData[index] = t; size++; } get(int i)12345678/** * getæ–¹æ³• é€šè¿‡ä¸‹æ ‡å»æ•°æ® * 1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ */public T get(int index) { rangeCheckForAdd(index); return (T) elementData[index];} remove(Object o)123456789101112131415161718192021222324/** * æ ¹æ®å…ƒç´ åˆ é™¤æ–¹æ³• * 2.åˆ é™¤æŒ‡å®šä½ç½®çš„å‰è¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€å‰ç§»åŠ¨ä¸€ä½ */public boolean remove(Object o) { if (o == null) { //ç§»ä½ for (int i = 0; i &lt; size(); i++) { if (elementData[i] == null) { fastRemove(i); return true; } } } else { for (int i = 0; i &lt; size(); i++) { if (elementData[i].equals(o)) { fastRemove(i); return true; } } } return false;} å®Œæ•´ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205package com.example.demo;import java.util.ArrayList;import java.util.Arrays;/** * Author: yj * * @Discription: * @Date:11:51 2018/8/16 * * åŸºäºæ•°ç»„å®ç°çš„ï¼š * ä¼˜ç¼ºç‚¹ï¼šæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢ * * */public class MyArrayList&lt;T&gt; { //é»˜è®¤åˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦ private static final int DEFAULT_CAPACITY = 10; //å®šä¹‰ä¸€ä¸ªæ•°ç»„ private Object[] elementData; //ç©ºæ•°ç»„ private static final Object[] EMPTY_ELEMENTDATA = {}; //æœ€å¤§å®¹é‡ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; //æ•°ç»„å®é™…å¤§å° private int size; /* * é»˜è®¤æ„é€ å‡½æ•° æ•°ç»„é•¿åº¦ä¸º10 * */ public MyArrayList() { this.size = 0; this.elementData = EMPTY_ELEMENTDATA; } /** * å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œå¦‚æœæ•°ç»„å°äº0åˆ™æŠ›å¼‚å¸¸ */ public MyArrayList(int initialCapacity) { if (initialCapacity &lt; 0) { throw new IllegalArgumentException(&quot;åˆå§‹å®¹é‡ä¸èƒ½å°äº0 &quot; + initialCapacity); } this.elementData = new Object[initialCapacity]; } public int size() { return size; } /** * æ·»åŠ æ–¹æ³• * 1.æ·»åŠ ä¹‹å‰æ£€æŸ¥æ•°ç»„å®¹é‡æ˜¯å¦å¤Ÿç”¨ * 2.å¦‚æœä¸å¤Ÿç”¨åˆ™å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹,æ‰©å®¹ä¸ºåŸæ¥é•¿åº¦çš„1.5å€ * */ public void add(T t) { ensureCapacityInternal(size + 1); elementData[size++] = t; } /** * * æŒ‡å®šä½ç½®æ’å…¥ *1.å…ˆæ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ * 2.æ˜¯å¦æ˜¯å¦éœ€è¦æ‰©å®¹ * 3.æŒ‡å®šä½ç½®åè¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€åç§»åŠ¨ä¸€ä½ * æ’å…¥å’Œåˆ é™¤æ•ˆç‡ä½ä¸‹ */ public void add(int index, T t) { //1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ rangeCheckForAdd(index); //2.æ˜¯å¦æ‰©å®¹ ensureCapacityInternal(size + 1); //ç§»ä½ for (int i = size(); i &gt; index; i--) { elementData[i] = elementData[i - 1]; } elementData[index] = t; size++; } /** * æ ¹æ®ä¸‹æ ‡ åˆ é™¤æ–¹æ³• * 1.å…ˆæ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ * 2.åˆ é™¤æŒ‡å®šä½ç½®çš„å‰è¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€å‰ç§»åŠ¨ä¸€ä½ */ public T remove(int index) { rangeCheckForAdd(index); T oldIndex = (T) elementData[index]; //ç§»ä½ fastRemove(index); for (int i=index;i&lt;size()-1;i++) { elementData[i]=null; if (i==size) { } elementData[i]=elementData[i+1]; } return oldIndex; } /** * æ ¹æ®å…ƒç´ åˆ é™¤æ–¹æ³• * 2.åˆ é™¤æŒ‡å®šä½ç½®çš„å‰è¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€å‰ç§»åŠ¨ä¸€ä½ */ public boolean remove(Object o) { if (o == null) { //ç§»ä½ for (int i = 0; i &lt; size(); i++) { if (elementData[i] == null) { fastRemove(i); return true; } } } else { for (int i = 0; i &lt; size(); i++) { if (elementData[i].equals(o)) { fastRemove(i); return true; } } } return false; } public void fastRemove(int index) { for (int i = index; i &lt; size() - 1; i++) { elementData[i] = null; elementData[i] = elementData[i + 1]; } size--; } /** * getæ–¹æ³• é€šè¿‡ä¸‹æ ‡å»æ•°æ® * 1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ */ public T get(int index) { rangeCheckForAdd(index); return (T) elementData[index]; } /** * æ£€æŸ¥æ•°ç»„å®¹é‡æ˜¯å¦å¤Ÿç”¨ */ public void ensureCapacityInternal(int minCapacity) { //æ•°ç»„å…ƒç´ ä¸ªæ•°å¤§äºåˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦æ—¶å€™ if (minCapacity - elementData.length &gt; 0) { //è¿›è¡Œæ•°ç»„æ‰©å®¹ grow(minCapacity); } } /** * * æ•°ç»„æ‰©å®¹ * */ public void grow(int minCapacity) { int oldLen = elementData.length; int newLen = oldLen + oldLen &gt;&gt; 1; //å·¦ç§»ä½ ç›¸å½“äºé™¤ä»¥2 //åŠ ä¸€ä¸ªå…ƒç´ å°±åŠ é•¿ä¸€ä¸ªé•¿åº¦ï¼Œæœ€å°‘ä¿è¯å®¹é‡å’ŒminCapacityä¸€æ · if (newLen - minCapacity &lt; 0) { newLen = minCapacity; } //å¦‚æœæ‰©å……ä¸€åŠåä»ç„¶ä¸å¤Ÿï¼Œåˆ™ newCapacity = minCapacity;minCapacityå®é™…å…ƒç´ çš„ä¸ªæ•°ã€‚ if (newLen - MAX_ARRAY_SIZE &gt; 0) { newLen = hugeCapacity(minCapacity); //æ•°ç»„æœ€å¤§ä½2^32 } elementData = Arrays.copyOf(elementData, newLen); } /** * * ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥ * */ private void rangeCheckForAdd(int index) { if (index &lt; 0 || index &gt; this.size) throw new IndexOutOfBoundsException(&quot;ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸&quot;); } /** * * èµ‹å€¼æ•°ç»„æœ€å¤§é•¿åº¦ * */ private static int hugeCapacity(int minCapacity) { if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } public static void main(String[] a) { MyArrayList&lt;String&gt; stringMyArrayList = new MyArrayList&lt;&gt;(); stringMyArrayList.add(&quot;å¼ ä¸‰&quot;); stringMyArrayList.add(&quot;æå››&quot;); stringMyArrayList.add(1, &quot;ç‹äº”&quot;); stringMyArrayList.add(1, &quot;ç‹éº»å­&quot;); stringMyArrayList.add(0, &quot;åˆ˜èƒ½&quot;); stringMyArrayList.add(5, &quot;åˆ˜èƒ½å»&quot;); //stringMyArrayList.remove(3); stringMyArrayList.remove(&quot;å¼ ä¸‰&quot;);// for (int i = 0; i &lt; 15; i++) {// stringMyArrayList.add(String.valueOf(i));// } for (int i = 0; i &lt; stringMyArrayList.size(); i++) { System.out.println(stringMyArrayList.get(i)); } }}","link":"/posts/e51c6570/"},{"title":"ç”¨è‡ªå·±çš„ç‰©ç†æœåŠ¡å™¨ æ­å»ºç§æœï¼Œæ‹¥æœ‰è‡ªå·±çš„mavenæœåŠ¡","text":"å‰è¨€ æœ€è¿‘ä¹°äº†ä¸ªç‰©ç†æœåŠ¡å™¨ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æŠ˜è…¾ï¼Œå­¦ä¹ ï¼›å› ä¸ºæƒ³è¦è¾¾åˆ°ç©å­¦ä¹ çš„ç›®çš„ï¼Œä¹°é‡Œäº‘çš„å¤ªè´µäº†ã€‚å­¦ç”Ÿæœºï¼Œé…ç½®å¤ªä½ã€‚æ ¹æœ¬æ— æ³•æŠ˜è…¾ã€‚ç´¢æ€§æ·˜å®æä¸€ä¸ª æˆ´å°”çš„ç©ç©ã€‚ å°†æœåŠ¡å™¨åœ¨å®¶é‡Œï¼Œå³ä½¿å‡ºé—¨åœ¨å¤–ï¼Œä¹Ÿä¸€æ ·å¯ä»¥åƒé˜¿é‡Œäº‘çš„æœåŠ¡å™¨ä¸€æ ·é€šè¿‡åŸŸåè®¿é—® ssh ç­‰ã€‚ä½†æ˜¯å¾—æœ‰ä¸€ä¸ªå…¬ç½‘ipï¼Œå®¶é‡Œçš„å®½å¸¦æ˜¯ç”µä¿¡çš„ï¼Œä¸€ä¸ª10000å®¢æœï¼Œè¯´è¦ä¸ªå…¬ç½‘ip,ç”¨äºå®¶é‡Œçš„ç›‘æ§ã€‚å°±ç›´æ¥å°†å®½å¸¦è®¾ç½®æˆäº†å…¬ç½‘çš„ã€‚ ä¸è¿‡æ‰“äº†å¥½å‡ ä¸ªå®¢æœï¼Œè¿™äº›å®¢æœæ„Ÿè§‰ä¸å¤ªä¸“ä¸šï¼Œæœ‰äº›å®¢æœè¯´ è¿™ä¸ªå…¬ç½‘ipæ˜¯å›ºå®šä¸å˜çš„ï¼Œæœ‰çš„è¯´è¿™ä¸ªå…¬ç½‘ipæ˜¯åŠ¨æ€çš„ã€‚åè€…æ˜¯å¯¹çš„ï¼›æ‹¿äº†å…¬ç½‘ipä¸€é¡¿æŠ˜è…¾ï¼Œå¤§å¹´åˆä¸€ éƒ½éªšæ‰° ç”µä¿¡çš„ç»´ä¿®å¸ˆå‚…ã€‚æœ€ç»ˆè¿˜æ˜¯æå¥½äº†ã€‚ç„¶åé˜¿é‡Œäº‘ä¹°ä¸ªåŸŸåï¼Œå†™ä¸ªè„šæœ¬ï¼ŒåŠ¨æ€è·å–å…¬ç½‘ip ddnsç»‘å®š å°±å¯ä»¥é€šè¿‡åŸŸåç›´æ¥è®¿é—®äº†ã€‚ ä¸»é¢˜å¼€å§‹ï¼šå› ä¸ºå¹³æ—¶ä¸ªäººå¼€å‘çš„ä¸€äº›demoæˆ–è€…ä¸ªäººçš„é¡¹ç›®çš„æ—¶å€™æ€»æœ‰å¾ˆå¤šå·¥å…·ç±»è¦ç”¨åˆ°ï¼Œå‡ ä¹å¾ˆå¤šä¸ªäººé¡¹ç›®éƒ½è¦ç”¨åˆ°ï¼Œæ‰€æœ‰å°±æƒ³æŠŠå®ƒåšæˆä¸€ä¸ªjaråŒ… ç›´æ¥ç§æœé‡Œé¢ä¸€ä¸¢ï¼Œåœ¨é¡¹ç›®é‡Œç›´æ¥å¼•ç”¨å°±å¥½ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸ªå¤åˆ¶æ¥å»ã€‚ ç”¨é˜¿é‡Œäº‘çš„å­¦ç”Ÿæœºä¹Ÿè¯•è¿‡ï¼Œè·‘ä¸èµ·æ¥ã€‚å°±æ˜¯å¾ˆå¤šéƒ½ä¸èƒ½ç©æ‰€ä»¥æ‰è¿™æ ·å­å¤„ç†ã€‚ æ‹‰å–é•œåƒï¼šDocker Hub æœç´¢ sonatype/nexus3 æ‹‰å–é•œåƒ docker pull sonatype/nexus3 æŸ¥çœ‹é•œåƒid:docker images åœ¨ä»»æ„ä¸€ä¸ªç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ ç”¨äºæ•°æ®æŒ‚è½½ mkdir /usr/local/software/docker/nexus/data åŠ¡å¿…æˆæƒï¼Œæˆ‘å› ä¸ºæ²¡æœ‰æˆæƒæ‰€ä»¥æ€»æ˜¯è·‘ä¸èµ·æ¥ 200æˆ–è€…777chown -R 200 /usr/local/software/docker/nexus/data å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼š 12345678docker stop nexus3 &amp;&amp; docker rm nexus3docker run -d --name nexus3 \\ -p 8081:8081 \\ -p 8082:8082 \\ -p 8083:8083 \\ -p 8084:8084 \\ --restart=always \\ -v /usr/local/software/docker/nexus/data:/nexus-data 87d9a097d22c å‘½ä»¤æ‰§è¡Œå®Œåï¼šdocker ps æŸ¥çœ‹è¿è¡Œæƒ…å†µå¯èƒ½ä¼šè¿è¡Œæ¯”è¾ƒä¹…ï¼Œæˆ‘å°±æ˜¯å¾ˆä¹… 5ã€6åˆ†é’Ÿæ‰è¿è¡Œèµ·æ¥ã€‚ æŸ¥çœ‹ ä¸Šé¢åˆ›å»º åˆ›å»ºçš„dataæ–‡ä»¶å®¶çœ‹çœ‹æ˜¯å¦æœ‰æ–‡ä»¶äº†ï¼Œç®¡ç†å…ƒå¯†ç åœ¨é‡Œé¢ã€‚ ç„¶åï¼šæµè§ˆå™¨è®¿é—®ï¼šhttp://æœåŠ¡å™¨IP:8081;å³å¯è¿›å…¥ç•Œé¢ ç‚¹å³ä¸Šè§’ çš„ sign in è¿›è¡Œç™»é™†ï¼š æŸ¥çœ‹ç®¡ç†å‘˜å¯†ç  /usr/local/software/docker/nexus/data/admin.passwordç™»é™†å ä¼šè¯¢é—®ä½ æ˜¯å¦ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹åè¿™ä¸ªæ–‡ä»¶å°±ä¸åœ¨äº†ï¼Œæ³¨æ„âš ï¸ã€‚","link":"/posts/62da2a0d/"},{"title":"é¡¹ç›®ç”Ÿæˆå·¥å…·,æ ¹æ®æ•°æ®åº“ç”Ÿæˆï¼ŒåŠ©ä½ æ•ˆç‡ç¿»å€","text":"æœ€è¿‘ï¼Œä¸ªäººä¹Ÿæ¥äº†ç‚¹ä¸è¶³æŒ‚é½¿çš„å°å°ç§æ´»ã€‚ä¸ºäº†å¿«é€Ÿå¼€å‘ï¼Œå¼€ç®±å³ç”¨ï¼Œæ¯ä¸ªé¡¹ç›®ä¸éœ€è¦é‡æ–°æ­å»ºã€‚æå‡æ•ˆç‡ï¼Œå°±å†™äº†åŸºæœ¬çš„é¡¹ç›®æ¶å­ï¼Œç„¶åæ ¹æ®å·²å»ºå¥½çš„æ•°æ®åº“ï¼Œç”Ÿæˆå¯¹åº”çš„å¢åˆ æ”¹æŸ¥çš„æ¥å£ã€‚ç”Ÿæˆå³å¯ä½¿ç”¨ã€‚ ä¸€ã€ç”Ÿæˆçš„é¡¹ç›®ç»“æ„è¯´æ˜ä¸€ã€é¡¹ç›®æŠ€æœ¯SpringBoot + shiro + mysql + mybatis-plus; é¡¹ç›®ç»Ÿä¸€ restful é£æ ¼ï¼Œç»Ÿä¸€å¼‚å¸¸ Json å¤„ç†åŒ–ï¼Œrespones æ•°æ®ç»“æ„ç»Ÿä¸€ã€‚ è·¨åŸŸé—®é¢˜å¤„ç†ã€‚ ä¹Ÿä¼šè¿‡æ»¤æ‰ç»™å‰ç«¯çš„ ä¸€äº› ä¸º null çš„å±æ€§ï¼Œå°†å€¼å¡«å……ä¸º ç©ºå­—ç¬¦ä¸² â€œâ€ï¼› ä¹ŸåŒ…å«äº†æ—¥å¿—æ–‡ä»¶è¾“å‡ºã€‚ ä¸‹é¢å°±æ˜¯å·¥å…·ç”Ÿæˆçš„é¡¹ç›®ç»“æ„ äºŒã€é¡¹ç›®ç»“æ„é¡¹ç›®çš„åŸºæœ¬ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚è¿™æ˜¯ä¸€å—å…¬å…±çš„ä»£ç å—ã€‚ core åŒ…ï¼š æ˜¯æ•°æ®åº“ç”Ÿæˆçš„ä¸šåŠ¡ä»£ç å¢åˆ æ”¹ï¼› mapper æ–‡ä»¶ åœ¨resoure ç›®å½•ä¸‹ã€‚ æ¯ä¸€ä¸ªç±»ï¼Œéƒ½æœ‰ä¸€ä¸ªæ³¨é‡Šè¯´æ˜ï¼Œåœ¨è¿™å°±ä¸ä¸€ä¸€åšè§£é‡Šäº†ã€‚ äºŒã€ä¸šåŠ¡ä»£ç æ¨¡å—æ¯ä¸€å¼ è¡¨ï¼Œéƒ½æœ‰å¯¹åº”çš„ å¢ åˆ  æ”¹ æŸ¥ çš„æ¥å£ã€‚ä½¿ç”¨çš„ä¸åŒè¯·æ±‚æ–¹å¼ã€‚ å¢ åˆ  æ”¹ æŸ¥ æ¥å£ è¿™æ ·ã€‚ æ•°æ®ç»“æ„é•¿è¿™æ ·ï¼š è¿™æ˜¯æŸ¥çš„æ¥å£æ•°æ®ç»“æœï¼ŒåŒ…å«äº†åˆ†å¤„ç†ã€‚ Service æ¥å£ï¼š ServiceImpl Mapperæ¥å£ï¼š xml: è¿™æ˜¯é¡¹ç›®çš„åŸºæœ¬ç»“æ„äº†ã€‚ ä¸‰ã€ç›¸å…³æ–‡ä»¶1ã€R.java å°è£…ç»Ÿä¸€å“åº”å‰ç«¯æ•°æ®ç»“æ„ 2ã€ç»Ÿä¸€å¼‚å¸¸æšä¸¾ 3ã€å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸ï¼Œé™åˆ¶é”™è¯¯æšä¸¾ 4ã€å…¨å±€å¼‚å¸¸æ•è·æ‹¦æˆª åŸºæœ¬çš„ç»“æ„ä»£ç ï¼Œä»‹ç»åˆ°æ­¤ã€‚ äºŒã€é¡¹ç›®ç”Ÿæˆå·¥å…·æºç ç»“æ„å·¥å…·æºç ç»“æ„ æºç ç»“æ„ä¸åšè¯´æ˜äº†ï¼Œå¤ªå¤šä¸œè¥¿ã€‚ 2ã€1 é¡¹ç›®å·¥å…·çš„ä½¿ç”¨ é¡¹ç›®æ‰€éœ€å±æ€§åœ¨ç±» ConfigProperties.java ä¸­ å¯é€šè¿‡ main æ–¹æ³•è¿›è¡Œé¡¹ç›®çš„å¿«é€Ÿç”Ÿæˆ ä¹Ÿå¯ä»¥éƒ¨ç½²å‡ºå»ï¼Œé€šè¿‡ http çš„å½¢å¼ï¼Œæ‰“åŒ…ä¸‹è½½ã€‚ é¡µé¢ æºç åœ°å€","link":"/posts/434af8d5/"},{"title":"ConcurrentHashMapæºç è¿‡ç¨‹æ‰§è¡Œè¿‡ç¨‹åˆ†æ","text":"::: hljs-center ConcurrentHashMap 1.7 æºç åˆ†æå­¦ä¹ ::: 1ã€å¸¸é‡è¯´æ˜ 123456789101112131415161718192021222324252627282930// concurrentHashMap é»˜è®¤é•¿åº¦static final int DEFAULT_INITIAL_CAPACITY = 16; // é»˜è®¤æ‰©å®¹å› å­static final float DEFAULT_LOAD_FACTOR = 0.75f;// é»˜è®¤ Segment[].length é•¿åº¦static final int DEFAULT_CONCURRENCY_LEVEL = 16;// concurrentHashMap æœ€å¤§å®¹é‡å€¼static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;// æ¯ä¸€ä¸ª Segment å¯¹è±¡ä¸­çš„ hashTable æ•°ç»„æœ€å°é•¿åº¦static final int MIN_SEGMENT_TABLE_CAPACITY = 2;// Segment[] æœ€å¤§å€¼static final int MAX_SEGMENTS = 1 &lt;&lt; 16; // slightly conservative// éé”å®šæƒ…å†µä¸‹è°ƒç”¨sizeå’Œcontainsæ–¹æ³•çš„é‡è¯•æ¬¡æ•°,é¿å…ç”±äºtableè¿ç»­è¢«ä¿®æ”¹å¯¼è‡´æ— é™é‡è¯•static final int RETRIES_BEFORE_LOCK = 2;//è®¡ç®—segmentä½ç½®çš„ä¸€ä¸ªå€¼final int segmentMask;//è®¡ç®—segmentä½ç½®æ—¶,ç”¨äºhashå‚ä¸è¿ç®—çš„ä½æ•°final int segmentShift;//Segment[]æ•°ç»„final Segment&lt;K,V&gt;[] segments; 2ã€æ•°æ®ç»“æ„å›¾ ConcurrentHashMap åº•å±‚æ•°æ®ç»“æ„æ˜¯é‡‡ç”¨åˆ†æ®µå¼å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸€ä¸ªSegmentå°±æ˜¯ä¸€æ®µï¼Œéƒ½æ˜¯ä¸€ä¸ªéå…¬å¹³é”é”ï¼Œç»§æ‰¿äº ReentrantLock,æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯ä¸€ä¸ªSegment ä¸‹ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå½“putå€¼çš„æ—¶å€™ï¼Œç®—å‡ºäº†keyæ‰€åœ¨segment[]ä¸­çš„ä½ç½®åï¼Œput å°±ä¼šé”ä½ï¼Œå½“å‰çš„è¿™ä¸ªsegmentå¯¹è±¡ï¼Œå…¶å®ƒçš„segment æ˜¯ä¸ä¸Šé”çš„ã€‚è¿™åŒºåˆ«äº hashTale, hashTable æ˜¯é”æ•´ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªæ–¹æ³•ä¸Š synchronized é”ä½ï¼Œæ‰€ä»¥åœ¨æ•ˆç‡ä¸Šä¼š å¤§å¤§ç”±äº hashTableã€‚ 3ã€Segment å¯¹è±¡Segment å¯¹è±¡ç»§æ‰¿äº†ReentrantLockï¼Œå¯¹æ¯ä¸€ä¸ªSegment å¯¹è±¡è¿›è¡Œåˆ†æ®µé”ï¼Œå½“çº¿ç¨‹æ‰§è¡Œputçš„æ—¶å€™ï¼Œåªé”ä½å¯¹åº”çš„ é‚£ä¸ªSegment å¯¹è±¡ï¼Œå¯¹å…¶ä»–çš„Segment çš„get put äº’ä¸å¹²æ‰°ï¼Œè¿™æ ·å­å°±æå‡äº†æ•ˆç‡ï¼›åšåˆ°äº†çº¿ç¨‹å®‰å…¨ã€‚ å¯¹äº HashTable æ˜¯é”ä½çš„æ•´ä¸ªHashTable,æ¯ä¸ªæ–¹æ³•éƒ½ä¸Šäº†é”ï¼Œçº¿ç¨‹é‡å¤§çš„æ—¶å€™ï¼Œä¼šæ¶ˆè€—cpu,æ•ˆç‡ä¹Ÿä½ä¸‹ã€‚ 12345678910111213141516171819202122232425static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable{ // HashEntrysæ•°ç»„ï¼Œæ•°ç»„åˆè£…é“¾è¡¨ transient volatile HashEntry&lt;K,V&gt;[] table; // æ•°ç»„é•¿åº¦ transient int count; // æ“ä½œæ¬¡æ•° transient int modCount; // æ‰©å®¹çš„ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ æ•°ç»„é•¿åº¦*è´Ÿè½½å› å­ é»˜è®¤ 0.75 transient int threshold; // è´Ÿè½½å› å­ 0.75 final float loadFactor; Segment(float lf, int threshold, ConcurrentHashMap.HashEntry&lt;K,V&gt;[] tab) { this.loadFactor = lf; this.threshold = threshold; this.table = tab; }} 4ã€æ„é€ åˆå§‹åŒ–1ã€æ„é€  å‚æ•°ä»‹ç»ï¼š int initialCapacity #concurrentHashMap åˆå§‹å®¹é‡ float loadFactor # åŠ è½½æ‰©å®¹å› å­ int concurrencyLevel # segment[]æˆåº¦ é»˜è®¤æ„é€ æ–¹æ³•ï¼Œéƒ½æ˜¯ä½¿ç”¨é»˜è®¤å‚æ•°å€¼,å…¶å®ƒæ„é€  æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨æ­¤æ„é€  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108public ConcurrentHashMap( int initialCapacity, float loadFactor, int concurrencyLevel) { // å‚æ•°æ ¡éªŒ if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; /** * // Find power-of-two sizes best matching arguments * * æ‰¾åˆ°ä¸¤ä¸ªå¤§å°çš„æœ€ä½³åŒ¹é…å‚æ•°çš„å¹‚ï¼Œå°±æ˜¯è®¡ç®—å‡ºï¼Œæ¯ä¸ª segment ä¸‹ åº”è¯¥æ”¾å‡ ä¸ª hashEntryå¯¹è±¡ï¼Œå°±æ˜¯å®ƒçš„hashEntry[]é•¿åº¦ * */ int sshift = 0; // é€šè¿‡è®¡ç®—è·å– segment[] æ•°ç»„é•¿åº¦çš„æœ€ä½³å€¼ int ssize = 1; /** * ä¸¾ä¾‹å­ï¼š * initialCapacity = 33ï¼ŒconcurrencyLevel = 16ï¼› * while å¾ªåï¼Œssize = 0, ç¬¬ä¸€æ¬¡ å°±æ˜¯ 2ï¼Œç¬¬äºŒæ¬¡ å°±æ˜¯ 4 ï¼Œç¬¬ä¸‰æ¬¡å°±æ˜¯ 8ï¼Œç¬¬å››æ¬¡å°±æ˜¯ 16 * * æ­¤æ—¶ (ssize = 16 ) &lt; concurrencyLevel = 16 è·³å‡ºå¾ªç¯ï¼Œsshift åŠ åŠ äº†å››æ¬¡ sshift = 4 ; * * ä» ssize &lt;&lt;= 1 æ¥çœ‹ï¼Œ segment[] é•¿åº¦å°±æ˜¯ï¼Œ2çš„å¹‚æ¬¡æ–¹ï¼› ä¸ºä»€ä¹ˆæ˜¯ 2çš„å¹‚æ¬¡æ–¹ï¼Œä¸ºäº†å‡å°‘ hashå†²çªï¼› */ while (ssize &lt; concurrencyLevel) { ++sshift; ssize &lt;&lt;= 1; } // ä¹Ÿè®¡ç®—å¾—å‡º äº† å‚ä¸ è®¡ç®— keyè¦å­˜å‚¨çš„ä¸‹è¡¨ä½ç½®çš„å€¼ï¼› this.segmentShift = 32 - sshift; this.segmentMask = ssize - 1; // è®¡ç®—ç»“æœ ä¹Ÿä¸èƒ½ å¤§äº segment[] é»˜è®¤çš„æœ€å¤§é•¿åº¦ï¼Œè¶…å‡ºåˆ™ä¸ºæœ€å¤§å€¼ if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; /** * * è®¡ç®— æ¯ä¸ª HashEntry çš„æœ€ä½³é•¿åº¦ * * ï¼ˆinitialCapacity = 33ï¼‰/ è®¡ç®—å‡ºæ¥çš„( ssize=16 ) * * ç›®çš„å°±æ˜¯ å‡ºç°åˆ†é…ä¸å‡ çš„æƒ…å†µ * * å‡å¦‚ segment[]=16;æœ€å¤§å®¹é‡æ˜¯ 33 ä¸ªï¼›å¦‚æœæ¯ä¸ª hashEntry[].length=2,é‚£è£…ä¸å®Œ * * 33/16=2.å¤šï¼›å°±æ¯ä¸ª hashEntry[].length+1; ä¿è¯è£…å®Œ * */ int c = initialCapacity / ssize; if (c * ssize &lt; initialCapacity) ++c; // å¦‚æœè®¡ç®—å‡ºçš„ c å°äº é»˜è®¤ æœ€å° å®¹é‡ï¼Œå°±å– é»˜è®¤å€¼ï¼Œ2çš„å¹‚æ¬¡æ–¹ï¼Œæœ€å°å°±æ˜¯2 int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // create segments and segments[0] /** * &lt;br&gt; * * åˆå§‹åŒ–Segmentå¯¹è±¡ * ã€‚loadFactor:Segment[]æ•°ç»„çš„æ‰©å®¹å› å­ * ã€‚(int) (cap * loadFactor):hashEntry[]çš„æ‰©å®¹å› å­ * ã€‚new HashEntry[cap]ï¼šåˆå§‹åŒ–Segmentå¯¹è±¡ä¸‹çš„æ•°ç»„ * * */ Segment&lt;K, V&gt; s0 = new Segment&lt;K, V&gt;(loadFactor, (int) (cap * loadFactor), (HashEntry&lt;K, V&gt;[]) new HashEntry[cap]); /** * * åˆå§‹åŒ– Segment æ•°ç»„ * */ Segment&lt;K, V&gt;[] ss = (Segment&lt;K, V&gt;[]) new Segment[ssize]; /** * &lt;br&gt; * * putOrderedObjectï¼ˆobj,offset,valï¼‰ * å°†objå¯¹è±¡çš„åç§»é‡ä¸ºoffsetçš„ä½ç½®ä¿®æ”¹ä¸ºvalue * * SBASE = UNSAFE.arrayBaseOffset(sc); * è¯»å–æ•°ç»„ç¬¬ä¸€ä¸ªçš„åç§»é‡ï¼Œç„¶å putOrderedObject è´Ÿå€¼ * */ UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss; } æ„é€ å‡½æ•°ï¼ŒSegment[] æ•°ç»„è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå¹¶ä¸”è®¡ç®—å‡ºï¼Œæ¯ä¸ªSegment å¯¹è±¡æœ€ä¼˜å­˜å‚¨ä¸ªæ•°ï¼Œä»¥åŠSegment[]çš„é•¿åº¦è®¡ç®—ï¼Œæ ¹æ®ä»£ç çš„ç®—æ³•ï¼ŒSegment[]çš„é•¿åº¦æ˜¯ä¸€å®šæ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œæœ€å°çš„é•¿åº¦ æ˜¯2ï¼ŒhashEntry[]çš„é•¿åº¦ä¹Ÿæ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚ 5ã€ConcurrentHashMap.put(K k,V v) 1234567891011121314151617181920212223242526272829303132public V put(K key, V value){ Segment&lt;K, V&gt; s; // put æ–¹æ³• æ²¡æœ‰åškey çš„éç©ºæ ¡éªŒï¼Œ1.8çš„åšäº†æ ¡éªŒ if (value == null) throw new NullPointerException(); // è®¡ç®—key çš„ hashå€¼ int hash = hash(key); // è®¡ç®— è¿™ä¸ªkey åœ¨Segment[] æ•°ç»„ä¸­çš„å“ªä¸ªä½ç½®ï¼› int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; /** * &lt;br&gt; * * UNSAFE.getObject(segments, (j &lt;&lt; SSHIFT) + SBASE) * å»æ‹¿è¿™ä¸ªè¿™ä¸ªä¸‹è¡¨ä½ç½®çš„åç§»é‡ï¼Œé€šè¿‡æ­¤æ–¹æ³•è·å–è¿™ä¸ªåç§»é‡ä½ç½®çš„Segmentå¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼› * * åœ¨æ„é€ çš„æ—¶å€™ï¼Œåªåˆå§‹åŒ–äº†ï¼Œä¸‹è¡¨ä¸º0çš„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ï¼› * * s = null çš„è¯ï¼Œå°± ensureSegment å®å®ä¾‹åŒ–å‡ºæ¥ * */ if ((s = (Segment&lt;K, V&gt;) UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment s = ensureSegment(j); return s.put(key, hash, value, false);} 5.1 ensureSegment(j) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667private Segment&lt;K,V&gt; ensureSegment(int k) { // è¯»å–Segment[] final Segment&lt;K,V&gt;[] ss = this.segments; // åœ¨è·å–ä¸€æ¬¡ key åœ¨æ•°ç»„ä¸­çš„åç§»é‡ long u = (k &lt;&lt; SSHIFT) + SBASE; // raw offset // ç”Ÿæ˜ å³å°†å®ä¾‹åŒ–çš„Segmentå¯¹åƒ Segment&lt;K,V&gt; seg; /** * &lt;br&gt; * é˜²æ­¢å…¶å®ƒçº¿ç¨‹ åœ¨æ­¤çº¿ç¨‹ä¿®æ”¹å‰å·²ç»ä¿®æ”¹äº† * * UNSAFE.getObjectVolatile(ss, u) * ä»å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„è·å–å˜é‡çš„å¼•ç”¨ * å†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºç©º * * */ if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) { // ä¸ºç©ºçš„è¯ï¼Œå°±æ‹¿æ„é€ åˆå§‹åŒ–çš„Segmentå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œæ‹¿å–ï¼ŒhashEntryp[]é•¿åº¦,å’ŒåŠ è½½å› å­ // å»å®ä¾‹åŒ–æ–°çš„Segmentå¯¹åƒ Segment&lt;K,V&gt; proto = ss[0]; // use segment 0 as prototype int cap = proto.table.length; float lf = proto.loadFactor; // è®¡ç®—æ•°ç»„çš„ åŠ è½½å› å­ int threshold = (int)(cap * lf); // å®ä¾‹åŒ– hashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])new HashEntry[cap]; /** * &lt;br&gt; * * å†æ¬¡å¤æŸ¥å½“å‰ä½ç½®æ˜¯å¦ä¸ºç©º * é˜²æ­¢å…¶å®ƒçº¿ç¨‹ åœ¨æ­¤çº¿ç¨‹ä¿®æ”¹å‰å·²ç»ä¿®æ”¹äº† * * å¦åˆ™ç›´æ¥returnå³å¯ */ if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) { // recheck // å®ä¾‹åŒ– Segment å¯¹è±¡ Segment&lt;K,V&gt; s = new Segment&lt;K,V&gt;(lf, threshold, tab); /** * &lt;br&gt; * * ä½¿ç”¨å¾ªç¯çŸ¥é“casæˆåŠŸä¸ºæ­¢ï¼Œå› ä¸ºæœ‰æ—¶å€™ä¼šcaså¤±è´¥ï¼› * */ while ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) { // cas ä¿®æ”¹æ•°ç»„ä¸­çš„keyåœ¨çš„ä¸‹æ ‡ä½ç½®çš„å€¼ï¼ŒåŸæ¥ä¸º null,ä¿®æ”¹å€¼ä¸º æ–°å¯¹è±¡ if (UNSAFE.compareAndSwapObject(ss, u, null, seg = s)) break; } } } return seg; } 5.2 Segment.put(K key, int hash, V value, boolean onlyIfAbsent)å°† key value åŒ…è£…æˆ HashEntry å¯¹è±¡ï¼Œå‡å¦‚åˆ°æ•°ç»„ä¸­ï¼Œæˆ–è€…HashEntry é“¾è¡¨ä¸­å»ï¼› Segment ç»§æ‰¿äº† ReentrantLock ï¼Œæ˜¯ä¸€æŠŠé”ï¼Œåœ¨æ­¤put æ–¹æ³•ä¸­è¿›è¡Œ tryLock(), è·å–é”ï¼Œè·å–å¤±è´¥ï¼Œæ•‘ä¼šscanAndLockForPut(key, hash, value),è¿›è¡Œå¾ªç¯é‡è¯•å–é”ï¼Œå¦‚æœåˆ°è¾¾æŒ‡å®šçš„å°è¯•æ¬¡æ•°è¿˜æ²¡æœ‰é”çš„è¯ï¼Œå°±ä¼šlock() è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚ æ­¤é”æ˜¯éå…¬å¹³é”ã€‚ put æ–¹æ³•ï¼š æ³¨æ„ç‚¹ï¼š &emsp; 1ã€hashå†²çªï¼Œkeyç›¸åŒçš„æƒ…å†µï¼Œå¤„ç†ï¼Ÿ &emsp;&emsp; &emsp; hash å†²çªï¼Œkey ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¼šé»˜è®¤ è¿›è¡Œï¼Œå€¼æ›¿æ¢ï¼Œæ–°å€¼è¦†ç›–æ—§å€¼ã€‚ &emsp; 2ã€key çš„hashå†²çªï¼Œkey ä¸ç›¸åŒçš„æƒ…å†µï¼Ÿ &emsp;&emsp;&emsp; åªæ˜¯ keyçš„ hash å†²çªï¼Œçš„è¯ï¼Œå°±ä¼šåœ¨é“¾è¡¨çš„å¤´èŠ‚ç‚¹åŠ å…¥æ–°çš„åŒ…è£…çš„HashEntryå¯¹è±¡ï¼› &emsp; 3ã€Segmentä¸‹çš„HashEntry æ•°ç»„è£…ä¸ä¸‹æ€ä¹ˆåŠï¼Ÿ &emsp;&emsp;&emsp; åœ¨åŠ å…¥ä¹‹å‰ï¼Œæ ¹æ®åŠ è½½å› å­å»è®¡ç®—ï¼Œæ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œä¸éœ€è¦æ‰©å®¹å°±ç›´æ¥åŠ å…¥ï¼Œå¦åˆ™å°±ä¼šå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ã€‚ ä»£ç åˆ†æï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100final V put(K key, int hash, V value, boolean onlyIfAbsent) { /** * &lt;br&gt; * * å¼€å§‹ä¸Šé”äº† * tryLock()ï¼›æ˜¯ ReentrantLock é‡Œé¢çš„æ–¹æ³•ï¼›æ˜¯éå…¬å¹³é”ï¼› * tryLock()å¤±è´¥ï¼Œå°±ä¼š * * scanAndLockForPut(); * è¿›è¡Œé‡è¯•è·å–é”ï¼Œåœ¨ä¸è¶…è¿‡ RETRIES_BEFORE_LOCK = 2 æ¬¡æ•°çš„æ—¶å€™ï¼Œ2 æ˜¯é»˜è®¤å€¼ */ HashEntry&lt;K, V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); V oldValue; try { HashEntry&lt;K, V&gt;[] tab = table; // è®¡ç®—HashEntryå¯¹è±¡åœ¨ HashEntry[]æ•°ç»„ä¸­çš„ä½ç½®ï¼Œè¿™ä¸ªç®—æ³•è·Ÿ HashTableä¸€æ ·çš„ int index = (tab.length - 1) &amp; hash; // è·å–è¿™ä¸ª æ•°ç»„ä¸­çš„ï¼Œè¿™ä¸ªä¸‹æ ‡ä½ç½®æ˜¯çš„å€¼ï¼Œæœ‰å¯èƒ½ä¸ºç©ºï¼Œæœ‰å¯èƒ½å­˜åœ¨å€¼ï¼Œå­˜åœ¨å€¼è¯´æ˜hashå†²çªäº† HashEntry&lt;K, V&gt; first = entryAt(tab, index); // éå† HashEntry&lt;K,V&gt; é“¾è¡¨ç»“æ„ï¼Œ for (HashEntry&lt;K, V&gt; e = first; ; ) { // e !=null æœ‰å¯èƒ½æ˜¯hashå†²çªäº†ï¼Œå­˜åœ¨ é“¾è¡¨ if (e != null) { /** * &lt;br&gt; * * ç»§ç»­è¿›ä¸€æ­¥åˆ¤æ–­ key çš„å†…å­˜æ˜¯å¦ç›¸ç­‰ã€ * å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€hash å€¼æ˜¯å¦ç›¸ç­‰ã€‚ * * è¿™ä¸ªåˆ¤æ–­è·Ÿ HashTableçš„åˆ¤æ–­ä¹Ÿæ˜¯ä¸€æ ·çš„ * * */ K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) { // æ­¤æ—¶keyç›¸ç­‰äº†ï¼Œå°±åˆ¤æ–­æ˜¯å¦æ–°å€¼è¦†ç›–æ—§å€¼ oldValue = e.value; // æ˜¯å¦è¦†ç›– if (!onlyIfAbsent) { // è¦†ç›– e.value = value; // ä¿®æ”¹æ¬¡æ•°åŠ ä¸€ ++modCount; } break; } // å¦‚æœ åªæ˜¯hashå†²çªï¼Œkeyçš„å€¼ä¸ç­‰ï¼Œå°±å½¢æˆäº†é“¾è¡¨ e = e.next; } else { // æ²¡æœ‰hashå†²çªï¼ŒHashEntry æ²¡æœ‰å­˜åœ¨é“¾è¡¨ï¼› if (node != null) // æ–°å¢çš„èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ node.setNext(first); else // åˆ›å»ºæ–°çš„HashENtryå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ node = new HashEntry&lt;K, V&gt;(hash, key, value, first); // æ•°ç»„å®¹é‡åŠ ä¸€ï¼Œå°±æ˜¯åˆ¤æ–­ï¼Œæ–°å¢è¿™ä¸ªkeyä¹‹åï¼Œè¿™ä¸ªæ•°ç»„çš„å®¹é‡æ˜¯å¦éœ€è¦æ‰©å®¹ int c = count + 1; // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else // ä¸éœ€è¦æ‰©å®¹ï¼Œå°±å°†æ•°ç»„ä¸‹çš„è¿™ä¸ªä½ç½®ï¼Œæ›¿æ¢ä¸ºæ–°çš„HashEntry setEntryAt(tab, index, node); // ä¿®æ”¹æ¬¡æ•°+1 ++modCount; count = c; oldValue = null; break; } } } finally { // é‡Šæ”¾é” unlock(); } return oldValue; } 5.21 scanAndLockForPut(K key, int hash, V value) tryLock()ï¼›æ˜¯ ReentrantLock é‡Œé¢çš„æ–¹æ³•ï¼›æ˜¯éå…¬å¹³é”ï¼› tryLock()å¤±è´¥ï¼Œå°±ä¼š scanAndLockForPut(); è¿›è¡Œé‡è¯•è·å–é”ï¼Œåœ¨ä¸è¶…è¿‡ RETRIES_BEFORE_LOCK = 2 æ¬¡æ•°çš„æ—¶å€™ï¼Œ2 æ˜¯é»˜è®¤å€¼; é‡è¯•æ¬¡æ•°å¤§äº æŒ‡å®šçš„é‡è¯•å€¼çš„æ—¶å€™ï¼Œçº¿ç¨‹è¢«æŒ‚èµ·ï¼Œè¿›å…¥AQS çš„é˜Ÿåˆ—ç­‰å¾… 1234567891011121314151617181920212223242526272829303132333435363738394041private HashEntry&lt;K,V&gt; scanAndLockForPut(K key, int hash, V value) { // æ ¹æ® è·å–å½“å‰æ•°ç»„ä¸‹çš„ä½ç½®ï¼Œè·å–ç¬¬ä¸€ä¸ªHashEntry HashEntry&lt;K,V&gt; first = entryForHash(this, hash); HashEntry&lt;K,V&gt; e = first; HashEntry&lt;K,V&gt; node = null; // åˆå§‹åŒ– é‡è¯•è·å–é”çš„æ ‡å¿—æ¬¡æ•° int retries = -1; // negative while locating node // å°è¯•å¾ªç¯é‡è¯•è¯»é” while (!tryLock()) { HashEntry&lt;K,V&gt; f; // to recheck first below if (retries &lt; 0) { // å¦‚è¿‡ æ•°ç»„çš„ä¸‹æ ‡è¿™ä¸ªä½ç½®æ˜¯ç©ºçš„ï¼Œåˆå§‹åŒ–æ–°çš„HashEntryå¯¹è±¡ï¼Œ // return å›å»ï¼Œåœ¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨é“¾è¡¨ if (e == null) { if (node == null) // speculatively create node node = new HashEntry&lt;K,V&gt;(hash, key, value, null); retries = 0; } else if (key.equals(e.key)) retries = 0; else e = e.next; } else if (++retries &gt; MAX_SCAN_RETRIES) { // å¦‚æœ é‡è¯•æ¬¡æ•°åˆ°è¾¾æœ€å¤§å€¼ï¼Œé˜»å¡è¿›å…¥AQSçš„é˜Ÿåˆ—æ’é˜Ÿ lock(); break; } else if ((retries &amp; 1) == 0 &amp;&amp; (f = entryForHash(this, hash)) != first) { // åˆ¤æ–­ è¿™ä¸ªä½ç½®æ˜¯å¦æœ‰è¢«ä¿®æ”¹ï¼Œä¿®æ”¹äº†åˆ™é‡æ–°åˆå§‹åŒ–å…¶å®ƒå€¼ e = first = f; // re-traverse if entry changed retries = -1; } } return node; } 6ã€rehash(HashEntry&lt;K,V&gt; node) æ‰©å®¹åœ¨æ–°å¢keyçš„æ—¶å€™ï¼Œå°±ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œæ‰©å®¹æ¡ä»¶å°±æ˜¯ã€‚æ–°å¢åçš„ä¸ªæ•°å¤§äºæ•°ç»„å®¹é‡*åŠ è½½å› å­(é»˜è®¤0.75) å¹¶ä¸” æ•°ç»„çš„å®¹é‡åœ¨ä¸å¤§äºæœ€å¤§å®¹é‡çš„æ—¶å€™&emsp; (count &gt; (cap * lf) &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) æ‰©å®¹è¿‡ç¨‹ï¼š1ã€æ‰©å®¹åçš„å®¹é‡æ˜¯åŸæ¥æ•°çš„ä¸€å€ï¼Œæœ€åè¿˜æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚2ã€é‡æ–°è®¡ç®—æ•° HashEntry åœ¨æ–°çš„æ•°ç»„ä¸Šçš„ä½ç½®ã€‚ éå†è€çš„HashEntry[] æ•°ç»„ï¼Œè¿›è¡Œæ•°æ®è¿ç§»ï¼Œå…ˆè¦é‡æ–°æ‹¿å– sizeMaskè¿™ä¸ªæ˜¯è®¡ç®—keyå­˜æ”¾ä½ç½®æ‰€åœ¨ä¸‹æ ‡ç”¨çš„ä¹Ÿå°±æ˜¯sizeMask = newTable.length-1 é‡æ–°ä¿®æ”¹ æ‰©å®¹é˜™å€¼æ¡ä»¶ threshold = (int)(newCapacity * loadFactor); åˆ¤æ–­ HashEntry[] çš„ä»»ä½•ä½ç½®ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é“¾è¡¨ï¼Œå¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±ç›´æ¥è®¡ç®— e.hash &amp; sizeMask åœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼Œè¿ç§»è¿‡å»ï¼› å¦‚æœé“¾è¡¨å­˜åœ¨å¤šä¸ªå€¼ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡éå†é“¾è¡¨ï¼šæ‹¿åˆ°é“¾è¡¨çš„æœ€åä¸€ä¸ª HashEntry,å°†å…¶è¿ç§»åˆ°æ–°æ•°ç»„ä¸­ï¼› æ¥ç€ ç¬¬äºŒä¸ªå¾ªç¯,éå†é“¾è¡¨çš„å‰é¢å‡ ä¸ª ä¸Šä¸€ä¸ª å¾ªç¯å·²ç»æ‹¿äº† æœ€åä¸€ä¸ªï¼Œæ ¹æ®è®¡ç®—çš„æ–°æ•°ç»„ä¸‹æ ‡ï¼Œä»æ–°æ•°ç»„ä¸­çš„è¿™ä¸ªä½ç½®æ‹¿HashEntryï¼Œç„¶åé‡æ–°æ„é€ è‡ªå·± HashEntryï¼Œå¦‚æœï¼Œè¿™ä¸ªä½ç½®ä¸å­˜åœ¨HashEntry çš„è¯ï¼Œé‚£è‡ªå·±å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ï¼Œè‡ªå·±ä½œä¸ºå¤´èŠ‚ç‚¹åŠ å…¥åˆ° é“¾è¡¨ä¸­ï¼Œå°†åŸæ¥çš„HashEntry ä½œä¸ºè‡ªå·±çš„nextã€‚ è¿™ç§æƒ…å†µæœ‰å¯èƒ½ä¼šåŠ å…¥åˆ°æ–°çš„é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”ä½œä¸ºå¤´èŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å¯èƒ½è‡ªå·±å æ®ä¸€ä¸ªä½ç½®ã€‚ æºç åˆ†æï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586 /** * æ‰©å®¹å¤„ç† * @param node */ private void rehash(HashEntry&lt;K,V&gt; node) { // æ—§æ•°ç»„ HashEntry&lt;K,V&gt;[] oldTable = table; int oldCapacity = oldTable.length; // æ–°æ•°ç»„å®¹é‡ï¼Œä¸ºæ—§çš„2å€ int newCapacity = oldCapacity &lt;&lt; 1; // ä¸‹ä¸€æ¬¡çš„æ‰©å®¹é˜™å€¼æ¡ä»¶ threshold = (int)(newCapacity * loadFactor); // æ–°æ•°ç»„ HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; int sizeMask = newCapacity - 1;// éå† è€Segment[]æ•°ç»„,è¿›è¡Œæ•°æ®è¿ç§» for (int i = 0; i &lt; oldCapacity ; i++) { // é“¾è¡¨çš„ç¬¬ä¸€ä¸ª å¤´èŠ‚ç‚¹ HashEntry&lt;K,V&gt; e = oldTable[i]; if (e != null) { HashEntry&lt;K,V&gt; next = e.next; // é‡æ–°è®¡ç®— å½“å‰key,åœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼› int idx = e.hash &amp; sizeMask; // å½“å‰ HashEntryå¯¹è±¡ï¼Œæ²¡æœ‰å­˜åœ¨ hashå†²çªï¼Œæ²¡æœ‰å½¢æˆé“¾è¡¨ï¼Œç›´æ¥ç»™å€¼åˆ°æ–°çš„æ•°ç»„ä¸­ if (next == null) // Single node on list newTable[idx] = e; else { // Reuse consecutive sequence at same slot /** * * éå†é“¾è¡¨ * * è¯»å–é“¾è¡¨çš„æœ€åä¸€ä¸ª HashEntry å¹¶ä¸”è®¡ç®—åœ¨æ–°æ•°ç»„çš„ä¸­ä½ç½®ï¼Œå°†å…¶æ”¾åˆ°æ–°æ•°ç»„ä¸­ */ HashEntry&lt;K,V&gt; lastRun = e; int lastIdx = idx; for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) { int k = last.hash &amp; sizeMask; if (k != lastIdx) { lastIdx = k; lastRun = last; } } newTable[lastIdx] = lastRun; // Clone remaining nodes // éå†é“¾è¡¨çš„å‰é¢å‡ ä¸ª ä¸Šä¸€ä¸ª å¾ªç¯å·²ç»æ‹¿äº† æœ€åä¸€ä¸ªï¼› for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) { V v = p.value; int h = p.hash; int k = h &amp; sizeMask; // æ ¹æ®è®¡ç®—çš„æ–°æ•°ç»„ä¸‹æ ‡ï¼Œä»æ–°æ•°ç»„ä¸­çš„è¿™ä¸ªä½ç½®æ‹¿HashEntryï¼Œ // ç„¶åé‡æ–°æ„é€ è‡ªå·± HashEntryï¼Œå¦‚æœï¼Œè¿™ä¸ªä½ç½®ä¸å­˜åœ¨HashEntry çš„è¯ï¼Œ // é‚£è‡ªå·±å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ï¼Œè‡ªå·±ä½œä¸ºå¤´èŠ‚ç‚¹åŠ å…¥åˆ° é“¾è¡¨ä¸­ï¼Œå°†åŸæ¥çš„HashEntry ä½œä¸ºè‡ªå·±çš„next. // è¿™ç§æƒ…å†µæœ‰å¯èƒ½ä¼šåŠ å…¥åˆ°æ–°çš„é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”ä½œä¸ºå¤´èŠ‚ç‚¹ï¼› // ä¹Ÿæœ‰å¯èƒ½è‡ªå·±å æ®ä¸€ä¸ªä½ç½®ã€‚ HashEntry&lt;K,V&gt; n = newTable[k]; newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); } } } } // æ·»åŠ æ–°çš„èŠ‚ç‚¹ int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; // æ›´æ¢æ–°çš„ HashEntry[] å› ä¸ºå·²ç»æ‰©å®¹äº† table = newTable } 7ã€Get(Object key) get æ–¹æ³•å¹¶æ²¡æœ‰åŠ é”ï¼Œè€Œæ˜¯é€šè¿‡UNSAFEç±»çš„æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚ 8ã€æ€»ç»“ ConcurrentHashMap ä¸ HashTable éƒ½æ˜¯å±äºçº¿ç¨‹å®‰å…¨çš„ Map,ä½†ä¸¤è€…çš„åŒºåˆ«ä¸åŒã€‚HashTable çš„çº¿ç¨‹å®‰å…¨æ˜¯åŸºäºSycnchronized,æ˜¯æ¯ä¸ªæ–¹æ³•éƒ½ä¸Šäº†sycnchronizedï¼›é”ä½äº†æ•´ä¸ªHashTable,æ•ˆç‡ä½ä¸‹ã€‚ConcurrentHashMap è€Œæ˜¯é‡‡ç”¨åˆ†æ®µé”çš„è®¾è®¡ï¼Œå°†æ•°æ®æ‹†åˆ†å¼€æ¥å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯ æ¯ä¸€ä¸ª Segment éƒ½æ˜¯ä¸€ä¸ª ä¸€ä¸ªé”ï¼ŒSegment ç»§æ‰¿äº† ReentrantLockï¼Œç»è¿‡ä¸¤æ¬¡ å¯¹keyçš„Hash è¿ç®—ï¼Œè¿›è¡Œå¯¹keyåœ¨ Segment[] æ•°ç»„ä¸­çš„ä½ç½®å’ŒSegment[]ä¸­çš„HashEntry[]æ•°ç»„ä¸­çš„ä½ç½®å®šä½ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å°†æ•°æ®æ‰“æ•£å¼€äº†å­˜å‚¨ï¼Œåœ¨Getçš„æ—¶å€™ï¼Œå¦‚æœä¸å­˜Hashå†²çªï¼Œä¹Ÿå°±æ˜¯ä¸åœ¨åŒä¸€ä¸ªSegment å°±ä¸ä¼šå‡ºç°ç«äº‰å…³ç³»ï¼Œå¤§å¤§æå‡äº†æ•ˆç‡é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ ConcurrentHashMapè¿­ä»£å™¨æ˜¯å¼±ä¸€è‡´æ€§çš„ã€‚ ConcurrentHashMapæœ‰äº›æ–¹æ³•éœ€è¦è·¨æ®µï¼Œæ¯”å¦‚size()å’ŒcontainsValue()ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦é”å®šæ•´ä¸ªè¡¨è€Œè€Œä¸ä»…ä»…æ˜¯æŸä¸ªæ®µï¼Œè¿™éœ€è¦æŒ‰é¡ºåºé”å®šæ‰€æœ‰æ®µï¼Œæ“ä½œå®Œæ¯•åï¼ŒåˆæŒ‰é¡ºåºé‡Šæ”¾æ‰€æœ‰æ®µçš„é”ã€‚è¿™é‡Œâ€œæŒ‰é¡ºåºâ€æ˜¯å¾ˆé‡è¦çš„ï¼Œå¦åˆ™ææœ‰å¯èƒ½å‡ºç°æ­»é”ï¼Œåœ¨ConcurrentHashMapå†…éƒ¨ï¼Œæ®µæ•°ç»„æ˜¯finalçš„ï¼Œå¹¶ä¸”å…¶æˆå‘˜å˜é‡å®é™…ä¸Šä¹Ÿæ˜¯finalçš„ï¼Œä½†æ˜¯ï¼Œä»…ä»…æ˜¯å°†æ•°ç»„å£°æ˜ä¸ºfinalçš„å¹¶ä¸ä¿è¯æ•°ç»„æˆå‘˜ä¹Ÿæ˜¯finalçš„ï¼Œè¿™éœ€è¦å®ç°ä¸Šçš„ä¿è¯ã€‚è¿™å¯ä»¥ç¡®ä¿ä¸ä¼šå‡ºç°æ­»é”ï¼Œå› ä¸ºè·å¾—é”çš„é¡ºåºæ˜¯å›ºå®šçš„ã€‚","link":"/posts/62ed19e0/"},{"title":"åœ¨å®‰å“é‡Œæ²¡æœ‰Spring?ä¸å­˜åœ¨çš„ï¼Œå’±ä»¬è‡ªå·±æ‰‹å†™å®ç° IOC ä¸ DIï¼Œåœ¨å®‰å“é‡Œä¹Ÿä¸å†è‡ªå·±newåƒ","text":"æœ€è¿‘æ¥è§¦çš„é¡¹ç›®ï¼Œä¸åŸç”Ÿçš„å®‰å“å¼€å‘ç›¸å…³ã€‚ å¯¹äºå®‰å“çš„å¼€å‘å¹¶ä¸ç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ°äº†å®‰å“å¼€å‘ã€‚å› ä¸ºè‡ªå·±ç”¨ä¹ æƒ¯äº†Spring æ¡†æ¶çš„å¼€å‘ã€‚ç”¨èµ·å®‰å“æ¥ï¼Œå¾ˆæ˜¯ä¸ä¹ æƒ¯äº†ã€‚ è¿™æ ·å­ä¸ç¬¦åˆæˆ‘çš„ä¸ªæ€§ä¹ æƒ¯äº†ï¼Œæˆ‘å°±æ˜¯åœ¨å®‰å“ä¸­ä½¿ç”¨Springçš„ç±»ä¼¼åŠŸèƒ½ï¼Œæˆ‘å°±è¦å®ç°Spring çš„ Beançš„æ³¨å…¥å¼€å‘ï¼Œå®ç° IOC å®ç°DIã€‚ å¦‚ä½•å®ç°è¯·çœ‹æ“ä½œï¼šï¼Ÿ 1ã€å»ºç«‹ä¸€ä¸ªAndroid demo é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š annotation åŒ…ï¼š Autowired æ³¨è§£ä¸Springçš„AutowiredåŠŸèƒ½ç±»ä¼¼ï¼Œå®ç°å±æ€§æ³¨å…¥ã€‚ BeanScan æ³¨è§£ åŒ…æ‰«ææ³¨è§£ Componet æ³¨è§£ ä¸Spring Componet æ³¨è§£ä¸€æ ·ã€‚ Table æ³¨è§£æ˜¯åš æ•°æ®çš„å®ä½“ä¸æ•°æ®åº“åšæ˜ å°„çš„ ä¸€ä¸ªæ³¨è§£ï¼Œç±»ä¼¼MyBtias-plusçš„ä¸€æ · db:æ˜¯æ•°æ®åº“ç›¸å…³çš„å°è£… ä¸æ­¤æ–‡æ²¡æœ‰å¤šå¤§å…³ç³» springåŒ…ï¼šå°±æ˜¯æ­¤æ–‡çš„é‡ç‚¹åŒ…ã€‚ ApplicationContextAwareï¼šä¸Spring çš„ApplicationContextAwareä¸€æ ·ï¼Œæ‹¿åˆ°ä¸Šä¸‹æ–‡çš„å¯¹è±¡ï¼Œæ‹¿åˆ°å¯¹è±¡å°±å¯ä»¥å¯¹è·å–Beanâ€¦ BeanFactoryPostProcessorï¼šä¸ºspringåœ¨å®¹å™¨åˆå§‹åŒ–æ—¶å¯¹å¤–å¯¹å¤–æš´éœ²çš„æ‰©å±•æ¥å£ï¼Œåœ¨Beanå®ä¾‹åŒ–å‰å¯ä»¥å¯¹ BeanDeinitionçš„ä¸€äº›å±æ€§è¿›è¡Œæ“ä½œä¿®æ”¹ã€‚ factoryåŒ…ï¼šBeanå·¥å‚åŒ…ï¼Œå®šä¹‰äº†Beanæ³¨å†Œçš„æ¥å£ï¼Œå’Œè·å–Bean çš„æ¥å£ã€‚ scanåŒ…ï¼šå¯¹é¡¹ç›®çš„è·Ÿè·¯å¾„è¿›è¡Œæ‰«æï¼Œå‡¡äº‹åŠ äº†æ³¨è§£@Componetæ³¨è§£çš„ï¼Œéƒ½ä¸€å°†Beanæ”¾åˆ°IOCå®¹å™¨ä¸­ã€‚ ApplicationContextï¼šå…¥å£ç±»ã€‚ é¡¹ç›®ç»“æ„ç®€å•å®Œæˆã€‚ æ³¨è§£ï¼š Autowiredï¼š 12345678910111213/** * &lt;p&gt; * * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-03-29 0w:22 */@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.FIELD)@Documentedpublic @interface Autowired {} Component 12345678910111213141516171819/** * &lt;p&gt; * * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-03-28 01:12 */@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.TYPE)@Documentedpublic @interface Component { /** * BeanName * @return */ String name() default &quot;&quot;;} BeanScan 1234567891011@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.TYPE)@Documentedpublic @interface BeanScan { /** * åŒ…è·¯å¾„ * @return */ String packages();} 2ã€å…¥å£ç±» ApplicationContext æ¨¡ä»¿Springçš„refresh()æ–¹æ³•ã€‚ æ„é€ å‡½æ•°ï¼š éœ€è¦ä¸€ä¸ª Activityå¯¹è±¡ï¼Œå®‰å“ä¸­æœ€é‡è¦çš„å°±æ˜¯Activityäº†ï¼ŒAndroidå››å¤§ç»„ä»¶ä¹‹ä¸€ã€‚æ¯ä¸€ä¸ªé¡µé¢éƒ½åˆä¸€ä¸ªActivity,å®‰å“ä¸­æœ‰ä¸€ä¸ªä¸»MainActivityï¼Œå®ƒå°±æ˜¯å…¥å£ï¼Œé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šé¦–å…ˆåŠ è½½ä¸»MainActivityã€‚Spring çš„åŒ…æ‰«æï¼Œä¹Ÿå°±å®šåœ¨è¿™ã€‚ 12345public ApplicationContext(MainActivity activity) { this.context = activity.getApplicationContext(); handlerBeanScaner(activity);} MainActivityï¼š 123456789101112131415161718@BeanScan(packages = &quot;com.example.testdemo&quot;)public class MainActivity extends Activity { public static Context context; public static ApplicationContext applicationContext; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); context = getApplicationContext(); applicationContext = new ApplicationContext(this); Tiger tiger = applicationContext.getBean(&quot;tiger&quot;); tiger.eat(); }} æ¯ä¸€ä¸ªActivityéƒ½è¦ç»§æ‰¿äºä¸€ä¸ªåŸºç±»Actityã€‚ é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¼šåŠ è½½ä¸€ä¸ª onCreate æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¼€å¯æˆ‘ä»¬çš„ å®‰å“Springä¹‹è·¯ã€‚ æˆ‘ä»¬æ„é€ ä¸€ä¸ª new ApplicationContext(this)ï¼›ä¼ å…¥å½“å‰å¯¹è±¡ï¼Œç›®çš„æ˜¯æ‹¿åˆ°å½“å‰å¯¹è±¡çš„æ³¨è§£ï¼Œ@BeanScan(packages = â€œcom.example.testdemoâ€) 12345678910111213141516public ApplicationContext(MainActivity activity) { this.context = activity.getApplicationContext(); handlerBeanScaner(activity);}private void handlerBeanScaner(MainActivity activity) { this.activity = activity; Class&lt;? extends MainActivity&gt; aClass = activity.getClass(); BeanScan annotation = aClass.getAnnotation(BeanScan.class); if (StringUtils.isNotNull(annotation)) { this.packages = annotation.packages(); this.refresh(); }} æ‹¿åˆ°äº†æ³¨è§£çš„ä¸Šçš„è¦æ‰«æçš„åŒ…è·¯å¾„ï¼Œç„¶åè¿›è¡Œç­›é€‰æ‰«æï¼š refreshæ–¹æ³• æ˜¯ä¸æ˜¯é›¨Spirngçš„æœ‰ç‚¹ç›¸ä¼¼å•Šã€‚ 12345678910111213141516private void refresh() { this.beanFactory = createBeanFactory(); this.scanner = new ClassBeanScanner(beanFactory); this.scanner.scan(this.context, this.packages); invokeBeanFactoryPostProcessors(beanFactory); finishBeanInit(); setApplicationContext(); invokeInitializingBean(beanFactory);} DefaultBeanFactory å®ç°äº† SingletonBeanFactory DefaultBeanFactory å°±å­˜æ”¾äº†å®ä¾‹åŒ–åçš„Bean ä¸ å®ä¾‹è¯å‰çš„ BeanDeinitionå¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºIOCå®¹å™¨ã€‚ åˆå§‹åŒ–å¥½åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œæ‰«æã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.example.testdemo.spring.scan;import android.content.Context;import com.example.testdemo.annotation.Component;import com.example.testdemo.spring.bean.BeanDefinition;import com.example.testdemo.spring.bean.GenericBeanDefinition;import com.example.testdemo.spring.factory.DefaultBeanFactory;import com.example.testdemo.utils.StringUtils;import java.io.IOException;import java.util.ArrayList;import java.util.Enumeration;import java.util.List;import dalvik.system.DexFile;/** * &lt;p&gt; * * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-03-29 01:01 */public abstract class ClassPathBeanDefinitionScanner implements BeanScanner { private DefaultBeanFactory beanFactory; public ClassPathBeanDefinitionScanner(DefaultBeanFactory beanFactory) { this.beanFactory = beanFactory; } /** * å®ç°äº†æˆ‘ä»¬çš„æ‰«ææ¥å£çš„æ–¹æ³• * @param context * @param packages * @return */ @Override public List&lt;BeanDefinition&gt; scan(Context context, String packages) { List&lt;String&gt; className = getClassName(context, packages); List&lt;BeanDefinition&gt; beanDefinitions = new ArrayList&lt;&gt;(); for (String clazz : className) { try { Class&lt;?&gt; aClass = Class.forName(clazz); Component component = aClass.getAnnotation(Component.class); if (StringUtils.isNull(component)) { continue; } GenericBeanDefinition beanDefinition = new GenericBeanDefinition(); String name = component.name(); if (StringUtils.isBlank(name)) { name = toLowerCaseFirstOne(aClass.getSimpleName()); } beanDefinition.setBeanName(name); beanDefinition.setAliasName(name); beanDefinition.setBeanClass(aClass); beanDefinitions.add(beanDefinition); beanFactory.registerSingleton(name, beanDefinition); } catch (ClassNotFoundException e) { e.printStackTrace(); } } return beanDefinitions; } /** * ç­›é€‰å¤„æŒ‡å®šåŒ…ä¸‹çš„ç±» * @param context * @param packageName * @return */ private List&lt;String&gt; getClassName(Context context, String packageName) { List&lt;String&gt; classNameList = new ArrayList&lt;String&gt;(); try { //é€šè¿‡DexFileæŸ¥æ‰¾å½“å‰çš„APKä¸­å¯æ‰§è¡Œæ–‡ä»¶ DexFile df = new DexFile(context.getPackageCodePath()); //è·å–dfä¸­çš„å…ƒç´  è¿™é‡ŒåŒ…å«äº†æ‰€æœ‰å¯æ‰§è¡Œçš„ç±»å è¯¥ç±»ååŒ…å«äº†åŒ…å+ç±»åçš„æ–¹å¼ Enumeration&lt;String&gt; enumeration = df.entries(); while (enumeration.hasMoreElements()) { String className = enumeration.nextElement(); //åœ¨å½“å‰æ‰€æœ‰å¯æ‰§è¡Œçš„ç±»é‡Œé¢æŸ¥æ‰¾åŒ…å«æœ‰è¯¥åŒ…åçš„æ‰€æœ‰ç±» if (className.contains(packageName)) { classNameList.add(className); } } } catch (IOException e) { e.printStackTrace(); } return classNameList; } /** * é¦–å­—æ¯å°å†™ * @param s * @return */ private static String toLowerCaseFirstOne(String s) { if (Character.isLowerCase(s.charAt(0))) { return s; } else { return (new StringBuilder()).append(Character.toLowerCase(s.charAt(0))).append(s.substring(1)).toString(); } }} invokeBeanFactoryPostProcessors(beanFactory); åœ¨å®ŒæˆBeançš„æ‰«æ å°†Beançš„å…ƒæ•°æ®è§£æåï¼Œè¿›è¡Œè°ƒç”¨ã€‚ 123456private void invokeBeanFactoryPostProcessors(DefaultBeanFactory beanFactory) { List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessor = beanFactory.getBeanFactoryPostProcessor(); for (BeanFactoryPostProcessor processor : beanFactoryPostProcessor) { processor.postProcessBeanFactory(this.singletonBeanFactory); }} finishBeanInit(); Beançš„å®ä¾‹åŒ–ï¼Œå’Œä¾èµ–æ³¨å…¥ï¼š 12345678910111213private void finishBeanInit() { Map&lt;String, BeanDefinition&gt; beanDefinitionMap = beanFactory.getBeanDefinitionMap(); for (Map.Entry&lt;String, BeanDefinition&gt; entry : beanDefinitionMap.entrySet()) { String beanName = entry.getKey(); GenericBeanDefinition beanDefinition = (GenericBeanDefinition) entry.getValue(); Class&lt;?&gt; beanClass = beanDefinition.getBeanClass(); Object newInstance = createBean(beanClass); registerBean(beanName, newInstance); } // å¤„ç†ä¾èµ–æ³¨å…¥ isInjection(beanDefinitionMap);} ä¾èµ–æ³¨å…¥ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849private void isInjection(Map&lt;String, BeanDefinition&gt; beanDefinitionMap) { // å†æ¬¡éå†æ‰€æœ‰çš„å®ä¾‹åŒ–çš„ BeanDefinition,å¤„ç†ä¾èµ–å…³ç³» for (Map.Entry&lt;String, BeanDefinition&gt; entry : beanDefinitionMap.entrySet()) { String beanName = entry.getKey(); GenericBeanDefinition beanDefinition = (GenericBeanDefinition) entry.getValue(); Class&lt;?&gt; beanClass = beanDefinition.getBeanClass(); Field[] declaredFields = beanClass.getDeclaredFields(); for (Field field : declaredFields) { Autowired annotation = field.getAnnotation(Autowired.class); if (StringUtils.isNull(annotation)) { continue; } // å½“å‰çš„å®ä¾‹ Object bean = getBean(beanName); if (StringUtils.isNull(bean)) { throw new BeansException(&quot;Autowired æ³¨å…¥å¿…é¡»ä¸ä¸ºç©º &quot; + field.getName()); } // å…è®¸æ“ä½œä¿®æ”¹ field.setAccessible(true); Class&lt;?&gt; fieldType = field.getType(); // æ£€æŸ¥åŠ åŠ äº† Autowired æ³¨è§£çš„å±æ€§ï¼Œæ˜¯å¦åŠ äº† Componentæ³¨è§£ // å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰¾ä¸åˆ°å®ä¾‹æ³¨å…¥ Component component = fieldType.getAnnotation(Component.class); if (StringUtils.isNotNull(component)) { String fieldBeanName = component.name(); if (StringUtils.isBlank(fieldBeanName)) { // å¦‚æœåŠ äº†ï¼Œä»IOCå®¹å™¨ä¸­è·å–å½“å‰å±æ€§çš„å®ä¾‹ fieldBeanName = toLowerCaseFirstOne(fieldType.getSimpleName()); Object fieldObject = getBean(fieldBeanName); if (StringUtils.isNotNull(fieldObject)) { try { // åšå±æ€§èµ‹å€¼ field.set(bean, fieldObject); } catch (IllegalAccessException e) { e.printStackTrace(); } } } } } }} spring åœ¨å¤„ç†æ³¨å…¥çš„æ—¶å€™ä½¿ç”¨äº†é€’å½’æ³¨å…¥ï¼Œåœ¨å®ä¾‹åŒ–Bean çš„æ—¶å€™ï¼Œå°±ä¼šæ£€æŸ¥å½“å‰ç±»çš„æœ‰æ²¡æœ‰å±æ€§ åŠ äº†ï¼ŒAutowired æ³¨è§£çš„ï¼Œå¦‚æœåŠ äº†ï¼Œåˆ¤æ–­å½“å‰å±æ€§æ˜¯å¦å·²ç»å®ä¾‹åŒ–äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šå®ä¾‹åŒ–ä¸‹å»ã€‚å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œåˆä¼šæ£€æŸ¥å®ƒçš„å±æ€§æ˜¯å¦åˆä¾èµ–æ³¨å…¥ï¼Œæœ‰è¿‡æœ‰åˆåˆ¤æ–­å½“å‰çš„å±æ€§æ˜¯å¦å®ä¾‹åŒ–ä¸‹å»ï¼Œè¿™æ ·å­ä¼šå¾ªç¯åˆ¤æ–­ä¸‹å»ï¼Œæ‰€ä»¥Springä½¿ç”¨äº†é€’å½’ã€‚ ç›¸äº’ä¾èµ–å†²çªçš„åŒ–å°±ä¼šå‡ºç° è¿™ä¼šå°±æœ‰å¯èƒ½ä¼šæŠ›å‡º circle å¼‚å¸¸ã€‚ åœ¨è¿™é‡Œæˆ‘å°±æ²¡æœ‰ä½¿ç”¨é€’å½’ï¼Œåˆ†å¼€äº†ä¸¤éƒ¨æ“ä½œï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å…ˆå®ä¾‹åŒ–æ‰€æœ‰çš„Beanå†å¤„ç†ä¾èµ–æ³¨å…¥çš„é—®é¢˜ï¼› è¿™ä¸ªæ—¶å€™å·²ç»å®Œæˆäº†DIçš„æ“ä½œäº†ã€‚ æµ‹è¯•ç»“æœï¼š Tiger ç±» 1234567891011121314@Componentpublic class Tiger implements Person { @Autowired private Women women; @Override public void eat() { women.eat(); System.out.println(&quot;Tiger eat...&quot;); }} Women ç±» 1234567@Componentpublic class Women implements Person { @Override public void eat() { System.out.println(&quot;women eat...&quot;); }} MyBeanFactoryPostProcessor Beanå®ä¾‹åŒ–å‰çš„æ‰©å±•æ¥å£ 1234567891011121314151617/** * &lt;p&gt; * * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-03-29 03:12 */@Componentpublic class MyBeanFactoryPostProcessor implements BeanFactoryPostProcessor{ @Override public void postProcessBeanFactory(SingletonBeanFactory beanFactory) throws BeansException { Set&lt;String&gt; names = beanFactory.getBeanDefinitionNames(); System.out.println(&quot;å…±æœ‰Bean:&quot;+beanFactory.getBeanDefinitionCount()); }} MyApplicationContextAware ä¸Šä¸‹æ–‡å¯¹è±¡ 12345678910111213141516171819202122/** * &lt;p&gt; * æ‹¿åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ å¯ä»¥åšä¸€ä¸ªBeanå·¥å‚ * &lt;/p&gt; * * @author æ°¸å¥ * @since 2020-03-29 03:39 */@Componentpublic class MyApplicationContextAware implements ApplicationContextAware { public static ApplicationContext context; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException { context=applicationContext; System.out.println(&quot;æ‹¿åˆ°Springä¸Šä¸Šä¸‹æ–‡å¯¹è±¡&quot;); System.out.println(context); } public static ApplicationContext getApplicationContext() { return context; }} MainActivty çš„ onCreate æ–¹æ³•ï¼Œå…¥å£ 12345678910@Overrideprotected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); context = getApplicationContext(); applicationContext = new ApplicationContext(this); Tiger tiger = applicationContext.getBean(&quot;tiger&quot;); tiger.eat();} æ‰§è¡ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š æ‰“å®Œæ‰‹å·¥ â€‹ ::: hljs-center MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼ å¹¶å‘å·¥å…·CountDownLatchæ˜¯å¦‚ä½•å®ç°é˜»å¡çš„ï¼Ÿ æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ŒMybatisçš„Mapper/Daoä¸ºä»€ä¹ˆå´å¯ä»¥@Autowiredæ³¨å…¥ï¼Ÿ :::","link":"/posts/f10cb61a/"},{"title":"mybatisæºç åˆ†æ-å¯åŠ¨åŸç†","text":"MMyBatiså¯åŠ¨åšäº†äº›ä»€ä¹ˆï¼Ÿ-Mybatis(SpringBoot) æºç åˆ†æ&emsp; æœ€è¿‘å­¦ä¹ äº† Mybatisæºç ï¼Œåšäº†äº›ç¬”è®°ï¼Œåšä¸€æ¬¡åˆ†äº«ã€‚ &emsp; Mybatisæ˜¯ä¸€å¥—å¾ˆæˆç†Ÿçš„ormæ¡†æ¶ï¼Œå†æ¬¡ä¸åšè¿‡å¤šçš„ä»‹ç»ï¼Œæœ¬æ–‡åŸºäºSpringBoot å»åˆ†ç ”ç©¶çš„æºç ã€‚ &emsp; åŠ å…¥æˆ‘ä»¬ä¸çŸ¥é“Mybatis æœ‰å“ªäº›æ ¸å¿ƒç»„å»ºï¼Œå“ªäº›æ ¸å¿ƒç±»ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆç ”ç©¶æºç ï¼Œå†è¿›è¡Œæ€»ç»“ï¼ &emsp; æ­£å¼å¼€å§‹ï¼Œæˆ‘ä»¬å¸¦å‡ ä¸ªç–‘é—®ï¼Ÿ 1.Mybatiså¯åŠ¨çš„æ—¶å€™åšäº†äº›ä»€ä¹ˆï¼Ÿ2.Mybatis å¯åŠ¨åï¼Œå‘èµ·ä¸€ä¸ªæŸ¥è¯¢å‘½ä»¤åˆåšäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¸¦ç€è¿™ä¸¤ä¸ªç–‘é—®è¿›è¡Œæ–­ç‚¹ç ”ç©¶æºç å»ï¼Œç„¶åå†å¯¹è¿™ä¸¤ä¸ªé—®é¢˜ç»†åŒ–åˆ†æï¼ æˆ‘ä»¬å…ˆåˆå§‹è¯æˆ‘ä»¬çš„SpringBoot å·¥ç¨‹ 1.ä¾èµ– 123456789&lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; &emsp; ç°åœ¨æˆ‘ä»¬å·²ç»æ­å¥½äº† SpringBootå·¥ç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ˜¯æ‰¾åˆ°å…¥å£ã€‚ âš ï¸ è¶…çº§MyBatis æºç åœ°å€:https://github.com/memoryoverflow/super-mybatis æˆ‘ä»¬çŸ¥é“SpringBoot ä¸€èˆ¬æ˜¯ä¸å†™xmlæ–‡ä»¶çš„ï¼Œé‚£å®ƒçš„å…¥å£åœ¨å“ªï¼Ÿ å½“ç„¶Mybatisä¸­æœ‰ä¸ªæ³¨è§£ @MapperScan() æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯æˆ‘çš„å…¥å£ã€‚ SpringBootå¯åŠ¨ç±»ä¸­åŠ ä¸Š @MapperScan 123456789@SpringBootApplication@MapperScan(&quot;com.mybatis.lyj.sys.mapper&quot;)@SuperMapperScan(basePackages = &quot;com.mybatis.lyj.sys.mapper&quot;)@EnableAutoForwardGeneration(entityPackages = &quot;com.mybatis.lyj.sys.entity&quot;)public class MybatisApplication{ public static void main(String[] args) { SpringApplication.run(MybatisApplication.class, args); }} &emsp;æˆ‘ä»¬è™½ç„¶æ‰¾åˆ°äº† å®ƒçš„å¯åŠ¨ç´¯æ³¨è§£ï¼Œä½†æ˜¯å®ƒçš„è°æ¥å¤„ç†å®ƒå‘¢ï¼Ÿæˆ‘ä»¬command+é¼ æ ‡ç‚¹å‡»è¿›å…¥è¿™ä¸ª MapperScan.java@MapperScan æºç ä¸­çœ‹åˆ° 123456789101112131415@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.TYPE)@Documented// æ­¤å¤„é‡ç‚¹å…³æ³¨è¿™ä¸ª@Importæ³¨è§£@Import(MapperScannerRegistrar.class)@Import(MapperScannerRegistrar.class)@Repeatable(MapperScans.class)public @interface MapperScan{ ...... // è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„å¸¸ç”¨åˆ°çš„Mapper.classæ‰€åœ¨åŒ…è·¯å¾„ String[] basePackages() default {}; ......} @Import æ³¨è§£çš„ä½œç”¨å°±æ˜¯ç½‘Springä¸­å€’å…¥ä¸€ä¸ªBean å®ƒå€’å…¥çš„è¿™ä¸ªMapperScannerRegistrar.classæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ è·Ÿå®ƒçš„å¯åŠ¨æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå½“ç„¶æœ‰å…³ç³»å•Šï¼Œ@MapperScan æ•…åæ€è®® è‚¯å®šæ˜¯æ‰«æ mapperç±»çš„ä½œç”¨å•Šï¼Ÿå¦‚æœåªæ˜¯å€’å…¥ä¸€ä¸ªBean MapperScannerRegistrar.class è¿™ä¸ªç±»æœ‰ä»€ä¹ˆå¤©æœºå‘¢ï¼Ÿ æˆ‘ä»¬è¿›å…¥çœ‹çœ‹ã€‚ çœ‹ï¼ ä»–ç»§æ‰¿äº† ImportBeanDefinitionRegistrar æ¥å£ã€‚çœ‹è¿‡Springçš„çŸ¥é“ï¼Œspringå®˜æ–¹å°±æ˜¯ç”¨è¿™ç§æ–¹å¼ï¼Œå®ç°äº†@Componentã€@Serviceç­‰æ³¨è§£çš„åŠ¨æ€æ³¨å…¥æœºåˆ¶ã€‚ Mybatis ä¹Ÿæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚æˆ‘ä»¬çœ‹è¿™ä¸ªç±»ä¸­çš„æ–¹æ³• MapperScannerRegistrar.java1234567891011@Overridepublic void(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry){ // é€šè¿‡å®ç°è¿™ä¸ªç±» æ‹¿åˆ°å¯åŠ¨ç±»ä¸Šçš„MapperScanæ³¨è§£ AnnotationAttributes mapperScanAttrs = AnnotationAttributes.fromMap(importingClassMetadata.getAnnotationAttributes(MapperScan.class.getName())); if (mapperScanAttrs != null) { // ç„¶ånew ä¸€ä¸ªSpringä¸­çš„æ‰«æå¯¹è±¡ ClassPathBeanDefinitionScanner åšæ‰«æ registerBeanDefinitions(mapperScanAttrs, registry); }} registerBeanDefinitions()12345678910111213141516171819202122232425262728293031323334353637383940void registerBeanDefinitions(AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry){ // æ­¤ç±»ç»§æ‰¿ Springçš„ ClassPathBeanDefinitionScanner ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry); // this check is needed in Spring 3.1 Optional.ofNullable(resourceLoader).ifPresent(scanner::setResourceLoader); Class&lt;? extends Annotation&gt; annotationClass = annoAttrs.getClass(&quot;annotationClass&quot;); if (!Annotation.class.equals(annotationClass)) { scanner.setAnnotationClass(annotationClass); } Class&lt;?&gt; markerInterface = annoAttrs.getClass(&quot;markerInterface&quot;); if (!Class.class.equals(markerInterface)) { scanner.setMarkerInterface(markerInterface); } Class&lt;? extends BeanNameGenerator&gt; generatorClass = annoAttrs.getClass(&quot;nameGenerator&quot;); if (!BeanNameGenerator.class.equals(generatorClass)) { scanner.setBeanNameGenerator(BeanUtils.instantiateClass(generatorClass)); } Class&lt;? extends MapperFactoryBean&gt; mapperFactoryBeanClass = annoAttrs.getClass(&quot;factoryBean&quot;); if (!MapperFactoryBean.class.equals(mapperFactoryBeanClass)) { scanner.setMapperFactoryBeanClass(mapperFactoryBeanClass); } scanner.setSqlSessionTemplateBeanName(annoAttrs.getString(&quot;sqlSessionTemplateRef&quot;)); scanner.setSqlSessionFactoryBeanName(annoAttrs.getString(&quot;sqlSessionFactoryRef&quot;)); //æ³¨è§£ä¸Šçš„ valueå€¼ List&lt;String&gt; basePackages = new ArrayList&lt;&gt;(); basePackages.addAll(Arrays.stream(annoAttrs.getStringArray(&quot;value&quot;)).filter(StringUtils::hasText).collect(Collectors.toList())); basePackages.addAll(Arrays.stream(annoAttrs.getStringArray(&quot;basePackages&quot;)).filter(StringUtils::hasText).collect(Collectors.toList())); basePackages.addAll(Arrays.stream(annoAttrs.getClassArray(&quot;basePackageClasses&quot;)).map(ClassUtils::getPackageName).collect(Collectors.toList())); // é‡å†™Springçš„æ‰«æè§„åˆ™ï¼Œå¦‚æœä¸é‡å†™ å°†Springçš„æ‰«æè§„åˆ™æ¥æ‰«æBean // å°†æ‰«æä¸åˆ° mapperç±» scanner.registerFilters(); // æ­¤å¤„é‡ç‚¹ æ‰«æmapper ç±» scanner.doScan(StringUtils.toStringArray(basePackages));} doScan(Stringâ€¦ basePackages)1234567891011121314151617@Overridepublic Set&lt;BeanDefinitionHolder&gt; doScan(String... basePackages){ // æ­¤å¤„è¿˜æ˜¯è°ƒç”¨Springä¸­çš„æ‰«æå™¨å»æ‰«æï¼Œåªä¸è¿‡å®ç°è‡ªå·±çš„æ‰«æè§„åˆ™ // æ‰«æè¿‡ç¨‹ å°±ä¸çœ‹äº† Set&lt;BeanDefinitionHolder&gt; beanDefinitions = super.doScan(basePackages); if (beanDefinitions.isEmpty()) { LOGGER.warn(() -&gt; &quot;No MyBatis mapper was found in \\'&quot; + Arrays.toString(basePackages) + &quot;\\' package. Please check your configuration.&quot;); } else { // å¯¹æ‰«æç»“æœè¿›è¡Œä¿®æ”¹ï¼Ÿï¼Ÿä¸ºä»€ä¹ˆè¦è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿ processBeanDefinitions(beanDefinitions); } return beanDefinitions;} processBeanDefinitions(Set beanDefinitions)å¯¹æ‰«æ mapperæ¥å£çš„ç»“æœè¿›è¡Œä¿®æ”¹ï¼Ÿï¼Ÿä¸ºä»€ä¹ˆè¦è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152void processBeanDefinitions(Set&lt;BeanDefinitionHolder&gt; beanDefinitions){ GenericBeanDefinition definition; // å¤šæ‰€ä»¥çš„ BeanDefinition çš„BeanClassè¿›è¡Œä¿®æ”¹ ä¸ºMapperFactoryBean.class for (BeanDefinitionHolder holder : beanDefinitions) { definition = (GenericBeanDefinition) holder.getBeanDefinition(); String beanClassName = definition.getBeanClassName(); LOGGER.debug(() -&gt; &quot;Creating MapperFactoryBean with name \\'&quot; + holder.getBeanName() + &quot;\\' and \\'&quot; + beanClassName + &quot;\\' mapperInterface&quot;); // the mapper interface is the original class of the bean // but, the actual class of the bean is MapperFactoryBean definition.getConstructorArgumentValues().addGenericArgumentValue(beanClassName); // issue #59 definition.setBeanClass(this.mapperFactoryBeanClass); definition.getPropertyValues().add(&quot;addToConfig&quot;, this.addToConfig); boolean explicitFactoryUsed = false; if (StringUtils.hasText(this.sqlSessionFactoryBeanName)) { definition.getPropertyValues().add(&quot;sqlSessionFactory&quot;, new RuntimeBeanReference(this.sqlSessionFactoryBeanName)); explicitFactoryUsed = true; } else if (this.sqlSessionFactory != null) { definition.getPropertyValues().add(&quot;sqlSessionFactory&quot;, this.sqlSessionFactory); explicitFactoryUsed = true; } if (StringUtils.hasText(this.sqlSessionTemplateBeanName)) { if (explicitFactoryUsed) { LOGGER.warn(() -&gt; &quot;Cannot use both: sqlSessionTemplate and sqlSessionFactory together. sqlSessionFactory is ignored.&quot;); } definition.getPropertyValues().add(&quot;sqlSessionTemplate&quot;, new RuntimeBeanReference(this.sqlSessionTemplateBeanName)); explicitFactoryUsed = true; } else if (this.sqlSessionTemplate != null) { if (explicitFactoryUsed) { LOGGER.warn(() -&gt; &quot;Cannot use both: sqlSessionTemplate and sqlSessionFactory together. sqlSessionFactory is ignored.&quot;); } definition.getPropertyValues().add(&quot;sqlSessionTemplate&quot;, this.sqlSessionTemplate); explicitFactoryUsed = true; } if (!explicitFactoryUsed) { LOGGER.debug(() -&gt; &quot;Enabling autowire by type for MapperFactoryBean with name \\'&quot; + holder.getBeanName() + &quot;\\'.&quot;); definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE); } }} åŸå› ï¼šä¸ºä»€ä¹ˆè¦ä¿®æ”¹å‘¢ï¼Ÿé¦–å…ˆï¼Œmapperæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸èƒ½å®ä¾‹è¯ã€‚é‚£æ€ä¹ˆåŠï¼Ÿ æ”¾åˆ°Springç®¡ç†çš„è¯ å®ƒå¹¶æ²¡æœ‰ç›´æ¥å¯¹æ¥å£çš„å¤„ç†ç”Ÿæˆä»£ç†å¯¹è±¡ï¼ï¼ä½†æ˜¯å‘¢ å®ƒæä¾›äº†ä¸€ä¸ªFactoryBean æ¥å£ï¼›å¤§å®¶éƒ½çŸ¥é“ Springä¸­åˆä¸¤ç§Beanä¸€ç§å°±æ˜¯æ™®é€šBean ä¸€ç§å°±æ˜¯ FactoryBeanï¼› mybatisä¸­å°±æ˜¯åˆ©ç”¨è¿™ä¸ªFactoryBean æ”¾åˆ° BeanDefinition ä¸­ï¼Œåœ¨Springä¸­å®ä¾‹è¯æ‰€ä»¥éæ‡’åŠ è½½çš„å•åˆ©beanæ—¶å€™ï¼Œå¦‚æœ æ˜¯ FactoryBean çš„è¯ å°±ä¼šè·å–getObjectæ–¹æ³•æ¥è·å–è¿™ä¸ªå®ä¾‹ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•ä¸­mybatis è¿”å›çš„æ˜¯ä¸€ä¸ªmapperä»£ç†å¯¹è±¡ã€‚æ­¤å¤„å°±å®Œæˆäº† å¯¹ Mapperæ¥å£çš„æ‰«æï¼Œæ¥ä¸‹æ¥çš„å®ä¾‹è¯ å°±äº¤ç»™Springæ¥å¤„ç†äº†ã€‚è¿™ä¸ªå°±æ˜¯ @MapperScan çš„ä½œç”¨äº†ã€‚ è¿™ä¸ªæ—¶å€™æ˜¯ä¸æ˜¯å°±æœ‰ä¸€ä¸ªç»“æœäº†å•Š1ã€MyBatiså¯åŠ¨çš„æ—¶å€™åˆ©ç”¨Springçš„æ‰«æå™¨å»æ‰«æMapperç±»ï¼Œå°†æ‰«æç»“æœè¿›è¡Œæ›¿æ¢ï¼ŒBeanClassè¿›è¡Œæ›¿æ¢ä¸º MapperFacotoryBean.class ï¼Œå®Œæˆmapperä»£ç†å¯¹è±¡çš„åˆå§‹åŒ–ã€‚ Mybatiså¯åŠ¨å°±åšäº†è¿™ç‚¹ä¸œè¥¿å—ï¼Ÿ ä¸è¿˜æœ‰xmlçš„è§£æï¼Œè‡ªåŠ¨åŒ–é…ç½®å¤„ç†â€¦. xmlè§£ææˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ xmlçš„è§£æï¼Œå…ˆçœ‹çœ‹SpringBoot Mybatis-starer jaråŒ…ä¸‹æœ‰é‚£å‡ ä¸ªåŒ… æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®çš„Staterè¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®çš„åŒ…åšä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œmybatiså¯åŠ¨ éœ€è¦é…ç½®ä¸€ä¸‹é…ç½®ä¿¡æ¯å§ï¼Œæ•°æ®æºä»€ä¹ˆçš„ï¼Œå› ä¸ºè¦åˆå§‹è¯ï¼Œæ‰€ä»¥å°±è¦å»è¯»å–é…ç½®æ–‡ä»¶çš„é…ç½®ä¿¡æ¯å§ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒå¹²äº†ä»€ä¹ˆï¼Ÿ&gt; å…ˆçœ‹ MybatisProperties.class è¿™é‡Œé¢åªæœ‰å®ƒçš„å±æ€§ MybatisProperties.class123456789101112131415161718192021222324252627282930313233343536373839404142public static final String MYBATIS_PREFIX = &quot;mybatis&quot;;private static final ResourcePatternResolver resourceResolver = new PathMatchingResourcePatternResolver();/** * Location of MyBatis xml config file. * mybatisçš„é…ç½®æ–‡ä»¶ */private String configLocation;/** * Locations of MyBatis mapper files. * mapper æ–‡ä»¶è·¯å¾„ */private String[] mapperLocations;/** * * Packages to search type aliases. (Package delimiters are &quot;,; \\\\t\\&quot;) */// åˆ«ååŒ… private String typeAliasesPackage;///** * The super class for filtering type alias. * If this not specifies, the MyBatis deal as type alias all classes that searched from typeAliasesPackage. */private Class&lt;?&gt; typeAliasesSuperType;/** * Packages to search for type handlers. (Package delimiters are &quot;,; \\\\t\\&quot;) */private String typeHandlersPackage;/** * Indicates whether perform presence check of the MyBatis xml config file. */private boolean checkConfigLocation = false;/** * Execution mode for {@link org.mybatis.spring.SqlSessionTemplate}. */private ExecutorType executorType;/** * Externalized properties for MyBatis configuration. */private Properties configurationProperties;/** * A Configuration object for customize default settings. If {@link #configLocation} * is specified, this property is not used. */// é‡ç‚¹åœ¨è¿™ä¸ª Configuration è¿™ä¸ª Configuration è´¯å½»å…¨æ–‡çš„ï¼Œç”»åœˆåœˆ è¦è€ƒè¯•çš„@NestedConfigurationPropertyprivate Configuration configuration; resolveMapperLocations()æ‰«æxmlå°†å…¶è½¬æ¢ä¸º Resource[] MybatisAutoConfiguration.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152@org.springframework.context.annotation.Configuration@ConditionalOnClass({SqlSessionFactory.class, SqlSessionFactoryBean.class})// æ•°æ®å…ƒå¤„ç†@ConditionalOnSingleCandidate(DataSource.class)@EnableConfigurationProperties(MybatisProperties.class)// æ•°æ®æºè‡ªåŠ¨åŒ–é…ç½®@AutoConfigureAfter(DataSourceAutoConfiguration.class)public class MybatisAutoConfiguration implements InitializingBean{ private static final Logger logger = LoggerFactory.getLogger(MybatisAutoConfiguration.class); private final MybatisProperties properties; private final Interceptor[] interceptors; private final ResourceLoader resourceLoader; private final DatabaseIdProvider databaseIdProvider; private final List&lt;ConfigurationCustomizer&gt; configurationCustomizers; public MybatisAutoConfiguration(MybatisProperties properties, ObjectProvider&lt;Interceptor[]&gt; interceptorsProvider, ResourceLoader resourceLoader, ObjectProvider&lt;DatabaseIdProvider&gt; databaseIdProvider, ObjectProvider&lt;List&lt;ConfigurationCustomizer&gt;&gt; configurationCustomizersProvider) { this.properties = properties; this.interceptors = interceptorsProvider.getIfAvailable(); this.resourceLoader = resourceLoader; this.databaseIdProvider = databaseIdProvider.getIfAvailable(); this.configurationCustomizers = configurationCustomizersProvider.getIfAvailable(); } @Override public void afterPropertiesSet() { checkConfigFileExists(); } private void checkConfigFileExists() { if (this.properties.isCheckConfigLocation() &amp;&amp; StringUtils.hasText(this.properties.getConfigLocation())) { Resource resource = this.resourceLoader.getResource(this.properties.getConfigLocation()); Assert.state(resource.exists(), &quot;Cannot find config location: &quot; + resource + &quot; (please add config file or check your Mybatis configuration)&quot;); } } // å…³é”®ç‚¹ åœ¨è¿™é‡Œ åˆå§‹åŒ–å·¥é•¿ï¼Œå¹¶ä¸”å®Œæˆxmlè§£æ @Bean @ConditionalOnMissingBean public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception { SqlSessionFactoryBean factory = new SqlSessionFactoryBean(); factory.setDataSource(dataSource); factory.setVfs(SpringBootVFS.class); if (StringUtils.hasText(this.properties.getConfigLocation())) { factory.setConfigLocation(this.resourceLoader.getResource(this.properties.getConfigLocation())); } applyConfiguration(factory); if (this.properties.getConfigurationProperties() != null) { factory.setConfigurationProperties(this.properties.getConfigurationProperties()); } if (!ObjectUtils.isEmpty(this.interceptors)) { factory.setPlugins(this.interceptors); } if (this.databaseIdProvider != null) { factory.setDatabaseIdProvider(this.databaseIdProvider); } if (StringUtils.hasLength(this.properties.getTypeAliasesPackage())) { factory.setTypeAliasesPackage(this.properties.getTypeAliasesPackage()); } if (this.properties.getTypeAliasesSuperType() != null) { factory.setTypeAliasesSuperType(this.properties.getTypeAliasesSuperType()); } if (StringUtils.hasLength(this.properties.getTypeHandlersPackage())) { factory.setTypeHandlersPackage(this.properties.getTypeHandlersPackage()); } // mapper æ‰«æã€‚å°†mapper.xmlè½¬æ¢ä¸ºResource if (!ObjectUtils.isEmpty(this.properties.resolveMapperLocations())) { factory.setMapperLocations(this.properties.resolveMapperLocations()); } // å·¥å‚åˆå§‹åŒ– return factory.getObject(); } private void applyConfiguration(SqlSessionFactoryBean factory) { Configuration configuration = this.properties.getConfiguration(); if (configuration == null &amp;&amp; !StringUtils.hasText(this.properties.getConfigLocation())) { configuration = new Configuration(); } if (configuration != null &amp;&amp; !CollectionUtils.isEmpty(this.configurationCustomizers)) { for (ConfigurationCustomizer customizer : this.configurationCustomizers) { customizer.customize(configuration); } } factory.setConfiguration(configuration); } @Bean @ConditionalOnMissingBean public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory sqlSessionFactory) { ExecutorType executorType = this.properties.getExecutorType(); if (executorType != null) { return new SqlSessionTemplate(sqlSessionFactory, executorType); } else { return new SqlSessionTemplate(sqlSessionFactory); } } // å¤„ç† @Mapperæ³¨è§£çš„ public static class AutoConfiguredMapperScannerRegistrar implements BeanFactoryAware, ImportBeanDefinitionRegistrar, ResourceLoaderAware { private BeanFactory beanFactory; private ResourceLoader resourceLoader; @Override public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) { if (!AutoConfigurationPackages.has(this.beanFactory)) { logger.debug(&quot;Could not determine auto-configuration package, automatic mapper scanning disabled.&quot;); return; } logger.debug(&quot;Searching for mappers annotated with @Mapper&quot;); List&lt;String&gt; packages = AutoConfigurationPackages.get(this.beanFactory); if (logger.isDebugEnabled()) { packages.forEach(pkg -&gt; logger.debug(&quot;Using auto-configuration base package \\'{}\\'&quot;, pkg)); } ClassPathMapperScanner scanner = new ClassPathMapperScanner(registry); if (this.resourceLoader != null) { scanner.setResourceLoader(this.resourceLoader); } scanner.setAnnotationClass(Mapper.class); scanner.registerFilters(); scanner.doScan(StringUtils.toStringArray(packages)); } @Override public void setBeanFactory(BeanFactory beanFactory) { this.beanFactory = beanFactory; } @Override public void setResourceLoader(ResourceLoader resourceLoader) { this.resourceLoader = resourceLoader; } }} ç°åœ¨è·Ÿä¸­ä¸‹å» å·¥å‚çš„åˆå§‹åŒ–SqlSessionFactoryBean.class &gt; getObject() -&gt;afterPropertiesSet()-&gt;buildSqlSessionFactory() SqlSessionFactoryBean å®ç°äº† InitializingBean æ¥å£ æ‰€ä»¥åœ¨SPringå®ä¾‹åŒ–beançš„æ—¶å€™ä¼šæ‰§è¡ŒafterPropertiesSetï¼›ä¸»è¦çœ‹ buildSqlSessionFactoryï¼ˆï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131protected SqlSessionFactory buildSqlSessionFactory() throws Exception { final Configuration targetConfiguration; XMLConfigBuilder xmlConfigBuilder = null; if (this.configuration != null) { targetConfiguration = this.configuration; if (targetConfiguration.getVariables() == null) { targetConfiguration.setVariables(this.configurationProperties); } else if (this.configurationProperties != null) { targetConfiguration.getVariables().putAll(this.configurationProperties); } } else if (this.configLocation != null) { xmlConfigBuilder = new XMLConfigBuilder(this.configLocation.getInputStream(), null, this.configurationProperties); targetConfiguration = xmlConfigBuilder.getConfiguration(); } else { LOGGER.debug(() -&gt; &quot;Property \\'configuration\\' or \\'configLocation\\' not specified, using default MyBatis Configuration&quot;); targetConfiguration = new Configuration(); Optional.ofNullable(this.configurationProperties).ifPresent(targetConfiguration::setVariables); } Optional.ofNullable(this.objectFactory).ifPresent(targetConfiguration::setObjectFactory); Optional.ofNullable(this.objectWrapperFactory).ifPresent(targetConfiguration::setObjectWrapperFactory); Optional.ofNullable(this.vfs).ifPresent(targetConfiguration::setVfsImpl); if (hasLength(this.typeAliasesPackage)) { scanClasses(this.typeAliasesPackage, this.typeAliasesSuperType).forEach(targetConfiguration.getTypeAliasRegistry()::registerAlias); } if (!isEmpty(this.typeAliases)) { Stream.of(this.typeAliases).forEach(typeAlias -&gt; { targetConfiguration.getTypeAliasRegistry().registerAlias(typeAlias); LOGGER.debug(() -&gt; &quot;Registered type alias: \\'&quot; + typeAlias + &quot;\\'&quot;); }); } if (!isEmpty(this.plugins)) { Stream.of(this.plugins).forEach(plugin -&gt; { targetConfiguration.addInterceptor(plugin); LOGGER.debug(() -&gt; &quot;Registered plugin: \\'&quot; + plugin + &quot;\\'&quot;); }); } if (hasLength(this.typeHandlersPackage)) { scanClasses(this.typeHandlersPackage, TypeHandler.class).stream().filter(clazz -&gt; !clazz.isInterface()).filter(clazz -&gt; !Modifier.isAbstract(clazz.getModifiers())).filter(clazz -&gt; ClassUtils.getConstructorIfAvailable(clazz) != null).forEach(targetConfiguration.getTypeHandlerRegistry()::register); } if (!isEmpty(this.typeHandlers)) { Stream.of(this.typeHandlers).forEach(typeHandler -&gt; { targetConfiguration.getTypeHandlerRegistry().register(typeHandler); LOGGER.debug(() -&gt; &quot;Registered type handler: \\'&quot; + typeHandler + &quot;\\'&quot;); }); } if (this.databaseIdProvider != null) { //fix #64 set databaseId before parse mapper xmls try { targetConfiguration.setDatabaseId(this.databaseIdProvider.getDatabaseId(this.dataSource)); } catch (SQLException e) { throw new NestedIOException(&quot;Failed getting a databaseId&quot;, e); } } Optional.ofNullable(this.cache).ifPresent(targetConfiguration::addCache); if (xmlConfigBuilder != null) { try { xmlConfigBuilder.parse(); LOGGER.debug(() -&gt; &quot;Parsed configuration file: \\'&quot; + this.configLocation + &quot;\\'&quot;); } catch (Exception ex) { throw new NestedIOException(&quot;Failed to parse config resource: &quot; + this.configLocation, ex); } finally { ErrorContext.instance().reset(); } } targetConfiguration.setEnvironment(new Environment(this.environment, this.transactionFactory == null ? new SpringManagedTransactionFactory() : this.transactionFactory, this.dataSource)); if (this.mapperLocations != null) { if (this.mapperLocations.length == 0) { LOGGER.warn(() -&gt; &quot;Property \\'mapperLocations\\' was specified but matching resources are not found.&quot;); } else { for (Resource mapperLocation : this.mapperLocations) { if (mapperLocation == null) { continue; } try { // mapper.xmlæ–‡ä»¶çš„è§£æï¼Œå³ xmlçš„èŠ‚ç‚¹è§£æ insert update select delete // ä»¥åŠç»“æœé›†æ˜ å°„ç­‰ç›¸å…³æ•°æ®ï¼Œåšå¥½æ•°æ®æ•°æ®çš„å¯¹åº”çš„åˆå§‹åŒ–ï¼Œç„¶åå¢åˆ æ”¹ï¼Œå°±ä¼š // åœ¨å›æ¥ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•æ•°æ® è¿™æ˜¯ä¸€ä¸ªä¸€æ¥ä¸€å›çš„è¿‡ç¨‹ï¼Œå¯åŠ¨çš„æ—¶å€™å°±æ˜¯ç›¸å½“äºé“ºè·¯ã€‚ XMLMapperBuilder xmlMapperBuilder = new XMLMapperBuilder(mapperLocation.getInputStream(), targetConfiguration, mapperLocation.toString(), targetConfiguration.getSqlFragments()); xmlMapperBuilder.parse(); } catch (Exception e) { throw new NestedIOException(&quot;Failed to parse mapping resource: \\'&quot; + mapperLocation + &quot;\\'&quot;, e); } finally { ErrorContext.instance().reset(); } LOGGER.debug(() -&gt; &quot;Parsed mapper file: \\'&quot; + mapperLocation + &quot;\\'&quot;); } } } else { LOGGER.debug(() -&gt; &quot;Property \\'mapperLocations\\' was not specified.&quot;); } //targetConfiguration æ•´ä¸ªmybatisçš„æ“ä½œè¿‡ç¨‹éƒ½å›´ç»•ç€å®ƒè½¬ï¼Œæ‰€ä»¥åœ¨è§£æxmlçš„æ—¶å€™ï¼Œå°±å·²ç»å¯¹å®ƒçš„å±æ€§è¿›è¡Œå¡«å……äº† return this.sqlSessionFactoryBuilder.build(targetConfiguration); } build(Configuration config)12345//build() æ–¹æ³• å°±newä¸€ä¸ªå·¥å‚public SqlSessionFactory build(Configuration config){ return new DefaultSqlSessionFactory(config);} xmlè§£æ parse()12345678910111213141516public void parse(){ if (!configuration.isResourceLoaded(resource)) { // è§£æMapper xmlæ–‡ä»¶ configurationEleme(parser.evalNode(&quot;/mapper&quot;)); // å¡«å……mapper.xmlçš„ resource configuration.addLoadedResource(resource); //ç»‘å®šå‘½åç©ºé—´ bindMapperForNamespace(); } parsePendingResultMaps(); parsePendingCacheRefs(); parsePendingStatements();} parse().configurationElement(XNode context)//è§£æMapper xmlæ–‡ä»¶ 1234567891011121314151617181920212223private void configurationElement(XNode context){ try { String namespace = context.getStringAttribute(&quot;namespace&quot;); if (namespace == null || namespace.equals(&quot;&quot;)) { throw new BuilderException(&quot;Mapper\\'s namespace cannot be empty&quot;); } builderAssistant.setCurrentNamespace(namespace); cacheRefElement(context.evalNode(&quot;cache-ref&quot;)); cacheElement(context.evalNode(&quot;cache&quot;)); parameterMapElement(context.evalNodes(&quot;/mapper/parameterMap&quot;)); resultMapElements(context.evalNodes(&quot;/mapper/resultMap&quot;)); sqlElement(context.evalNodes(&quot;/mapper/sql&quot;)); // å¤„ç† èŠ‚ç‚¹ä¸ºselect insert update delete buildStatementFromContext(context.evalNodes(&quot;select|insert|update|delete&quot;)); } catch (Exception e) { throw new BuilderException(&quot;Error parsing Mapper XML. The XML location is \\'&quot; + resource + &quot;\\'. Cause: &quot; + e, e); }} parse().configurationElement(XNode context)1234567891011121314151617181920212223private void configurationElement(XNode context){ try { String namespace = context.getStringAttribute(&quot;namespace&quot;); if (namespace == null || namespace.equals(&quot;&quot;)) { throw new BuilderException(&quot;Mapper\\'s namespace cannot be empty&quot;); } builderAssistant.setCurrentNamespace(namespace); cacheRefElement(context.evalNode(&quot;cache-ref&quot;)); cacheElement(context.evalNode(&quot;cache&quot;)); parameterMapElement(context.evalNodes(&quot;/mapper/parameterMap&quot;)); resultMapElements(context.evalNodes(&quot;/mapper/resultMap&quot;)); sqlElement(context.evalNodes(&quot;/mapper/sql&quot;)); // å¤„ç† èŠ‚ç‚¹ä¸ºselect insert update delete buildStatementFromContext(context.evalNodes(&quot;select|insert|update|delete&quot;)); } catch (Exception e) { throw new BuilderException(&quot;Error parsing Mapper XML. The XML location is \\'&quot; + resource + &quot;\\'. Cause: &quot; + e, e); }} pare().buildStatementFromContext1234567891011121314151617181920212223242526private void buildStatementFromContext(List&lt;XNode&gt; list){ if (configuration.getDatabaseId() != null) { buildStatementFromContext(list, configuration.getDatabaseId()); } buildStatementFromContext(list, null);}private void buildStatementFromContext(List&lt;XNode&gt; list, String requiredDatabaseId){ for (XNode context : list) { // XMLStatementBuilder sqlè§£æå¯¹è±¡ æ³¨æ„ å¸¦ç€configurationçš„ final XMLStatementBuilder statementParser = new XMLStatementBuilder(configuration, builderAssistant, context, requiredDatabaseId); try { // è§£æ statementParser.parseStatementNode(); } catch (IncompleteElementException e) { configuration.addIncompleteStatement(statementParser); } }} pare().buildStatementFromContext(List list, String requiredDatabaseId)1234567891011121314151617private void buildStatementFromContext(List&lt;XNode&gt; list, String requiredDatabaseId){ for (XNode context : list) { // XMLStatementBuilder sqlè§£æå¯¹è±¡ æ³¨æ„ å¸¦ç€configurationçš„ final XMLStatementBuilder statementParser = new XMLStatementBuilder(configuration, builderAssistant, context, requiredDatabaseId); try { // è§£æ statementParser.parseStatementNode(); } catch (IncompleteElementException e) { configuration.addIncompleteStatement(statementParser); } }} è§£æsql èŠ‚ç‚¹ æ ‡ç­¾ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public void parseStatementNode(){ // sqlè¯­å¥çš„å”¯ä¸€id String id = context.getStringAttribute(&quot;id&quot;); String databaseId = context.getStringAttribute(&quot;databaseId&quot;); if (!databaseIdMatchesCurrent(id, databaseId, this.requiredDatabaseId)) { return; } // è¯­å¥ç±»å‹ String nodeName = context.getNode().getNodeName(); SqlCommandType sqlCommandType = SqlCommandType.valueOf(nodeName.toUpperCase(Locale.ENGLISH)); boolean isSelect = sqlCommandType == SqlCommandType.SELECT; // æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜ boolean flushCache = context.getBooleanAttribute(&quot;flushCache&quot;, !isSelect); boolean useCache = context.getBooleanAttribute(&quot;useCache&quot;, isSelect); boolean resultOrdered = context.getBooleanAttribute(&quot;resultOrdered&quot;, false); // Include Fragments before parsing XMLIncludeTransformer includeParser = new XMLIncludeTransformer(configuration, builderAssistant); includeParser.applyIncludes(context.getNode()); String parameterType = context.getStringAttribute(&quot;parameterType&quot;); Class&lt;?&gt; parameterTypeClass = resolveClass(parameterType); String lang = context.getStringAttribute(&quot;lang&quot;); LanguageDriver langDriver = getLanguageDriver(lang); // Parse selectKey after includes and remove them. processSelectKeyNodes(id, parameterTypeClass, langDriver); // Parse the SQL (pre: &lt;selectKey&gt; and &lt;include&gt; were parsed and removed) KeyGenerator keyGenerator; String keyStatementId = id + SelectKeyGenerator.SELECT_KEY_SUFFIX; keyStatementId = builderAssistant.applyCurrentNamespace(keyStatementId, true); if (configuration.hasKeyGenerator(keyStatementId)) { keyGenerator = configuration.getKeyGenerator(keyStatementId); } else { keyGenerator = context.getBooleanAttribute(&quot;useGeneratedKeys&quot;, configuration.isUseGeneratedKeys() &amp;&amp; SqlCommandType.INSERT.equals(sqlCommandType)) ? Jdbc3KeyGenerator.INSTANCE : NoKeyGenerator.INSTANCE; } // å¤„ç†sqlæ ‡ç­¾çš„å…¶å®ƒå±æ€§ SqlSource sqlSource = langDriver.createSqlSource(configuration, context, parameterTypeClass); StatementType statementType = StatementType.valueOf(context.getStringAttribute(&quot;statementType&quot;, StatementType.PREPARED.toString())); Integer fetchSize = context.getIntAttribute(&quot;fetchSize&quot;); Integer timeout = context.getIntAttribute(&quot;timeout&quot;); String parameterMap = context.getStringAttribute(&quot;parameterMap&quot;); String resultType = context.getStringAttribute(&quot;resultType&quot;); Class&lt;?&gt; resultTypeClass = resolveClass(resultType); String resultMap = context.getStringAttribute(&quot;resultMap&quot;); String resultSetType = context.getStringAttribute(&quot;resultSetType&quot;); ResultSetType resultSetTypeEnum = resolveResultSetType(resultSetType); String keyProperty = context.getStringAttribute(&quot;keyProperty&quot;); String keyColumn = context.getStringAttribute(&quot;keyColumn&quot;); String resultSets = context.getStringAttribute(&quot;resultSets&quot;); // å°†è§£æå‡ºæ¥çš„sqlæ ‡ç­¾çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ¡sqlè¯­å¥ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ æ·»åŠ åˆ° MappedStatementä¸­å» çœ‹çœ‹ä¸‹é¢çš„å›¾ç‰‡ å®ƒçš„å±æ€§æ˜¯ä¸æ˜¯ä¸Šé¢ è§£æå‡ºæ¥çš„å±æ€§å‘¢ builderAssistant.addMappedStatement(id, sqlSource, statementType, sqlCommandType, fetchSize, timeout, parameterMap, parameterTypeClass, resultMap, resultTypeClass, resultSetTypeEnum, flushCache, useCache, resultOrdered, keyGenerator, keyProperty, keyColumn, databaseId, langDriver, resultSets);} å°†sqlèŠ‚ç‚¹æ ‡ç­¾è§£æå®Œæˆåï¼Œå°†ä¿¡æ¯å­˜å‚¨åˆ° configuratinçš„MappedStatementMapä¸­ï¼Œkey å°±æ˜¯å‘½åç©ºé—´+sql+idbuilderAssistant.addMappedStatement(â€¦â€¦)addMappedStatement()æ–¹æ³•çš„éƒ¨åˆ†ä»£ç  123456789101112131415.... MappedStatement.Builder statementBuilder = new MappedStatement.Builder(configuration, id, sqlSource, sqlCommandType).resource(resource).fetchSize(fetchSize).timeout(timeout).statementType(statementType).keyGenerator(keyGenerator).keyProperty(keyProperty).keyColumn(keyColumn).databaseId(databaseId).lang(lang).resultOrdered(resultOrdered).resultSets(resultSets).resultMaps(getStatementResultMaps(resultMap, resultType, id)).resultSetType(resultSetType).flushCacheRequired(valueOrDefault(flushCache, !isSelect)).useCache(valueOrDefault(useCache, isSelect)).cache(currentCache); ParameterMap statementParameterMap = getStatementParameterMap(parameterMap, parameterType, id); if(statementParameterMap !=null) { statementBuilder.parameterMap(statementParameterMap); } MappedStatement statement = statementBuilder.build(); // å°†MappedStatement å­˜åˆ°configuration çš„MappedStatement mapä¸­ configuration.addMappedStatement(statement);.... bindMapperForNamespace()MappedStatement idï¼šå°±æ˜¯å½“äº²å•Šsqlçš„ mapper.xmlå‘½åç©ºé—´+sqlèŠ‚ç‚¹çš„Idè¿™ä¸ªidå°†ä¼šä½œä¸ºkey ï¼ŒMappedStatement ï¼šä½œä¸ºvalueæ”¾å¤§configrationä¸­çš„ä¸€ä¸ª mapä¸­ï¼›åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±ä¼šæ ¹æ® è¿™ä¸ªidæ‹¿åˆ°è¿™ä¸ªsqlå¯¹åº”çš„MappedStatementï¼Œè¿›è¡Œåç»­æ“ä½œ &gt; çœ‹çœ‹ç»‘å®šå‘½å ç©ºé—´çš„æ–¹æ³• bindMapperForNamespace() 123456789101112131415161718192021222324252627282930private void bindMapperForNamespace(){ String namespace = builderAssistant.getCurrentNamespace(); if (namespace != null) { Class&lt;?&gt; boundType = null; try { // å‘½åç©ºé—´çš„Class =mapperæ¥å£å¯¹è±¡ boundType = Resources.classForName(namespace); } catch (ClassNotFoundException e) { //ignore, bound type is not required } if (boundType != null) { if (!configuration.hasMapper(boundType)) { // Spring may not know the real resource name so we set a flag // to prevent loading again this resource from the mapper interface // look at MapperAnnotationBuilder#loadXmlResource configuration.addLoadedResource(&quot;namespace:&quot; + namespace); // å°†mapperå¯¹è±¡classæ”¾åˆ° configuration çš„ä¸€ä¸ªMapperRegistry å¯¹è±¡ä¸­ è€ŒMapperRegistry åˆä¸€ä¸ªMapå±æ€§å°±æ˜¯æ”¾ mapperæ¥å£çš„ä»£ç†å·¥å‚çš„MapperProxyFactoryå¯¹è±¡çš„ï¼Œä»£ç†å¯¹è±¡çš„äº§ç”Ÿå°±æ˜¯åœ¨è¿™é‡Œçš„ newInstanceï¼ˆï¼‰æ–¹æ³•ã€‚ å‰é¢æåˆ°è¿‡çš„FactoryBean çš„getObjectæ–¹æ³•ä¸­æ‹¿çš„Beanå°±æ˜¯ç»è¿‡ configurationåˆ°è¿™é‡Œå‡ºæ¥çš„å“¦ã€‚ configuration.addMapper(boundType); } } }} configuration.addMapper(boundType); mapperRegistry.addMapper(boundType) knownMappers.put(type, new MapperProxyFactory&lt;&gt;(type)); åˆ°ç°åœ¨ å·²ç»ç®€å•çš„çœ‹åˆ°äº† åŸºäºSpringBootçš„Mybatiså¯åŠ¨çš„è¿‡ç¨‹ï¼ŒçŸ¥é“å®ƒåˆå§‹åŒ–äº†å“ªäº›é‡è¦çš„ä¸œè¥¿äº†","link":"/posts/8497ffc5/"}],"tags":[{"name":"åŠ å¯†æ–‡ç« ","slug":"åŠ å¯†æ–‡ç« ","link":"/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","link":"/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"httpåè®®","slug":"httpåè®®","link":"/tags/http%E5%8D%8F%E8%AE%AE/"},{"name":"é”","slug":"é”","link":"/tags/%E9%94%81/"},{"name":"lock","slug":"lock","link":"/tags/lock/"},{"name":"SpringBoot","slug":"SpringBoot","link":"/tags/SpringBoot/"},{"name":"linux","slug":"linux","link":"/tags/linux/"},{"name":"github","slug":"github","link":"/tags/github/"},{"name":"gitlab-ci","slug":"gitlab-ci","link":"/tags/gitlab-ci/"},{"name":"gitlab-runner","slug":"gitlab-runner","link":"/tags/gitlab-runner/"},{"name":"åå°„","slug":"åå°„","link":"/tags/%E5%8F%8D%E5%B0%84/"},{"name":"mybatis","slug":"mybatis","link":"/tags/mybatis/"},{"name":"å­˜å‚¨è¿‡ç¨‹","slug":"å­˜å‚¨è¿‡ç¨‹","link":"/tags/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"},{"name":"mysql","slug":"mysql","link":"/tags/mysql/"},{"name":"ç§æœ‰äº‘ç›˜","slug":"ç§æœ‰äº‘ç›˜","link":"/tags/%E7%A7%81%E6%9C%89%E4%BA%91%E7%9B%98/"},{"name":"nextcloud","slug":"nextcloud","link":"/tags/nextcloud/"},{"name":"SpringBoot starter","slug":"SpringBoot-starter","link":"/tags/SpringBoot-starter/"},{"name":"Nexus","slug":"Nexus","link":"/tags/Nexus/"},{"name":"maven","slug":"maven","link":"/tags/maven/"},{"name":"shell","slug":"shell","link":"/tags/shell/"},{"name":"centos","slug":"centos","link":"/tags/centos/"},{"name":"é›†åˆ","slug":"é›†åˆ","link":"/tags/%E9%9B%86%E5%90%88/"},{"name":"ConcurrentHashMap","slug":"ConcurrentHashMap","link":"/tags/ConcurrentHashMap/"},{"name":"IOC Spring","slug":"IOC-Spring","link":"/tags/IOC-Spring/"},{"name":"æºç å­¦ä¹ ","slug":"æºç å­¦ä¹ ","link":"/tags/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"}],"categories":[{"name":"private","slug":"private","link":"/categories/private/"},{"name":"java","slug":"java","link":"/categories/java/"},{"name":"é”","slug":"é”","link":"/categories/%E9%94%81/"},{"name":"Docker","slug":"Docker","link":"/categories/Docker/"},{"name":"vue","slug":"vue","link":"/categories/vue/"},{"name":"mybatis","slug":"java/mybatis","link":"/categories/java/mybatis/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","link":"/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"java","slug":"é”/java","link":"/categories/%E9%94%81/java/"},{"name":"mybatis","slug":"mybatis","link":"/categories/mybatis/"},{"name":"mysql","slug":"mysql","link":"/categories/mysql/"},{"name":"docker","slug":"java/docker","link":"/categories/java/docker/"},{"name":"Nexus","slug":"Nexus","link":"/categories/Nexus/"},{"name":"æŒç»­è‡ªåŠ¨åŒ–éƒ¨ç½²","slug":"vue/æŒç»­è‡ªåŠ¨åŒ–éƒ¨ç½²","link":"/categories/vue/%E6%8C%81%E7%BB%AD%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"},{"name":"linux","slug":"linux","link":"/categories/linux/"},{"name":"linux","slug":"java/linux","link":"/categories/java/linux/"},{"name":"mybatis","slug":"æ•°æ®åº“/mybatis","link":"/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mybatis/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"é”/java/å¹¶å‘ç¼–ç¨‹","link":"/categories/%E9%94%81/java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"å­˜å‚¨è¿‡ç¨‹","slug":"æ•°æ®åº“/mybatis/å­˜å‚¨è¿‡ç¨‹","link":"/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mybatis/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"java/å¹¶å‘ç¼–ç¨‹","link":"/categories/java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}]}