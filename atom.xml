<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rotten Code</title>
  
  <subtitle>å†™çš„ä¸€æ‰‹å¥½ä»£ç ï¼ğŸ‘</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="http://lyj08.gitee.io/"/>
  <updated>2020-12-30T09:28:04.329Z</updated>
  <id>http://lyj08.gitee.io/</id>
  
  <author>
    <name>Rotten Code</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>é¡¹ç›®ç”Ÿæˆå·¥å…·,æ ¹æ®æ•°æ®åº“ç”Ÿæˆï¼ŒåŠ©ä½ æ•ˆç‡ç¿»å€</title>
    <link href="http://lyj08.gitee.io/posts/434af8d5/"/>
    <id>http://lyj08.gitee.io/posts/434af8d5/</id>
    <published>2020-05-26T13:41:00.000Z</published>
    <updated>2020-12-30T09:28:04.329Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ï¼Œä¸ªäººä¹Ÿæ¥äº†ç‚¹ä¸è¶³æŒ‚é½¿çš„å°å°ç§æ´»ã€‚ä¸ºäº†å¿«é€Ÿå¼€å‘ï¼Œå¼€ç®±å³ç”¨ï¼Œæ¯ä¸ªé¡¹ç›®ä¸éœ€è¦é‡æ–°æ­å»ºã€‚æå‡æ•ˆç‡ï¼Œå°±å†™äº†åŸºæœ¬çš„é¡¹ç›®æ¶å­ï¼Œç„¶åæ ¹æ®å·²å»ºå¥½çš„æ•°æ®åº“ï¼Œç”Ÿæˆå¯¹åº”çš„å¢åˆ æ”¹æŸ¥çš„æ¥å£ã€‚ç”Ÿæˆå³å¯ä½¿ç”¨ã€‚</p><a id="more"></a><h2 id="ä¸€ã€ç”Ÿæˆçš„é¡¹ç›®ç»“æ„è¯´æ˜"><a href="#ä¸€ã€ç”Ÿæˆçš„é¡¹ç›®ç»“æ„è¯´æ˜" class="headerlink" title="ä¸€ã€ç”Ÿæˆçš„é¡¹ç›®ç»“æ„è¯´æ˜"></a>ä¸€ã€ç”Ÿæˆçš„é¡¹ç›®ç»“æ„è¯´æ˜</h2><h3 id="ä¸€ã€é¡¹ç›®æŠ€æœ¯"><a href="#ä¸€ã€é¡¹ç›®æŠ€æœ¯" class="headerlink" title="ä¸€ã€é¡¹ç›®æŠ€æœ¯"></a>ä¸€ã€é¡¹ç›®æŠ€æœ¯</h3><p><strong>SpringBoot + shiro + mysql + mybatis-plus;</strong></p><p>é¡¹ç›®ç»Ÿä¸€ restful é£æ ¼ï¼Œç»Ÿä¸€å¼‚å¸¸ Json å¤„ç†åŒ–ï¼Œrespones æ•°æ®ç»“æ„ç»Ÿä¸€ã€‚</p><p>è·¨åŸŸé—®é¢˜å¤„ç†ã€‚</p><p>ä¹Ÿä¼šè¿‡æ»¤æ‰ç»™å‰ç«¯çš„ ä¸€äº› ä¸º null çš„å±æ€§ï¼Œå°†å€¼å¡«å……ä¸º ç©ºå­—ç¬¦ä¸² â€œâ€ï¼›</p><p>ä¹ŸåŒ…å«äº†æ—¥å¿—æ–‡ä»¶è¾“å‡ºã€‚</p><p><strong>ä¸‹é¢å°±æ˜¯å·¥å…·ç”Ÿæˆçš„é¡¹ç›®ç»“æ„</strong></p><h3 id="äºŒã€é¡¹ç›®ç»“æ„"><a href="#äºŒã€é¡¹ç›®ç»“æ„" class="headerlink" title="äºŒã€é¡¹ç›®ç»“æ„"></a>äºŒã€é¡¹ç›®ç»“æ„</h3><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498197752.png" alt="é¡¹ç›®ç»“æ„.png"><br>é¡¹ç›®çš„åŸºæœ¬ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚è¿™æ˜¯ä¸€å—å…¬å…±çš„ä»£ç å—ã€‚</p><p><strong>core åŒ…ï¼š</strong> æ˜¯æ•°æ®åº“ç”Ÿæˆçš„ä¸šåŠ¡ä»£ç å¢åˆ æ”¹ï¼›</p><p>mapper æ–‡ä»¶ åœ¨resoure ç›®å½•ä¸‹ã€‚</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498218984.png" alt="é¡¹ç›®ç»“æ„2.png"></p><p>æ¯ä¸€ä¸ªç±»ï¼Œéƒ½æœ‰ä¸€ä¸ªæ³¨é‡Šè¯´æ˜ï¼Œåœ¨è¿™å°±ä¸ä¸€ä¸€åšè§£é‡Šäº†ã€‚</p><h3 id="äºŒã€ä¸šåŠ¡ä»£ç æ¨¡å—"><a href="#äºŒã€ä¸šåŠ¡ä»£ç æ¨¡å—" class="headerlink" title="äºŒã€ä¸šåŠ¡ä»£ç æ¨¡å—"></a>äºŒã€ä¸šåŠ¡ä»£ç æ¨¡å—</h3><p>æ¯ä¸€å¼ è¡¨ï¼Œéƒ½æœ‰å¯¹åº”çš„ å¢ åˆ  æ”¹ æŸ¥ çš„æ¥å£ã€‚ä½¿ç”¨çš„ä¸åŒè¯·æ±‚æ–¹å¼ã€‚<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498234628.png" alt="core.png"></p><p><strong>å¢ åˆ  æ”¹ æŸ¥ æ¥å£ è¿™æ ·ã€‚</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498321532.png" alt="image.png"></p><p><strong>æ•°æ®ç»“æ„é•¿è¿™æ ·ï¼š</strong></p><p>è¿™æ˜¯æŸ¥çš„æ¥å£æ•°æ®ç»“æœï¼ŒåŒ…å«äº†åˆ†å¤„ç†ã€‚</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498338181.png" alt="æ¥å£ç»“æœ.png"></p><p><strong>Service æ¥å£ï¼š</strong><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498377412.png" alt="service.png"></p><p><strong>ServiceImpl</strong></p><p><strong>Mapperæ¥å£ï¼š</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498421701.png" alt="mapper.png"></p><p><strong>xml:</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498474866.png" alt="xml.png"></p><p>è¿™æ˜¯é¡¹ç›®çš„åŸºæœ¬ç»“æ„äº†ã€‚</p><h3 id="ä¸‰ã€ç›¸å…³æ–‡ä»¶"><a href="#ä¸‰ã€ç›¸å…³æ–‡ä»¶" class="headerlink" title="ä¸‰ã€ç›¸å…³æ–‡ä»¶"></a>ä¸‰ã€ç›¸å…³æ–‡ä»¶</h3><p><strong>1ã€R.java å°è£…ç»Ÿä¸€å“åº”å‰ç«¯æ•°æ®ç»“æ„</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498497162.png" alt="R.png"></p><p><strong>2ã€ç»Ÿä¸€å¼‚å¸¸æšä¸¾</strong><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498525124.png" alt="Error.png"></p><p><strong>3ã€å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸ï¼Œé™åˆ¶é”™è¯¯æšä¸¾</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498550002.png" alt="serviceException.png"><br><strong>4ã€å…¨å±€å¼‚å¸¸æ•è·æ‹¦æˆª</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498578199.png" alt="å¼‚å¸¸æ•è·.png"></p><p>åŸºæœ¬çš„ç»“æ„ä»£ç ï¼Œä»‹ç»åˆ°æ­¤ã€‚</p><h2 id="äºŒã€é¡¹ç›®ç”Ÿæˆå·¥å…·æºç ç»“æ„"><a href="#äºŒã€é¡¹ç›®ç”Ÿæˆå·¥å…·æºç ç»“æ„" class="headerlink" title="äºŒã€é¡¹ç›®ç”Ÿæˆå·¥å…·æºç ç»“æ„"></a>äºŒã€é¡¹ç›®ç”Ÿæˆå·¥å…·æºç ç»“æ„</h2><p>å·¥å…·æºç ç»“æ„</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498623636.png" alt="gen.png"></p><p>æºç ç»“æ„ä¸åšè¯´æ˜äº†ï¼Œå¤ªå¤šä¸œè¥¿ã€‚</p><h3 id="2ã€1-é¡¹ç›®å·¥å…·çš„ä½¿ç”¨"><a href="#2ã€1-é¡¹ç›®å·¥å…·çš„ä½¿ç”¨" class="headerlink" title="2ã€1 é¡¹ç›®å·¥å…·çš„ä½¿ç”¨"></a>2ã€1 é¡¹ç›®å·¥å…·çš„ä½¿ç”¨</h3><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498649387.png" alt="ä½¿ç”¨.png"></p><p>é¡¹ç›®æ‰€éœ€å±æ€§åœ¨ç±» <code>ConfigProperties.java</code> ä¸­</p><p>å¯é€šè¿‡ main æ–¹æ³•è¿›è¡Œé¡¹ç›®çš„å¿«é€Ÿç”Ÿæˆ ä¹Ÿå¯ä»¥éƒ¨ç½²å‡ºå»ï¼Œé€šè¿‡ http çš„å½¢å¼ï¼Œæ‰“åŒ…ä¸‹è½½ã€‚</p><p><strong>é¡µé¢</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498685103.png" alt="é¡µé¢.png"></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-05-26/1590498724832.png" alt="æ‰“åŒ…ä¸‹è½½.png"></p><p><a href="https://github.com/memoryoverflow/gen-code.git">æºç åœ°å€</a></p><p><img src="http://thisforyou.cn:180/file/img/publick-qrcode.jpg" alt="img"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ï¼Œä¸ªäººä¹Ÿæ¥äº†ç‚¹ä¸è¶³æŒ‚é½¿çš„å°å°ç§æ´»ã€‚ä¸ºäº†å¿«é€Ÿå¼€å‘ï¼Œå¼€ç®±å³ç”¨ï¼Œæ¯ä¸ªé¡¹ç›®ä¸éœ€è¦é‡æ–°æ­å»ºã€‚æå‡æ•ˆç‡ï¼Œå°±å†™äº†åŸºæœ¬çš„é¡¹ç›®æ¶å­ï¼Œç„¶åæ ¹æ®å·²å»ºå¥½çš„æ•°æ®åº“ï¼Œç”Ÿæˆå¯¹åº”çš„å¢åˆ æ”¹æŸ¥çš„æ¥å£ã€‚ç”Ÿæˆå³å¯ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>github å…‹éš†é€Ÿåº¦æ…¢ï¼Ÿæ€ä¹ˆè§£å†³ï¼Œä¸‰æ­¥ï¼Œé€Ÿåº¦è¾¾åˆ° Mib/s</title>
    <link href="http://lyj08.gitee.io/posts/e4924e28/"/>
    <id>http://lyj08.gitee.io/posts/e4924e28/</id>
    <published>2020-04-12T02:23:00.000Z</published>
    <updated>2020-12-30T09:26:02.378Z</updated>
    
    <content type="html"><![CDATA[<p>github å…‹éš†dubboæºç çš„é€Ÿåº¦ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586657818053.png" alt="1.png"></p><p>ä¸‰æ­¥ä¹‹åæˆ‘ä»¬å†çœ‹çœ‹é€Ÿåº¦</p><a id="more"></a><h2 id="ç¬¬ä¸€æ­¥ï¼š"><a href="#ç¬¬ä¸€æ­¥ï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼š"></a>ç¬¬ä¸€æ­¥ï¼š</h2><p>â€‹    githubä¸Šæ‰¾åˆ°æƒ³è¦å…‹éš†çš„é¡¹ç›®ï¼Œç„¶åå…ˆfuck ä¸€ä¸‹ï¼Œå¯¹ä¸èµ·è¯´é”™äº†ï¼Œæ˜¯forkä¸€ä¸‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586657924853.png" alt="d.png"></p><p>fork ä¹‹åï¼Œè¿›å…¥è‡ªå·±çš„ä»“åº“çœ‹çœ‹ï¼Œåƒè¿™æ ·ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586657979199.png" alt="3.png"></p><h2 id="ç¬¬äºŒæ­¥ï¼š"><a href="#ç¬¬äºŒæ­¥ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥ï¼š"></a>ç¬¬äºŒæ­¥ï¼š</h2><p>â€‹    åˆ°é©¬äº‘ä¸Šï¼Œæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œä¸ï¼Œæ˜¯ç äº‘â€“giteeã€‚æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œåƒè¿™æ ·ï¼š<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586658001350.png" alt="gite.png"></p><p>ä¸€ä¸ªdubboçš„æºç ï¼Œå€’å…¥åˆ°giteeä»“åº“10ç§’é’Ÿå°±æå®šã€‚</p><p>å¯¼å…¥ååœ¨è‡ªå·±çš„ä»“åº“ä¸­çœ‹çœ‹ï¼Œåƒè¿™æ ·ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586658019773.png" alt="4.png"></p><h2 id="ç¬¬ä¸‰æ­¥ï¼š"><a href="#ç¬¬ä¸‰æ­¥ï¼š" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼š"></a>ç¬¬ä¸‰æ­¥ï¼š</h2><p>â€‹    å¤åˆ¶æˆ‘ä»¬çš„ gitee ä¸Šçš„å…‹éš†åœ°å€ï¼š  </p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;gitee.com&#x2F;lyj08&#x2F;dubbo.git</span><br></pre></td></tr></table></figure><p>ç°åœ¨å†çœ‹çœ‹å…‹éš†åˆ°å¤šå°‘äº†ï¼š</p><p>å…¶å® 10åˆ†é’Ÿè¿‡å»äº†ï¼Œæ‰ä¸‹è½½é‚£ä¹ˆä¸€ç‚¹ç‚¹ï¼Œæœ‰æ—¶å€™è¿˜å¤±è´¥ï¼š</p><p><img src="https://pic4.zhimg.com/80/v2-96e310f0a889071149cf9b8fdc10beef_1440w.jpg" alt="img"></p><p>çœ‹çœ‹è¿™ä¸ªgitee çš„é€Ÿåº¦ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586658123085.png" alt="7.png"></p><p>è¿™ä¸ªé€Ÿåº¦ï¼Œæ ¹æ®ä½ çš„ç½‘é€Ÿå†³å®šï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586658133776.png" alt="8.png"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>ä¸‰æ­¥æå®šï¼š</p><ol><li>github forké¡¹ç›®ã€‚</li><li>gitee æ–°å»ºä»“åº“ï¼Œä»github forkçš„åœ°å€ï¼Œå¯¼å…¥åˆ°giteeä¸­ã€‚</li><li>git clone giteeæ–°å»ºçš„åœ°å€ã€‚</li></ol><p><img src="http://thisforyou.cn:180/file/img/publick-qrcode.jpg" alt=""></p><hr><ul><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483786&idx=1&sn=8a08186a948c62398f3e6d2551529207&chksm=cf360250f8418b4602aa9b5c77b7c82418afdcd54228db386f7a0ff56655a3c4ef764cb1fc2a#rd">å®‰å“ä¸­ï¼Œæ²¡æœ‰Spring?ä¸å­˜åœ¨çš„ã€‚ å¸¦ä½ åœ¨å®‰å“ä¸­å†™ä¸€ä¸ªIOCã€DIæ¡†æ¶ï¼Œå®ç°Spring çš„ä¾èµ–æ³¨å…¥ã€‚</a></li><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483762&idx=1&sn=d4530ccbe3c8f93845a7e178dddd0bac&chksm=cf3602a8f8418bbe2dd24b56070196e4a9bebf1c0f85ccfcc95b30f823b3f456cb05eacce437#rd">å¹¶å‘å·¥å…·CountDownLatchæ˜¯å¦‚ä½•å®ç°é˜»å¡çš„ï¼Ÿ</a></li><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483747&idx=1&sn=313a454acc561b2f8d16aefd164fef5f&chksm=cf3602b9f8418baf40d6eb63d5fdaba3df27004484c5d3109578955eae2a8115743b321ca516#rd">æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ŒMybatisçš„Mapper/Daoä¸ºä»€ä¹ˆå´å¯ä»¥@Autowiredæ³¨å…¥ï¼Ÿ</a></li><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483775&idx=1&sn=845f221556b6ee93b83e835ab36e384b&chksm=cf3602a5f8418bb3967420e867f33397c22daad2eb3c473311c195110a90e1ceb9396620cbb5#rd">MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;github å…‹éš†dubboæºç çš„é€Ÿåº¦ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586657818053.png&quot; alt=&quot;1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‰æ­¥ä¹‹åæˆ‘ä»¬å†çœ‹çœ‹é€Ÿåº¦&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/tags/java/"/>
    
      <category term="github" scheme="http://lyj08.gitee.io/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨å®‰å“é‡Œæ²¡æœ‰Spring?ä¸å­˜åœ¨çš„ï¼Œå’±ä»¬è‡ªå·±æ‰‹å†™å®ç° IOC ä¸ DIï¼Œåœ¨å®‰å“é‡Œä¹Ÿä¸å†è‡ªå·±newåƒ</title>
    <link href="http://lyj08.gitee.io/posts/f10cb61a/"/>
    <id>http://lyj08.gitee.io/posts/f10cb61a/</id>
    <published>2020-03-29T08:06:00.000Z</published>
    <updated>2020-12-30T09:27:46.746Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æ¥è§¦çš„é¡¹ç›®ï¼Œä¸åŸç”Ÿçš„å®‰å“å¼€å‘ç›¸å…³ã€‚</p><p>å¯¹äºå®‰å“çš„å¼€å‘å¹¶ä¸ç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ°äº†å®‰å“å¼€å‘ã€‚å› ä¸ºè‡ªå·±ç”¨ä¹ æƒ¯äº†Spring æ¡†æ¶çš„å¼€å‘ã€‚ç”¨èµ·å®‰å“æ¥ï¼Œå¾ˆæ˜¯ä¸ä¹ æƒ¯äº†ã€‚</p><p>è¿™æ ·å­ä¸ç¬¦åˆæˆ‘çš„ä¸ªæ€§ä¹ æƒ¯äº†ï¼Œæˆ‘å°±æ˜¯åœ¨å®‰å“ä¸­ä½¿ç”¨Springçš„ç±»ä¼¼åŠŸèƒ½ï¼Œæˆ‘å°±è¦å®ç°Spring çš„ Beançš„æ³¨å…¥å¼€å‘ï¼Œå®ç° IOC å®ç°DIã€‚</p><p>å¦‚ä½•å®ç°è¯·çœ‹æ“ä½œï¼šï¼Ÿ</p><a id="more"></a><p><strong>1ã€å»ºç«‹ä¸€ä¸ªAndroid demo</strong></p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586660035491.jpg" alt="670.jpg"></p><ul><li><p>annotation åŒ…ï¼š</p></li><li><ul><li>Autowired æ³¨è§£ä¸Springçš„AutowiredåŠŸèƒ½ç±»ä¼¼ï¼Œå®ç°å±æ€§æ³¨å…¥ã€‚</li><li>BeanScan æ³¨è§£ åŒ…æ‰«ææ³¨è§£</li><li>Componet æ³¨è§£ ä¸Spring Componet æ³¨è§£ä¸€æ ·ã€‚</li><li>Table æ³¨è§£æ˜¯åš æ•°æ®çš„å®ä½“ä¸æ•°æ®åº“åšæ˜ å°„çš„ ä¸€ä¸ªæ³¨è§£ï¼Œç±»ä¼¼MyBtias-plusçš„ä¸€æ ·</li></ul></li><li><p>db:æ˜¯æ•°æ®åº“ç›¸å…³çš„å°è£… ä¸æ­¤æ–‡æ²¡æœ‰å¤šå¤§å…³ç³»</p></li><li><p>springåŒ…ï¼šå°±æ˜¯æ­¤æ–‡çš„é‡ç‚¹åŒ…ã€‚</p></li><li><ul><li>ApplicationContextAwareï¼šä¸Spring çš„ApplicationContextAwareä¸€æ ·ï¼Œæ‹¿åˆ°ä¸Šä¸‹æ–‡çš„å¯¹è±¡ï¼Œæ‹¿åˆ°å¯¹è±¡å°±å¯ä»¥å¯¹è·å–Beanâ€¦</li><li>BeanFactoryPostProcessorï¼šä¸ºspringåœ¨å®¹å™¨åˆå§‹åŒ–æ—¶å¯¹å¤–å¯¹å¤–æš´éœ²çš„æ‰©å±•æ¥å£ï¼Œåœ¨Beanå®ä¾‹åŒ–å‰å¯ä»¥å¯¹ BeanDeinitionçš„ä¸€äº›å±æ€§è¿›è¡Œæ“ä½œä¿®æ”¹ã€‚</li></ul></li><li><p>factoryåŒ…ï¼šBeanå·¥å‚åŒ…ï¼Œå®šä¹‰äº†Beanæ³¨å†Œçš„æ¥å£ï¼Œå’Œè·å–Bean çš„æ¥å£ã€‚</p></li><li><p>scanåŒ…ï¼šå¯¹é¡¹ç›®çš„è·Ÿè·¯å¾„è¿›è¡Œæ‰«æï¼Œå‡¡äº‹åŠ äº†æ³¨è§£@Componetæ³¨è§£çš„ï¼Œéƒ½ä¸€å°†Beanæ”¾åˆ°IOCå®¹å™¨ä¸­ã€‚</p></li><li><p>ApplicationContextï¼šå…¥å£ç±»ã€‚</p></li></ul><p>é¡¹ç›®ç»“æ„ç®€å•å®Œæˆã€‚</p><p>æ³¨è§£ï¼š</p><p>Autowiredï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-03-29 0w:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Component</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-03-28 01:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Component &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * BeanName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>BeanScan</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BeanScan &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒ…è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">packages</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2ã€å…¥å£ç±» ApplicationContext</p><p>æ¨¡ä»¿Springçš„refresh()æ–¹æ³•ã€‚<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586660008662.jpg" alt="640.jpg"></p><p>æ„é€ å‡½æ•°ï¼š</p><p>éœ€è¦ä¸€ä¸ª Activityå¯¹è±¡ï¼Œå®‰å“ä¸­æœ€é‡è¦çš„å°±æ˜¯Activityäº†ï¼ŒAndroidå››å¤§ç»„ä»¶ä¹‹ä¸€ã€‚æ¯ä¸€ä¸ªé¡µé¢éƒ½åˆä¸€ä¸ªActivity,å®‰å“ä¸­æœ‰ä¸€ä¸ªä¸»MainActivityï¼Œå®ƒå°±æ˜¯å…¥å£ï¼Œé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šé¦–å…ˆåŠ è½½ä¸»MainActivityã€‚Spring çš„åŒ…æ‰«æï¼Œä¹Ÿå°±å®šåœ¨è¿™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApplicationContext</span><span class="params">(MainActivity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.context = activity.getApplicationContext();</span><br><span class="line">    handlerBeanScaner(activity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>MainActivityï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeanScan(packages = &quot;com.example.testdemo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Context context;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        context = getApplicationContext();</span><br><span class="line"></span><br><span class="line">        applicationContext = <span class="keyword">new</span> ApplicationContext(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Tiger tiger = applicationContext.getBean(<span class="string">&quot;tiger&quot;</span>);</span><br><span class="line">        tiger.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªActivityéƒ½è¦ç»§æ‰¿äºä¸€ä¸ªåŸºç±»Actityã€‚</p><p>é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¼šåŠ è½½ä¸€ä¸ª onCreate æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¼€å¯æˆ‘ä»¬çš„ å®‰å“Springä¹‹è·¯ã€‚</p><p>æˆ‘ä»¬æ„é€ ä¸€ä¸ª new ApplicationContext(this)ï¼›ä¼ å…¥å½“å‰å¯¹è±¡ï¼Œç›®çš„æ˜¯æ‹¿åˆ°å½“å‰å¯¹è±¡çš„æ³¨è§£ï¼Œ@BeanScan(packages = â€œcom.example.testdemoâ€)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ApplicationContext</span><span class="params">(MainActivity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.context = activity.getApplicationContext();</span><br><span class="line">    handlerBeanScaner(activity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handlerBeanScaner</span><span class="params">(MainActivity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.activity = activity;</span><br><span class="line">    Class&lt;? extends MainActivity&gt; aClass = activity.getClass();</span><br><span class="line">    BeanScan annotation = aClass.getAnnotation(BeanScan.class);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotNull(annotation)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.packages = annotation.packages();</span><br><span class="line">        <span class="keyword">this</span>.refresh();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°äº†æ³¨è§£çš„ä¸Šçš„è¦æ‰«æçš„åŒ…è·¯å¾„ï¼Œç„¶åè¿›è¡Œç­›é€‰æ‰«æï¼š</p><p>refreshæ–¹æ³• æ˜¯ä¸æ˜¯é›¨Spirngçš„æœ‰ç‚¹ç›¸ä¼¼å•Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.beanFactory = createBeanFactory();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.scanner = <span class="keyword">new</span> ClassBeanScanner(beanFactory);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.scanner.scan(<span class="keyword">this</span>.context, <span class="keyword">this</span>.packages);</span><br><span class="line"></span><br><span class="line">    invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">    finishBeanInit();</span><br><span class="line"></span><br><span class="line">    setApplicationContext();</span><br><span class="line"></span><br><span class="line">    invokeInitializingBean(beanFactory);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DefaultBeanFactory å®ç°äº† SingletonBeanFactory</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586659973942.jpg" alt="640.jpg"><br>DefaultBeanFactory å°±å­˜æ”¾äº†å®ä¾‹åŒ–åçš„Bean ä¸ å®ä¾‹è¯å‰çš„ BeanDeinitionå¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºIOCå®¹å™¨ã€‚</p><p>åˆå§‹åŒ–å¥½åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿›è¡Œæ‰«æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testdemo.spring.scan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.testdemo.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> com.example.testdemo.spring.bean.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> com.example.testdemo.spring.bean.GenericBeanDefinition;</span><br><span class="line"><span class="keyword">import</span> com.example.testdemo.spring.factory.DefaultBeanFactory;</span><br><span class="line"><span class="keyword">import</span> com.example.testdemo.utils.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dalvik.system.DexFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-03-29 01:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassPathBeanDefinitionScanner</span> <span class="keyword">implements</span> <span class="title">BeanScanner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DefaultBeanFactory beanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClassPathBeanDefinitionScanner</span><span class="params">(DefaultBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç°äº†æˆ‘ä»¬çš„æ‰«ææ¥å£çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> packages</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;BeanDefinition&gt; <span class="title">scan</span><span class="params">(Context context, String packages)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; className = getClassName(context, packages);</span><br><span class="line">        List&lt;BeanDefinition&gt; beanDefinitions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String clazz : className) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class&lt;?&gt; aClass = Class.forName(clazz);</span><br><span class="line">                Component component = aClass.getAnnotation(Component.class);</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isNull(component)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                GenericBeanDefinition beanDefinition = <span class="keyword">new</span> GenericBeanDefinition();</span><br><span class="line"></span><br><span class="line">                String name = component.name();</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isBlank(name)) &#123;</span><br><span class="line">                    name = toLowerCaseFirstOne(aClass.getSimpleName());</span><br><span class="line">                &#125;</span><br><span class="line">                beanDefinition.setBeanName(name);</span><br><span class="line">                beanDefinition.setAliasName(name);</span><br><span class="line">                beanDefinition.setBeanClass(aClass);</span><br><span class="line">                beanDefinitions.add(beanDefinition);</span><br><span class="line"></span><br><span class="line">                beanFactory.registerSingleton(name, beanDefinition);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­›é€‰å¤„æŒ‡å®šåŒ…ä¸‹çš„ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> packageName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">getClassName</span><span class="params">(Context context, String packageName)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; classNameList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//é€šè¿‡DexFileæŸ¥æ‰¾å½“å‰çš„APKä¸­å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">            DexFile df = <span class="keyword">new</span> DexFile(context.getPackageCodePath());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–dfä¸­çš„å…ƒç´   è¿™é‡ŒåŒ…å«äº†æ‰€æœ‰å¯æ‰§è¡Œçš„ç±»å è¯¥ç±»ååŒ…å«äº†åŒ…å+ç±»åçš„æ–¹å¼</span></span><br><span class="line">            Enumeration&lt;String&gt; enumeration = df.entries();</span><br><span class="line">            <span class="keyword">while</span> (enumeration.hasMoreElements()) &#123;</span><br><span class="line">                String className = enumeration.nextElement();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//åœ¨å½“å‰æ‰€æœ‰å¯æ‰§è¡Œçš„ç±»é‡Œé¢æŸ¥æ‰¾åŒ…å«æœ‰è¯¥åŒ…åçš„æ‰€æœ‰ç±»</span></span><br><span class="line">                <span class="keyword">if</span> (className.contains(packageName)) &#123;</span><br><span class="line">                    classNameList.add(className);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> classNameList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¦–å­—æ¯å°å†™</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">toLowerCaseFirstOne</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Character.isLowerCase(s.charAt(<span class="number">0</span>))) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">new</span> StringBuilder()).append(Character.toLowerCase(s.charAt(<span class="number">0</span>))).append(s.substring(<span class="number">1</span>)).toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>invokeBeanFactoryPostProcessors(<strong>beanFactory</strong>);</p><p>åœ¨å®ŒæˆBeançš„æ‰«æ å°†Beançš„å…ƒæ•°æ®è§£æåï¼Œè¿›è¡Œè°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeBeanFactoryPostProcessors</span><span class="params">(DefaultBeanFactory beanFactory)</span> </span>&#123;</span><br><span class="line">    List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessor = beanFactory.getBeanFactoryPostProcessor();</span><br><span class="line">    <span class="keyword">for</span> (BeanFactoryPostProcessor processor : beanFactoryPostProcessor) &#123;</span><br><span class="line">        processor.postProcessBeanFactory(<span class="keyword">this</span>.singletonBeanFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>finishBeanInit(); Beançš„å®ä¾‹åŒ–ï¼Œå’Œä¾èµ–æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishBeanInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, BeanDefinition&gt; beanDefinitionMap = beanFactory.getBeanDefinitionMap();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, BeanDefinition&gt; entry : beanDefinitionMap.entrySet()) &#123;</span><br><span class="line">        String beanName = entry.getKey();</span><br><span class="line">        GenericBeanDefinition beanDefinition = (GenericBeanDefinition) entry.getValue();</span><br><span class="line">        Class&lt;?&gt; beanClass = beanDefinition.getBeanClass();</span><br><span class="line">        Object newInstance = createBean(beanClass);</span><br><span class="line">        registerBean(beanName, newInstance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†ä¾èµ–æ³¨å…¥</span></span><br><span class="line">    isInjection(beanDefinitionMap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¾èµ–æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">isInjection</span><span class="params">(Map&lt;String, BeanDefinition&gt; beanDefinitionMap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†æ¬¡éå†æ‰€æœ‰çš„å®ä¾‹åŒ–çš„ BeanDefinition,å¤„ç†ä¾èµ–å…³ç³»</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, BeanDefinition&gt; entry : beanDefinitionMap.entrySet()) &#123;</span><br><span class="line">        String beanName = entry.getKey();</span><br><span class="line">        GenericBeanDefinition beanDefinition = (GenericBeanDefinition) entry.getValue();</span><br><span class="line">        Class&lt;?&gt; beanClass = beanDefinition.getBeanClass();</span><br><span class="line">        Field[] declaredFields = beanClass.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : declaredFields) &#123;</span><br><span class="line">            Autowired annotation = field.getAnnotation(Autowired.class);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNull(annotation)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å½“å‰çš„å®ä¾‹</span></span><br><span class="line">            Object bean = getBean(beanName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNull(bean)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BeansException(<span class="string">&quot;Autowired æ³¨å…¥å¿…é¡»ä¸ä¸ºç©º &quot;</span> + field.getName());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å…è®¸æ“ä½œä¿®æ”¹</span></span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Class&lt;?&gt; fieldType = field.getType();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ£€æŸ¥åŠ åŠ äº†  Autowired æ³¨è§£çš„å±æ€§ï¼Œæ˜¯å¦åŠ äº† Componentæ³¨è§£</span></span><br><span class="line">            <span class="comment">// å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰¾ä¸åˆ°å®ä¾‹æ³¨å…¥</span></span><br><span class="line">            Component component = fieldType.getAnnotation(Component.class);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotNull(component)) &#123;</span><br><span class="line">                String fieldBeanName = component.name();</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isBlank(fieldBeanName)) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœåŠ äº†ï¼Œä»IOCå®¹å™¨ä¸­è·å–å½“å‰å±æ€§çš„å®ä¾‹</span></span><br><span class="line">                    fieldBeanName = toLowerCaseFirstOne(fieldType.getSimpleName());</span><br><span class="line">                    Object fieldObject = getBean(fieldBeanName);</span><br><span class="line">                    <span class="keyword">if</span> (StringUtils.isNotNull(fieldObject)) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="comment">// åšå±æ€§èµ‹å€¼</span></span><br><span class="line">                            field.set(bean, fieldObject);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>spring åœ¨å¤„ç†æ³¨å…¥çš„æ—¶å€™ä½¿ç”¨äº†é€’å½’æ³¨å…¥ï¼Œåœ¨å®ä¾‹åŒ–Bean çš„æ—¶å€™ï¼Œå°±ä¼šæ£€æŸ¥å½“å‰ç±»çš„æœ‰æ²¡æœ‰å±æ€§ åŠ äº†ï¼ŒAutowired æ³¨è§£çš„ï¼Œå¦‚æœåŠ äº†ï¼Œåˆ¤æ–­å½“å‰å±æ€§æ˜¯å¦å·²ç»å®ä¾‹åŒ–äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šå®ä¾‹åŒ–ä¸‹å»ã€‚å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œåˆä¼šæ£€æŸ¥å®ƒçš„å±æ€§æ˜¯å¦åˆä¾èµ–æ³¨å…¥ï¼Œæœ‰è¿‡æœ‰åˆåˆ¤æ–­å½“å‰çš„å±æ€§æ˜¯å¦å®ä¾‹åŒ–ä¸‹å»ï¼Œè¿™æ ·å­ä¼šå¾ªç¯åˆ¤æ–­ä¸‹å»ï¼Œæ‰€ä»¥Springä½¿ç”¨äº†é€’å½’ã€‚ </p><p>ç›¸äº’ä¾èµ–å†²çªçš„åŒ–å°±ä¼šå‡ºç° è¿™ä¼šå°±æœ‰å¯èƒ½ä¼šæŠ›å‡º circle å¼‚å¸¸ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘å°±æ²¡æœ‰ä½¿ç”¨é€’å½’ï¼Œåˆ†å¼€äº†ä¸¤éƒ¨æ“ä½œï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å…ˆå®ä¾‹åŒ–æ‰€æœ‰çš„Beanå†å¤„ç†ä¾èµ–æ³¨å…¥çš„é—®é¢˜ï¼›</p><p>è¿™ä¸ªæ—¶å€™å·²ç»å®Œæˆäº†DIçš„æ“ä½œäº†ã€‚</p><p>æµ‹è¯•ç»“æœï¼š</p><p><img src="https://pic1.zhimg.com/80/v2-20c1bf4bc9f01bf67793199312981c48_1440w.jpg" alt=""></p><p>Tiger ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tiger</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Women women;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        women.eat();</span><br><span class="line">        System.out.println(<span class="string">&quot;Tiger eat...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Women ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Women</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;women eat...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> MyBeanFactoryPostProcessor Beanå®ä¾‹åŒ–å‰çš„æ‰©å±•æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-03-29 03:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(SingletonBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        Set&lt;String&gt; names = beanFactory.getBeanDefinitionNames();</span><br><span class="line">        System.out.println(<span class="string">&quot;å…±æœ‰Bean:&quot;</span>+beanFactory.getBeanDefinitionCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyApplicationContextAware ä¸Šä¸‹æ–‡å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ‹¿åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡ å¯ä»¥åšä¸€ä¸ªBeanå·¥å‚</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-03-29 03:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationContextAware</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext context;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        context=applicationContext;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‹¿åˆ°Springä¸Šä¸Šä¸‹æ–‡å¯¹è±¡&quot;</span>);</span><br><span class="line">        System.out.println(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title">getApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>MainActivty çš„ onCreate æ–¹æ³•ï¼Œå…¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    context = getApplicationContext();</span><br><span class="line"></span><br><span class="line">    applicationContext = <span class="keyword">new</span> ApplicationContext(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    Tiger tiger = applicationContext.getBean(<span class="string">&quot;tiger&quot;</span>);</span><br><span class="line">    tiger.eat();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-04-12/1586659784930.png" alt="640.png"></p><p>æ‰“å®Œæ‰‹å·¥</p><p>â€‹                      </p><hr><p>::: hljs-center</p><p><img src="http://thisforyou.cn:180/file/img/publick-qrcode.jpg" alt="img"></p><hr><ul><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483775&idx=1&sn=845f221556b6ee93b83e835ab36e384b&chksm=cf3602a5f8418bb3967420e867f33397c22daad2eb3c473311c195110a90e1ceb9396620cbb5#rd">MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼</a></li><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483762&idx=1&sn=d4530ccbe3c8f93845a7e178dddd0bac&chksm=cf3602a8f8418bbe2dd24b56070196e4a9bebf1c0f85ccfcc95b30f823b3f456cb05eacce437#rd">å¹¶å‘å·¥å…·CountDownLatchæ˜¯å¦‚ä½•å®ç°é˜»å¡çš„ï¼Ÿ</a></li><li><a href="http://mp.weixin.qq.com/s?__biz=Mzg3NjEwNzQ0NQ==&mid=2247483747&idx=1&sn=313a454acc561b2f8d16aefd164fef5f&chksm=cf3602b9f8418baf40d6eb63d5fdaba3df27004484c5d3109578955eae2a8115743b321ca516#rd">æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ŒMybatisçš„Mapper/Daoä¸ºä»€ä¹ˆå´å¯ä»¥@Autowiredæ³¨å…¥ï¼Ÿ</a></li></ul><p>:::</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘æ¥è§¦çš„é¡¹ç›®ï¼Œä¸åŸç”Ÿçš„å®‰å“å¼€å‘ç›¸å…³ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå®‰å“çš„å¼€å‘å¹¶ä¸ç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ°äº†å®‰å“å¼€å‘ã€‚å› ä¸ºè‡ªå·±ç”¨ä¹ æƒ¯äº†Spring æ¡†æ¶çš„å¼€å‘ã€‚ç”¨èµ·å®‰å“æ¥ï¼Œå¾ˆæ˜¯ä¸ä¹ æƒ¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å­ä¸ç¬¦åˆæˆ‘çš„ä¸ªæ€§ä¹ æƒ¯äº†ï¼Œæˆ‘å°±æ˜¯åœ¨å®‰å“ä¸­ä½¿ç”¨Springçš„ç±»ä¼¼åŠŸèƒ½ï¼Œæˆ‘å°±è¦å®ç°Spring çš„ Beançš„æ³¨å…¥å¼€å‘ï¼Œå®ç° IOC å®ç°DIã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•å®ç°è¯·çœ‹æ“ä½œï¼šï¼Ÿ&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="IOC Spring" scheme="http://lyj08.gitee.io/tags/IOC-Spring/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis -- Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼</title>
    <link href="http://lyj08.gitee.io/posts/7c99dfb8/"/>
    <id>http://lyj08.gitee.io/posts/7c99dfb8/</id>
    <published>2020-03-08T10:21:00.000Z</published>
    <updated>2020-12-30T09:27:01.177Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MyBatis-â€“-Invalid-bound-statement-not-found-çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼"><a href="#MyBatis-â€“-Invalid-bound-statement-not-found-çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼" class="headerlink" title="MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼"></a>MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼</h1><p>å¾ˆå¤šäººåˆšåˆšå¼€å§‹å­¦mybatisçš„æ—¶å€™ï¼Œå¸¸å¸¸åœ¨åšselectã€updateã€deleteã€insertçš„æ—¶å€™ï¼Œä¼šé‡åˆ°ç±»ä¼¼è¿™ç§ï¼Œ</p><p>Invalid bound statement (not found)ï¼šâ€¦. çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662605040.png" alt="1.png"></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥åˆ°è¿™è‚¯å®šæ˜¯ï¼Œå‘½åç©ºé—´é…ç½®é”™äº†ï¼Œæˆ–è€…æ˜¯ï¼Œdao æ¥å£çš„çš„ æ–¹æ³•ï¼Œå’Œ mapperæ–‡ä»¶çš„æ–¹æ³•æ²¡æœ‰å¯¹åº”ä¸Šã€‚ è¿™æ”¹æ­£è¿‡æ¥å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼›</p><a id="more"></a><p>ä½†æ˜¯ mybatis æ˜¯æ€ä¹ˆé€šè¿‡Dao/mapperæ¥å£çš„æ–¹æ³•ï¼Œæ‰¾åˆ°å¯¹åº”çš„ xml èŠ‚ç‚¹ sql å—ï¼Ÿ</p><p>æ¥åˆ†æä¸€ä¸‹è¿™å…¶ä¸­çš„å› ä¸ºæ‰€ä»¥ï¼ŒæŠ½ä¸å‰¥èŒ§ã€‚</p><p>è¿‡ç¨‹çœ‹ä¸æ˜ç™½ç›´æ¥çœ‹æ€»ç»“å³å¯ğŸ˜‚ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2019-10-16/1571221216702.gif" alt=""></p><h3 id="é¦–å…ˆ-å…ˆä»‹ç»å‡ ä¸ªç±»ï¼š"><a href="#é¦–å…ˆ-å…ˆä»‹ç»å‡ ä¸ªç±»ï¼š" class="headerlink" title="é¦–å…ˆ å…ˆä»‹ç»å‡ ä¸ªç±»ï¼š"></a>é¦–å…ˆ å…ˆä»‹ç»å‡ ä¸ªç±»ï¼š</h3><ol><li><p>Configuration.java</p><p>mybatis å…¨å±€éƒ½å›´ç»•ç€å®ƒè½¬ï¼Œå› ä¸ºå®ƒå‡ ä¹æ¶µç›–mybatisçš„æ‰€æœ‰åˆå§‹åŒ–åè¦å­˜å‚¨çš„ä¿¡æ¯ã€‚</p><ul><li><p>Map&lt;String, MappedStatement&gt; mappedStatementsï¼š</p><p>è¿™ä¸ª map å°±æ˜¯åœ¨å¯åŠ¨é¡¹ç›®æ—¶å€™ï¼Œæ‰«æxmlæ–‡ä»¶å¯¹xml èŠ‚ç‚¹ï¼ˆselectã€updateã€deleteã€insertï¼‰è§£æå°è£…æˆMappedStatementå¯¹è±¡ä¸­çš„ã€‚</p><p>Key:å°±æ˜¯ å‘½åç©ºé—´+æ–¹æ³•åï¼Œvalue:å°±æ˜¯è§£æåä¸€ä¸ªxml èŠ‚ç‚¹ä¿¡æ¯ã€‚</p></li></ul></li><li><p>MappedStatementï¼š</p><p>ä¸€ä¸ªMappedStatementå¯¹åº”ä¸€æ¡ xml ä¸­çš„ ä¸€ä¸ªèŠ‚ç‚¹ æ¯”å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;&quot;</span> <span class="attr">resultSets</span>=<span class="string">&quot;&quot;</span> <span class="attr">flushCache</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span>/&gt;</span> from tb_city</span><br><span class="line">    where id =#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨åˆå§‹åŒ–è¿‡ç¨‹å°±ä¼šè§£æ xml å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¿¡æ¯å°è£…æˆ MappedStatement å¯¹è±¡ï¼š</p><p>ä¾‹å¦‚ï¼š id â€“å¯¹åº”çš„å°±æ˜¯xml ä¸­çš„ èŠ‚ç‚¹id å¦‚ï¼šä¸Šé¢çš„ select è¯­å¥çš„ id=â€findByIdâ€,å…¶å®ƒçš„å±æ€§ä¹Ÿä¼šä¸€ä¸€å¯¹åº”èŠ‚ç‚¹ä¸­é…ç½®çš„ã€‚ä¼šå°†å…¥å‚ ç»“æœé›†éƒ½è§£æå°è£…åˆ°å…¶ä¸­ resultMapsâ€¦ è¿˜æœ‰sqlç±»å‹â€¦..</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å±æ€§</span></span><br><span class="line"> <span class="keyword">private</span> String resource;</span><br><span class="line"> <span class="keyword">private</span> Configuration configuration;</span><br><span class="line"> <span class="keyword">private</span> String id;</span><br><span class="line"> <span class="keyword">private</span> Integer fetchSize;</span><br><span class="line"> <span class="keyword">private</span> Integer timeout;</span><br><span class="line"> <span class="keyword">private</span> StatementType statementType;</span><br><span class="line"> <span class="keyword">private</span> ResultSetType resultSetType;</span><br><span class="line"> <span class="keyword">private</span> SqlSource sqlSource;</span><br><span class="line"> <span class="keyword">private</span> Cache cache;</span><br><span class="line"> <span class="keyword">private</span> ParameterMap parameterMap;</span><br><span class="line"> <span class="keyword">private</span> List&lt;ResultMap&gt; resultMaps;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> flushCacheRequired;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> useCache;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> resultOrdered;</span><br><span class="line"> <span class="keyword">private</span> SqlCommandType sqlCommandType;</span><br><span class="line"> <span class="keyword">private</span> KeyGenerator keyGenerator;</span><br><span class="line"> <span class="keyword">private</span> String[] keyProperties;</span><br><span class="line"> <span class="keyword">private</span> String[] keyColumns;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> hasNestedResultMaps;</span><br><span class="line"> <span class="keyword">private</span> String databaseId;</span><br><span class="line"> <span class="keyword">private</span> Log statementLog;</span><br><span class="line"> <span class="keyword">private</span> LanguageDriver lang;</span><br><span class="line"> <span class="keyword">private</span> String[] resultSets;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>MybatisMapperProxy.java</p><p> Mybatis Dao/Mapperæ¥å£çš„åŠ¨æ€ä»£ç†ç±»ï¼Œæ‰€æœ‰è°ƒç”¨mapper æ¥å£çš„æ–¹æ³•ï¼Œå…¥å£å³åœ¨è¿™ï¼Œæ–­ç‚¹ä»è¿™å¼€å§‹ã€‚</p></li><li><p>MapperMethod.java</p><p>åœ¨ä»£ç†ç±»MybatisMapperProxy.java ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œinvoke æ–¹æ³•æœ€åè°ƒç”¨çš„æ˜¯ï¼ŒMapperMethodã€‚excute()æ–¹æ³•ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å±æ€§</span></span><br><span class="line"><span class="comment">// å†…éƒ¨ç±»ï¼Œåœ¨è·å–MapperMethodä¹‹å‰ï¼Œä¼šå…ˆ new SqlCommand åˆå§‹å¥½ï¼Œsqlç±»å‹ ä¾‹å¦‚ï¼šæ˜¯insertè¿˜æ˜¯selec</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SqlCommand command;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// å°è£…äº†æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ è¿”å›ç±»å‹ä¿¡æ¯,</span></span><br><span class="line"><span class="comment">// åœ¨è·å–MapperMethodä¹‹å‰ï¼Œä¼šå…ˆ new MethodSignature,å¯¹mapperæ¥å£çš„æ–¹æ³•ä¿¡æ¯è¿›è¡Œå°è£… </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MethodSignature method;</span><br></pre></td></tr></table></figure></li></ol><h3 id="çŸ¥å…¶æ‰€ä»¥ç„¶"><a href="#çŸ¥å…¶æ‰€ä»¥ç„¶" class="headerlink" title="çŸ¥å…¶æ‰€ä»¥ç„¶"></a>çŸ¥å…¶æ‰€ä»¥ç„¶</h3><p><strong>CityMapper.XML</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;generator.test.demo.core.mapper.CityMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span>/&gt;</span> from tb_city</span><br><span class="line">        where id =#&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- é€šç”¨æŸ¥è¯¢æ˜ å°„ç»“æœ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;generator.test.demo.core.entity.City&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;city_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;city_code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cityCode&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é€šç”¨æŸ¥è¯¢ç»“æœåˆ—   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span></span><br><span class="line">        id,</span><br><span class="line">        city_name,</span><br><span class="line">        city_code</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>CityMapper.java</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662628622.png" alt="9.png"></p><h3 id="XML-è§£æå°†-sql-èŠ‚ç‚¹å°è£…æˆ-MappedStatment"><a href="#XML-è§£æå°†-sql-èŠ‚ç‚¹å°è£…æˆ-MappedStatment" class="headerlink" title="XML è§£æå°† sql èŠ‚ç‚¹å°è£…æˆ MappedStatment"></a>XML è§£æå°† sql èŠ‚ç‚¹å°è£…æˆ MappedStatment</h3><p>XML è§£æå°† sql èŠ‚ç‚¹å°è£…æˆ MappedStatment ä¸­ï¼Œå¹¶å°†å…¶ å­˜åˆ° Configuration å¯¹è±¡çš„çš„ mappedStatements s Mapå±æ€§ä¸­ï¼›å¹¶ä¸”ä»¥keyä¸º <strong>å‘½åç©ºé—´+æ–¹æ³•Id</strong>  ä¹Ÿå°±æ˜¯ mapperæ¥å£çš„ æ‰€åœ¨<strong>å…¨é™å®šå+æ–¹æ³•å</strong>ï¼›</p><p>ä¸‹å›¾æ˜¯ XML çš„è§£ææµç¨‹ï¼šæ­¤å¤„æˆ‘ä»¬åªçœ‹ï¼ŒMappedStatment å‘½åç©ºé—´çš„ç”Ÿæˆ</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662648625.png" alt="æœªå‘½åæ–‡ä»¶.png"></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662657366.png" alt="8.png"></p><p>çœ‹çœ‹è¿™ä¸ª MappedStatement çš„ getId() æ˜¯ä»€ä¹ˆå€¼ï¼š</p><p>debbug  çœ‹åˆ°çš„æ˜¯ ä¸Šé¢çš„ CityMapper.xml æ–‡ä»¶çš„ namespace+findById (select èŠ‚ç‚¹çš„Idç»„æˆï¼‰;</p><p>ä¹Ÿå°±æ˜¯ç­‰äº ä¸Šé¢çš„ <strong>CityMapper.java</strong> å›¾ç‰‡çš„ 1+2+3+4 ç»„æˆï¼›</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662680555.png" alt="7.png"></p><h3 id="å¢åˆ æ”¹è°ƒç”¨è¿‡ç¨‹"><a href="#å¢åˆ æ”¹è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="å¢åˆ æ”¹è°ƒç”¨è¿‡ç¨‹"></a><strong>å¢åˆ æ”¹è°ƒç”¨è¿‡ç¨‹</strong></h3><p>  å‰é¢å·²ç»åˆ†æäº†ï¼ŒMappedStatement å¯¹åƒçš„ç”Ÿæˆäº†ï¼Œå°±æ˜¯åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹è§£æ xmlæ–‡ä»¶ï¼Œå°†æ¯ä¸ª xmlçš„çš„å¢åˆ æ”¹èŠ‚ç‚¹ï¼Œå°è£…æˆ MappedStatement å­˜åˆ° Configuration ä¸­çš„map å¯¹è±¡ä¸­ã€‚</p><p>å¹¶ä¸”ä»¥ï¼š<strong>key:å‘½åç©ºé—´+ sqlæ ‡ç­¾Idç»„æˆã€‚</strong></p><p><strong>å› ä¸ºæ˜¯è¿™æ ·ï¼Œæ‰€ä»¥é‚£æ ·,è¿™æ ·æ˜¯é‚£æ ·ï¼Ÿ</strong></p><p><strong>åœ¨mybatisä¸­ï¼Œåœ¨æ¯ä¸ªxml ä¸­ï¼Œæ¯ä¸ªsqlçš„idæ˜¯å”¯ä¸€çš„ï¼Œmapperæ¥å£çš„æ–¹æ³•ä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹ä¸ç”¨æ”¹å‡ºç°ä¸¤ä¸ª sql id ç›¸åŒçš„æ–¹æ³•ã€‚</strong></p><p>æ—¢ç„¶å­˜çš„æ˜¯ä¸€ä¸ª Mapå¯¹è±¡ï¼Œé‚£æ‹¿çš„æ—¶å€™ï¼Œè‚¯å®šä¹Ÿæ˜¯é€šè¿‡ key æ¥æ‹¿å°±æ˜¯ MappedStatement Idçš„å€¼ï¼›</p><p>å‰é¢è®²åˆ°äº†ä»£ç†å¯¹åƒ MybatisMapperProxy.javaï¼Œæ‰€æœ‰mybatis çš„mapperæ¥å£ç»è¿‡ä»–çš„ invokeæ–¹æ³•ï¼›æ‰€ä»¥æ–­ç‚¹è¿›å…¥è¿™é‡Œçœ‹ï¼›</p><p><strong>findById è¿›æ¥äº†</strong>ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662696633.png" alt="11.png"></p><p><strong>cachedMapperMethod(mentod)</strong>è¿™ä¸ªæ–¹æ³•æ˜¯ä¼˜åŒ–äº†ï¼Œå…ˆé‡ç¼“å­˜æ–¹æ³•æ‹¿ MybatisMapperMethod å¯¹è±¡ï¼Œå¦‚æœæ‹¿ä¸åˆ°å°± new ä¸€ä¸ª æ·»åŠ åˆ°ç¼“å­˜ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> MybatisMapperMethod <span class="title">cachedMapperMethod</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> methodCache.computeIfAbsent(method, k -&gt; <span class="keyword">new</span> MybatisMapperMethod(mapperInterface, method, sqlSession.getConfiguration()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®æ­¥éª¤åœ¨  <code>new MybatisMapperMethod(mapperInterface, method, sqlSession.getConfiguration()));</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MybatisMapperMethod</span><span class="params">(Class&lt;?&gt; mapperInterface, Method method, Configuration config)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// SqlCommand å‰é¢æœ‰ä»‹ç»</span></span><br><span class="line">        <span class="keyword">this</span>.command = <span class="keyword">new</span> MapperMethod.SqlCommand(config, mapperInterface, method);</span><br><span class="line">        <span class="keyword">this</span>.method = <span class="keyword">new</span> MapperMethod.MethodSignature(config, mapperInterface, method);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>new MapperMethod.SqlCommand</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SqlCommand</span><span class="params">(Configuration configuration, Class&lt;?&gt; mapperInterface, Method method)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// invoke æ–¹æ³•ä¸­æ‹¿åˆ°äº†æ‰§è¡Œçš„æ–¹æ³•å¯¹è±¡ ä»è€Œ æ‹¿åˆ° æ–¹æ³•å</span></span><br><span class="line">      <span class="comment">// è¿˜æœ‰çš„å°±æ˜¯ ä»£ç†ç±»çš„ class</span></span><br><span class="line">      <span class="keyword">final</span> String methodName = method.getName();</span><br><span class="line">      <span class="keyword">final</span> Class&lt;?&gt; declaringClass = method.getDeclaringClass();</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// åœ¨è¿™é‡Œè·å–  MappedStatement å¯¹è±¡</span></span><br><span class="line">      MappedStatement ms = resolveMappedStatement(mapperInterface, methodName, declaringClass,</span><br><span class="line">          configuration);</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">if</span> (ms == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (method.getAnnotation(Flush.class) != <span class="keyword">null</span>) &#123;</span><br><span class="line">          name = <span class="keyword">null</span>;</span><br><span class="line">          type = SqlCommandType.FLUSH;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Invalid bound statement (not found): &quot;</span></span><br><span class="line">              + mapperInterface.getName() + <span class="string">&quot;.&quot;</span> + methodName);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        name = ms.getId();</span><br><span class="line">        type = ms.getSqlCommandType();</span><br><span class="line">        <span class="keyword">if</span> (type == SqlCommandType.UNKNOWN) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">&quot;Unknown execution method for: &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>resolveMappedStatement() å…³é”®æ–¹æ³•</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662733189.png" alt="12.png"></p><p><strong>è·å–mapperæ¥å£çš„å…¨é™å®šåï¼šmapperInterface.getName() æ‹¼æ¥ä¸Š æ–¹æ³•åï¼›</strong></p><p><strong>è¿™æ—¶å€™å°±å¯ä»¥å°±å¯ä»¥ä» configuration ä¸­æ‹¿åˆ°äº† MappedStatementå¯¹è±¡äº†ï¼›</strong>è¿”å›ç©ºçš„æ—¶å€™ï¼ŒSqlCommad æ„é€ å‡½æ•°å°±æŠ›å‡ºäº† å¼‚å¸¸äº†ã€‚</p><p><strong>åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ï¼š</strong> </p><p>  configuration.addMappedStatement(statement);</p><p><strong>åœ¨å¢åˆ æ”¹æŸ¥çš„æ—¶å€™è°ƒç”¨ï¼š</strong></p><p>  <strong>configuration.getMappedStatement(statementId);</strong>    </p><p>è¿™è¿‡ç¨‹å°±æ˜¯  <strong>Invalid bound statement (not found)</strong>  å¼‚å¸¸çš„ æ‰€ä»¥ç„¶æ¥äº†ã€‚ </p><h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><p>Invalid bound statement (not foundï¼‰çš„äº§ç”Ÿçš„åŸå› å°±æ˜¯ï¼Œxmlçš„å‘½åç©ºé—´+sqlèŠ‚ç‚¹çš„id å¯¹åº”ä¸ä¸Šï¼ŒMapperæ¥å£çš„å…¨é™å®šå+å½“å‰è°ƒç”¨çš„æ–¹æ³•åï¼›</p><p>è§£å†³åŠæ³•å°±æ˜¯ï¼š æ£€æŸ¥ xml çš„ namespace çš„å€¼æ˜¯ä¸å¯¹åº”ä¸Šäº† å’Œ sqlèŠ‚ç‚¹çš„å€¼ï¼Œæˆ–è€… xml æ˜¯å¦è¢«æ‰«æåˆ°äº†ï¼›</p><p>Invalid bound statement (not found) çš„åŸç†ï¼š</p><pre><code>åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œæ‰«æxmlæ–‡ä»¶å¤¹ä¸‹çš„ mapper.xmlæ–‡ä»¶ï¼Œå¯¹ xml çš„ sql èŠ‚ç‚¹è¿›è¡Œè§£æï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯å°è£…åˆ° MapperStaementå¯¹è±¡ä¸­ï¼Œç„¶å put è¿›å»åˆ°  Configuration å¯¹è±¡ä¸­çš„ Map&lt;String, MappedStatement&gt; mappedStatements  å±æ€§ä¸­ï¼›ke y:å‘½åç©ºé—´+sqlèŠ‚ç‚¹idã€‚</code></pre><p>åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä»£ç†å¯¹åƒ MybatisMapperProxy ä¸­invokeæ–¹æ³• æ‹¿åˆ°å½“å‰ mapper.java å¯¹åƒçš„class.getName()å…¨é™å®šåï¼Œå’Œæ–¹æ³•å æ‹¼æ¥æˆ statementId å»configuration.getMappedStatement(id)ä¸­è·å– MappedStatement å¯¹åƒã€‚</p><p>åœ¨ç»§ç»­è·Ÿè¸ªä¸‹å»ï¼Œå°±æ˜¯åˆ°äº† åˆ†æ”¯ï¼Œé€šè¿‡ SqlCommad åˆ¤æ–­ å½“å‰æ˜¯å¢è¿˜æ˜¯åˆ  è¿˜æ˜¯æŸ¥è¿˜æ˜¯æ”¹äº†â€¦â€¦â€¦..</p><p>::: hljs-center</p><h2 id="æ‰“å®Œæ”¶å·¥"><a href="#æ‰“å®Œæ”¶å·¥" class="headerlink" title="æ‰“å®Œæ”¶å·¥"></a>æ‰“å®Œæ”¶å·¥</h2><p><img src="http://thisforyou.cn:180/file/img/publick-qrcode.jpg" alt=""><br>å…³æ³¨å…¬ä¼—å·<br>:::</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;MyBatis-â€“-Invalid-bound-statement-not-found-çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼&quot;&gt;&lt;a href=&quot;#MyBatis-â€“-Invalid-bound-statement-not-found-çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼&quot; class=&quot;headerlink&quot; title=&quot;MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼&quot;&gt;&lt;/a&gt;MyBatis â€“ Invalid bound statement (not found) çš„æ‰€ä»¥ç„¶æ¥ï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ï¼&lt;/h1&gt;&lt;p&gt;å¾ˆå¤šäººåˆšåˆšå¼€å§‹å­¦mybatisçš„æ—¶å€™ï¼Œå¸¸å¸¸åœ¨åšselectã€updateã€deleteã€insertçš„æ—¶å€™ï¼Œä¼šé‡åˆ°ç±»ä¼¼è¿™ç§ï¼Œ&lt;/p&gt;
&lt;p&gt;Invalid bound statement (not found)ï¼šâ€¦. çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://thisforyou.cn:180/file/articleContentImg/2020-03-08/1583662605040.png&quot; alt=&quot;1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæˆ‘ä»¬éƒ½çŸ¥åˆ°è¿™è‚¯å®šæ˜¯ï¼Œå‘½åç©ºé—´é…ç½®é”™äº†ï¼Œæˆ–è€…æ˜¯ï¼Œdao æ¥å£çš„çš„ æ–¹æ³•ï¼Œå’Œ mapperæ–‡ä»¶çš„æ–¹æ³•æ²¡æœ‰å¯¹åº”ä¸Šã€‚ è¿™æ”¹æ­£è¿‡æ¥å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼›&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
      <category term="mybatis" scheme="http://lyj08.gitee.io/categories/java/mybatis/"/>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/tags/java/"/>
    
      <category term="mybatis" scheme="http://lyj08.gitee.io/tags/mybatis/"/>
    
  </entry>
  
  <entry>
    <title>CountDownLatchåº•å±‚å®ç°æ„æˆï¼Œä¸€æ­¥æ­¥åˆ†æ</title>
    <link href="http://lyj08.gitee.io/posts/7ac91ac6/"/>
    <id>http://lyj08.gitee.io/posts/7ac91ac6/</id>
    <published>2020-03-07T13:19:00.000Z</published>
    <updated>2020-12-30T09:26:28.848Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CountDownLach-è®¡æ•°å™¨"><a href="#CountDownLach-è®¡æ•°å™¨" class="headerlink" title="CountDownLach è®¡æ•°å™¨"></a>CountDownLach è®¡æ•°å™¨</h1><p> CountDownLach çš„ä½¿ç”¨è¿‡ç¨‹æ–¹æ³•è°ƒç”¨ï¼Œåº•å±‚æºç å­¦ä¹ ã€‚</p><p><strong>CountDownLachï¼š</strong> é€‚ç”¨äºï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¼€å¯å¤šä¸ªå­çº¿ç¨‹å»ç»Ÿè®¡æŸäº›ä¸åŒæ•°æ®çš„ç»“æœï¼Œç„¶åä¸»çº¿ç¨‹éœ€è¦å¯¹è¿™äº›ç»“æœè¿›è¡Œæ“ä½œçš„åœºæ™¯ã€‚</p> <a id="more"></a><h2 id="ä¸»è¦æ–¹æ³•"><a href="#ä¸»è¦æ–¹æ³•" class="headerlink" title="ä¸»è¦æ–¹æ³•"></a>ä¸»è¦æ–¹æ³•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„state</span><br><span class="line">CountDownLach cdl &#x3D; new CountDownLach(2);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é˜»å¡çº¿ç¨‹ï¼Œè¿›å…¥é˜Ÿåˆ—å€™ç€ï¼Œç­‰å¾…å”¤é†’</span><br><span class="line">cdl.await();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹</span><br><span class="line">cdl.countDown();</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-02-18 13:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkCountDownLatch</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„ state = 5</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CountDownLatch cdl = <span class="keyword">new</span> CountDownLatch(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// æ¥ä¸€ä¸ªçº¿ç¨‹ state-1 </span></span><br><span class="line">            <span class="comment">// ç›´åˆ°ä¸º 0ï¼Œcdl.await(); åé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œã€‚</span></span><br><span class="line">            cdl.countDown();</span><br><span class="line">            ++i;</span><br><span class="line">            System.out.println(i);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯5ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            service.execute(<span class="keyword">new</span> Task());</span><br><span class="line">        &#125;</span><br><span class="line">        service.shutdown();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// çº¿ç¨‹è¿›å¦‚é˜Ÿåˆ—ç­‰å€™</span></span><br><span class="line">            cdl.await();</span><br><span class="line">            System.out.println(<span class="string">&quot;å­çº¿ç¨‹å¤„ç†ç»“æœï¼š&quot;</span>+i);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åº•å±‚ä»£ç éªŒè¯æŸ¥çœ‹</strong></p><h2 id="new-CountDownLatch-5"><a href="#new-CountDownLatch-5" class="headerlink" title="new CountDownLatch(5)"></a>new CountDownLatch(5)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CountDownLatch</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;count &lt; 0&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.sync = <span class="keyword">new</span> Sync(count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…éƒ¨ç±» Sync ç»§æ‰¿äºAQS  è°ƒç”¨AQSçš„æ–¹æ³• è®¾ç½®å€¼stateçš„å€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4982264981922014374L</span>;</span><br><span class="line"></span><br><span class="line">    Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">        setState(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å…±äº«é” æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾å…±äº«é”ï¼Œè°ƒç”¨cutDown() çš„æ—¶å€™</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = getState();</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">                <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ•°ä¸èƒ½ &lt; 0ï¼Œä¸€ä¸ªå†…ç½®åŒæ­¥ç±»ï¼Œç»§æ‰¿äºAQS,åŸºäºAQSçš„stateè¿›è¡Œè®¡æ•°ï¼Œç„¶åè¿›è¡Œcasæ“ä½œã€‚</p><h2 id="cdl-await"><a href="#cdl-await" class="headerlink" title="cdl.await()"></a>cdl.await()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       sync.acquireSharedInterruptibly(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line"></span><br><span class="line"><span class="comment">//tryAcquireShared AQS çš„å…±äº«é”çš„æ–¹æ³•ï¼Œç„¶å CountDownLach çš„ Sync é‡å†™äº† æ­¤æ–¹æ³•ï¼Œè¿›è¡Œå†…éƒ¨çš„é€»è¾‘æ“ä½œ</span></span><br><span class="line">       <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">           doAcquireSharedInterruptibly(arg);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-18/1582006036142.png" alt="1.png"></p><p><strong>tryAcquireShared(1)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p> è·å– stateçš„å€¼ï¼ŒacquireSharedInterruptiblyï¼ˆï¼‰ä¸­<br><code>if (tryAcquireShared(arg) &lt; 0)&#123;         doAcquireSharedInterruptibly(arg);&#125;</code> å¦‚æœstateå€¼ä¸ä¸º0çš„æ—¶å€™ï¼Œä»£è¡¨await()ä¹‹åçš„ä»£ç è¿˜ä¼šç»§ç»­é˜»å¡ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œã€‚å½“å‰è°ƒç”¨çš„awaitçš„çº¿ç¨‹ï¼Œå°±ä¼šæš‚æ—¶è¿›å…¥é˜Ÿåˆ—ä¸­æœ€# ä¸€çº§æ ‡é¢˜åè°ƒç”¨USAVE.park()æŒ‚èµ·ã€‚ä¸º0æ—¶å€™ï¼Œè¯´æ˜countDown çš„æ¬¡æ•°å·²ç»ç­‰äºäº†åˆå§‹åŒ–æ„é€ çš„æ—¶å€™ å‚æ•°å€¼äº†ã€‚æ­¤æ—¶å°±ä¼šä»é˜Ÿåˆ—å”¤é†’è°ƒç”¨awaitçš„çº¿ç¨‹ã€‚</p><h2 id="cdl-countDown"><a href="#cdl-countDown" class="headerlink" title="cdl.countDown()"></a>cdl.countDown()</h2><p>sync.releaseShared(1)é‡Šæ”¾é”ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">releaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">        doReleaseShared();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>tryReleaseShared()</strong> æ–¹æ³•ï¼Œæ˜¯æœ¬ç±»ä¸­çš„Sysnc ä¸­çš„æ–¹æ³•ï¼Œçœ‹æ“ä½œæºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4982264981922014374L</span>;</span><br><span class="line"></span><br><span class="line">      Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">          setState(count);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> getState();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// ä¸€ä¸ªæ­»å¾ªç¯</span></span><br><span class="line">          <span class="keyword">for</span> (;;) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–stateå€¼ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒä¸€æ¬¡countDownæ–¹æ³•å°±ä¼šï¼Œå¯¹state-1;</span></span><br><span class="line">              <span class="keyword">int</span> c = getState();</span><br><span class="line">              <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">              <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">              <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">                  <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å½“æ¯ä¸ªçº¿ç¨‹,è°ƒç”¨ä¸€æ¬¡countDown AQSçš„stateå€¼å°±ä¼šå‡1ï¼Œå¦‚æœåœ¨å‡1ä¹‹å‰ï¼Œstateå°±ä¸º0çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè¿›è¡Œé˜»å¡äº†ï¼Œæ¯”å¦‚ new CountDownLach(5) ,ä½†æ˜¯æœ‰6æ¡çº¿ç¨‹çš„æ—¶å€™ï¼Œç¬¬å…­æ¡è°ƒç”¨countDownçš„æ—¶å€™ï¼Œå°±ä¼š getState==0,ä½†æ˜¯ï¼Œè¿™ä¹‹å‰ï¼Œawaitåé¢çš„ä»£ç å·²ç»æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ ,ä¸‹é¢ä»£ç ä¸ä¼šè¿›å…¥doReleaseSharedï¼ˆï¼‰ å»å”¤é†’ä¸»çº¿ç¨‹ï¼Œç¬¬äº”å¤©çº¿ç¨‹å·²ç»å”¤é†’è¿‡äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">     doReleaseShared();</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼Œå¦‚æœè¿™æ—¶å€™ï¼Œç¬¬5æ¡çº¿ç¨‹æ¥è°ƒç”¨countDownçš„æ—¶å€™ï¼Œä¼šcaså»ä¿®æ”¹ï¼Œstateå€¼ï¼Œå¦‚æœstate-1=0æ—¶å€™ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ doReleaseShared() å”¤é†’é˜Ÿåˆ—ä¸­çš„ç¥çº¿ç¨‹äº†ã€‚æ­¤æ—¶awiteåé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œäº†ã€‚</p><h2 id="æ€»ç»“-æµç¨‹å›¾"><a href="#æ€»ç»“-æµç¨‹å›¾" class="headerlink" title="æ€»ç»“ æµç¨‹å›¾"></a>æ€»ç»“ æµç¨‹å›¾</h2><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-19/1582095878090.png" alt="1.png"></p><h1 id="CountDownLach-è®¡æ•°å™¨-1"><a href="#CountDownLach-è®¡æ•°å™¨-1" class="headerlink" title="CountDownLach è®¡æ•°å™¨"></a>CountDownLach è®¡æ•°å™¨</h1><p> CountDownLach çš„ä½¿ç”¨è¿‡ç¨‹æ–¹æ³•è°ƒç”¨ï¼Œåº•å±‚æºç å­¦ä¹ ã€‚</p><p><strong>CountDownLachï¼š</strong> é€‚ç”¨äºï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¼€å¯å¤šä¸ªå­çº¿ç¨‹å»ç»Ÿè®¡æŸäº›ä¸åŒæ•°æ®çš„ç»“æœï¼Œç„¶åä¸»çº¿ç¨‹éœ€è¦å¯¹è¿™äº›ç»“æœè¿›è¡Œæ“ä½œçš„åœºæ™¯ã€‚</p><h2 id="æºç æŸ¥çœ‹"><a href="#æºç æŸ¥çœ‹" class="headerlink" title="æºç æŸ¥çœ‹"></a>æºç æŸ¥çœ‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„state</span><br><span class="line">CountDownLach cdl &#x3D; new CountDownLach(2);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; é˜»å¡çº¿ç¨‹ï¼Œè¿›å…¥é˜Ÿåˆ—å€™ç€ï¼Œç­‰å¾…å”¤é†’</span><br><span class="line">cdl.await();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹</span><br><span class="line">cdl.countDown();</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2020-02-18 13:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkCountDownLatch</span></span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– çº¿ç¨‹é˜™å€¼ï¼ŒAQS çš„ state = 5</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CountDownLatch cdl = <span class="keyword">new</span> CountDownLatch(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// æ¥ä¸€ä¸ªçº¿ç¨‹ state-1 </span></span><br><span class="line">            <span class="comment">// ç›´åˆ°ä¸º 0ï¼Œcdl.await(); åé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œã€‚</span></span><br><span class="line">            cdl.countDown();</span><br><span class="line">            ++i;</span><br><span class="line">            System.out.println(i);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼€å¯5ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            service.execute(<span class="keyword">new</span> Task());</span><br><span class="line">        &#125;</span><br><span class="line">        service.shutdown();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// çº¿ç¨‹è¿›å¦‚é˜Ÿåˆ—ç­‰å€™</span></span><br><span class="line">            cdl.await();</span><br><span class="line">            System.out.println(<span class="string">&quot;å­çº¿ç¨‹å¤„ç†ç»“æœï¼š&quot;</span>+i);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åº•å±‚ä»£ç éªŒè¯æŸ¥çœ‹</strong></p><h2 id="new-CountDownLatch-5-1"><a href="#new-CountDownLatch-5-1" class="headerlink" title="new CountDownLatch(5)"></a>new CountDownLatch(5)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CountDownLatch</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;count &lt; 0&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.sync = <span class="keyword">new</span> Sync(count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…éƒ¨ç±» Sync ç»§æ‰¿äºAQS  è°ƒç”¨AQSçš„æ–¹æ³• è®¾ç½®å€¼stateçš„å€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4982264981922014374L</span>;</span><br><span class="line"></span><br><span class="line">    Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">        setState(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å…±äº«é” æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾å…±äº«é”ï¼Œè°ƒç”¨cutDown() çš„æ—¶å€™</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = getState();</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">                <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ•°ä¸èƒ½ &lt; 0ï¼Œä¸€ä¸ªå†…ç½®åŒæ­¥ç±»ï¼Œç»§æ‰¿äºAQS,åŸºäºAQSçš„stateè¿›è¡Œè®¡æ•°ï¼Œç„¶åè¿›è¡Œcasæ“ä½œã€‚</p><h2 id="cdl-await-1"><a href="#cdl-await-1" class="headerlink" title="cdl.await()"></a>cdl.await()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       sync.acquireSharedInterruptibly(<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquireSharedInterruptibly</span><span class="params">(<span class="keyword">int</span> arg)</span></span></span><br><span class="line"><span class="function">           <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line"></span><br><span class="line"><span class="comment">//tryAcquireShared AQS çš„å…±äº«é”çš„æ–¹æ³•ï¼Œç„¶å CountDownLach çš„ Sync é‡å†™äº† æ­¤æ–¹æ³•ï¼Œè¿›è¡Œå†…éƒ¨çš„é€»è¾‘æ“ä½œ</span></span><br><span class="line">       <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">           doAcquireSharedInterruptibly(arg);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-18/1582006036142.png" alt="1.png"></p><p><strong>tryAcquireShared(1)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p> è·å– stateçš„å€¼ï¼ŒacquireSharedInterruptiblyï¼ˆï¼‰ä¸­<br><code>if (tryAcquireShared(arg) &lt; 0)&#123;         doAcquireSharedInterruptibly(arg);&#125;</code> å¦‚æœstateå€¼ä¸ä¸º0çš„æ—¶å€™ï¼Œä»£è¡¨await()ä¹‹åçš„ä»£ç è¿˜ä¼šç»§ç»­é˜»å¡ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œã€‚å½“å‰è°ƒç”¨çš„awaitçš„çº¿ç¨‹ï¼Œå°±ä¼šæš‚æ—¶è¿›å…¥é˜Ÿåˆ—ä¸­æœ€# ä¸€çº§æ ‡é¢˜åè°ƒç”¨USAVE.park()æŒ‚èµ·ã€‚ä¸º0æ—¶å€™ï¼Œè¯´æ˜countDown çš„æ¬¡æ•°å·²ç»ç­‰äºäº†åˆå§‹åŒ–æ„é€ çš„æ—¶å€™ å‚æ•°å€¼äº†ã€‚æ­¤æ—¶å°±ä¼šä»é˜Ÿåˆ—å”¤é†’è°ƒç”¨awaitçš„çº¿ç¨‹ã€‚</p><h2 id="cdl-countDown-1"><a href="#cdl-countDown-1" class="headerlink" title="cdl.countDown()"></a>cdl.countDown()</h2><p>sync.releaseShared(1)é‡Šæ”¾é”ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">releaseShared</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">        doReleaseShared();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>tryReleaseShared()</strong> æ–¹æ³•ï¼Œæ˜¯æœ¬ç±»ä¸­çš„Sysnc ä¸­çš„æ–¹æ³•ï¼Œçœ‹æ“ä½œæºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4982264981922014374L</span>;</span><br><span class="line"></span><br><span class="line">      Sync(<span class="keyword">int</span> count) &#123;</span><br><span class="line">          setState(count);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> getState();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> (getState() == <span class="number">0</span>) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// Decrement count; signal when transition to zero</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// ä¸€ä¸ªæ­»å¾ªç¯</span></span><br><span class="line">          <span class="keyword">for</span> (;;) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–stateå€¼ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒä¸€æ¬¡countDownæ–¹æ³•å°±ä¼šï¼Œå¯¹state-1;</span></span><br><span class="line">              <span class="keyword">int</span> c = getState();</span><br><span class="line">              <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">              <span class="keyword">int</span> nextc = c-<span class="number">1</span>;</span><br><span class="line">              <span class="keyword">if</span> (compareAndSetState(c, nextc))</span><br><span class="line">                  <span class="keyword">return</span> nextc == <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å½“æ¯ä¸ªçº¿ç¨‹,è°ƒç”¨ä¸€æ¬¡countDown AQSçš„stateå€¼å°±ä¼šå‡1ï¼Œå¦‚æœåœ¨å‡1ä¹‹å‰ï¼Œstateå°±ä¸º0çš„æ—¶å€™ï¼Œå°±ä¸ä¼šè¿›è¡Œé˜»å¡äº†ï¼Œæ¯”å¦‚ new CountDownLach(5) ,ä½†æ˜¯æœ‰6æ¡çº¿ç¨‹çš„æ—¶å€™ï¼Œç¬¬å…­æ¡è°ƒç”¨countDownçš„æ—¶å€™ï¼Œå°±ä¼š getState==0,ä½†æ˜¯ï¼Œè¿™ä¹‹å‰ï¼Œawaitåé¢çš„ä»£ç å·²ç»æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ ,ä¸‹é¢ä»£ç ä¸ä¼šè¿›å…¥doReleaseSharedï¼ˆï¼‰ å»å”¤é†’ä¸»çº¿ç¨‹ï¼Œç¬¬äº”å¤©çº¿ç¨‹å·²ç»å”¤é†’è¿‡äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (tryReleaseShared(arg)) &#123;</span><br><span class="line">     doReleaseShared();</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼Œå¦‚æœè¿™æ—¶å€™ï¼Œç¬¬5æ¡çº¿ç¨‹æ¥è°ƒç”¨countDownçš„æ—¶å€™ï¼Œä¼šcaså»ä¿®æ”¹ï¼Œstateå€¼ï¼Œå¦‚æœstate-1=0æ—¶å€™ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ doReleaseShared() å”¤é†’é˜Ÿåˆ—ä¸­çš„ç¥çº¿ç¨‹äº†ã€‚æ­¤æ—¶awiteåé¢çš„ä»£ç å°±ä¼šæ‰§è¡Œäº†ã€‚</p><p>::: hljs-center</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-07/1583587047909.jpg" alt="publickqrcode.jpg"><br>å…³æ³¨å…¬ä¼—å·<br>:::</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;CountDownLach-è®¡æ•°å™¨&quot;&gt;&lt;a href=&quot;#CountDownLach-è®¡æ•°å™¨&quot; class=&quot;headerlink&quot; title=&quot;CountDownLach è®¡æ•°å™¨&quot;&gt;&lt;/a&gt;CountDownLach è®¡æ•°å™¨&lt;/h1&gt;&lt;p&gt; CountDownLach çš„ä½¿ç”¨è¿‡ç¨‹æ–¹æ³•è°ƒç”¨ï¼Œåº•å±‚æºç å­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CountDownLachï¼š&lt;/strong&gt; é€‚ç”¨äºï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¼€å¯å¤šä¸ªå­çº¿ç¨‹å»ç»Ÿè®¡æŸäº›ä¸åŒæ•°æ®çš„ç»“æœï¼Œç„¶åä¸»çº¿ç¨‹éœ€è¦å¯¹è¿™äº›ç»“æœè¿›è¡Œæ“ä½œçš„åœºæ™¯ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/tags/java/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://lyj08.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Docker å¿«é€Ÿå®‰è£… NextCloud ä¸ªäººç§æœ‰äº‘ç›˜ å¹¶ä¸”è¿æ¥ Mysql æ•°æ®åº“ï¼Œç½‘é€Ÿè¶…å¿«</title>
    <link href="http://lyj08.gitee.io/posts/f01f8482/"/>
    <id>http://lyj08.gitee.io/posts/f01f8482/</id>
    <published>2020-03-01T09:00:00.000Z</published>
    <updated>2020-12-30T09:27:34.097Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£"><a href="#1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£" class="headerlink" title="1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£"></a>1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£</h4><p>â€‹    å‚è€ƒï¼š<a href="https://docs.docker.com/install/linux/docker-ce/centos/">centos å®˜ç½‘å®‰è£…æ•™ç¨‹</a></p><a id="more"></a><h4 id="2ã€mysqlå®‰è£…"><a href="#2ã€mysqlå®‰è£…" class="headerlink" title="2ã€mysqlå®‰è£…"></a>2ã€mysqlå®‰è£…</h4><ol><li><p>å®‰è£…å‚è€ƒï¼š<a href="https://hub.docker.com/_/mysql">dockerHub æ•™ç¨‹</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql # æ‹‰å–é•œåƒ</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images # æŸ¥çœ‹åç§°/é•œåƒid</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d é•œåƒid </span><br></pre></td></tr></table></figure><p>è¿è¡Œmysql å¹¶ä¸”è®¾ç½®è®¿é—®ç«¯å£ï¼š3306ï¼Œå®¹å™¨åç§°ï¼šmysql ,ç®¡ç†å‘˜å¯†ç ï¼š123456</p></li></ol><ol start="2"><li><p>é…ç½®ä¸€ä¸ªè´¦æˆ·å’Œæƒé™ç»™ nextcloud ç½‘ç›˜ä½¿ç”¨/ ä¹Ÿå¯ä»¥ä¸åˆ›å»ºç”¨æˆ·ï¼Œä½¿ç”¨root,åˆ›å»ºä¸ªæ•°æ®è£¤å³å¯ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿˜æ˜¯å•ç‹¬åˆ†é…æƒé™çš„å¥½ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it å®¹å™¨åç§°/å®¹å™¨id bash</span><br></pre></td></tr></table></figure><ul><li><p>ç™»é™†mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><p>æ¥ç€è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š123456 å›è½¦</p></li><li><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE nextcloud; </span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;nextcloud&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;; </span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·  åç§°ä¸ºï¼šnextcloudï¼›â€˜%â€™ï¼šä»£è¡¨ä¸é™ipç™»é™†ï¼Œè¿œç¨‹ç™»é™†; å¯†ç ä¸ºï¼š123456ã€‚</p></li><li><p>æˆæƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL ON nextcloud.* TO nextcloud@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><p>ç»™è¿™ä¸ªç”¨æˆ· nextcloud æˆäºˆ è¿™ä¸ªæ•°æ®åº“  nextcloud.* æ‰€æœ‰çš„æƒé™ï¼Œè¿œç¨‹ç™»é™†ï¼Œå¯†ç ä¸º 123456ï¼›</p></li></ul></li></ol><h4 id="2ã€NextCloud-å®˜ç½‘"><a href="#2ã€NextCloud-å®˜ç½‘" class="headerlink" title="2ã€NextCloud å®˜ç½‘"></a>2ã€NextCloud å®˜ç½‘</h4><ul><li><a href="https://github.com/chrootLogin/docker-nextcloud">nextcloudå®˜ç½‘</a></li></ul><p>è¿›å…¥å®˜ç½‘å…ˆçœ‹æ•™ç¨‹ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-01/1583052950912.png" alt="3.png"></p><ol><li><p>ç¬¬ä¸€æ­¥ä¸‹è½½é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rootlogin/nextcloud</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºä¸€ä¸ªç›®å½•å°†é•œåƒçš„æ•°æ®æŒ‚è½½åˆ°å®¿ä¸»æœºä¸­</p><p>åœ¨æœåŠ¡å™¨ä¸Šï¼Œè‡ªå·±æ‰¾ä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚æˆ‘çš„ï¼Œ<code>/usr/local/software/docker/</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/software/docker/nextcloud/data</span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™ä¸€ä¸ªå¯åŠ¨è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/docker/nextcloud/ &amp;&amp; vim start.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå¡«å†™å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker stop nextcloud &amp;&amp; docker rm nextcloud</span><br><span class="line">docker run -d -p 9989:80 --name nextcloud \</span><br><span class="line"> --privileged=true \</span><br><span class="line"> --restart=always \</span><br><span class="line"> --link mysql:next_cloud_db \ # è¿™ä¸€è¡Œå‰é¢çš„ `mysql` æ˜¯ mysql å®¹å™¨çš„åç§°ï¼Œå†’å·åçš„ è‡ªå®šä¹‰çš„</span><br><span class="line"> - v /usr/local/software/docker/nextcloud/data:/data \ # æ•°æ®æŒ‚è½½åˆ°å®¿ä¸»æœºä¸­</span><br><span class="line"> rootlogin/nextcloud</span><br></pre></td></tr></table></figure><p>å°†80ç«¯å£æ˜ å°„ä¸ºå¤–éƒ¨è®¿é—®ç«¯å£ 9989ï¼š ç«¯å£è‡ªå®šä¹‰ï¼›</p><p>å¦‚æœæœåŠ¡å™¨é˜²ç«å¢™æ²¡æœ‰å…³ï¼Œå¼€æ”¾ç«¯å£ï¼Œä¸ç„¶æ— æ³•è®¿é—®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9989/tcp --permanent &amp;&amp; firewall-cmd --reload &amp;&amp; firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure><p>å¼€æ”¾ç«¯å£ï¼Œå¹¶ä¸”reload é˜²ç«å¢™ä½¿å…¶ç”Ÿæ•ˆï¼ŒæŸ¥çœ‹å·²å¼€æ”¾ç«¯å£ã€‚</p></li><li><p>å¯åŠ¨nextcloud</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/docker/nextcloud/ &amp;&amp; sh start.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps # æ£€æµ‹å¯åŠ¨æ˜¯å¦æˆåŠŸ</span><br></pre></td></tr></table></figure><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-01/1583052967293.png" alt="4.png"></p></li></ol><p>æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼šhttp://æœåŠ¡å™¨ip:9989</p><p>è¿›å…¥é¡µé¢åï¼Œéœ€è¦å¡«å†™è´¦æˆ·æ–°ç”¨æˆ·è´¦æˆ·å¯†ç ï¼šè¿˜æœ‰æ•°æ®åº“</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-01/1583052998530.png" alt="10.png"></p><p>æŒ‰å›¾ç‰‡å¡«å†™å³å¯ï¼Œå¡«å†™å®Œæˆç‚¹å‡» å®‰è£…å®Œæˆï¼Œç­‰å¾…ä¸ª1ï½2æ—¶é—´ï¼ŒæˆåŠŸä¹‹åï¼Œå°±ä¼šç›´æ¥è¿›å…¥ä¸»é¡µé¢ï¼›</p><p>æ­¤å¤„ï¼Œåœ¨ç”¨æˆ·æˆæƒçš„æ—¶å€™ï¼Œæœ€å¥½ç›´æ¥å¡«å†™ All ä¸è¦ä¸€ä¸ªä¸ªå†™ï¼Œå®¹æ˜“æ¼æ‰æƒé™ï¼Œä»¥å…å¸¦æ¥ï¼Œåˆ›å»ºæ•°æ®åº“çš„çš„æ—¶å€™ï¼ŒæŠ¥æ²¡æœ‰æƒé™çš„é”™è¯¯ã€‚</p><p><img src="/Users/yongjian/Downloads/11.png" alt=""></p><p>å¤§åŠŸå‘Šæˆã€‚</p><p>çœ‹çœ‹mysqlæ•°æ®è£¤æœ‰å¤šå°‘ä¸œè¥¿ï¼š</p><p>çœ‹ oc_usersè¡¨ä¸­ä¼šæœ‰ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ï¼Œå¯†ç æ˜¯åŠ è¿‡å¯†çš„ï¼›</p><p>é…ç½®æ–‡ä»¶åœ¨ï¼š<code>/usr/local/software/docker/nextcloud/data</code> ä¸­ï¼Œéœ€è¦ä¿®æ”¹åœ¨é‚£é‡Œæ”¹å³å¯ï¼›</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-01/1583053005895.png" alt="31.png"></p><p>::: hljs-center</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-03-01/1583054676570.jpg" alt="publickqrcode.jpg"><br>å…³æ³¨å…¬ä¼—å·æ¯å¤©ä¸ºä½ åˆ†äº« æ›´å¤šå†…å®¹</p><p>:::</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£&quot;&gt;&lt;a href=&quot;#1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£&quot; class=&quot;headerlink&quot; title=&quot;1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£&quot;&gt;&lt;/a&gt;1ã€å½“ç„¶æ˜¯å…ˆå®‰è£…dockerï¼Œæ­¤å¤„dockerç¯å¢ƒå®‰è£…ä¸è®²è§£&lt;/h4&gt;&lt;p&gt;â€‹    å‚è€ƒï¼š&lt;a href=&quot;https://docs.docker.com/install/linux/docker-ce/centos/&quot;&gt;centos å®˜ç½‘å®‰è£…æ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
      <category term="docker" scheme="http://lyj08.gitee.io/categories/java/docker/"/>
    
    
      <category term="ç§æœ‰äº‘ç›˜" scheme="http://lyj08.gitee.io/tags/%E7%A7%81%E6%9C%89%E4%BA%91%E7%9B%98/"/>
    
      <category term="nextcloud" scheme="http://lyj08.gitee.io/tags/nextcloud/"/>
    
  </entry>
  
  <entry>
    <title>æ¥å£ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ŒMybatisçš„Mapper/Daoä¸ºä»€ä¹ˆå´å¯ä»¥@Autowiredæ³¨å…¥ï¼Ÿ</title>
    <link href="http://lyj08.gitee.io/posts/92011cd1/"/>
    <id>http://lyj08.gitee.io/posts/92011cd1/</id>
    <published>2020-02-29T02:26:52.000Z</published>
    <updated>2020-12-30T09:27:12.757Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºæˆ‘ä»¬ java æ¥è¯´ï¼Œæ¥å£æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–çš„ã€‚è€Œä¸”æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯publicçš„ã€‚</p><p>å¯æ˜¯ä¸ºä»€ä¹ˆ Mybaits çš„mapper æ¥å£ï¼Œå¯ä»¥ç›´æ¥ @Autowired æ³¨å…¥ ä½¿ç”¨ï¼Ÿ</p><p>æ¥ä¸‹æ¥çœ‹çœ‹Mybatis æ˜¯å¦‚ä½•åšçš„ã€‚</p><p>åŸºäºSpringBoot çš„ @MapperScan æ³¨è§£å…¥æ‰‹ï¼Œåˆ†æã€‚</p><a id="more"></a><p><strong>å¸¦ç€é—®é¢˜åˆ†æä»£ç ï¼š</strong></p><ol><li>Mybatis çš„mapperæ¥å£ï¼Œæ˜¯æ€ä¹ˆè¢«æ‰«æçš„ï¼Ÿ</li><li>mapperæ¥å£æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨@Autowiredæ³¨å…¥ï¼Ÿ</li></ol><h2 id="MapperScan"><a href="#MapperScan" class="headerlink" title="@MapperScan"></a>@MapperScan</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(MapperScannerRegistrar.class)</span></span><br><span class="line"><span class="meta">@Repeatable(MapperScans.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨ä½¿ç”¨MapperScanä¸­ï¼Œæ‰«æåŒ…çš„è·¯å¾„ã€‚</span></span><br><span class="line">  <span class="comment">// å¡«å†™çš„æ˜¯ mapper æ¥å£æ‰€åœ¨åŒ…åï¼Œå¯¹è¯¥valueå€¼ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‰«æ</span></span><br><span class="line">  String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">  String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">  Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  Class&lt;? extends BeanNameGenerator&gt; nameGenerator() <span class="keyword">default</span> BeanNameGenerator.class;</span><br><span class="line">  Class&lt;? extends Annotation&gt; annotationClass() <span class="keyword">default</span> Annotation.class;</span><br><span class="line">  Class&lt;?&gt; markerInterface() <span class="keyword">default</span> Class.class;</span><br><span class="line">  <span class="function">String <span class="title">sqlSessionTemplateRef</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">  <span class="function">String <span class="title">sqlSessionFactoryRef</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">  Class&lt;? extends MapperFactoryBean&gt; factoryBean() <span class="keyword">default</span> MapperFactoryBean.class;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.thisforyou.core.blog.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println( <span class="string">&quot;Hello World!&quot;</span> );</span><br><span class="line">        SpringApplication.run(App.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨SpringBootä¸­ä½¿ç”¨mybatis,é‚£å®ƒçš„å…¥å£å°±åœ¨ @MapperScanä¸­ã€‚@MapperScanæ³¨è§£ï¼Œæ˜¯åœ¨SpringBootçš„å¯åŠ¨ç±»ä¸­ã€‚</p><p> @MapperScanä¸­æœ‰ä¸ª @Import æ³¨è§£ã€‚</p><h2 id="Import-æ³¨è§£ï¼Œå¯ä»¥åŠ è½½æŸä¸ªç±»ï¼Œæ”¾åˆ°Springçš„IOCä¸­ç®¡ç†"><a href="#Import-æ³¨è§£ï¼Œå¯ä»¥åŠ è½½æŸä¸ªç±»ï¼Œæ”¾åˆ°Springçš„IOCä¸­ç®¡ç†" class="headerlink" title="@Import æ³¨è§£ï¼Œå¯ä»¥åŠ è½½æŸä¸ªç±»ï¼Œæ”¾åˆ°Springçš„IOCä¸­ç®¡ç†"></a>@Import æ³¨è§£ï¼Œå¯ä»¥åŠ è½½æŸä¸ªç±»ï¼Œæ”¾åˆ°Springçš„IOCä¸­ç®¡ç†</h2><p>åœ¨Springä¸­ï¼Œè¦å°†Beanæ”¾åˆ°IOCå®¹å™¨ä¸­ç®¡ç†çš„è¯ï¼Œæœ‰å‡ ç§æ–¹å¼ã€‚</p><ul><li>@Import æ­¤ç§æ–¹æ³•</li><li>@Configuration ä¸ @Bean æ³¨è§£ç»“åˆä½¿ç”¨</li><li>@Controller @Service @Repository @Component </li><li>@ComponentScan æ‰«æã€‚</li><li>é‡å†™BeanFactoryPostProcessor çš„postProcessBeanFactory()æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®ç°Beançš„æ³¨å…¥</li></ul><h3 id="MapperScannerRegistrar"><a href="#MapperScannerRegistrar" class="headerlink" title="MapperScannerRegistrar"></a>MapperScannerRegistrar</h3><p>é€šè¿‡@Import æ³¨è§£ï¼Œå°†<code>MapperScannerRegistrar</code> æ³¨å…¥åˆ°äº†IOCå®¹å™¨ä¸­ï¼Œè€Œ<code>MapperScannerRegistrar</code>å®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼Œ<code>ImportBeanDefinitionRegistrar, ResourceLoaderAware</code></p><p><code>ImportBeanDefinitionRegistrar</code> åœ¨Springéœ€è¦é…åˆ@Imporä½¿ç”¨ï¼ŒåŠ è½½å®ƒçš„å®ç°ç±»ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸»è¦è´Ÿè´£Bean çš„åŠ¨æ€æ³¨å…¥çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å¯ä»¥æ‹¿åˆ° Springçš„æ³¨å†Œå¯¹è±¡ <code>BeanDefinitionRegistry</code> è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæä¾›äº†å¥½6ã€7ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanDefinitionRegistry</span> <span class="keyword">extends</span> <span class="title">AliasRegistry</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="comment">// æ³¨å†Œ BeanDefinition</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(String var1, BeanDefinition var2)</span> <span class="keyword">throws</span> BeanDefinitionStoreException</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç§»é™¤ BeanDefinition</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">removeBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®name è·å–ä¸€ä¸ª BeanDefinition</span></span><br><span class="line">        <span class="function">BeanDefinition <span class="title">getBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">containsBeanDefinition</span><span class="params">(String var1)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// BeanDefinition çš„é€‚é‡</span></span><br><span class="line">        String[] getBeanDefinitionNames();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">getBeanDefinitionCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ˜¯å¦ä½¿ç”¨ä¸­</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">isBeanNameInUse</span><span class="params">(String var1)</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>BeanDefinition:</strong>æ˜¯Springå¯¹Beanè§£æä¸ºï¼ŒSpringå†…éƒ¨çš„ <strong>BeanDefinition</strong> ç»“æ„ï¼Œæ˜¯å¯¹ç±»çš„æ•°æ®åŒ…è£…ï¼Œç±»å…¨é™å®šåï¼Œæ˜¯å¦æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¦æ˜¯æ‡’åŠ è½½çš„ï¼Œæ³¨å…¥æ–¹å¼æ˜¯ä»€ä¹ˆâ€¦</p><h4 id="registerBeanDefinitions-æ³¨å†Œæ–¹æ³•"><a href="#registerBeanDefinitions-æ³¨å†Œæ–¹æ³•" class="headerlink" title="registerBeanDefinitions æ³¨å†Œæ–¹æ³•"></a>registerBeanDefinitions æ³¨å†Œæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, org.springframework.beans.factory.support.BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‹¿åˆ°æ³¨è§£ï¼Œç›®çš„æ˜¯æ‹¿åˆ°æ³¨è§£é‡Œçš„å±æ€§å€¼ï¼Œæ‹¿åˆ°å€¼åè¿›è¡Œæ‰«æï¼Œå¹¶ä¸”å¯¹ç»“æœè¿›è¡Œä¸€ä¸ªè½¬æ¢ AnnotationAttributes</span></span><br><span class="line">        AnnotationAttributes mapperScanAttrs = AnnotationAttributes</span><br><span class="line">                .fromMap(importingClassMetadata.getAnnotationAttributes(MapperScan.class.getName()));</span><br><span class="line">        <span class="keyword">if</span> (mapperScanAttrs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            registerBeanDefinitions(mapperScanAttrs, registry);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹ MapperScan çš„å±æ€§å€¼è¿›è¡Œä¸€ä¸ªè§£æå¤„ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> annoAttrs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * ğŸŒŸ</span></span><br><span class="line"><span class="comment">         * è¿™æ˜¯Mybatisçš„ä¸€ä¸ªæ‰«æå™¨</span></span><br><span class="line"><span class="comment">         * ä¹Ÿæ˜¯ ç»§æ‰¿äº† Springçš„æ‰«æå™¨ ClassPathBeanDefinitionScanner</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ClassPathMapperScanner scanner = <span class="keyword">new</span> ClassPathMapperScanner(registry);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// this check is needed in Spring 3.1</span></span><br><span class="line">        Optional.ofNullable(resourceLoader).ifPresent(scanner::setResourceLoader);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ........</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  è¯»å–åŒ…mapperåŒ…ä¸‹çš„è·¯å¾„ å’Œ è¦æ‰«æçš„ä¸€ç»„ mapper.class</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;String&gt; basePackages = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        basePackages.addAll(</span><br><span class="line">                Arrays.stream(annoAttrs.getStringArray(<span class="string">&quot;value&quot;</span>))</span><br><span class="line">                        .filter(StringUtils::hasText)</span><br><span class="line">                        .collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        basePackages.addAll(</span><br><span class="line">                Arrays.stream(annoAttrs.getStringArray(<span class="string">&quot;basePackages&quot;</span>))</span><br><span class="line">                        .filter(StringUtils::hasText)</span><br><span class="line">                        .collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        basePackages.addAll(</span><br><span class="line">                Arrays.stream(annoAttrs.getClassArray(<span class="string">&quot;basePackageClasses&quot;</span>))</span><br><span class="line">                        .map(ClassUtils::getPackageName)</span><br><span class="line">                        .collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸŒŸè¿™æ˜¯è‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼Œä¸Springçš„é»˜è®¤æœºåˆ¶ä¸åŒ</span></span><br><span class="line">        scanner.registerFilters();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ğŸŒŸè°ƒç”¨æ‰«æå™¨ å¯¹åŒ…è·¯å¾„è¿›è¡Œæ‰«æ</span></span><br><span class="line">        scanner.doScan(StringUtils.toStringArray(basePackages));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰«æå™¨-ClassPathMapperScanner"><a href="#æ‰«æå™¨-ClassPathMapperScanner" class="headerlink" title="æ‰«æå™¨ ClassPathMapperScanner"></a>æ‰«æå™¨ ClassPathMapperScanner</h3><p>classPathMapperScanner æ˜¯mybatisçš„ä¸€ä¸ªç±»ï¼Œç»§æ‰¿äº† ClassPathBeanDefinitionScannerï¼Œé‡å†™äº†doScanæ–¹æ³•ï¼›ç„¶åä¹Ÿè°ƒç”¨äº† å®ƒçš„çš„æ‰«ææ–¹æ³•ã€‚å¹¶ä¸”å®šä¹‰äº†æ‰«æè§„åˆ™ï¼Œè¿˜æœ‰ä¸€äº›Beançš„è¿‡æ»¤ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªåŒ…ä¸‹ï¼Œä¸å•å•æœ‰ mapper æ¥å£çš„ç±»ï¼Œæˆ‘ä»¬çš„@MapperScanä¸»è¦å¤„ç†çš„æ˜¯ mapper æ¥å£ï¼Œæ‰€ä»¥å°†å…¶æ’é™¤:</p><p>æ’é™¤æ‰éæ¥å£çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isCandidateComponent</span><span class="params">(AnnotatedBeanDefinition beanDefinition)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> beanDefinition.getMetadata().isInterface() &amp;&amp; beanDefinition.getMetadata().isIndependent();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰«æå™¨-ClassPathMapperScanner-çš„doScanæ–¹æ³•"><a href="#æ‰«æå™¨-ClassPathMapperScanner-çš„doScanæ–¹æ³•" class="headerlink" title="æ‰«æå™¨ ClassPathMapperScanner çš„doScanæ–¹æ³•"></a>æ‰«æå™¨ ClassPathMapperScanner çš„doScanæ–¹æ³•</h4><p>é‡å†™äº†çˆ¶ç±»çš„doScanæ–¹æ³•ï¼Œå¹¶ä¸”ä¹Ÿè°ƒç”¨äº†å®ƒçš„æ–¹æ³•ï¼Œé€šè¿‡çˆ¶ç±»çš„æ‰«æç»“æœï¼Œå°±å°† è¯¥åŒ…ä¸‹çš„æ‰€æœ‰ Mapperæ¥å£ï¼Œè§£ææˆäº† BeanDefinitionHolderï¼Œæ”¾åˆ°äº† seté›†åˆä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title">doScan</span><span class="params">(String... basePackages)</span> </span>&#123;</span><br><span class="line">  Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="keyword">super</span>.doScan(basePackages);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (beanDefinitions.isEmpty()) &#123;</span><br><span class="line">    LOGGER.warn(() -&gt; <span class="string">&quot;No MyBatis mapper was found in &#x27;&quot;</span> + Arrays.toString(basePackages) + <span class="string">&quot;&#x27; package. Please check your configuration.&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¯¹æ‰«æç»“æœè¿›è¡Œå¤„ç†ï¼Œå¦‚æœä¸å¤„ç†çš„è¯ï¼Œè¿™ä¸ªæ¥å£å°±å½“ä½œäº†</span></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªæ™®é€šçš„Beanæ³¨å…¥IOCäº†ï¼Œåœ¨å¼•å…¥è°ƒç”¨ï¼Œå°±ä¼šå‡ºç°é”™è¯¯äº†ã€‚</span></span><br><span class="line">    processBeanDefinitions(beanDefinitions);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>BeanDefinitionHolderï¼š</strong>æ˜¯<strong>BeanDefinition</strong>çš„æŒæœ‰è€…ï¼ŒåŒ…å«äº†Be naçš„ åå­—ï¼Œå’ŒBeançš„åˆ«åï¼Œä¹ŸåŒ…å«äº†BeanDefinitionã€‚</p><h4 id="processBeanDefinitions-å¤„ç†BeanDefinitionçš„BeanClass"><a href="#processBeanDefinitions-å¤„ç†BeanDefinitionçš„BeanClass" class="headerlink" title="processBeanDefinitions å¤„ç†BeanDefinitionçš„BeanClass"></a>processBeanDefinitions å¤„ç†BeanDefinitionçš„BeanClass</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processBeanDefinitions</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; beanDefinitions)</span> </span>&#123;</span><br><span class="line">    GenericBeanDefinition definition;</span><br><span class="line">    <span class="comment">// å¾ªç¯éå†ï¼Œä¸€ä¸ªä¸ªä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">for</span> (BeanDefinitionHolder holder : beanDefinitions) &#123;</span><br><span class="line">      definition = (GenericBeanDefinition) holder.getBeanDefinition();</span><br><span class="line">      String beanClassName = definition.getBeanClassName();</span><br><span class="line">      </span><br><span class="line">      definition.getConstructorArgumentValues().addGenericArgumentValue(beanClassName); </span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å…³é”®æ­¥éª¤ï¼š è¿™å°† GenericBeanDefinition çš„BeanClass ä¿®æ”¹æˆäº†mapperFactoryBeanClassï¼›</span></span><br><span class="line">      <span class="comment">// æ‰«æç»“æœ è¿™ä¸ªbeanClass å°±æ˜¯ mapper.class</span></span><br><span class="line">      definition.setBeanClass(<span class="keyword">this</span>.mapperFactoryBeanClass);</span><br><span class="line"></span><br><span class="line">      definition.getPropertyValues().add(<span class="string">&quot;addToConfig&quot;</span>, <span class="keyword">this</span>.addToConfig);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// .........</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“Spring ä¸­æœ‰ä¸¤ç§Bean,ä¸€ç§æ˜¯ æ™®é€šçš„Bean,å¦ä¸€ç§å°±æ˜¯ <code>FactoryBean</code>ï¼Œå¦‚æœæ˜¯<code>FactoryBean</code>åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨å®ƒçš„ getObjectæ–¹æ³•è·å–å¯¹è±¡ã€‚</p><p><code>FactoryBean</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼šmybatisçš„ <code>MapperFactoryBean</code> å®ç°äº†å®ƒï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FactoryBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–å¯¹åƒ</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function">T <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç±»å‹</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Class&lt;?&gt; getObjectType();</span><br><span class="line">  <span class="comment">// é»˜è®¤æ˜¯å•ä¾‹Bean</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>MapperFactoryBeanï¼š</strong></p><p>MapperFactoryBean æœ‰ä¸¤ä¸ªå±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Class&lt;T&gt; mapperInterface;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ˜¯mapperæ¥å£çš„class,çœ‹å®ƒé‡å†™çš„getObject()æ–¹æ³•ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getSqlSession().getMapper(<span class="keyword">this</span>.mapperInterface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ç”±å®ƒçš„<code>SqlSession</code>çš„å…·ä½“ç±»å»è°ƒç”¨ å…¨å±€çš„é…ç½®æ–‡ä»¶ Configuration å¯¹è±¡ä¸­çš„ä¸€ä¸ªMapperRegisterå¯¹è±¡çš„ä¸€ä¸ªgetMapperæ–¹æ³•ï¼Œç„¶åæ ¹æ®classä» MapperRegister ä¸­çš„å±æ€§Map -&gt; knownMappers æ‹¿åˆ° MapperProxyFactoryä»£ç†å·¥å‚ï¼Œé€šè¿‡newInstanceæ–¹æ³•ä»£ç†ç”Ÿæˆå¯¹åƒï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperProxyFactory</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Method, MapperMethod&gt; methodCache = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ........</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// --------</span></span><br><span class="line">  <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> T <span class="title">newInstance</span><span class="params">(MapperProxy&lt;T&gt; mapperProxy)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), <span class="keyword">new</span> Class[] &#123; mapperInterface &#125;, mapperProxy);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> MapperProxy&lt;T&gt; mapperProxy = <span class="keyword">new</span> MapperProxy&lt;&gt;(sqlSession, mapperInterface, methodCache);</span><br><span class="line">    <span class="keyword">return</span> newInstance(mapperProxy);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±å®Œæˆäº†ä¸€ä¸ªå¯¹ mapperæ¥å£çš„å¤„ç†ã€‚</p><p>åœ¨myBatisçš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šå°†æ‰«æçš„mapperä¿¡æ¯è¿›è¡Œå°è£…ï¼Œæ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šåœ¨ Configuration ä¸­ï¼›</p><p>æ¯”å¦‚ï¼šä¸€ä¸ª mapper æ¥å£ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.thisforyou.blog.core.mapper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PayMapper</span></span>&#123;</span><br><span class="line">  pay(String outNo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> å¯¹æ¥å£è¿›è¡Œè§£æï¼Œæ‹¿åˆ°  Class: PayMapper.class</p><p>ç„¶å è°ƒç”¨ MapperRegistryçš„ addMapperæ–¹æ³• åŒ…è£…æˆä¸€ä¸ªä»£ç†å¯¹åƒ MapperProxyFactory</p><p>æ”¾åˆ°mapä¸­ï¼Œå°±æ˜¯ key-&gt; PayMapper.class,vaue:new MapperProxyFactory(class)ï¼›</p><p>åœ¨æ³¨å…¥çš„æ—¶å€™ï¼Œå°±ä¼šgetObect()æ–¹æ³•ï¼Œæœ€åå°±è°ƒç”¨äº†MapperProxyFactory.newInstanceç”Ÿæˆä»£ç†å¯¹åƒã€‚</p><p>MapperRegistry åœ¨ Configurationå¯¹è±¡ä¸­ï¼›</p><p><strong>æœ€åï¼šmapperçš„@Autowired æ³¨å…¥çš„å…¶å®å°±æ˜¯ <code>MapperFactoryBean</code> é€šè¿‡å®ƒçš„getObjectæ–¹æ³•ï¼Œä»£ç†ç”Ÿæˆæ¥å£å¯¹è±¡ã€‚</strong></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><ol><li><p>Mybatis çš„mapperæ¥å£ï¼Œæ˜¯æ€ä¹ˆè¢«æ‰«æçš„ï¼Ÿ</p><p>Mybatis é€šè¿‡æ³¨è§£@MapperScan ä¸‹çš„@Importæ³¨è§£åŠ è½½ï¼Œ<code>MapperScannerRegistrar</code>ç±»ï¼Œæ­¤ç±»ç»§æ‰¿äº†<code>ImportBeanDefinitionRegistrar</code>ç±»,å¯¹beançš„æ³¨å†Œå¤„ç†ï¼Œåœ¨æ³¨å†Œä¹‹å‰ ä¼šæ‹¿åˆ° @MapperScan çš„ å‚æ•°å€¼ï¼Œmapper åŒ…è·¯å¾„ï¼Œç„¶åè°ƒç”¨<code>new ClassPathMapperScanner(registry)</code> ç±»å»æ‰«æï¼Œ<code>ClassPathMapperScanner extends ClassPathBeanDefinitionScanner</code>,é‡å†™doScanæ–¹æ³•ï¼Œå®šä¹‰æ‰«æè§„åˆ™ï¼Œå¯¹æ‰«æç»“æœè¿›è¡Œæ›´æ”¹ BeanDefinition  çš„beanClass è¿›è¡Œæ›¿æ¢æˆ <code>MapperFactoryBeanClass</code>;</p></li><li><p>mapperæ¥å£æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨@Autowiredæ³¨å…¥ï¼Ÿ</p><p>mapperæ¥å£æ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œæ˜¯é€šè¿‡ FactoryBean çš„æ–¹å¼æ³¨å…¥åˆ° IOC ä¸­ï¼Œé€šè¿‡è°ƒç”¨getObjectæ–¹æ³•ç”Ÿæˆä»£ç†å¯¹åƒ @Autowiredçš„ï¼›</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¯¹äºæˆ‘ä»¬ java æ¥è¯´ï¼Œæ¥å£æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–çš„ã€‚è€Œä¸”æ¥å£çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯publicçš„ã€‚&lt;/p&gt;
&lt;p&gt;å¯æ˜¯ä¸ºä»€ä¹ˆ Mybaits çš„mapper æ¥å£ï¼Œå¯ä»¥ç›´æ¥ @Autowired æ³¨å…¥ ä½¿ç”¨ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çœ‹çœ‹Mybatis æ˜¯å¦‚ä½•åšçš„ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäºSpringBoot çš„ @MapperScan æ³¨è§£å…¥æ‰‹ï¼Œåˆ†æã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="mybatis" scheme="http://lyj08.gitee.io/categories/mybatis/"/>
    
    
      <category term="mybatis" scheme="http://lyj08.gitee.io/tags/mybatis/"/>
    
  </entry>
  
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ ï¼Œgitlab-ci&amp;gitlab-runner,å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œä¸ä¼šä¸è¦é’±ï¼Œä¼šä¹Ÿä¸è¦é’±ã€‚</title>
    <link href="http://lyj08.gitee.io/posts/86deff97/"/>
    <id>http://lyj08.gitee.io/posts/86deff97/</id>
    <published>2020-02-28T20:17:00.000Z</published>
    <updated>2020-12-30T09:26:39.907Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Gitlab-ci å¯ä»¥ç®€åŒ–çš„é¡¹ç›®éƒ¨ç½²æ“ä½œï¼Œè®²ç©¶è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚åªéœ€è¦åŠ¨åŠ¨æ‰‹æŒ‡ï¼Œåœ¨ä½ çš„ç»ˆç«¯æ•²ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &#x27;update&#x27; </span><br></pre></td></tr></table></figure><p>å³å¯æ›´æ–°ä»“åº“ä»£ç å¹¶ä¸”ç›´æ¥å‘å¸ƒåˆ°çº¿ä¸Šå»ã€‚</p><h1 id="1ã€æœ¬æœºç¯å¢ƒ"><a href="#1ã€æœ¬æœºç¯å¢ƒ" class="headerlink" title="1ã€æœ¬æœºç¯å¢ƒ"></a>1ã€æœ¬æœºç¯å¢ƒ</h1><ol><li><p>Centos 7</p></li><li><p>Docker version 19.03.5</p></li><li><p>Gitlab-ce  â€“version lastest æœ€æ–°</p></li><li><p>Nginx ç‰ˆæœ¬ä¸é‡è¦</p></li><li><p>Gitlab-runner version 12.8</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/gitci1.png" alt="gitci1"></p></li></ol><p>é™¤æ­¤ä¹‹å¤–ï¼šè¿˜éœ€è¦åœ¨éƒ¨ç½²çš„æœåŠ¡ä¸Šï¼Œå¤„ç†å¥½ å…å¯†ç ç™»é™†ã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè‡ªç„¶ä¸éœ€è¦æ‰‹åŠ¨æ“ã€‚åšå¥½å…å¯†ç™»é™†ï¼Œå°±å¯ä»¥å°†æ‰“åŒ…çš„distæ–‡ä»¶å¤¹ scp åˆ°æœåŠ¡å™¨ä¸Šçš„nginx æŒ‡å®šè·¯å¾„ï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚</p><a id="more"></a><h1 id="2ã€å®‰è£…è¯´æ˜"><a href="#2ã€å®‰è£…è¯´æ˜" class="headerlink" title="2ã€å®‰è£…è¯´æ˜"></a>2ã€å®‰è£…è¯´æ˜</h1><h3 id="2-1-nginx-é…ç½®"><a href="#2-1-nginx-é…ç½®" class="headerlink" title="2.1 nginx é…ç½®"></a>2.1 nginx é…ç½®</h3><p>nginx å®‰è£…è¿‡ç¨‹ä¹Ÿç•¥è¿‡ã€‚vim nginx.conf,è¿›è¡Œä¿®æ”¹ã€‚</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/gitlab12.png" alt="gitlab12"></p><p>Nginx é…ç½®è·¯å¾„,è½¬å‘ï¼›ç„¶å éƒ¨ç½²è„šæœ¬ è¦å°† æ‰“åŒ…å¥½çš„dist æ–‡ä»¶å¤¹ï¼Œå¤åˆ¶åˆ°éƒ¨ç½²çš„æœåŠ¡å™¨ä¸Š<code>/opt/project/web/</code>æ­¤æ–‡ä»¶å¤¹ä¸‹ã€‚</p><p><code>nginx -s reload</code></p><h3 id="2-2-éƒ¨ç½²çš„æœåŠ¡å™¨è¦åšssh-å…å¯†ç ç™»é™†"><a href="#2-2-éƒ¨ç½²çš„æœåŠ¡å™¨è¦åšssh-å…å¯†ç ç™»é™†" class="headerlink" title="2.2 éƒ¨ç½²çš„æœåŠ¡å™¨è¦åšssh å…å¯†ç ç™»é™†"></a>2.2 éƒ¨ç½²çš„æœåŠ¡å™¨è¦åšssh å…å¯†ç ç™»é™†</h3><ol><li><p>ç™»é™† è¦å°†é¡¹ç›®å‘å¸ƒçš„æœåŠ¡å™¨ä¸Šã€‚</p></li><li><p>è·Ÿç›®å½•ä¸‹å¤„ç†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s sh-keygen -t rsa</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å…¥åä¸€ç›´å›è½¦ é»˜è®¤æ“ä½œå³å¯ï¼Œä¸åŠ å¯†ï¼Œä¸æ”¹å˜ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®</span></span><br></pre></td></tr></table></figure><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/ssh2.png" alt=""></p></li><li><p>æ‹·è´å…¬é’¥åˆ°è®¤è¯æ–‡ä»¶-å‘½ä»¤ï¼šcat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/ssh3.png" alt="ssh3"></p></li><li><p>Ssh localhost çœ‹çœ‹æœ‰æ²¡æœ‰æˆåŠŸ</p></li><li><p>ssh-copy-id root@éƒ¨ç½²çš„æœåŠ¡å™¨ip</p><p>æ­¤å¤„æˆ‘æ˜¯éƒ¨ç½²ç¯å¢ƒï¼Œå’Œ gitlab-runner ç¯å¢ƒåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸¤å°ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹æœ‰å³å¯é…ç½®å¯ä»¥ã€‚</p></li></ol><p>   scp çš„æ—¶å€™ æˆ‘å†™çš„æ˜¯ 122ç«¯å£ï¼Œè¿™æ˜¯æˆ‘çš„ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰æ”¹è¿‡ï¼Œé»˜è®¤æ˜¯22 </p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id root@thisforyou.cn </span><br></pre></td></tr></table></figure><h2 id="2-3-åœ¨è‡ªå·±çš„gitlabä»“åº“ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¾‹å¦‚æœ¬æœºæµ‹è¯•çš„ã€‚"><a href="#2-3-åœ¨è‡ªå·±çš„gitlabä»“åº“ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¾‹å¦‚æœ¬æœºæµ‹è¯•çš„ã€‚" class="headerlink" title="2.3 åœ¨è‡ªå·±çš„gitlabä»“åº“ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¾‹å¦‚æœ¬æœºæµ‹è¯•çš„ã€‚"></a>2.3 åœ¨è‡ªå·±çš„gitlabä»“åº“ä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä¾‹å¦‚æœ¬æœºæµ‹è¯•çš„ã€‚</h2><p> <strong>ä»“åº“ï¼š</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab2.png" alt="gitlab2"></p><p><strong>çº¿ä¸‹ç¯å¢ƒï¼š</strong></p><p><img src="/Users/yongjian/Downloads/gitlab3.png" alt="gitlab3"></p><h2 id="2-3-ç¯å¢ƒå®‰è£…"><a href="#2-3-ç¯å¢ƒå®‰è£…" class="headerlink" title="2.3 ç¯å¢ƒå®‰è£…"></a>2.3 ç¯å¢ƒå®‰è£…</h2><p><strong>æœ¬æ–‡é‡ç‚¹åœ¨äº</strong> <strong>gitlab-runnnerçš„é›†æˆè‡ªåŠ¨åŒ–éƒ¨ç½²</strong>ï¼Œæ‰€ä»¥dockerçš„å®‰è£…ï¼Œgitlabçš„å®‰è£…ï¼Œnginx  çš„å®‰è£…è¿‡ç¨‹è·³è¿‡ã€‚</p><p>å½“ä½ çœ‹åˆ°æ­¤æ–‡çš„æ—¶å€™ï¼Œè¿™äº›ç¯å¢ƒç›¸ä¿¡ä½ ä¹Ÿåº”è¯¥æœ‰äº†ã€‚ä¸»è¦æ˜¯ gitlab-runnerçš„é…ç½®é—®é¢˜ã€‚</p><h3 id="2-21-åŸºäºDockerå®‰è£…-gitlab-runner"><a href="#2-21-åŸºäºDockerå®‰è£…-gitlab-runner" class="headerlink" title="2.21 åŸºäºDockerå®‰è£…  gitlab-runner"></a>2.21 åŸºäºDockerå®‰è£…  gitlab-runner</h3><p><strong>1ã€å®‰è£…</strong></p><p>ç›®å‰æˆ‘å®‰è£…çš„æ—¶å€™æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼š</p><p>ç‰ˆæœ¬é€‰æ‹©ï¼Œ<a href="https://hub.docker.com/r/gitlab/gitlab-runner">ç§»æ­¥â€”&gt;</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull gitlab&#x2F;gitlab-runner</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å‘½ä»¤ï¼š æˆ‘è¿™æ˜¯ä¸€ä¸ªè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path=/usr/local/software/docker/gitlab-runner</span><br><span class="line">docker stop gitlab-runner &amp;&amp; docker rm gitlab-runner</span><br><span class="line">docker run -d --name gitlab-runner \</span><br><span class="line"> --restart always \</span><br><span class="line"> -v /usr/local/software/docker/gitlab-runner/config/gitlab-runner:/etc/gitlab-runner \</span><br><span class="line"> 430012f3776d</span><br></pre></td></tr></table></figure><ul><li>-v:å°†é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Š </li><li>430012f3776d: é•œåƒID</li></ul><p>å¯åŠ¨æˆåŠŸåï¼Œå¦‚æœ <code>/usr/local/software/docker/gitlab-runner/config/gitlab-runner</code> ä¸‹æ²¡æœ‰ é…ç½®æ–‡ä»¶ <code>config.toml</code> æ–‡ä»¶çš„è¯ã€‚</p><p>å…ˆåœæ‰  <code>docker stop gitlab-runner &amp;&amp; docker rm gitlab-runner</code> </p><p>ç›´æ¥æ‰§è¡Œï¼š <code>docker run -d gitlab-runner  430012f3776d</code></p><p>ç„¶åå°†å®¹å™¨ä¸­çš„æ•°æ®å¤åˆ¶å‡ºæ¥ï¼š<code>docker cp gitlab-runner /etc/gitlab-runner :/usr/local/software/docker/gitlab-runner/config</code></p><p>å†æ¬¡ æ‰§è¡Œå¯åŠ¨è„šæœ¬ã€‚</p><p>æˆ–è€…ç­‰ä¼šï¼Œåˆ°æ³¨å†Œçš„é‚£ä¸€æ­¥ä¹Ÿä¼šç”Ÿæˆçš„ã€‚</p><p><strong>2ã€å…ˆåˆ°ä»“åº“æ‹¿åˆ°Token</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab4.png" alt="gitlab4"></p><p><strong>3ã€æ³¨å†Œ</strong></p><p>è¿›å…¥å®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it gitlab-runner bash</span><br></pre></td></tr></table></figure><p>è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner register</span><br></pre></td></tr></table></figure><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab5.png" alt="gitlab5"></p><ul><li><p>Please enter the gitlab-ci coordinator URL (e.g. <a href="https://gitlab.com/">https://gitlab.com/</a>): è¾“å…¥ä½ çš„gi tlabè®¿é—®åœ°å€ï¼Œä¸Šä¸€æ­¥æœ‰è¯´åˆ°</p></li><li><p>Please enter the gitlab-ci token for this runner: è®¿é—®token,å¦‚ä½•è·å–ä¸Šä¸€æ­¥æœ‰è¯´åˆ°</p></li><li><p>Please enter the gitlab-ci description for this runner: è¾“å…¥æè¿°ï¼Œè‡ªå®šä¹‰</p></li><li><p>Please enter the gitlab-ci tags for this runner (comma separated): tags,åœ¨åé¢å†™è„šæœ¬çš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼Œè¯·å…ˆå†™ä¸Šï¼Œæˆ‘æ­¤å¤„åˆ†ä¸¤ä¸ªï¼Œæ˜¯åœ¨å†™è„šæœ¬çš„æ—¶å€™ï¼Œä¹Ÿåˆ†æ¥ä¸ª job æ¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿå¯¹åº”ä¸¤ä¸ªã€‚éå¿…è¦çš„ï¼Œgitlabä»“åº“ä¸Šå¯ä»¥è®¾ç½®ï¼Œæ˜¯ä¸æ˜¯è¦å¡«å†™ï¼Œtagsæ ‡ç­¾ä¸Šè¿è¡Œã€‚æ˜¯å¯ä»¥é™åˆ¶</p></li><li><p>Please enter the executor: docker+machine, custom, docker, virtualbox, ssh, docker-ssh+machine, kubernetes, docker-ssh, parallels, shell:</p><p>è¿™é‡Œæ¯”è¾ƒé‡è¦ï¼Œåšjavaå¼€å‘çš„ï¼Œä¸»è¦è¿˜æ˜¯ä½¿ç”¨ sshã€shellã€Dockerå¤šï¼Œè‡³äºå…¶å®ƒé‚£äº›ä¸ªæš‚ä¸æã€‚</p><p>æ­¤å¤„æ„å»ºçš„æ˜¯ï¼Œvueé¡¹ç›®ï¼Œvueé¡¹ç›®æ‰€éœ€çš„æ˜¯ node ç¯å¢ƒã€‚å› ä¸ºè¿™ä¸ª gitlab-runneræ˜¯åŸºäºDockerå®‰è£…çš„ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼Œä½ çš„æœåŠ¡å™¨ä¸Šçš„ node , git éƒ½æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œå¦‚æœæ­¤æ—¶ï¼Œé€‰æ‹©çš„æ˜¯ shell æˆ–è€… ssh,çš„è¯ï¼Œåè¾¹å†™æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ <code>npm run build</code> å°±ä¼šæŠ¥ npm not found,å› ä¸ºæˆ‘çš„gitlab-runneræ˜¯Dockerè£…çš„ï¼Œæ‰€ä»¥æ²¡æœ‰é›†æˆï¼Œå…¶å®ƒç¯å¢ƒã€‚æ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒ ä¸º Docker ,å¯ä»¥å¾ˆå¥½çš„ç®¡ç†ä¾èµ–ï¼Œä¹Ÿå¯ä»¥è‡ªå·±åšä¸€ä¸ªé•œåƒï¼Œå°†æ‰€éœ€ä¾èµ–æ”¾ä¸€èµ·ã€‚</p><p><a href="http://s0docs0gitlab0com.icopy.site/runner/executors/README.html">ä¸­æ–‡å®˜ç½‘è¯´æ˜</a></p></li><li><p>Please enter the default Docker image (e.g. ruby:2.6):  é€‰æ‹©äº†Docker æ‰§è¡Œï¼Œé‚£å°±éœ€è¦å†™ä¸Š éœ€è¦çš„docker é•œåƒï¼Œæ­¤å¤„éœ€è¦nodeç¯å¢ƒï¼Œå°±ç›´æ¥å¡«å†™ï¼šnode å³å¯ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šç‰ˆæœ¬å¥½ã€‚æ­¤å¤„ä¹Ÿå¯ä»¥é€šè¿‡ï¼Œè‡ªå·±å†™ä¸€ä¸ªDockerfileï¼Œåˆ¶ä½œä¸€ä¸ªå®¹å™¨ã€‚å°†ç¯å¢ƒä¾èµ–éƒ½å†™ä¸ŠDockerfileé‡Œã€‚ </p></li></ul><p><strong>4ã€æ­¤æ—¶æ˜¯å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼Œå›åˆ°gitlabä»“åº“çœ‹çœ‹</strong></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab6.png" alt="gitlab6"></p><p>å·²ç»æˆåŠŸäº†ã€‚è¿™é‡Œç‚¹å‡»è¿›å»å¯ä»¥ä¿®æ”¹ä¸€äº›å±æ€§æ“ä½œ</p><p><strong>5ã€ç¼–å†™è„šæœ¬</strong></p><p>ç¼–å†™è„šæœ¬è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ç¼–å†™ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹ä¸æ˜ç™½å…ˆä¸è¦ç´§ï¼Œå…ˆçœ‹æ˜ç™½å®ƒçš„å…³ç³»å…ˆ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ymlæ ¼å¼ç¼–å†™</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># stagesï¼šé€šä¿—è®²ï¼šå°±æ˜¯å°†é¡¹ç›®ï¼Œä»æ‰“åŒ…éƒ¨ç½²ï¼Œåˆ†å‡ ä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œå°±åˆ†ä¸¤ä¸ªæ­¥éª¤ï¼Œä¸€ä¸ª build,æ‰“åŒ…ç¼–è¯‘ï¼Œ deployï¼šéƒ¨ç½²</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å¦‚æœæœ‰æ›´å¤šæ­¥éª¤å°±å†™ä¸Šï¼Œæ¯”å¦‚ å…ˆ clean build test deploy ï¼›å¦‚Javaçš„é¡¹ç›®ï¼š å…ˆ mvn clean , mvn test ,mvn package</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> image: node <span class="comment"># å°±æ˜¯æ‰€ä¾èµ–çš„ç¯å¢ƒ åœ¨ gitrunner-cliæ³¨å†Œçš„æ—¶å€™ï¼Œå·²ç»å†™äº†æ­¤å¤„å¯ä»¥çœç•¥ä¸å†™</span></span></span><br><span class="line">stages:</span><br><span class="line">    - build    </span><br><span class="line">    - deploy</span><br><span class="line">    </span><br><span class="line">before_script:</span><br><span class="line">  - &#x27;which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )&#x27;</span><br><span class="line">  - eval $(ssh-agent -s)</span><br><span class="line">  - ssh-add &lt;(echo &quot;$SSH_KEY&quot;)</span><br><span class="line">  - mkdir -p ~/.ssh</span><br><span class="line">  - &#x27;[[ -f /.dockerenv ]] &amp;&amp; echo -e &quot;Host *\n\tStrictHostKeyChecking no\n\n&quot; &gt; ~/.ssh/config&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash"> ç¬¬ä¸€æ­¥æ‰“åŒ…ï¼Œ</span> </span><br><span class="line">   build: # build:è¿™ä¸ªåç§°è‡ªå®šä¹‰</span><br><span class="line">     stage: buil  # è¿™ä¸€ä¸ªstageï¼šçš„å€¼å°±æ˜¯ä¸Šé¢çš„ stagesä¸‹çš„ç¬¬ä¸€ä¸ª build</span><br><span class="line">     tags: # tag åœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œæœ‰æåˆ°è¿‡ï¼Œåˆ†ä¸¤æ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯ buil,æ‰€ä»¥è¿™é‡Œä¹Ÿå¯¹åº”ä¸Šï¼Œæ³¨å†Œçš„æ—¶å€™æ˜¯è‡ªå®šä¹‰çš„åç§°</span><br><span class="line">      - buil</span><br><span class="line">     script: # è¿™ä¸ªå°±æ˜¯ æ“ä½œå‘½ä»¤ æˆ–è€…å†™è„šæœ¬è·¯å¾„</span><br><span class="line">      - npm install -g cnpm --registry=https://registry.npm.taobao.org # åˆ‡æ¢cnpm æå‡é€Ÿåº¦</span><br><span class="line">      - echo `pwd` # æˆ‘åªæ˜¯è¾“å‡ºä¸‹è§‚å¯Ÿå†™è·¯å¾„</span><br><span class="line">      - cnpm install  # å®‰è£… nodemodus</span><br><span class="line">      - cnpm run build  # æ‰“åŒ…ç”Ÿæˆ dist æ–‡ä»¶å¤¹</span><br><span class="line">   </span><br><span class="line"><span class="meta"> #</span><span class="bash"> ç¼“å­˜ï¼Œå› ä¸ºæ˜¯å®¹å™¨æ‰§è¡Œï¼Œæ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šé‡æ–°æ‰“åŒ…ï¼Œç¼“å­˜èµ·æ¥å°±ä¸éœ€è¦å®‰è£…ä¸€æ¬¡</span>  </span><br><span class="line">cache:</span><br><span class="line">  paths:</span><br><span class="line">   - node_modules/</span><br><span class="line">   - dist/</span><br><span class="line">   </span><br><span class="line"><span class="meta">   #</span><span class="bash"> ç¬¬äºŒä¸ªä»»åŠ¡ å°±æ˜¯ ä¸“ä¸šè¯è¯­ job ,ç¬¬ä¸€ä¸ªæ˜¯å…ˆ build ,è¿™ä¸ªè·Ÿä¸Šé¢çš„buildä¸€æ ·åç§°è‡ªå®šä¹‰</span></span><br><span class="line">   deploy:</span><br><span class="line">     stage: deploy  # è¿™ä¸€ä¸ªstageï¼šçš„å€¼å°±æ˜¯ä¸Šé¢çš„ stagesä¸‹çš„ç¬¬ä¸€ä¸ª deploy</span><br><span class="line">     tags:</span><br><span class="line">       - deploy # tag åœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œæœ‰æåˆ°è¿‡ï¼Œåˆ†ä¸¤æ­¥éª¤ï¼Œç¬¬äºŒä¸ªä¸ªæ˜¯ deploy,æ‰€ä»¥è¿™é‡Œä¹Ÿå¯¹åº”ä¸Šï¼Œæ³¨å†Œçš„æ—¶å€™æ˜¯è‡ªå®šä¹‰çš„åç§°</span><br><span class="line">     script:</span><br><span class="line">      - pwd #  ä¹Ÿè¾“å‡ºä¸‹è·¯å¾„</span><br><span class="line">      - mv dist vue-ci # ä¿®æ”¹æ–‡ä»¶å¤¹åå­—ï¼Œå¯¹åº”ä¸Šnginx é…ç½®çš„ è·¯å¾„åå­—ï¼Œä¸ç„¶nginx æ— æ³•æ­£ç¡®è½¬å‘ </span><br><span class="line">      - scp -R 122 -r /dist/ root@thisforyou.cn:/opt/project  # å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶ä¸Šåˆ°å‘å¸ƒé¡¹ç›®çš„æœåŠ¡å™¨ä¸­çš„ã€‚æ”¾åˆ°nginxèƒ½è®¿é—®åˆ°çš„æ–‡ä»¶å¤¹ä¸‹</span><br><span class="line">      #  æˆ‘å†™çš„æ˜¯ 122ç«¯å£ï¼Œè¿™æ˜¯æˆ‘çš„ç«¯å£ï¼Œå¦‚æœæ²¡æœ‰æ”¹è¿‡ï¼Œé»˜è®¤æ˜¯22  ,scp ä¸éœ€è¦ å†™ `â€”R 122`</span><br></pre></td></tr></table></figure><p>è„šæœ¬å†™å¥½äº†ï¼Œå°±å°†æ­¤æ–‡ä»¶æ›´æ–°åˆ°gitlabçš„ä»“åº“ä¸Šå»å§ï¼Œgit pushä¹‹åï¼Œå°±ä¼šæ‰§è¡Œæ­¤è„šæœ¬æ–‡ä»¶äº†ï¼Œç„¶åè¿›å…¥æµè§ˆå™¨æŸ¥çœ‹è¿‡ç¨‹æœ‰æ²¡æœ‰é—®é¢˜ã€‚</p><p><strong>âš ï¸yamlè¯­æ³•æ£€æµ‹ï¼šhttp://ä½ çš„gitlabè®¿é—®åœ°å€/è´¦æˆ·/vue-ci/-/ci/lint</strong></p><p>æœ¬æ–‡æ­£ç¡®çš„è¯­æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line"> - build    </span><br><span class="line"> - deploy</span><br><span class="line"></span><br><span class="line">before_script:</span><br><span class="line">  - &#x27;which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )&#x27;</span><br><span class="line">  - eval $(ssh-agent -s)</span><br><span class="line">  - ssh-add &lt;(echo &quot;$SSH_KEY&quot;)</span><br><span class="line">  - mkdir -p ~/.ssh</span><br><span class="line">  - &#x27;[[ -f /.dockerenv ]] &amp;&amp; echo -e &quot;Host *\n\tStrictHostKeyChecking no\n\n&quot; &gt; ~/.ssh/config&#x27;</span><br><span class="line">build:</span><br><span class="line"> stage: build </span><br><span class="line"> tags: </span><br><span class="line">  - buil</span><br><span class="line"> script:</span><br><span class="line">  - npm install -g cnpm --registry=https://registry.npm.taobao.org </span><br><span class="line">  - echo `pwd`</span><br><span class="line">  - cnpm install </span><br><span class="line">  - cnpm run build</span><br><span class="line">cache:</span><br><span class="line">  paths:</span><br><span class="line">   - node_modules/</span><br><span class="line">   - dist/</span><br><span class="line">deploy:</span><br><span class="line"> stage: deploy  </span><br><span class="line"> tags:</span><br><span class="line">   - deploy </span><br><span class="line"> script:</span><br><span class="line">  - pwd</span><br><span class="line">  - ls -l</span><br><span class="line">  - mv dist vue-ci </span><br><span class="line">  - scp -P 122 -r vue-ci root@thisforyou.cn:/opt/project/web</span><br></pre></td></tr></table></figure><ul><li><p>before_script:  å°±æ˜¯åœ¨æ‰§è¡Œè„šæœ¬æˆ–è€…å‘½ä»¤å‰ï¼Œå…ˆæ‰§è¡Œçš„æ“çºµã€‚æ¯”å¦‚éœ€è¦é¢„å…ˆå¤„ç†ï¼Œç¯å¢ƒé—®é¢˜ï¼Œæ­¤å¤„æ˜¯è¦å’‹dock erå†…é…ç½®å¥½ä¸æœåŠ¡å™¨çš„å…å¯†ç™»é™†ã€‚</p><ul><li><p>-ssh-add &lt;(echo â€œ$SSH_KEYâ€)ï¼š $SSH_KEYï¼Œè¿™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œéœ€è¦åˆ°gitlab-ci é¡µé¢é‡Œé¢è®¾ç½®ã€‚</p><p><code>cat /root/.ssh/id_rsa</code> æŸ¥çœ‹å¯†é’¥ï¼Œè®°ä¸‹æ¥,å¡«åˆ°ä¸‹é¢å»ã€‚</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab16.png" alt="gitlab16"></p></li></ul></li></ul><p>æŸ¥çœ‹ç»“æœï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab10.png" alt="gitlab10"></p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab11.png" alt="gitlab11"></p><p><strong>è¿›å…¥ç¬¬ä¸€ä¸ªjob build:</strong></p><p>è¿™å›¾ç‰‡å·²ç»ä¸æ˜¯ç¬¬ä¸€æ¬¡buildäº†ï¼Œå‰é¢æœ‰å¥½å‡ æ¬¡æµ‹è¯•ï¼Œå› ä¸ºè„šæœ¬çš„é”™ tags:buil å†™é”™äº† buid, æ³¨å†Œçš„æ—¶å€™ï¼Œæƒ³å†™çš„æ˜¯ build å´å†™æˆäº† buil ã€‚ åœ¨é€”ä¸­ï¼Œæ˜¯ç¬¬å·²ç»æœ‰äº†nodemodulsçš„ç¼“å­˜äº†ã€‚</p><p>ç¬¬ä¸€æ¬¡build:</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/02-28-24.jpg" alt=""></p><p>ç¬¬äºŒæ¬¡build,çº æ­£è„šæœ¬åã€‚</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/02.40.36.jpg" alt="é•¿æˆªå›¾   2020-02-28 ä¸Šåˆ02.40.36"></p><p>buildæˆåŠŸäº†ã€‚</p><p>ç¬¬ä¸€ä¸ªjob,æˆåŠŸï¼Œç°åœ¨çœ‹çœ‹ç¬¬äºŒä¸ªï¼Œdeploy job</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/103921.jpg" alt=""></p><p><strong>çœ‹çœ‹æœåŠ¡å™¨ä¸Šçœ‹çœ‹</strong></p><p>çœ‹å·²ç»æœ‰äº†ï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/gitlab14.png" alt="gitlab14"></p><p>å…ˆæµè§ˆå™¨çœ‹çœ‹æˆåŠŸäº†æ²¡æœ‰ï¼š </p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28//gitlab15.png" alt="gitlab15"></p><p><img src="https://www.memoryoverflow.cn/file/articleContentImg/2019-10-16/1571216899999.gif" alt=""></p><p>è¿”å›ä¸Šä¸€é¡µçœ‹ï¼Œæ­¥éª¤ç»“æœï¼š</p><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-28/gitlab13.png" alt="gitlab13"></p><p>ç°åœ¨å·²ç»éƒ¨ç½²æˆåŠŸï¼›</p><p>å…ˆè·‘æµç¨‹è·‘é€šå†æ¥çœ‹ï¼›é…ç½®æ–‡ä»¶å‚æ•°è¯¦è§£ï¼š</p><table><thead><tr><th>å€¼</th><th align="left">æ˜¯å¦å¿…é¡»</th><th>æè¿°</th></tr></thead><tbody><tr><td>script</td><td align="left">å¿…é¡»</td><td>å®šä¹‰ç”±Runneræ‰§è¡Œçš„shellè„šæœ¬æˆ–å‘½ä»¤</td></tr><tr><td>extends</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰æ­¤ä½œä¸šå°†ç»§æ‰¿çš„é…ç½®æ¡ç›®</td></tr><tr><td>image</td><td align="left">éå¿…é¡»</td><td>éœ€è¦ä½¿ç”¨çš„dockeré•œåƒï¼Œè¯·æŸ¥é˜…è¯¥æ–‡æ¡£</td></tr><tr><td>services</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰æ‰€éœ€çš„dockeræœåŠ¡ï¼Œè¯·æŸ¥é˜…è¯¥æ–‡æ¡£</td></tr><tr><td>stage</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰ä¸€ä¸ªå·¥ä½œåœºæ™¯é˜¶æ®µï¼Œé»˜è®¤æ˜¯test</td></tr><tr><td>type</td><td align="left">éå¿…é¡»</td><td>stageçš„åˆ«å,ä¸èµæˆä½¿ç”¨</td></tr><tr><td>variables</td><td align="left">éå¿…é¡»</td><td>åœ¨jobçº§åˆ«ä¸Šå®šä¹‰çš„å˜é‡</td></tr><tr><td>only</td><td align="left">éå¿…é¡»</td><td><strong>å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œä»»åŠ¡ jobsä¸‹çš„é…ç½®ï¼Œonly: - master è¿™ä¸ªé…ç½®çš„æ˜¯åœ¨ä»“åº“çš„å“ªä¸ªåˆ†æ”¯ä¸Šæ‰§è¡Œçš„ã€‚</strong></td></tr><tr><td>except</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰jobæ‰€ä¸é€‚ç”¨çš„gitåˆ†æ”¯</td></tr><tr><td>tags</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰jobæ‰€é€‚ç”¨çš„runnerï¼Œtagsä¸ºrunneræ ‡ç­¾</td></tr><tr><td>allow_failure</td><td align="left">éå¿…é¡»</td><td>å…è®¸ä»»åŠ¡å¤±è´¥ï¼Œä½†æ˜¯å¦‚æœå¤±è´¥ï¼Œå°†ä¸ä¼šæ”¹å˜æäº¤çŠ¶æ€</td></tr><tr><td>when</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰äº†jobä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œå¯ä»¥æ˜¯on_successã€on_failureã€alwayså’Œmanual</td></tr><tr><td>dependencies</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰äº†è¯¥jobä¾èµ–å“ªä¸€ä¸ªjobï¼Œå¦‚æœè®¾ç½®è¯¥é¡¹ï¼Œå¯ä»¥é€šè¿‡artifactsè®¾ç½®</td></tr><tr><td>artifacts</td><td align="left">éå¿…é¡»</td><td>å·¥ä»¶ï¼Œåœ¨ä¾èµ–é¡¹ä¹‹é—´ä¼ é€’çš„ä¸œè¥¿ï¼Œç±»ä¼¼cacheï¼Œä½†åŸç†ä¸cacheä¸åŒ</td></tr><tr><td>cache</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰éœ€è¦è¢«ç¼“å­˜çš„æ–‡ä»¶ã€æ–‡ä»¶å¤¹åˆ—è¡¨</td></tr><tr><td>before_script</td><td align="left">éå¿…é¡»</td><td>è¦†ç›–åœ¨ä½œä¸šä¹‹å‰æ‰§è¡Œçš„è„šæœ¬æˆ–å‘½ä»¤</td></tr><tr><td>after_script</td><td align="left">éå¿…é¡»</td><td>è¦†ç›–åœ¨ä½œä¸šä¹‹åæ‰§è¡Œçš„è„šæœ¬æˆ–å‘½ä»¤</td></tr><tr><td>environment</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰è®©jobå®Œæˆéƒ¨ç½²çš„ç¯å¢ƒåç§°</td></tr><tr><td>coverage</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰jobè®¾ç½®ä»£ç è¦†ç›–ç‡</td></tr><tr><td>retry</td><td align="left">éå¿…é¡»</td><td>å®šä¹‰jobå¤±è´¥åçš„è‡ªåŠ¨é‡è¯•æ¬¡æ•°</td></tr></tbody></table><p>ä¸åŒçš„é¡¹ç›®éœ€è¦ä¸åŒçš„é…ç½®</p><p><strong>Gitlab-ci</strong> æ›´å¤šçš„åŠŸèƒ½ï¼Œç­‰ä½ æ¥æ·±ç©¶ï½</p><p><a href="http://s0docs0gitlab0com.icopy.site/runner/executors/README.html">ä¸­æ–‡å®˜ç½‘è¯´æ˜</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Gitlab-ci å¯ä»¥ç®€åŒ–çš„é¡¹ç›®éƒ¨ç½²æ“ä½œï¼Œè®²ç©¶è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚åªéœ€è¦åŠ¨åŠ¨æ‰‹æŒ‡ï¼Œåœ¨ä½ çš„ç»ˆç«¯æ•²ä¸‹&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git commit -m &amp;#x27;update&amp;#x27; &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å³å¯æ›´æ–°ä»“åº“ä»£ç å¹¶ä¸”ç›´æ¥å‘å¸ƒåˆ°çº¿ä¸Šå»ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1ã€æœ¬æœºç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#1ã€æœ¬æœºç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;1ã€æœ¬æœºç¯å¢ƒ&quot;&gt;&lt;/a&gt;1ã€æœ¬æœºç¯å¢ƒ&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Centos 7&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Docker version 19.03.5&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Gitlab-ce  â€“version lastest æœ€æ–°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Nginx ç‰ˆæœ¬ä¸é‡è¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Gitlab-runner version 12.8&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://thisforyou.cn:180/file/articleContentImg/2020-02-28/gitci1.png&quot; alt=&quot;gitci1&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼šè¿˜éœ€è¦åœ¨éƒ¨ç½²çš„æœåŠ¡ä¸Šï¼Œå¤„ç†å¥½ å…å¯†ç ç™»é™†ã€‚è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè‡ªç„¶ä¸éœ€è¦æ‰‹åŠ¨æ“ã€‚åšå¥½å…å¯†ç™»é™†ï¼Œå°±å¯ä»¥å°†æ‰“åŒ…çš„distæ–‡ä»¶å¤¹ scp åˆ°æœåŠ¡å™¨ä¸Šçš„nginx æŒ‡å®šè·¯å¾„ï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="vue" scheme="http://lyj08.gitee.io/categories/vue/"/>
    
      <category term="æŒç»­è‡ªåŠ¨åŒ–éƒ¨ç½²" scheme="http://lyj08.gitee.io/categories/vue/%E6%8C%81%E7%BB%AD%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="gitlab-ci" scheme="http://lyj08.gitee.io/tags/gitlab-ci/"/>
    
      <category term="gitlab-runner" scheme="http://lyj08.gitee.io/tags/gitlab-runner/"/>
    
  </entry>
  
  <entry>
    <title>ConcurrentHashMapæºç è¿‡ç¨‹æ‰§è¡Œè¿‡ç¨‹åˆ†æ</title>
    <link href="http://lyj08.gitee.io/posts/62ed19e0/"/>
    <id>http://lyj08.gitee.io/posts/62ed19e0/</id>
    <published>2020-02-23T14:06:20.000Z</published>
    <updated>2020-12-30T09:26:25.335Z</updated>
    
    <content type="html"><![CDATA[<p>::: hljs-center</p><h1 id="ConcurrentHashMap-1-7-æºç åˆ†æå­¦ä¹ "><a href="#ConcurrentHashMap-1-7-æºç åˆ†æå­¦ä¹ " class="headerlink" title="ConcurrentHashMap 1.7 æºç åˆ†æå­¦ä¹ "></a>ConcurrentHashMap 1.7 æºç åˆ†æå­¦ä¹ </h1><p>:::</p><a id="more"></a><blockquote><h1 id="1ã€å¸¸é‡è¯´æ˜"><a href="#1ã€å¸¸é‡è¯´æ˜" class="headerlink" title="1ã€å¸¸é‡è¯´æ˜"></a>1ã€å¸¸é‡è¯´æ˜</h1></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// concurrentHashMap é»˜è®¤é•¿åº¦</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// é»˜è®¤æ‰©å®¹å› å­</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤ Segment[].length é•¿åº¦</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CONCURRENCY_LEVEL = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// concurrentHashMap æœ€å¤§å®¹é‡å€¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯ä¸€ä¸ª Segment å¯¹è±¡ä¸­çš„ hashTable æ•°ç»„æœ€å°é•¿åº¦</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_SEGMENT_TABLE_CAPACITY = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Segment[] æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SEGMENTS = <span class="number">1</span> &lt;&lt; <span class="number">16</span>; <span class="comment">// slightly conservative</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éé”å®šæƒ…å†µä¸‹è°ƒç”¨sizeå’Œcontainsæ–¹æ³•çš„é‡è¯•æ¬¡æ•°,é¿å…ç”±äºtableè¿ç»­è¢«ä¿®æ”¹å¯¼è‡´æ— é™é‡è¯•</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRIES_BEFORE_LOCK = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¡ç®—segmentä½ç½®çš„ä¸€ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> segmentMask;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¡ç®—segmentä½ç½®æ—¶,ç”¨äºhashå‚ä¸è¿ç®—çš„ä½æ•°</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> segmentShift;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Segment[]æ•°ç»„</span></span><br><span class="line"><span class="keyword">final</span> Segment&lt;K,V&gt;[] segments;</span><br></pre></td></tr></table></figure><blockquote><h1 id="2ã€æ•°æ®ç»“æ„å›¾"><a href="#2ã€æ•°æ®ç»“æ„å›¾" class="headerlink" title="2ã€æ•°æ®ç»“æ„å›¾"></a>2ã€æ•°æ®ç»“æ„å›¾</h1><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-22/1582363106092.png" alt="1.png"></p></blockquote><p>ConcurrentHashMap åº•å±‚æ•°æ®ç»“æ„æ˜¯é‡‡ç”¨åˆ†æ®µå¼å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸€ä¸ªSegmentå°±æ˜¯ä¸€æ®µï¼Œéƒ½æ˜¯ä¸€ä¸ªéå…¬å¹³é”é”ï¼Œç»§æ‰¿äº ReentrantLock,æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯ä¸€ä¸ªSegment ä¸‹ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå½“putå€¼çš„æ—¶å€™ï¼Œç®—å‡ºäº†keyæ‰€åœ¨segment[]ä¸­çš„ä½ç½®åï¼Œput å°±ä¼šé”ä½ï¼Œå½“å‰çš„è¿™ä¸ªsegmentå¯¹è±¡ï¼Œå…¶å®ƒçš„segment æ˜¯ä¸ä¸Šé”çš„ã€‚è¿™åŒºåˆ«äº hashTale, hashTable æ˜¯é”æ•´ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªæ–¹æ³•ä¸Š synchronized é”ä½ï¼Œæ‰€ä»¥åœ¨æ•ˆç‡ä¸Šä¼š å¤§å¤§ç”±äº hashTableã€‚</p><blockquote><h1 id="3ã€Segment-å¯¹è±¡"><a href="#3ã€Segment-å¯¹è±¡" class="headerlink" title="3ã€Segment å¯¹è±¡"></a>3ã€Segment å¯¹è±¡</h1><p>Segment å¯¹è±¡ç»§æ‰¿äº†ReentrantLockï¼Œå¯¹æ¯ä¸€ä¸ªSegment å¯¹è±¡è¿›è¡Œåˆ†æ®µé”ï¼Œå½“çº¿ç¨‹æ‰§è¡Œputçš„æ—¶å€™ï¼Œåªé”ä½å¯¹åº”çš„ é‚£ä¸ªSegment å¯¹è±¡ï¼Œå¯¹å…¶ä»–çš„Segment çš„get put äº’ä¸å¹²æ‰°ï¼Œè¿™æ ·å­å°±æå‡äº†æ•ˆç‡ï¼›åšåˆ°äº†çº¿ç¨‹å®‰å…¨ã€‚</p></blockquote><p>å¯¹äº HashTable æ˜¯é”ä½çš„æ•´ä¸ªHashTable,æ¯ä¸ªæ–¹æ³•éƒ½ä¸Šäº†é”ï¼Œçº¿ç¨‹é‡å¤§çš„æ—¶å€™ï¼Œä¼šæ¶ˆè€—cpu,æ•ˆç‡ä¹Ÿä½ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Segment</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// HashEntrysæ•°ç»„ï¼Œæ•°ç»„åˆè£…é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> HashEntry&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ“ä½œæ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰©å®¹çš„ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ æ•°ç»„é•¿åº¦*è´Ÿè½½å› å­ é»˜è®¤ 0.75</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è´Ÿè½½å› å­ 0.75</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line"></span><br><span class="line">    Segment(<span class="keyword">float</span> lf, <span class="keyword">int</span> threshold, ConcurrentHashMap.HashEntry&lt;K,V&gt;[] tab) &#123;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = lf;</span><br><span class="line">        <span class="keyword">this</span>.threshold = threshold;</span><br><span class="line">        <span class="keyword">this</span>.table = tab;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><h1 id="4ã€æ„é€ åˆå§‹åŒ–"><a href="#4ã€æ„é€ åˆå§‹åŒ–" class="headerlink" title="4ã€æ„é€ åˆå§‹åŒ–"></a>4ã€æ„é€ åˆå§‹åŒ–</h1><p><strong>1ã€æ„é€ </strong></p></blockquote><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><ol><li>int initialCapacity   #concurrentHashMap åˆå§‹å®¹é‡</li><li>float loadFactor      # åŠ è½½æ‰©å®¹å› å­</li><li>int concurrencyLevel  # segment[]æˆåº¦</li></ol><p>é»˜è®¤æ„é€ æ–¹æ³•ï¼Œéƒ½æ˜¯ä½¿ç”¨é»˜è®¤å‚æ•°å€¼,å…¶å®ƒæ„é€  æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨æ­¤æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">float</span> loadFactor, <span class="keyword">int</span> concurrencyLevel)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="comment">// å‚æ•°æ ¡éªŒ</span></span><br><span class="line">      <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">      <span class="keyword">if</span> (concurrencyLevel &gt; MAX_SEGMENTS)</span><br><span class="line">          concurrencyLevel = MAX_SEGMENTS;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *  // Find power-of-two sizes best matching arguments</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * æ‰¾åˆ°ä¸¤ä¸ªå¤§å°çš„æœ€ä½³åŒ¹é…å‚æ•°çš„å¹‚ï¼Œå°±æ˜¯è®¡ç®—å‡ºï¼Œæ¯ä¸ª segment ä¸‹ åº”è¯¥æ”¾å‡ ä¸ª hashEntryå¯¹è±¡ï¼Œå°±æ˜¯å®ƒçš„hashEntry[]é•¿åº¦</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> sshift = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// é€šè¿‡è®¡ç®—è·å– segment[] æ•°ç»„é•¿åº¦çš„æœ€ä½³å€¼</span></span><br><span class="line">      <span class="keyword">int</span> ssize = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * ä¸¾ä¾‹å­ï¼š</span></span><br><span class="line"><span class="comment">       *   initialCapacity = 33ï¼ŒconcurrencyLevel = 16ï¼›</span></span><br><span class="line"><span class="comment">       *   while å¾ªåï¼Œssize = 0, ç¬¬ä¸€æ¬¡ å°±æ˜¯ 2ï¼Œç¬¬äºŒæ¬¡ å°±æ˜¯ 4 ï¼Œç¬¬ä¸‰æ¬¡å°±æ˜¯ 8ï¼Œç¬¬å››æ¬¡å°±æ˜¯ 16</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *   æ­¤æ—¶ (ssize = 16 ) &lt; concurrencyLevel = 16 è·³å‡ºå¾ªç¯ï¼Œsshift åŠ åŠ äº†å››æ¬¡ sshift = 4 ;</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *   ä» ssize &lt;&lt;= 1  æ¥çœ‹ï¼Œ segment[] é•¿åº¦å°±æ˜¯ï¼Œ2çš„å¹‚æ¬¡æ–¹ï¼› ä¸ºä»€ä¹ˆæ˜¯ 2çš„å¹‚æ¬¡æ–¹ï¼Œä¸ºäº†å‡å°‘ hashå†²çªï¼›</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">while</span> (ssize &lt; concurrencyLevel)</span><br><span class="line">      &#123;</span><br><span class="line">          ++sshift;</span><br><span class="line">          ssize &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¹Ÿè®¡ç®—å¾—å‡º äº† å‚ä¸ è®¡ç®— keyè¦å­˜å‚¨çš„ä¸‹è¡¨ä½ç½®çš„å€¼ï¼›</span></span><br><span class="line">      <span class="keyword">this</span>.segmentShift = <span class="number">32</span> - sshift;</span><br><span class="line">      <span class="keyword">this</span>.segmentMask = ssize - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è®¡ç®—ç»“æœ ä¹Ÿä¸èƒ½ å¤§äº segment[] é»˜è®¤çš„æœ€å¤§é•¿åº¦ï¼Œè¶…å‡ºåˆ™ä¸ºæœ€å¤§å€¼</span></span><br><span class="line">      <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">          initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * è®¡ç®— æ¯ä¸ª HashEntry çš„æœ€ä½³é•¿åº¦</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *  ï¼ˆinitialCapacity = 33ï¼‰/ è®¡ç®—å‡ºæ¥çš„( ssize=16 )</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *   ç›®çš„å°±æ˜¯ å‡ºç°åˆ†é…ä¸å‡ çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *   å‡å¦‚ segment[]=16;æœ€å¤§å®¹é‡æ˜¯ 33 ä¸ªï¼›å¦‚æœæ¯ä¸ª hashEntry[].length=2,é‚£è£…ä¸å®Œ</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *   33/16=2.å¤šï¼›å°±æ¯ä¸ª hashEntry[].length+1; ä¿è¯è£…å®Œ</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">int</span> c = initialCapacity / ssize;</span><br><span class="line">      <span class="keyword">if</span> (c * ssize &lt; initialCapacity)</span><br><span class="line">          ++c;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœè®¡ç®—å‡ºçš„ c å°äº é»˜è®¤ æœ€å° å®¹é‡ï¼Œå°±å– é»˜è®¤å€¼ï¼Œ2çš„å¹‚æ¬¡æ–¹ï¼Œæœ€å°å°±æ˜¯2</span></span><br><span class="line">      <span class="keyword">int</span> cap = MIN_SEGMENT_TABLE_CAPACITY;</span><br><span class="line">      <span class="keyword">while</span> (cap &lt; c)</span><br><span class="line">          cap &lt;&lt;= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// create segments and segments[0]</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * &lt;br&gt;</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * åˆå§‹åŒ–Segmentå¯¹è±¡</span></span><br><span class="line"><span class="comment">       *   ã€‚loadFactor:Segment[]æ•°ç»„çš„æ‰©å®¹å› å­</span></span><br><span class="line"><span class="comment">       *   ã€‚(int) (cap * loadFactor):hashEntry[]çš„æ‰©å®¹å› å­</span></span><br><span class="line"><span class="comment">       *   ã€‚new HashEntry[cap]ï¼šåˆå§‹åŒ–Segmentå¯¹è±¡ä¸‹çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Segment&lt;K, V&gt; s0 =</span><br><span class="line">              <span class="keyword">new</span> Segment&lt;K, V&gt;(loadFactor, (<span class="keyword">int</span>) (cap * loadFactor),</span><br><span class="line">                      (HashEntry&lt;K, V&gt;[]) <span class="keyword">new</span> HashEntry[cap]);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * åˆå§‹åŒ– Segment æ•°ç»„</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Segment&lt;K, V&gt;[] ss = (Segment&lt;K, V&gt;[]) <span class="keyword">new</span> Segment[ssize];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * &lt;br&gt;</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * putOrderedObjectï¼ˆobj,offset,valï¼‰</span></span><br><span class="line"><span class="comment">       *   å°†objå¯¹è±¡çš„åç§»é‡ä¸ºoffsetçš„ä½ç½®ä¿®æ”¹ä¸ºvalue</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       *   SBASE = UNSAFE.arrayBaseOffset(sc);</span></span><br><span class="line"><span class="comment">       *      è¯»å–æ•°ç»„ç¬¬ä¸€ä¸ªçš„åç§»é‡ï¼Œç„¶å putOrderedObject è´Ÿå€¼</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      UNSAFE.putOrderedObject(ss, SBASE, s0); <span class="comment">// ordered write of segments[0]</span></span><br><span class="line">      <span class="keyword">this</span>.segments = ss;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°ï¼ŒSegment[] æ•°ç»„è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå¹¶ä¸”è®¡ç®—å‡ºï¼Œæ¯ä¸ªSegment å¯¹è±¡æœ€ä¼˜å­˜å‚¨ä¸ªæ•°ï¼Œä»¥åŠSegment[]çš„é•¿åº¦è®¡ç®—ï¼Œæ ¹æ®ä»£ç çš„ç®—æ³•ï¼ŒSegment[]çš„é•¿åº¦æ˜¯ä¸€å®šæ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œæœ€å°çš„é•¿åº¦ æ˜¯2ï¼ŒhashEntry[]çš„é•¿åº¦ä¹Ÿæ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚</p><blockquote><h1 id="5ã€ConcurrentHashMap-put-K-k-V-v"><a href="#5ã€ConcurrentHashMap-put-K-k-V-v" class="headerlink" title="5ã€ConcurrentHashMap.put(K k,V v)"></a>5ã€ConcurrentHashMap.put(K k,V v)</h1></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Segment&lt;K, V&gt; s;</span><br><span class="line">    <span class="comment">// put æ–¹æ³• æ²¡æœ‰åškey çš„éç©ºæ ¡éªŒï¼Œ1.8çš„åšäº†æ ¡éªŒ</span></span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—key çš„ hashå€¼</span></span><br><span class="line">    <span class="keyword">int</span> hash = hash(key);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®— è¿™ä¸ªkey åœ¨Segment[] æ•°ç»„ä¸­çš„å“ªä¸ªä½ç½®ï¼›</span></span><br><span class="line">    <span class="keyword">int</span> j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  UNSAFE.getObject(segments, (j &lt;&lt; SSHIFT) + SBASE)</span></span><br><span class="line"><span class="comment">     *      å»æ‹¿è¿™ä¸ªè¿™ä¸ªä¸‹è¡¨ä½ç½®çš„åç§»é‡ï¼Œé€šè¿‡æ­¤æ–¹æ³•è·å–è¿™ä¸ªåç§»é‡ä½ç½®çš„Segmentå¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *      åœ¨æ„é€ çš„æ—¶å€™ï¼Œåªåˆå§‹åŒ–äº†ï¼Œä¸‹è¡¨ä¸º0çš„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ï¼›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *      s = null çš„è¯ï¼Œå°± ensureSegment å®å®ä¾‹åŒ–å‡ºæ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> ((s = (Segment&lt;K, V&gt;) UNSAFE.getObject          <span class="comment">// nonvolatile; recheck</span></span><br><span class="line">            (segments, (j &lt;&lt; SSHIFT) + SBASE)) == <span class="keyword">null</span>) <span class="comment">//  in ensureSegment</span></span><br><span class="line">        s = ensureSegment(j);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s.put(key, hash, value, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><h2 id="5-1-ensureSegment-j"><a href="#5-1-ensureSegment-j" class="headerlink" title="5.1 ensureSegment(j)"></a>5.1 ensureSegment(j)</h2></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Segment&lt;K,V&gt; <span class="title">ensureSegment</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// è¯»å–Segment[]</span></span><br><span class="line">     <span class="keyword">final</span> Segment&lt;K,V&gt;[] ss = <span class="keyword">this</span>.segments;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// åœ¨è·å–ä¸€æ¬¡ key åœ¨æ•°ç»„ä¸­çš„åç§»é‡</span></span><br><span class="line">     <span class="keyword">long</span> u = (k &lt;&lt; SSHIFT) + SBASE; <span class="comment">// raw offset</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// ç”Ÿæ˜ å³å°†å®ä¾‹åŒ–çš„Segmentå¯¹åƒ</span></span><br><span class="line">     Segment&lt;K,V&gt; seg;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * &lt;br&gt;</span></span><br><span class="line"><span class="comment">      * é˜²æ­¢å…¶å®ƒçº¿ç¨‹ åœ¨æ­¤çº¿ç¨‹ä¿®æ”¹å‰å·²ç»ä¿®æ”¹äº†</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      * UNSAFE.getObjectVolatile(ss, u)</span></span><br><span class="line"><span class="comment">      *   ä»å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„è·å–å˜é‡çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">      *   å†æ¬¡åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">     <span class="keyword">if</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// ä¸ºç©ºçš„è¯ï¼Œå°±æ‹¿æ„é€ åˆå§‹åŒ–çš„Segmentå¯¹è±¡ä½œä¸ºåŸå‹ï¼Œæ‹¿å–ï¼ŒhashEntryp[]é•¿åº¦,å’ŒåŠ è½½å› å­</span></span><br><span class="line">         <span class="comment">// å»å®ä¾‹åŒ–æ–°çš„Segmentå¯¹åƒ</span></span><br><span class="line">         Segment&lt;K,V&gt; proto = ss[<span class="number">0</span>]; <span class="comment">// use segment 0 as prototype</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">int</span> cap = proto.table.length;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">float</span> lf = proto.loadFactor;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// è®¡ç®—æ•°ç»„çš„ åŠ è½½å› å­</span></span><br><span class="line">         <span class="keyword">int</span> threshold = (<span class="keyword">int</span>)(cap * lf);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// å®ä¾‹åŒ– hashEntryæ•°ç»„</span></span><br><span class="line">         HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])<span class="keyword">new</span> HashEntry[cap];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="comment">/**</span></span><br><span class="line"><span class="comment">          * &lt;br&gt;</span></span><br><span class="line"><span class="comment">          *</span></span><br><span class="line"><span class="comment">          * å†æ¬¡å¤æŸ¥å½“å‰ä½ç½®æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="comment">          * é˜²æ­¢å…¶å®ƒçº¿ç¨‹ åœ¨æ­¤çº¿ç¨‹ä¿®æ”¹å‰å·²ç»ä¿®æ”¹äº†</span></span><br><span class="line"><span class="comment">          *</span></span><br><span class="line"><span class="comment">          * å¦åˆ™ç›´æ¥returnå³å¯</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">         <span class="keyword">if</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u))</span><br><span class="line">                 == <span class="keyword">null</span>) &#123; <span class="comment">// recheck</span></span><br><span class="line"></span><br><span class="line">             <span class="comment">// å®ä¾‹åŒ– Segment å¯¹è±¡</span></span><br><span class="line">             Segment&lt;K,V&gt; s = <span class="keyword">new</span> Segment&lt;K,V&gt;(lf, threshold, tab);</span><br><span class="line"></span><br><span class="line">             <span class="comment">/**</span></span><br><span class="line"><span class="comment">              * &lt;br&gt;</span></span><br><span class="line"><span class="comment">              *</span></span><br><span class="line"><span class="comment">              * ä½¿ç”¨å¾ªç¯çŸ¥é“casæˆåŠŸä¸ºæ­¢ï¼Œå› ä¸ºæœ‰æ—¶å€™ä¼šcaså¤±è´¥ï¼›</span></span><br><span class="line"><span class="comment">              *</span></span><br><span class="line"><span class="comment">              */</span></span><br><span class="line">             <span class="keyword">while</span> ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u))</span><br><span class="line">                     == <span class="keyword">null</span>) &#123;</span><br><span class="line">                 <span class="comment">// cas ä¿®æ”¹æ•°ç»„ä¸­çš„keyåœ¨çš„ä¸‹æ ‡ä½ç½®çš„å€¼ï¼ŒåŸæ¥ä¸º null,ä¿®æ”¹å€¼ä¸º æ–°å¯¹è±¡</span></span><br><span class="line">                 <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(ss, u, <span class="keyword">null</span>, seg = s))</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> seg;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><h2 id="5-2-Segment-put-K-key-int-hash-V-value-boolean-onlyIfAbsent"><a href="#5-2-Segment-put-K-key-int-hash-V-value-boolean-onlyIfAbsent" class="headerlink" title="5.2 Segment.put(K key, int hash, V value, boolean onlyIfAbsent)"></a>5.2 Segment.put(K key, int hash, V value, boolean onlyIfAbsent)</h2><p>å°† key value åŒ…è£…æˆ HashEntry å¯¹è±¡ï¼Œå‡å¦‚åˆ°æ•°ç»„ä¸­ï¼Œæˆ–è€…HashEntry é“¾è¡¨ä¸­å»ï¼›</p></blockquote><p>Segment ç»§æ‰¿äº† ReentrantLock ï¼Œæ˜¯ä¸€æŠŠé”ï¼Œåœ¨æ­¤put æ–¹æ³•ä¸­è¿›è¡Œ tryLock(), è·å–é”ï¼Œè·å–å¤±è´¥ï¼Œæ•‘ä¼š<br>scanAndLockForPut(key, hash, value),è¿›è¡Œå¾ªç¯é‡è¯•å–é”ï¼Œå¦‚æœåˆ°è¾¾æŒ‡å®šçš„å°è¯•æ¬¡æ•°è¿˜æ²¡æœ‰é”çš„è¯ï¼Œå°±ä¼šlock() è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚</p><p>æ­¤é”æ˜¯éå…¬å¹³é”ã€‚</p><p><strong>put æ–¹æ³•</strong>ï¼š<br>  <strong>æ³¨æ„ç‚¹ï¼š</strong><br>  &emsp; 1ã€hashå†²çªï¼Œkeyç›¸åŒçš„æƒ…å†µï¼Œå¤„ç†ï¼Ÿ<br>    &emsp;&emsp; &emsp; hash å†²çªï¼Œkey ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¼šé»˜è®¤ è¿›è¡Œï¼Œå€¼æ›¿æ¢ï¼Œæ–°å€¼è¦†ç›–æ—§å€¼ã€‚</p><p>  &emsp; 2ã€key çš„hashå†²çªï¼Œkey ä¸ç›¸åŒçš„æƒ…å†µï¼Ÿ<br>      &emsp;&emsp;&emsp; åªæ˜¯ keyçš„ hash å†²çªï¼Œçš„è¯ï¼Œå°±ä¼šåœ¨é“¾è¡¨çš„å¤´èŠ‚ç‚¹åŠ å…¥æ–°çš„åŒ…è£…çš„HashEntryå¯¹è±¡ï¼›<br>  &emsp; 3ã€Segmentä¸‹çš„HashEntry æ•°ç»„è£…ä¸ä¸‹æ€ä¹ˆåŠï¼Ÿ<br>       &emsp;&emsp;&emsp; åœ¨åŠ å…¥ä¹‹å‰ï¼Œæ ¹æ®åŠ è½½å› å­å»è®¡ç®—ï¼Œæ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œä¸éœ€è¦æ‰©å®¹å°±ç›´æ¥åŠ å…¥ï¼Œå¦åˆ™å°±ä¼šå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ã€‚</p><p><strong>ä»£ç åˆ†æï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">put</span><span class="params">(K key, <span class="keyword">int</span> hash, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &lt;br&gt;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * å¼€å§‹ä¸Šé”äº†</span></span><br><span class="line"><span class="comment">         * tryLock()ï¼›æ˜¯ ReentrantLock é‡Œé¢çš„æ–¹æ³•ï¼›æ˜¯éå…¬å¹³é”ï¼›</span></span><br><span class="line"><span class="comment">         * tryLock()å¤±è´¥ï¼Œå°±ä¼š</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * scanAndLockForPut();</span></span><br><span class="line"><span class="comment">         *   è¿›è¡Œé‡è¯•è·å–é”ï¼Œåœ¨ä¸è¶…è¿‡ RETRIES_BEFORE_LOCK = 2 æ¬¡æ•°çš„æ—¶å€™ï¼Œ2 æ˜¯é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        HashEntry&lt;K, V&gt; node = tryLock() ? <span class="keyword">null</span> :</span><br><span class="line">                scanAndLockForPut(key, hash, value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        V oldValue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            HashEntry&lt;K, V&gt;[] tab = table;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¡ç®—HashEntryå¯¹è±¡åœ¨ HashEntry[]æ•°ç»„ä¸­çš„ä½ç½®ï¼Œè¿™ä¸ªç®—æ³•è·Ÿ HashTableä¸€æ ·çš„</span></span><br><span class="line">            <span class="keyword">int</span> index = (tab.length - <span class="number">1</span>) &amp; hash;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·å–è¿™ä¸ª æ•°ç»„ä¸­çš„ï¼Œè¿™ä¸ªä¸‹æ ‡ä½ç½®æ˜¯çš„å€¼ï¼Œæœ‰å¯èƒ½ä¸ºç©ºï¼Œæœ‰å¯èƒ½å­˜åœ¨å€¼ï¼Œå­˜åœ¨å€¼è¯´æ˜hashå†²çªäº†</span></span><br><span class="line">            HashEntry&lt;K, V&gt; first = entryAt(tab, index);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// éå† HashEntry&lt;K,V&gt; é“¾è¡¨ç»“æ„ï¼Œ</span></span><br><span class="line">            <span class="keyword">for</span> (HashEntry&lt;K, V&gt; e = first; ; )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// e !=null æœ‰å¯èƒ½æ˜¯hashå†²çªäº†ï¼Œå­˜åœ¨ é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">if</span> (e != <span class="keyword">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">                     *</span></span><br><span class="line"><span class="comment">                     * ç»§ç»­è¿›ä¸€æ­¥åˆ¤æ–­ key çš„å†…å­˜æ˜¯å¦ç›¸ç­‰ã€</span></span><br><span class="line"><span class="comment">                     * å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€hash å€¼æ˜¯å¦ç›¸ç­‰ã€‚</span></span><br><span class="line"><span class="comment">                     *</span></span><br><span class="line"><span class="comment">                     * è¿™ä¸ªåˆ¤æ–­è·Ÿ HashTableçš„åˆ¤æ–­ä¹Ÿæ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">                     *</span></span><br><span class="line"><span class="comment">                     *</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    K k;</span><br><span class="line">                    <span class="keyword">if</span> ((k = e.key) == key ||</span><br><span class="line">                            (e.hash == hash &amp;&amp; key.equals(k)))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// æ­¤æ—¶keyç›¸ç­‰äº†ï¼Œå°±åˆ¤æ–­æ˜¯å¦æ–°å€¼è¦†ç›–æ—§å€¼</span></span><br><span class="line">                        oldValue = e.value;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// æ˜¯å¦è¦†ç›–</span></span><br><span class="line">                        <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// è¦†ç›–</span></span><br><span class="line">                            e.value = value;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// ä¿®æ”¹æ¬¡æ•°åŠ ä¸€</span></span><br><span class="line">                            ++modCount;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å¦‚æœ åªæ˜¯hashå†²çªï¼Œkeyçš„å€¼ä¸ç­‰ï¼Œå°±å½¢æˆäº†é“¾è¡¨</span></span><br><span class="line">                    e = e.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// æ²¡æœ‰hashå†²çªï¼ŒHashEntry æ²¡æœ‰å­˜åœ¨é“¾è¡¨ï¼›</span></span><br><span class="line">                    <span class="keyword">if</span> (node != <span class="keyword">null</span>)</span><br><span class="line">                        <span class="comment">// æ–°å¢çš„èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">                        node.setNext(first);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">// åˆ›å»ºæ–°çš„HashENtryå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">                        node = <span class="keyword">new</span> HashEntry&lt;K, V&gt;(hash, key, value, first);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ•°ç»„å®¹é‡åŠ ä¸€ï¼Œå°±æ˜¯åˆ¤æ–­ï¼Œæ–°å¢è¿™ä¸ªkeyä¹‹åï¼Œè¿™ä¸ªæ•°ç»„çš„å®¹é‡æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">                    <span class="keyword">int</span> c = count + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line">                    <span class="keyword">if</span> (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)</span><br><span class="line">                        rehash(node);</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">// ä¸éœ€è¦æ‰©å®¹ï¼Œå°±å°†æ•°ç»„ä¸‹çš„è¿™ä¸ªä½ç½®ï¼Œæ›¿æ¢ä¸ºæ–°çš„HashEntry</span></span><br><span class="line">                        setEntryAt(tab, index, node);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ä¿®æ”¹æ¬¡æ•°+1</span></span><br><span class="line">                    ++modCount;</span><br><span class="line">                    count = c;</span><br><span class="line">                    oldValue = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">            unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><h3 id="5-21-scanAndLockForPut-K-key-int-hash-V-value"><a href="#5-21-scanAndLockForPut-K-key-int-hash-V-value" class="headerlink" title="5.21 scanAndLockForPut(K key, int hash, V value)"></a>5.21 scanAndLockForPut(K key, int hash, V value)</h3><p>  tryLock()ï¼›æ˜¯ ReentrantLock é‡Œé¢çš„æ–¹æ³•ï¼›æ˜¯éå…¬å¹³é”ï¼›<br>  tryLock()å¤±è´¥ï¼Œå°±ä¼š scanAndLockForPut();<br>  è¿›è¡Œé‡è¯•è·å–é”ï¼Œåœ¨ä¸è¶…è¿‡ RETRIES_BEFORE_LOCK = 2 æ¬¡æ•°çš„æ—¶å€™ï¼Œ2 æ˜¯é»˜è®¤å€¼;<br>  é‡è¯•æ¬¡æ•°å¤§äº æŒ‡å®šçš„é‡è¯•å€¼çš„æ—¶å€™ï¼Œçº¿ç¨‹è¢«æŒ‚èµ·ï¼Œè¿›å…¥AQS çš„é˜Ÿåˆ—ç­‰å¾…</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HashEntry&lt;K,V&gt; <span class="title">scanAndLockForPut</span><span class="params">(K key, <span class="keyword">int</span> hash, V value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ¹æ® è·å–å½“å‰æ•°ç»„ä¸‹çš„ä½ç½®ï¼Œè·å–ç¬¬ä¸€ä¸ªHashEntry</span></span><br><span class="line">        HashEntry&lt;K,V&gt; first = entryForHash(<span class="keyword">this</span>, hash);</span><br><span class="line">        HashEntry&lt;K,V&gt; e = first;</span><br><span class="line">        HashEntry&lt;K,V&gt; node = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ– é‡è¯•è·å–é”çš„æ ‡å¿—æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">int</span> retries = -<span class="number">1</span>; <span class="comment">// negative while locating node</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è¯•å¾ªç¯é‡è¯•è¯»é”</span></span><br><span class="line">        <span class="keyword">while</span> (!tryLock()) &#123;</span><br><span class="line">            HashEntry&lt;K,V&gt; f; <span class="comment">// to recheck first below</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (retries &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚è¿‡ æ•°ç»„çš„ä¸‹æ ‡è¿™ä¸ªä½ç½®æ˜¯ç©ºçš„ï¼Œåˆå§‹åŒ–æ–°çš„HashEntryå¯¹è±¡ï¼Œ</span></span><br><span class="line">                <span class="comment">// return å›å»ï¼Œåœ¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="comment">// speculatively create node</span></span><br><span class="line">                        node = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    retries = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (key.equals(e.key))</span><br><span class="line">                    retries = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    e = e.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (++retries &gt; MAX_SCAN_RETRIES) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœ é‡è¯•æ¬¡æ•°åˆ°è¾¾æœ€å¤§å€¼ï¼Œé˜»å¡è¿›å…¥AQSçš„é˜Ÿåˆ—æ’é˜Ÿ</span></span><br><span class="line">                lock();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((retries &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                    (f = entryForHash(<span class="keyword">this</span>, hash)) != first) &#123;</span><br><span class="line">                <span class="comment">// åˆ¤æ–­ è¿™ä¸ªä½ç½®æ˜¯å¦æœ‰è¢«ä¿®æ”¹ï¼Œä¿®æ”¹äº†åˆ™é‡æ–°åˆå§‹åŒ–å…¶å®ƒå€¼</span></span><br><span class="line"></span><br><span class="line">                e = first = f; <span class="comment">// re-traverse if entry changed</span></span><br><span class="line">                retries = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><h1 id="6ã€rehash-HashEntry-lt-K-V-gt-node-æ‰©å®¹"><a href="#6ã€rehash-HashEntry-lt-K-V-gt-node-æ‰©å®¹" class="headerlink" title="6ã€rehash(HashEntry&lt;K,V&gt; node) æ‰©å®¹"></a>6ã€rehash(HashEntry&lt;K,V&gt; node) æ‰©å®¹</h1><p>åœ¨æ–°å¢keyçš„æ—¶å€™ï¼Œå°±ä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œæ‰©å®¹æ¡ä»¶å°±æ˜¯ã€‚<br>æ–°å¢åçš„ä¸ªæ•°å¤§äºæ•°ç»„å®¹é‡*åŠ è½½å› å­(é»˜è®¤0.75) å¹¶ä¸” æ•°ç»„çš„å®¹é‡åœ¨ä¸å¤§äºæœ€å¤§å®¹é‡çš„æ—¶å€™<br>&emsp; <code>(count &gt; (cap * lf) &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)</code></p></blockquote><p><strong>æ‰©å®¹è¿‡ç¨‹ï¼š</strong><br>1ã€æ‰©å®¹åçš„å®¹é‡æ˜¯åŸæ¥æ•°çš„ä¸€å€ï¼Œæœ€åè¿˜æ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚<br>2ã€é‡æ–°è®¡ç®—æ•° HashEntry åœ¨æ–°çš„æ•°ç»„ä¸Šçš„ä½ç½®ã€‚</p><p>éå†è€çš„HashEntry[] æ•°ç»„ï¼Œè¿›è¡Œæ•°æ®è¿ç§»ï¼Œå…ˆè¦é‡æ–°æ‹¿å– sizeMaskè¿™ä¸ªæ˜¯è®¡ç®—keyå­˜æ”¾ä½ç½®æ‰€åœ¨ä¸‹æ ‡ç”¨çš„ä¹Ÿå°±æ˜¯<br>sizeMask = newTable.length-1</p><p>é‡æ–°ä¿®æ”¹ æ‰©å®¹é˜™å€¼æ¡ä»¶ threshold = (int)(newCapacity * loadFactor);</p><p>åˆ¤æ–­ HashEntry[] çš„ä»»ä½•ä½ç½®ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é“¾è¡¨ï¼Œå¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±ç›´æ¥è®¡ç®— <code>e.hash &amp; sizeMask</code> åœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼Œè¿ç§»è¿‡å»ï¼›</p><p>å¦‚æœé“¾è¡¨å­˜åœ¨å¤šä¸ªå€¼ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡éå†é“¾è¡¨ï¼šæ‹¿åˆ°é“¾è¡¨çš„æœ€åä¸€ä¸ª HashEntry,å°†å…¶è¿ç§»åˆ°æ–°æ•°ç»„ä¸­ï¼›</p><p>æ¥ç€ ç¬¬äºŒä¸ªå¾ªç¯,éå†é“¾è¡¨çš„å‰é¢å‡ ä¸ª ä¸Šä¸€ä¸ª å¾ªç¯å·²ç»æ‹¿äº† æœ€åä¸€ä¸ªï¼Œ<br>æ ¹æ®è®¡ç®—çš„æ–°æ•°ç»„ä¸‹æ ‡ï¼Œä»æ–°æ•°ç»„ä¸­çš„è¿™ä¸ªä½ç½®æ‹¿HashEntryï¼Œç„¶åé‡æ–°æ„é€ è‡ªå·± HashEntryï¼Œå¦‚æœï¼Œè¿™ä¸ªä½ç½®ä¸å­˜åœ¨HashEntry çš„è¯ï¼Œé‚£è‡ªå·±å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ï¼Œè‡ªå·±ä½œä¸ºå¤´èŠ‚ç‚¹åŠ å…¥åˆ° é“¾è¡¨ä¸­ï¼Œå°†åŸæ¥çš„HashEntry ä½œä¸ºè‡ªå·±çš„nextã€‚</p><p>è¿™ç§æƒ…å†µæœ‰å¯èƒ½ä¼šåŠ å…¥åˆ°æ–°çš„é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”ä½œä¸ºå¤´èŠ‚ç‚¹ï¼Œä¹Ÿæœ‰å¯èƒ½è‡ªå·±å æ®ä¸€ä¸ªä½ç½®ã€‚</p><p><strong>æºç åˆ†æï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * æ‰©å®¹å¤„ç†</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rehash</span><span class="params">(HashEntry&lt;K,V&gt; node)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">       <span class="comment">// æ—§æ•°ç»„</span></span><br><span class="line">       HashEntry&lt;K,V&gt;[] oldTable = table;</span><br><span class="line">       <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ–°æ•°ç»„å®¹é‡ï¼Œä¸ºæ—§çš„2å€</span></span><br><span class="line">       <span class="keyword">int</span> newCapacity = oldCapacity &lt;&lt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// ä¸‹ä¸€æ¬¡çš„æ‰©å®¹é˜™å€¼æ¡ä»¶</span></span><br><span class="line">       threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ–°æ•°ç»„</span></span><br><span class="line">       HashEntry&lt;K,V&gt;[] newTable =</span><br><span class="line">               (HashEntry&lt;K,V&gt;[]) <span class="keyword">new</span> HashEntry[newCapacity];</span><br><span class="line"></span><br><span class="line">       <span class="keyword">int</span> sizeMask = newCapacity - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå† è€Segment[]æ•°ç»„,è¿›è¡Œæ•°æ®è¿ç§»</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldCapacity ; i++) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// é“¾è¡¨çš„ç¬¬ä¸€ä¸ª å¤´èŠ‚ç‚¹</span></span><br><span class="line">           HashEntry&lt;K,V&gt; e = oldTable[i];</span><br><span class="line">           <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">               HashEntry&lt;K,V&gt; next = e.next;</span><br><span class="line"></span><br><span class="line">               <span class="comment">// é‡æ–°è®¡ç®— å½“å‰key,åœ¨æ–°æ•°ç»„çš„ä½ç½®ï¼›</span></span><br><span class="line">               <span class="keyword">int</span> idx = e.hash &amp; sizeMask;</span><br><span class="line"></span><br><span class="line">               <span class="comment">// å½“å‰ HashEntryå¯¹è±¡ï¼Œæ²¡æœ‰å­˜åœ¨ hashå†²çªï¼Œæ²¡æœ‰å½¢æˆé“¾è¡¨ï¼Œç›´æ¥ç»™å€¼åˆ°æ–°çš„æ•°ç»„ä¸­</span></span><br><span class="line">               <span class="keyword">if</span> (next == <span class="keyword">null</span>)   <span class="comment">//  Single node on list</span></span><br><span class="line">                   newTable[idx] = e;</span><br><span class="line">               <span class="keyword">else</span> &#123; <span class="comment">// Reuse consecutive sequence at same slot</span></span><br><span class="line"></span><br><span class="line">                   <span class="comment">/**</span></span><br><span class="line"><span class="comment">                    *</span></span><br><span class="line"><span class="comment">                    * éå†é“¾è¡¨</span></span><br><span class="line"><span class="comment">                    *</span></span><br><span class="line"><span class="comment">                    * è¯»å–é“¾è¡¨çš„æœ€åä¸€ä¸ª HashEntry å¹¶ä¸”è®¡ç®—åœ¨æ–°æ•°ç»„çš„ä¸­ä½ç½®ï¼Œå°†å…¶æ”¾åˆ°æ–°æ•°ç»„ä¸­</span></span><br><span class="line"><span class="comment">                    */</span></span><br><span class="line">                   HashEntry&lt;K,V&gt; lastRun = e;</span><br><span class="line">                   <span class="keyword">int</span> lastIdx = idx;</span><br><span class="line">                   <span class="keyword">for</span> (HashEntry&lt;K,V&gt; last = next;</span><br><span class="line">                        last != <span class="keyword">null</span>;</span><br><span class="line">                        last = last.next) &#123;</span><br><span class="line">                       <span class="keyword">int</span> k = last.hash &amp; sizeMask;</span><br><span class="line">                       <span class="keyword">if</span> (k != lastIdx) &#123;</span><br><span class="line">                           lastIdx = k;</span><br><span class="line">                           lastRun = last;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">                   newTable[lastIdx] = lastRun;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                   <span class="comment">// Clone remaining nodes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                   <span class="comment">// éå†é“¾è¡¨çš„å‰é¢å‡ ä¸ª ä¸Šä¸€ä¸ª å¾ªç¯å·²ç»æ‹¿äº† æœ€åä¸€ä¸ªï¼›</span></span><br><span class="line">                   <span class="keyword">for</span> (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123;</span><br><span class="line">                       V v = p.value;</span><br><span class="line">                       <span class="keyword">int</span> h = p.hash;</span><br><span class="line">                       <span class="keyword">int</span> k = h &amp; sizeMask;</span><br><span class="line"></span><br><span class="line">                       <span class="comment">// æ ¹æ®è®¡ç®—çš„æ–°æ•°ç»„ä¸‹æ ‡ï¼Œä»æ–°æ•°ç»„ä¸­çš„è¿™ä¸ªä½ç½®æ‹¿HashEntryï¼Œ</span></span><br><span class="line">                       <span class="comment">// ç„¶åé‡æ–°æ„é€ è‡ªå·± HashEntryï¼Œå¦‚æœï¼Œè¿™ä¸ªä½ç½®ä¸å­˜åœ¨HashEntry çš„è¯ï¼Œ</span></span><br><span class="line">                       <span class="comment">// é‚£è‡ªå·±å°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ï¼Œè‡ªå·±ä½œä¸ºå¤´èŠ‚ç‚¹åŠ å…¥åˆ° é“¾è¡¨ä¸­ï¼Œå°†åŸæ¥çš„HashEntry ä½œä¸ºè‡ªå·±çš„next.</span></span><br><span class="line">                       <span class="comment">// è¿™ç§æƒ…å†µæœ‰å¯èƒ½ä¼šåŠ å…¥åˆ°æ–°çš„é“¾è¡¨ä¸­ï¼Œå¹¶ä¸”ä½œä¸ºå¤´èŠ‚ç‚¹ï¼›</span></span><br><span class="line">                       <span class="comment">// ä¹Ÿæœ‰å¯èƒ½è‡ªå·±å æ®ä¸€ä¸ªä½ç½®ã€‚</span></span><br><span class="line">                       HashEntry&lt;K,V&gt; n = newTable[k];</span><br><span class="line">                       newTable[k] = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(h, p.key, v, n);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ·»åŠ æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">       <span class="keyword">int</span> nodeIndex = node.hash &amp; sizeMask; <span class="comment">// add the new node</span></span><br><span class="line">       node.setNext(newTable[nodeIndex]);</span><br><span class="line">       newTable[nodeIndex] = node;</span><br><span class="line">       <span class="comment">// æ›´æ¢æ–°çš„ HashEntry[] å› ä¸ºå·²ç»æ‰©å®¹äº†</span></span><br><span class="line">       table = newTable</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><h1 id="7ã€Get-Object-key"><a href="#7ã€Get-Object-key" class="headerlink" title="7ã€Get(Object key)"></a>7ã€Get(Object key)</h1><p> get æ–¹æ³•å¹¶æ²¡æœ‰åŠ é”ï¼Œè€Œæ˜¯é€šè¿‡UNSAFEç±»çš„æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote><blockquote><h1 id="8ã€æ€»ç»“"><a href="#8ã€æ€»ç»“" class="headerlink" title="8ã€æ€»ç»“"></a>8ã€æ€»ç»“</h1></blockquote><p>ConcurrentHashMap ä¸ HashTable éƒ½æ˜¯å±äºçº¿ç¨‹å®‰å…¨çš„ Map,ä½†ä¸¤è€…çš„åŒºåˆ«ä¸åŒã€‚HashTable çš„çº¿ç¨‹å®‰å…¨æ˜¯åŸºäºSycnchronized,æ˜¯æ¯ä¸ªæ–¹æ³•éƒ½ä¸Šäº†sycnchronizedï¼›é”ä½äº†æ•´ä¸ªHashTable,æ•ˆç‡ä½ä¸‹ã€‚ConcurrentHashMap è€Œæ˜¯é‡‡ç”¨åˆ†æ®µé”çš„è®¾è®¡ï¼Œå°†æ•°æ®æ‹†åˆ†å¼€æ¥å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯ æ¯ä¸€ä¸ª Segment éƒ½æ˜¯ä¸€ä¸ª ä¸€ä¸ªé”ï¼ŒSegment ç»§æ‰¿äº† ReentrantLockï¼Œç»è¿‡ä¸¤æ¬¡ å¯¹keyçš„Hash è¿ç®—ï¼Œè¿›è¡Œå¯¹keyåœ¨ Segment[] æ•°ç»„ä¸­çš„ä½ç½®å’ŒSegment[]ä¸­çš„HashEntry[]æ•°ç»„ä¸­çš„ä½ç½®å®šä½ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å°†æ•°æ®æ‰“æ•£å¼€äº†å­˜å‚¨ï¼Œåœ¨Getçš„æ—¶å€™ï¼Œå¦‚æœä¸å­˜Hashå†²çªï¼Œä¹Ÿå°±æ˜¯ä¸åœ¨åŒä¸€ä¸ªSegment å°±ä¸ä¼šå‡ºç°ç«äº‰å…³ç³»ï¼Œå¤§å¤§æå‡äº†æ•ˆç‡é—®é¢˜ï¼Œä¹Ÿè§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>ConcurrentHashMapè¿­ä»£å™¨æ˜¯å¼±ä¸€è‡´æ€§çš„ã€‚</p><p>ConcurrentHashMapæœ‰äº›æ–¹æ³•éœ€è¦è·¨æ®µï¼Œæ¯”å¦‚size()å’ŒcontainsValue()ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦é”å®šæ•´ä¸ªè¡¨è€Œè€Œä¸ä»…ä»…æ˜¯æŸä¸ªæ®µï¼Œè¿™éœ€è¦æŒ‰é¡ºåºé”å®šæ‰€æœ‰æ®µï¼Œæ“ä½œå®Œæ¯•åï¼ŒåˆæŒ‰é¡ºåºé‡Šæ”¾æ‰€æœ‰æ®µçš„é”ã€‚è¿™é‡Œâ€œæŒ‰é¡ºåºâ€æ˜¯å¾ˆé‡è¦çš„ï¼Œå¦åˆ™ææœ‰å¯èƒ½å‡ºç°æ­»é”ï¼Œåœ¨ConcurrentHashMapå†…éƒ¨ï¼Œæ®µæ•°ç»„æ˜¯finalçš„ï¼Œå¹¶ä¸”å…¶æˆå‘˜å˜é‡å®é™…ä¸Šä¹Ÿæ˜¯finalçš„ï¼Œä½†æ˜¯ï¼Œä»…ä»…æ˜¯å°†æ•°ç»„å£°æ˜ä¸ºfinalçš„å¹¶ä¸ä¿è¯æ•°ç»„æˆå‘˜ä¹Ÿæ˜¯finalçš„ï¼Œè¿™éœ€è¦å®ç°ä¸Šçš„ä¿è¯ã€‚è¿™å¯ä»¥ç¡®ä¿ä¸ä¼šå‡ºç°æ­»é”ï¼Œå› ä¸ºè·å¾—é”çš„é¡ºåºæ˜¯å›ºå®šçš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;::: hljs-center&lt;/p&gt;
&lt;h1 id=&quot;ConcurrentHashMap-1-7-æºç åˆ†æå­¦ä¹ &quot;&gt;&lt;a href=&quot;#ConcurrentHashMap-1-7-æºç åˆ†æå­¦ä¹ &quot; class=&quot;headerlink&quot; title=&quot;ConcurrentHashMap 1.7 æºç åˆ†æå­¦ä¹ &quot;&gt;&lt;/a&gt;ConcurrentHashMap 1.7 æºç åˆ†æå­¦ä¹ &lt;/h1&gt;&lt;p&gt;:::&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://lyj08.gitee.io/categories/java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://lyj08.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="é›†åˆ" scheme="http://lyj08.gitee.io/tags/%E9%9B%86%E5%90%88/"/>
    
      <category term="ConcurrentHashMap" scheme="http://lyj08.gitee.io/tags/ConcurrentHashMap/"/>
    
  </entry>
  
  <entry>
    <title>æ ¹æ®ArrayListåŸç†ï¼Œå®ç°ä¸€ä¸ªè‡ªå·±çš„ArrayList ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</title>
    <link href="http://lyj08.gitee.io/posts/e51c6570/"/>
    <id>http://lyj08.gitee.io/posts/e51c6570/</id>
    <published>2020-02-20T15:25:00.000Z</published>
    <updated>2020-12-30T09:27:58.467Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ‰‹å†™â—†ArrayList"><a href="#æ‰‹å†™â—†ArrayList" class="headerlink" title="æ‰‹å†™â—†ArrayList"></a>æ‰‹å†™â—†ArrayList</h1><blockquote><p>&emsp; åœ¨å‰é¢ä¸€ç« ä¸­ï¼Œåˆ†æäº†ArrayListçš„å®ç°åŸç†ï¼Œç°åœ¨æ ¹æ®å®ƒçš„æ€è·¯ï¼Œè‡ªå·±é€ ä¸€ä¸ªArrayList</p></blockquote><h1 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//é»˜è®¤åˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"> <span class="comment">//å®šä¹‰ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"> <span class="keyword">private</span> Object[] elementData;</span><br><span class="line"><span class="comment">//ç©ºæ•°ç»„</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"> <span class="comment">//æœ€å¤§å®¹é‡</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line"> <span class="comment">//æ•°ç»„å®é™…å¤§å°</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="æ„é€ "><a href="#æ„é€ " class="headerlink" title="æ„é€ "></a>æ„é€ </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é»˜è®¤æ„é€ å‡½æ•° æ•°ç»„é•¿åº¦ä¸º10</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œå¦‚æœæ•°ç»„å°äº0åˆ™æŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;åˆå§‹å®¹é‡ä¸èƒ½å°äº0 &quot;</span> + initialCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> size;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h1 id="add-T-t"><a href="#add-T-t" class="headerlink" title="add(T t)"></a>add(T t)</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ·»åŠ æ–¹æ³•</span></span><br><span class="line"><span class="comment">  * 1.æ·»åŠ ä¹‹å‰æ£€æŸ¥æ•°ç»„å®¹é‡æ˜¯å¦å¤Ÿç”¨</span></span><br><span class="line"><span class="comment">  * 2.å¦‚æœä¸å¤Ÿç”¨åˆ™å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹,æ‰©å®¹ä¸ºåŸæ¥é•¿åº¦çš„1.5å€</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">      ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">      elementData[size++] = t;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * æŒ‡å®šä½ç½®æ’å…¥</span></span><br><span class="line"><span class="comment">   *1.å…ˆæ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line"><span class="comment">   * 2.æ˜¯å¦æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line"><span class="comment">   * 3.æŒ‡å®šä½ç½®åè¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€åç§»åŠ¨ä¸€ä½</span></span><br><span class="line"><span class="comment">   *      æ’å…¥å’Œåˆ é™¤æ•ˆç‡ä½ä¸‹</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T t)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line">      rangeCheckForAdd(index);</span><br><span class="line">      <span class="comment">//2.æ˜¯å¦æ‰©å®¹</span></span><br><span class="line">      ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">      <span class="comment">//ç§»ä½</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = size(); i &gt; index; i--) &#123;</span><br><span class="line">          elementData[i] = elementData[i - <span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      elementData[index] = t;</span><br><span class="line">      size++;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="get-int-i"><a href="#get-int-i" class="headerlink" title="get(int i)"></a>get(int i)</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * getæ–¹æ³• é€šè¿‡ä¸‹æ ‡å»æ•°æ®</span></span><br><span class="line"><span class="comment"> * 1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line">    <span class="keyword">return</span> (T) elementData[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="remove-Object-o"><a href="#remove-Object-o" class="headerlink" title="remove(Object o)"></a>remove(Object o)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * æ ¹æ®å…ƒç´ åˆ é™¤æ–¹æ³•</span><br><span class="line"> * 2.åˆ é™¤æŒ‡å®šä½ç½®çš„å‰è¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€å‰ç§»åŠ¨ä¸€ä½</span><br><span class="line"> *&#x2F;</span><br><span class="line">public boolean remove(Object o) &#123;</span><br><span class="line">    if (o &#x3D;&#x3D; null) &#123;</span><br><span class="line">        &#x2F;&#x2F;ç§»ä½</span><br><span class="line">        for (int i &#x3D; 0; i &lt; size(); i++) &#123;</span><br><span class="line">            if (elementData[i] &#x3D;&#x3D; null) &#123;</span><br><span class="line">                fastRemove(i);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; size(); i++) &#123;</span><br><span class="line">            if (elementData[i].equals(o)) &#123;</span><br><span class="line">                fastRemove(i);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author: yj</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Discription</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>:11:51 2018/8/16</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * åŸºäºæ•°ç»„å®ç°çš„ï¼š</span></span><br><span class="line"><span class="comment"> * ä¼˜ç¼ºç‚¹ï¼šæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArrayList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤åˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å®šä¹‰ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> Object[] elementData;</span><br><span class="line">    <span class="comment">//ç©ºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">    <span class="comment">//æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line">    <span class="comment">//æ•°ç»„å®é™…å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * é»˜è®¤æ„é€ å‡½æ•° æ•°ç»„é•¿åº¦ä¸º10</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œå¦‚æœæ•°ç»„å°äº0åˆ™æŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;åˆå§‹å®¹é‡ä¸èƒ½å°äº0 &quot;</span> + initialCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 1.æ·»åŠ ä¹‹å‰æ£€æŸ¥æ•°ç»„å®¹é‡æ˜¯å¦å¤Ÿç”¨</span></span><br><span class="line"><span class="comment">     * 2.å¦‚æœä¸å¤Ÿç”¨åˆ™å¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹,æ‰©å®¹ä¸ºåŸæ¥é•¿åº¦çš„1.5å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">        elementData[size++] = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šä½ç½®æ’å…¥</span></span><br><span class="line"><span class="comment">     *1.å…ˆæ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line"><span class="comment">     * 2.æ˜¯å¦æ˜¯å¦éœ€è¦æ‰©å®¹</span></span><br><span class="line"><span class="comment">     * 3.æŒ‡å®šä½ç½®åè¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€åç§»åŠ¨ä¸€ä½</span></span><br><span class="line"><span class="comment">     *      æ’å…¥å’Œåˆ é™¤æ•ˆç‡ä½ä¸‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, T t)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line">        <span class="comment">//2.æ˜¯å¦æ‰©å®¹</span></span><br><span class="line">        ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//ç§»ä½</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size(); i &gt; index; i--) &#123;</span><br><span class="line">            elementData[i] = elementData[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        elementData[index] = t;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ä¸‹æ ‡ åˆ é™¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 1.å…ˆæ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line"><span class="comment">     * 2.åˆ é™¤æŒ‡å®šä½ç½®çš„å‰è¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€å‰ç§»åŠ¨ä¸€ä½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line">        T oldIndex = (T) elementData[index];</span><br><span class="line">        <span class="comment">//ç§»ä½</span></span><br><span class="line">        fastRemove(index);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=index;i&lt;size()-<span class="number">1</span>;i++) &#123;</span><br><span class="line">            elementData[i]=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (i==size) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            elementData[i]=elementData[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldIndex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å…ƒç´ åˆ é™¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 2.åˆ é™¤æŒ‡å®šä½ç½®çš„å‰è¾¹çš„å…ƒç´ ç»Ÿç»Ÿå¾€å‰ç§»åŠ¨ä¸€ä½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//ç§»ä½</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (elementData[i] == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    fastRemove(i);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (elementData[i].equals(o)) &#123;</span><br><span class="line">                    fastRemove(i);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fastRemove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            elementData[i] = <span class="keyword">null</span>;</span><br><span class="line">            elementData[i] = elementData[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getæ–¹æ³• é€šè¿‡ä¸‹æ ‡å»æ•°æ®</span></span><br><span class="line"><span class="comment">     * 1.æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line">        <span class="keyword">return</span> (T) elementData[index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥æ•°ç»„å®¹é‡æ˜¯å¦å¤Ÿç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ•°ç»„å…ƒç´ ä¸ªæ•°å¤§äºåˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦æ—¶å€™</span></span><br><span class="line">        <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//è¿›è¡Œæ•°ç»„æ‰©å®¹</span></span><br><span class="line">            grow(minCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ•°ç»„æ‰©å®¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> oldLen = elementData.length;</span><br><span class="line">        <span class="keyword">int</span> newLen = oldLen + oldLen &gt;&gt; <span class="number">1</span>; <span class="comment">//å·¦ç§»ä½ ç›¸å½“äºé™¤ä»¥2</span></span><br><span class="line">        <span class="comment">//åŠ ä¸€ä¸ªå…ƒç´ å°±åŠ é•¿ä¸€ä¸ªé•¿åº¦ï¼Œæœ€å°‘ä¿è¯å®¹é‡å’ŒminCapacityä¸€æ ·</span></span><br><span class="line">        <span class="keyword">if</span> (newLen - minCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            newLen = minCapacity;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœæ‰©å……ä¸€åŠåä»ç„¶ä¸å¤Ÿï¼Œåˆ™ newCapacity = minCapacity;minCapacityå®é™…å…ƒç´ çš„ä¸ªæ•°ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (newLen - MAX_ARRAY_SIZE &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            newLen = hugeCapacity(minCapacity);</span><br><span class="line">            <span class="comment">//æ•°ç»„æœ€å¤§ä½2^32</span></span><br><span class="line">        &#125;</span><br><span class="line">        elementData = Arrays.copyOf(elementData, newLen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rangeCheckForAdd</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; <span class="keyword">this</span>.size)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">&quot;ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * èµ‹å€¼æ•°ç»„æœ€å¤§é•¿åº¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">        <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">                Integer.MAX_VALUE :</span><br><span class="line">                MAX_ARRAY_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] a)</span> </span>&#123;</span><br><span class="line">        MyArrayList&lt;String&gt; stringMyArrayList = <span class="keyword">new</span> MyArrayList&lt;&gt;();</span><br><span class="line">        stringMyArrayList.add(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">        stringMyArrayList.add(<span class="string">&quot;æå››&quot;</span>);</span><br><span class="line">        stringMyArrayList.add(<span class="number">1</span>, <span class="string">&quot;ç‹äº”&quot;</span>);</span><br><span class="line">        stringMyArrayList.add(<span class="number">1</span>, <span class="string">&quot;ç‹éº»å­&quot;</span>);</span><br><span class="line">        stringMyArrayList.add(<span class="number">0</span>, <span class="string">&quot;åˆ˜èƒ½&quot;</span>);</span><br><span class="line">        stringMyArrayList.add(<span class="number">5</span>, <span class="string">&quot;åˆ˜èƒ½å»&quot;</span>);</span><br><span class="line">        <span class="comment">//stringMyArrayList.remove(3);</span></span><br><span class="line">        stringMyArrayList.remove(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line"><span class="comment">//        for (int i = 0; i &lt; 15; i++) &#123;</span></span><br><span class="line"><span class="comment">//            stringMyArrayList.add(String.valueOf(i));</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringMyArrayList.size(); i++) &#123;</span><br><span class="line">            System.out.println(stringMyArrayList.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ‰‹å†™â—†ArrayList&quot;&gt;&lt;a href=&quot;#æ‰‹å†™â—†ArrayList&quot; class=&quot;headerlink&quot; title=&quot;æ‰‹å†™â—†ArrayList&quot;&gt;&lt;/a&gt;æ‰‹å†™â—†ArrayList&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&amp;emsp; åœ¨å‰é¢ä¸€ç« ä¸­ï¼Œåˆ†æäº†ArrayListçš„å®ç°åŸç†ï¼Œç°åœ¨æ ¹æ®å®ƒçš„æ€è·¯ï¼Œè‡ªå·±é€ ä¸€ä¸ªArrayList&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å±æ€§&quot;&gt;&lt;a href=&quot;#å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;å±æ€§&quot;&gt;&lt;/a&gt;å±æ€§&lt;/h1&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;//é»˜è®¤åˆå§‹åŒ–çš„æ•°ç»„é•¿åº¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; DEFAULT_CAPACITY = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;//å®šä¹‰ä¸€ä¸ªæ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Object[] elementData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//ç©ºæ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Object[] EMPTY_ELEMENTDATA = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;//æœ€å¤§å®¹é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; MAX_ARRAY_SIZE = Integer.MAX_VALUE - &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;//æ•°ç»„å®é™…å¤§å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; size;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>httpåè®®æ˜¯ç½‘é¡µå¼€å‘çš„å¿…å¤‡çŸ¥è¯†ï¼Œæ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ã€‚</title>
    <link href="http://lyj08.gitee.io/posts/9c4d68f1/"/>
    <id>http://lyj08.gitee.io/posts/9c4d68f1/</id>
    <published>2020-02-16T12:26:00.000Z</published>
    <updated>2020-12-30T09:35:00.714Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Http-åè®®ç›¸å…³çŸ¥è¯†ç‚¹"><a href="#Http-åè®®ç›¸å…³çŸ¥è¯†ç‚¹" class="headerlink" title="Http åè®®ç›¸å…³çŸ¥è¯†ç‚¹"></a>Http åè®®ç›¸å…³çŸ¥è¯†ç‚¹</h1><p>&emsp; httpåè®®æ˜¯ç½‘é¡µå¼€å‘çš„å¿…å¤‡çŸ¥è¯†ï¼Œæ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ã€‚</p><h1 id="1ã€HTTP-åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€HTTP-åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€HTTP åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€HTTP åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>HTTPåè®®æ˜¯åŸºäº å®¢æˆ·ç«¯/æœåŠ¡ç«¯ çš„æ¶æ„æ¨¡å‹ï¼›æ˜¯ä¸€ç§è¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚</p><h1 id="2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ"><a href="#2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ" class="headerlink" title="2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ"></a>2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ</h1><h3 id="1-è¯·æ±‚è¡Œ-n"><a href="#1-è¯·æ±‚è¡Œ-n" class="headerlink" title="1.è¯·æ±‚è¡Œ\n"></a>1.è¯·æ±‚è¡Œ\n<img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569643462174.png" alt="image.png"></h3><p>è¯·æ±‚è¡ŒåŒ…æ‹¬äº†ï¼š è¯·æ±‚æ–¹æ³• url httpåè®®ç‰ˆæœ¬ </p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /write/edit/<span class="number">68</span> HTTP/<span class="number">1.1</span></span><br><span class="line">User-Agent: curl/<span class="number">7.16</span><span class="number">.3</span> libcurl/<span class="number">7.16</span><span class="number">.3</span> OpenSSL/<span class="number">0.9</span>.<span class="number">7l</span> zlib/<span class="number">1.2</span><span class="number">.3</span></span><br><span class="line">Host: www.memoryoverflow.cn</span><br><span class="line">.......</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2-è¯·æ±‚å¤´éƒ¨"><a href="#2-è¯·æ±‚å¤´éƒ¨" class="headerlink" title="2.è¯·æ±‚å¤´éƒ¨"></a>2.è¯·æ±‚å¤´éƒ¨</h3><p>è¯·æ±‚å¤´åŒ…å«çš„ä¸œè¥¿å°±å¾ˆå¤šå¯ä»¥è‡ªå®šä¹‰ï¼šè‡ªå¸¦ä¸€èˆ¬ä¼šæœ‰ date  server content-type ç­‰å­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">access-control-allow-credentials: <span class="keyword">true</span></span><br><span class="line">access-control-allow-headers: Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers,Accept</span><br><span class="line">access-control-allow-methods: GET, POST, PATCH, DELETE, PUT, OPTIONS</span><br><span class="line">content-type: application/json;charset=UTF-<span class="number">8</span></span><br><span class="line">date: Sat, <span class="number">28</span> Sep <span class="number">2019</span> <span class="number">03</span>:<span class="number">59</span>:<span class="number">55</span> GMT</span><br><span class="line">server: nginx/<span class="number">1.12</span><span class="number">.2</span>\nstatus: <span class="number">200</span></span><br></pre></td></tr></table></figure><h3 id="3-ç©ºè¡Œ"><a href="#3-ç©ºè¡Œ" class="headerlink" title="3.ç©ºè¡Œ"></a>3.ç©ºè¡Œ</h3><p><strong>ç©ºè¡Œï¼Œè¯·æ±‚å¤´éƒ¨åé¢çš„ç©ºè¡Œæ˜¯å¿…é¡»çš„ï¼›å³ä½¿ç¬¬å››éƒ¨åˆ†çš„è¯·æ±‚æ•°æ®ä¸ºç©ºï¼Œä¹Ÿå¿…é¡»æœ‰ç©ºè¡Œã€‚</strong></p><h3 id="4-è¯·æ±‚æ•°æ®"><a href="#4-è¯·æ±‚æ•°æ®" class="headerlink" title="4.è¯·æ±‚æ•°æ®"></a>4.è¯·æ±‚æ•°æ®</h3><p>   è¯·æ±‚æ•°æ®å°±æ˜¯ï¼šå®¢æˆ·ç«¯äºæœåŠ¡ç«¯äº¤æµæ—¶å€™ï¼Œæ‰€æºå¸¦çš„å‚æ•°å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">68</span>&amp;type=intenet</span><br></pre></td></tr></table></figure><p><strong>ä¸€ä¸ªHTTPçš„è¯·æ±‚ä¾‹å­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /write/edit/<span class="number">68</span>  http1<span class="number">.1</span>\nHost:www.memoryoverflow.cn\nUser-Agent:Mozilla/<span class="number">4.0</span> (compatible; MSIE <span class="number">6.0</span>; Windows NT <span class="number">5.1</span>; SV1;</span><br><span class="line">Content-Type:application/x-www-form-urlencoded</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">id=<span class="number">68</span></span><br></pre></td></tr></table></figure><h2 id="HTTPå“åº”ï¼š"><a href="#HTTPå“åº”ï¼š" class="headerlink" title="HTTPå“åº”ï¼š"></a>HTTPå“åº”ï¼š</h2><p>å“åº”æŠ¥æ–‡åŒ…æ‹¬å››éƒ¨åˆ†ï¼šçŠ¶æ€è¡Œï¼Œæ¶ˆæ¯æŠ¥å¤´ ç©ºè¡Œ å“åº”å†…å®¹<br>å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569644539894.png" alt="image.png"></p><h1 id="3ã€HTTP-å®¢æˆ·ç«¯äºæœåŠ¡ç«¯çš„äº¤æµè¿‡ç¨‹ï¼Ÿ"><a href="#3ã€HTTP-å®¢æˆ·ç«¯äºæœåŠ¡ç«¯çš„äº¤æµè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="3ã€HTTP å®¢æˆ·ç«¯äºæœåŠ¡ç«¯çš„äº¤æµè¿‡ç¨‹ï¼Ÿ"></a>3ã€HTTP å®¢æˆ·ç«¯äºæœåŠ¡ç«¯çš„äº¤æµè¿‡ç¨‹ï¼Ÿ</h1><p>æ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ï¼›<br><strong>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼Œé»˜è®¤ç«¯å£æ˜¯ 80ï¼‰â€”â€“  å»ºç«‹TCPè¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰  â€”-&gt; æœåŠ¡ç«¯â€”-æ–­å¼€è¿æ¥ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰â€“&gt;å“åº”å®¢æˆ·ç«¯ï¼Œ</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569642894760.png" alt="image.png"><br><strong>Http(åº”ç”¨å±‚)â€”&gt;TCP/UDP(ä¼ è¾“å±‚)â€”&gt;ç½‘ç»œå±‚ï¼ˆIPï¼‰â€”&gt; é“¾è·¯å±‚(ç½‘ç»œç¡¬ä»¶)</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569646104250.png" alt="image.png"></p><h3 id="1-TCPçš„ä¸‰æ¬¡æ¡æ‰‹"><a href="#1-TCPçš„ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="1.TCPçš„ä¸‰æ¬¡æ¡æ‰‹"></a>1.TCPçš„ä¸‰æ¬¡æ¡æ‰‹</h3><p><strong>å®¢æˆ·ç«¯äºæœåŠ¡ç«¯å»ºç«‹è¿æ¥ä¹‹å‰éœ€è¦è¿›è¡Œé€šä¿¡æµ‹è¯•è¿æ¥</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569647802279.png" alt="image.png"></p><h3 id="2-TCPçš„å››æ¬¡æŒ¥æ‰‹"><a href="#2-TCPçš„å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="2.TCPçš„å››æ¬¡æŒ¥æ‰‹"></a>2.TCPçš„å››æ¬¡æŒ¥æ‰‹</h3><p><strong>å½“å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ•°æ®å¤„ç†å®Œæˆåï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€å½“å‰è¿æ¥è¯·æ±‚</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569648944856.png" alt="image.png"><br>ç¬¬ä¸€æ¬¡ï¼šå®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚ï¼ŒFIN=1,seq=u;å®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€<br>ç¬¬äºŒæ¬¡ï¼šæœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾ä¿¡æ¯ï¼Œå“åº”ç¡®è®¤ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚<br>ç¬¬ä¸‰æ¬¡ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚<br>æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾ä¿¡æ¯ï¼ŒFIN=1ï¼Œack=u+1ï¼Œï¼›</p><p>ç¬¬å››æ­¤ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šç¡®è®¤æ¶ˆæ¯åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤æ¶ˆæ¯ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚</p><p>**æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2âˆ— *âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚</p><h1 id="4ã€å¸¸ç”¨çš„HTTPæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#4ã€å¸¸ç”¨çš„HTTPæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4ã€å¸¸ç”¨çš„HTTPæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a>4ã€å¸¸ç”¨çš„HTTPæ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h1><ol><li><p>POSTï¼šå¸¸ç”¨äº ä¼ è¾“æ•°æ®åˆ°æœåŠ¡ç«¯</p></li><li><p>GETï¼šä¸€èˆ¬ç”¨äº å‘æœåŠ¡å»è·å–æ¶ˆæ¯</p></li><li><p>DELETEï¼š ç”¨äºåˆ é™¤æ•°æ®/æ–‡ä»¶è¯·æ±‚</p></li><li><p>PUT:å¸¸ç”¨äºæ•°æ®ä¿®æ”¹</p></li><li><p>HEAD:ç±»ä¼¼äº GET è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´</p></li><li><p>OPTIONS:æŸ¥è¯¢ç›¸åº”URIæ”¯æŒçš„HTTPæ–¹æ³•</p></li></ol><h1 id="5ã€HTTP-å¸¸è§çŠ¶æ€ç ï¼Œæœ‰å“ªäº›ï¼Ÿ"><a href="#5ã€HTTP-å¸¸è§çŠ¶æ€ç ï¼Œæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5ã€HTTP å¸¸è§çŠ¶æ€ç ï¼Œæœ‰å“ªäº›ï¼Ÿ"></a>5ã€HTTP å¸¸è§çŠ¶æ€ç ï¼Œæœ‰å“ªäº›ï¼Ÿ</h1><ol><li>200 è¯·æ±‚æˆåŠŸ</li><li>301 èµ„æºç½‘é¡µè¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒURL</li><li>404 è¯·æ±‚çš„è·¯å¾„é”™è¯¯ï¼Œä¸å­˜åœ¨</li><li>500 æœåŠ¡å™¨æŠ›å‡ºå¼‚å¸¸ï¼ŒæœåŠ¡å™¨é”™è¯¯</li><li>503 æœåŠ¡å™¨ä¸å­˜åœ¨ï¼Œè¿æ¥ä¸ä¸ŠæœåŠ¡å™¨</li><li>400 å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯</li><li>401 æ²¡æœ‰æƒé™ï¼Œæœªè¿›è¡Œèº«ä»½è®¤è¯</li><li>405 è¯·æ±‚æ–¹æ³•é”™è¯¯ æ¯”å¦‚ åå°æŒ‡å®šçš„HTTPæ–¹æ³•ä¸º POST ,å®¢æˆ·ç«¯å‘é€GETè¯·æ±‚</li><li>504 ç½‘å…³é”™è¯¯ </li></ol><h1 id="6ã€HTTP-ä¸-http-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#6ã€HTTP-ä¸-http-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="6ã€HTTP ä¸ http æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>6ã€HTTP ä¸ http æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h1><p>http:<br>1.é€šä¿¡ä¸åŠ å¯†ï¼Œå†…å®¹å¯èƒ½è¢«çªƒå¬<br>2.ä¸éªŒè¯é€šä¿¡æ–¹èº«ä»½ï¼Œå¯èƒ½é­åˆ°ä¼ªè£…<br>3.æ— æ³•éªŒè¯æŠ¥æ–‡å®Œæ•´æ€§ï¼Œå¯èƒ½è¢«ç¯¡æ”¹<br>http:<br>æ˜¯ä¸€ä¸ªåŠ å¯†çš„å®‰å…¨åè®®</p><h1 id="7ã€Httpåè®®æœ‰å“ªäº›ç‰¹å¾"><a href="#7ã€Httpåè®®æœ‰å“ªäº›ç‰¹å¾" class="headerlink" title="7ã€Httpåè®®æœ‰å“ªäº›ç‰¹å¾?"></a>7ã€Httpåè®®æœ‰å“ªäº›ç‰¹å¾?</h1><h3 id="1-æ— çŠ¶æ€ï¼š"><a href="#1-æ— çŠ¶æ€ï¼š" class="headerlink" title="1.æ— çŠ¶æ€ï¼š"></a>1.æ— çŠ¶æ€ï¼š</h3><p>&emsp; HTTPåè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«</p><h3 id="2-æ— è¿æ¥"><a href="#2-æ— è¿æ¥" class="headerlink" title="2.æ— è¿æ¥"></a>2.æ— è¿æ¥</h3><p>&emsp;æ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´</p><h3 id="3-åª’ä½“ç‹¬ç«‹"><a href="#3-åª’ä½“ç‹¬ç«‹" class="headerlink" title="3.åª’ä½“ç‹¬ç«‹"></a>3.åª’ä½“ç‹¬ç«‹</h3><p>&emsp;è¿™æ„å‘³ç€ï¼Œåªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çŸ¥é“å¦‚ä½•å¤„ç†çš„æ•°æ®å†…å®¹ï¼Œä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥é€šè¿‡HTTPå‘é€ã€‚å®¢æˆ·ç«¯ä»¥åŠæœåŠ¡å™¨æŒ‡å®šä½¿ç”¨é€‚åˆçš„MIME-typeå†…å®¹ç±»å‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Http-åè®®ç›¸å…³çŸ¥è¯†ç‚¹&quot;&gt;&lt;a href=&quot;#Http-åè®®ç›¸å…³çŸ¥è¯†ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;Http åè®®ç›¸å…³çŸ¥è¯†ç‚¹&quot;&gt;&lt;/a&gt;Http åè®®ç›¸å…³çŸ¥è¯†ç‚¹&lt;/h1&gt;&lt;p&gt;&amp;emsp; httpåè®®æ˜¯ç½‘é¡µå¼€å‘çš„å¿…å¤‡çŸ¥è¯†ï¼Œæ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ è¾“æ•°æ®çš„ã€‚&lt;/p&gt;
&lt;h1 id=&quot;1ã€HTTP-åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#1ã€HTTP-åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1ã€HTTP åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;1ã€HTTP åè®®çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h1&gt;&lt;p&gt;HTTPåè®®æ˜¯åŸºäº å®¢æˆ·ç«¯/æœåŠ¡ç«¯ çš„æ¶æ„æ¨¡å‹ï¼›æ˜¯ä¸€ç§è¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚&lt;/p&gt;
&lt;h1 id=&quot;2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ&quot;&gt;&lt;/a&gt;2ã€HTTPè¯·æ±‚æœ‰é‚£ä¸‰éƒ¨åˆ†ç»„æˆï¼Ÿ&lt;/h1&gt;&lt;h3 id=&quot;1-è¯·æ±‚è¡Œ-n&quot;&gt;&lt;a href=&quot;#1-è¯·æ±‚è¡Œ-n&quot; class=&quot;headerlink&quot; title=&quot;1.è¯·æ±‚è¡Œ\n&quot;&gt;&lt;/a&gt;1.è¯·æ±‚è¡Œ\n&lt;img src=&quot;http://www.memoryoverflow.cn/file/articleContentImg/2019-09-28/1569643462174.png&quot; alt=&quot;image.png&quot;&gt;&lt;/h3&gt;&lt;p&gt;è¯·æ±‚è¡ŒåŒ…æ‹¬äº†ï¼š è¯·æ±‚æ–¹æ³• url httpåè®®ç‰ˆæœ¬ &lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;GET /write/edit/&lt;span class=&quot;number&quot;&gt;68&lt;/span&gt; HTTP/&lt;span class=&quot;number&quot;&gt;1.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;User-Agent: curl/&lt;span class=&quot;number&quot;&gt;7.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt; libcurl/&lt;span class=&quot;number&quot;&gt;7.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt; OpenSSL/&lt;span class=&quot;number&quot;&gt;0.9&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;7l&lt;/span&gt; zlib/&lt;span class=&quot;number&quot;&gt;1.2&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Host: www.memoryoverflow.cn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.......&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="httpåè®®" scheme="http://lyj08.gitee.io/tags/http%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>ReentrantLockå¯é‡å…¥é”,æºç å­¦ä¹ ï¼Œåˆ†ææ‰§è¡ŒåŸç†</title>
    <link href="http://lyj08.gitee.io/posts/84b802e7/"/>
    <id>http://lyj08.gitee.io/posts/84b802e7/</id>
    <published>2020-02-11T14:26:54.000Z</published>
    <updated>2020-12-30T09:27:29.297Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h1><p>&emsp; <code>ReentrantLock</code> åœ¨1.6 ä¹‹å‰ï¼Œæ€§èƒ½æ¯” <code>Synchronized</code>ï¼Œå¥½å¾ˆå¤šï¼Œå› ä¸ºå®ç°åŒæ­¥ï¼Œä¸éœ€è¦åˆ°jvmçš„æ“ä½œç³»ç»Ÿä¸­å¤„ç†ï¼Œåœ¨javaä»£ç å±‚é¢å°±å¯ä»¥å¤„ç†æ‰ï¼Œè€ŒSynchronized æ˜¯éœ€è¦åˆ°æ“ä½œç³»ç»Ÿå¤„ç†ã€‚åœ¨1.6ä¹‹åï¼ŒSynchronized è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨æ€§ä¸Šæ²¡æœ‰å¤ªå¤šçš„å·®åˆ«ã€‚</p><a id="more"></a><h1 id="ReentrantLockæºç å­¦ä¹ "><a href="#ReentrantLockæºç å­¦ä¹ " class="headerlink" title="ReentrantLockæºç å­¦ä¹ "></a>ReentrantLockæºç å­¦ä¹ </h1><h2 id="1ã€ReentrantLock-æ„é€ å‡½æ•°"><a href="#1ã€ReentrantLock-æ„é€ å‡½æ•°" class="headerlink" title="1ã€ReentrantLock æ„é€ å‡½æ•°"></a>1ã€ReentrantLock æ„é€ å‡½æ•°</h2><p>&emsp; æˆ‘ä»¬å¯ä»¥çœ‹æºç /jdk.chmï¼ŒçŸ¥é“ ReentrantLock æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ã€‚<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-12/1581479921147.png" alt="1.png"></p><p>ä»£ç ä¸Šçš„é”å–å†³äºç¨‹åºå‘˜çš„å‚æ•°å¤„ç†ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ï¼Œä¸å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ <strong>éå…¬å¹³é”</strong>ï¼ŒReentrantLock(true),ä½¿ç”¨çš„å°±æ˜¯<strong>å…¬å¹³é”</strong>ã€‚</p><p>åœ¨è¿™ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€è¾¹æºç ï¼Œå¯¹å®ƒçš„æ•´ä½“è¿‡ç¨‹æœ‰ä¸ªå¤§è‡´çš„äº†è§£ã€‚<br>å…ˆçœ‹çœ‹ è¿™å‡ ä¸ªç±»æœ‰äº›ä»€ä¹ˆ<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-12/1581480193834.png" alt="image.png"></p><p><strong>åŠ é”è¿‡ç¨‹ å¦‚å›¾ï¼š</strong><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-13/1581572584555.png" alt="1.png"></p><p><strong>ä»£ç åˆ†æ</strong></p><h3 id="1-1-ReentrantLock-å…¬å¹³é”"><a href="#1-1-ReentrantLock-å…¬å¹³é”" class="headerlink" title="1.1 ReentrantLock å…¬å¹³é”"></a>1.1 ReentrantLock å…¬å¹³é”</h3><h4 id="1-11-new-ReentrantLock-true-æ„é€ "><a href="#1-11-new-ReentrantLock-true-æ„é€ " class="headerlink" title="1.11 new ReentrantLock(true) æ„é€ "></a>1.11 new ReentrantLock(true) æ„é€ </h4><p><code>static ReentrantLock lock = new ReentrantLock(true)</code><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-13/1581572718699.png" alt="1.png"><br><strong>æœ‰ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æœ‰å‚çš„ä¸€ä¸ªæ— å‚ï¼Œæ ¹æ®å‚æ•° å®åŠ›åŒ–ä¸€ä¸ªå…¬å¹³é”/éå…¬å¹³é”ã€‚</strong></p><h4 id="1-12-åŠ é”è¿‡ç¨‹-new-FairSync-lock"><a href="#1-12-åŠ é”è¿‡ç¨‹-new-FairSync-lock" class="headerlink" title="1.12 åŠ é”è¿‡ç¨‹ new FairSync().lock()"></a>1.12 åŠ é”è¿‡ç¨‹ new FairSync().lock()</h4><h4 id="åŠ é”è¿‡ç¨‹å›¾è§£"><a href="#åŠ é”è¿‡ç¨‹å›¾è§£" class="headerlink" title="åŠ é”è¿‡ç¨‹å›¾è§£"></a><strong>åŠ é”è¿‡ç¨‹å›¾è§£</strong></h4><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-20/1582181039535.jpg" alt="é•¿æˆªå›¾   20200220 ä¸‹åˆ02.43.37.jpg"></p><p><strong>æ¥ä¸‹æ¥çœ‹lock()æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    acquire(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">         acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">         selfInterrupt();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><strong>tryAcquire(int acquires) å°è¯•åŠ é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getState() è·å–é”çš„çŠ¶æ€ï¼ŒAQSä¸­çš„ä¸€ä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡ï¼Œæ ¹æ®æ­¤å˜é‡æ¥åˆ¤æ–­é”çš„çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">     *  å¦‚æœ çŠ¶æ€ä¸º0ï¼Œè¯´æ˜é”æ­¤æ—¶æ˜¯è‡ªç”±çŠ¶æ€ï¼Œå¦‚æœä¸ä¸º0ï¼Œå¹¶ä¸”æ¥å–é”çš„çº¿ç¨‹ä¸ä¸ºå½“å‰çº¿ç¨‹ï¼Œ</span></span><br><span class="line"><span class="comment">     *  çš„è¯ï¼Œå°±å–é”å¤±è´¥ å°±ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾… acquireQueued(addWaiter(Node.EXCLUSIVE), arg)</span></span><br><span class="line"><span class="comment">     *  å¦åˆ™å°±æ˜¯ï¼ŒçŠ¶æ€++ï¼Œè¯´æ˜è‡ªæ—‹å¤šäº†ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> c = getState();</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * hasQueuedPredecessors() </span></span><br><span class="line"><span class="comment">         *     åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡ï¼Œæ˜¯å¦æœ‰çº¿ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line"><span class="comment">         * compareAndSetState(0, acquires)ï¼š</span></span><br><span class="line"><span class="comment">         *      å¦‚æœä¸éœ€è¦è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œåˆ™è¿›è¡ŒCASä¿®æ”¹çŠ¶æ€ä¸º1 å–é”æ“ä½œã€‚</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * setExclusiveOwnerThread(current)ï¼š</span></span><br><span class="line"><span class="comment">         *      å°†è·å¾—é”çš„çº¿ç¨‹è®¾ç½®ä¸ºè‡ªå·±</span></span><br><span class="line"><span class="comment">         *    </span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (!hasQueuedPredecessors() &amp;&amp;</span><br><span class="line">                compareAndSetState(<span class="number">0</span>, acquires))</span><br><span class="line">        &#123;</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread())</span><br><span class="line">    &#123;</span><br><span class="line"> <span class="comment">// çº¿ç¨‹é‡å…¥å–é”ï¼Œstate+1</span></span><br><span class="line">        <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">        <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">        setState(nextc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·å¾—é”è¿”å›true,æ–¹æ³•ä¸€å±‚å±‚è¿”å›ï¼Œæ¥ç€å°±ä¼šæ‰§è¡Œ.lock()æ–¹æ³•ä¸‹çš„ä¸šåŠ¡ä»£ç ã€‚</strong></p><p><strong>åœ¨å¹¶å‘çš„çŠ¶å†µä¸‹å¹¶ä¸”å­˜åœ¨ç«äº‰çš„æ—¶å€™ï¼Œå¦‚æœç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè·å¾—äº†é”ï¼Œåœ¨ä¸šåŠ¡æœªå®Œæˆä¹‹å‰ï¼Œé”æœªé‡Šæ”¾çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹æ¥å¼ºé”çš„æ—¶å€™ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥é˜Ÿåˆ—æ’é˜Ÿç­‰å€™å¹¶ä¸”ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå› ä¸ºæ˜¯å…¬å¹³é”æ‰€ä»¥å…ˆè¿›å»çš„ä¼šå…ˆè·å¾—é”</strong></p><p><strong>hasQueuedPredecessors()æ–¹æ³•</strong><br>&emsp;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">hasQueuedPredecessors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// The correctness of this depends on head being initialized</span></span><br><span class="line">    <span class="comment">// before tail and on head.next being accurate if the current</span></span><br><span class="line">    <span class="comment">// thread is first in queue.</span></span><br><span class="line">    Node t = tail; <span class="comment">// Read fields in reverse initialization order</span></span><br><span class="line">    Node h = head;</span><br><span class="line">    Node s;</span><br><span class="line">    <span class="keyword">return</span> h != t &amp;&amp;</span><br><span class="line">        ((s = h.next) == <span class="keyword">null</span> || s.thread != Thread.currentThread());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºç¬¬ä¸€ä¸ªè¿›å…¥çš„æ—¶å€™ aqsä¸­çš„è¿™ä¸ª tail å’Œ head è‚¯å®šæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ h != t å¿…å®šè¿”å›falseã€‚æ‰€ä»¥ä¸åŠ é”ã€‚ çº¿ç¨‹çš„å¹¶å‘çŠ¶å†µï¼Œå¦‚æœä¸å­˜åœ¨ç«äº‰ï¼Œäº¤æ›¿æ‰§è¡Œé‚£è‚¯å®š ä¸ä¼šç”¨åˆ°AQSçš„è¿™ä¸ªé˜Ÿåˆ—æ“</p><h4 id="1-13-å…¥é˜Ÿè¿‡ç¨‹"><a href="#1-13-å…¥é˜Ÿè¿‡ç¨‹" class="headerlink" title="1.13 å…¥é˜Ÿè¿‡ç¨‹"></a>1.13 å…¥é˜Ÿè¿‡ç¨‹</h4><p><strong>1ã€addWaiter(Node node)</strong><br>å°†èŠ‚ç‚¹åŒ…è£…æˆNode</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">     * å½“ç¬¬ä¸€æ¡çº¿ç¨‹å…¥é˜Ÿçš„æ—¶å€™ï¼Œä¸ä¼šèµ°è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * å½“ç¬¬äºŒæ¡çº¿ç¨‹æ¥çš„æ—¶å€™ï¼›</span></span><br><span class="line"><span class="comment">     *   å°¾éƒ¨èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå½“å‰çº¿ç¨‹åŒ…è£…çš„èŠ‚ç‚¹node.pred = pred å°±æ˜¯ä¸Šä¸€ä¸ªçº¿ç¨‹åŒ…è£…çš„Node</span></span><br><span class="line"><span class="comment">     *   compareAndSetTail(pred, node)</span></span><br><span class="line"><span class="comment">     *      å°† AQS çš„ tail = å½“å‰çº¿ç¨‹åŒ…è£…çš„èŠ‚ç‚¹node</span></span><br><span class="line"><span class="comment">     *      node.next = å½“å‰çº¿ç¨‹åŒ…è£…çš„èŠ‚ç‚¹node</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">        node.prev = pred;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">            pred.next = node;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¡çº¿ç¨‹å…¥é˜Ÿæ—¶å€™ èµ°è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2ã€enq(node)</strong><br>çº¿ç¨‹ç¬¬ä¸€æ¬¡å…¥é˜Ÿçš„æ—¶å€™ï¼šèµ°enq</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Node t = tail;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &lt;br&gt;</span></span><br><span class="line"><span class="comment">         * ç¬¬ä¸€æ¬¡å¾ªç¯ä¸ä¼š å°¾éƒ¨èŠ‚ç‚¹å¿…ç„¶æ˜¯ç©ºçš„ã€‚</span></span><br><span class="line"><span class="comment">         * æ‰€ä»¥åˆå§‹åŒ–ä¸€ä¸ª ä»€ä¹ˆéƒ½ä¸è£…çš„Node å¹¶ä¸”setHead </span></span><br><span class="line"><span class="comment">         * AQSçš„ head = new Node(); å¦‚æœnodeä¸ºç©ºï¼Œåœ¨acquireQueuedä¼šæŠ¥ç©ºæŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * æ­¤æ—¶ AQSçš„ head = tail = new Node();</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * å› ä¸ºæ˜¯æ­»å¾ªç¯ï¼šæ¥ç€ç¬¬äºŒæ¬¡éå†</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * æ­¤æ—¶ t==null ä¸æˆç«‹ èµ° else</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * node.pred  =  AQSçš„ head</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * compareAndSetTail(t, node)</span></span><br><span class="line"><span class="comment">         *    è®¾ç½® AQSçš„ tail = node(å½“å‰çº¿ç¨‹åŒ…è£…çš„node)</span></span><br><span class="line"><span class="comment">         *    node.next æŒ‡å‘è‡ªå·±ï¼›</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123; <span class="comment">// Must initialize</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                tail = head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.prev = t;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class="line">                t.next = node;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3ã€acquireQueued</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  å½“çº¿ç¨‹åŒ…è£…æˆèŠ‚ç‚¹çš„æ—¶å€™å°±ä¼šè°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arg</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * &lt;br&gt;</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * è·å–addWaiteråŒ…è£…çš„èŠ‚ç‚¹node,çš„å±± ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="comment">             * åœ¨ ç¬¬ä¸€ä¸ªçº¿ç¨‹å…¥é˜Ÿçš„æ—¶å€™ head å·²ç»åˆå§‹åŒ–äº†ï¼Œä¸º new Node(),ç¬¬ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">             * node.pred = new Node();æ­¤æ—¶ ä¸ä¼šç©ºï¼Œä¸æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * ç¬¬ä¸€æ¡çº¿ç¨‹æ¥çš„æ—¶å€™ï¼Œp == head æˆç«‹ï¼Œä¼šå†æ¬¡èµ°ä¸€é  tryAcquire(arg)</span></span><br><span class="line"><span class="comment">             * å¦‚æœè·å¾—é”æˆåŠŸï¼Œæ­¤æ—¶ä¿®æ”¹å¤´èŠ‚ç‚¹ ä¸º node , p.next æŒ‡å‘ä¸ºç©ºï¼Œæ­¤æ—¶ï¼Œé˜Ÿåˆ—æ²¡æœ‰æ’é˜Ÿçš„çº¿ç¨‹äº†ã€‚</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * a. ç¬¬ä¸€æ¡çº¿ç¨‹æ¥æ’é˜Ÿæ—¶å€™</span></span><br><span class="line"><span class="comment">             * å‡å¦‚ tryAcquire(arg) ä¸æˆç«‹ï¼Œèµ° shouldParkAfterFailedAcquire</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * bã€ç¬¬äºŒæ¡çº¿ç¨‹æ¥çš„æ—¶å€™ï¼Œæ­¤æ—¶è·å–é”çš„çº¿ç¨‹è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œé˜Ÿåˆ—ä¸­å·²ç»æœ‰ä¸€æ¡äº†ï¼Œæˆ‘æ˜¯æ¥ç¬¬äºŒä¸ªæ’é˜Ÿçš„</span></span><br><span class="line"><span class="comment">             *   æ¬¡æ¡çº¿ç¨‹çš„node.pred æŒ‡å‘çš„å°±æ˜¯ ä¸Šä¸€ä¸ªå…¥é˜Ÿçš„Nodeã€‚ addWaiter()æ–¹æ³•ä¸­å¤„ç†çš„</span></span><br><span class="line"><span class="comment">             *   æ­¤æ—¶ p == head &amp;&amp; tryAcquire(arg) ä¹Ÿä¸æˆç«‹ï¼Œç»§ç»­èµ° shouldParkAfterFailedAcquire</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">final</span> AbstractQueuedSynchronizer.Node p = node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4ã€shouldParkAfterFailedAcquire(p, node)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * &lt;br&gt;</span></span><br><span class="line"><span class="comment">      *  a.  å‡å¦‚ ç¬¬ä¸€æ¡çº¿æ¥æ’é˜Ÿçš„æ—¶å€™ï¼ŒtryAcquire(arg) ä¸æˆç«‹ï¼›åˆ™ pred = new Node()</span></span><br><span class="line"><span class="comment">      *    æ­¤æ—¶è¿™ä¸ª waitStatus æ˜¯åˆå§‹å€¼0ï¼›</span></span><br><span class="line"><span class="comment">      *    æ‰€ä»¥ compareAndSetWaitStatus(pred, ws, SIGNAL);</span></span><br><span class="line"><span class="comment">      *    å°† pred çš„waitStatus ä¿®æ”¹ä¸º SIGNAL = -1</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * &lt;br&gt;</span></span><br><span class="line"><span class="comment">      *  b. ç¬¬äºŒæ¡çº¿ç¨‹è¿›æ¥æ’é˜Ÿçš„æ—¶å€™ï¼Œæ­¤æ—¶pred å°±æ˜¯ä¸Šä¸€ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªnode</span></span><br><span class="line"><span class="comment">      *       ä¸Šä¸€æ¡nodeè¿›æ¥çš„æ—¶å€™ï¼Œpred.waitStatus å·²ç»è¢«ä¿®æ”¹ä¸º -1äº†ã€‚</span></span><br><span class="line"><span class="comment">      *       æ‰€ä»¥ ws == Node.SIGNAL æˆç«‹ è¿”å› true,parkAndCheckInterrupt() é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">int</span> ws = pred.waitStatus;</span><br><span class="line">     <span class="keyword">if</span> (ws == Node.SIGNAL)</span><br><span class="line">         <span class="comment">/*</span></span><br><span class="line"><span class="comment">          * This node has already set status asking a release</span></span><br><span class="line"><span class="comment">          * to signal it, so it can safely park.</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">     <span class="keyword">if</span> (ws &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">/*</span></span><br><span class="line"><span class="comment">          * Predecessor was cancelled. Skip over predecessors and</span></span><br><span class="line"><span class="comment">          * indicate retry.</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">         <span class="keyword">do</span> &#123;</span><br><span class="line">             node.prev = pred = pred.prev;</span><br><span class="line">         &#125; <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>);</span><br><span class="line">         pred.next = node;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">/*</span></span><br><span class="line"><span class="comment">          * waitStatus must be 0 or PROPAGATE.  Indicate that we</span></span><br><span class="line"><span class="comment">          * need a signal, but don&#x27;t park yet.  Caller will need to</span></span><br><span class="line"><span class="comment">          * retry to make sure it cannot acquire before parking.</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">         compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><strong>5ã€å…¥é˜ŸèŠ‚ç‚¹ æµç¨‹å›¾</strong><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-20/1582193140776.jpg" alt="é•¿æˆªå›¾   20200220 ä¸‹åˆ06.05.18.jpg"></p><h4 id="1-14-è§£é”è¿‡ç¨‹-new-FairSync-lock"><a href="#1-14-è§£é”è¿‡ç¨‹-new-FairSync-lock" class="headerlink" title="1.14 è§£é”è¿‡ç¨‹ new FairSync().lock()"></a>1.14 è§£é”è¿‡ç¨‹ new FairSync().lock()</h4><p>unlock-&gt;sync.releas(1)-&gt;tryRelease(1)</p><p><strong>1ã€release(1)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœcas æˆåŠŸï¼Œå”¤é†’é˜Ÿåˆ—çš„ä¸­ä¸­çš„æ’é˜Ÿçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2ã€tryRelease(arg)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–state å€¼ï¼Œå‡1ï¼ŒåŠ é”çš„æ—¶å€™å¦‚æœæ²¡æœ‰è‡ªæ—‹ å°±æ˜¯1ï¼Œæœ‰è‡ªæ—‹å¤šä¸€æ¬¡ä¹Ÿå°±å¤šåŠ ä¸€æ¬¡1</span></span><br><span class="line">       <span class="keyword">int</span> c = getState() - releases;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// åˆ¤æ–­ å½“å‰çº¿ç¨‹ æ˜¯ä¸æ˜¯è‡ªå·±çš„çº¿ç¨‹</span></span><br><span class="line">       <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">       <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// stateä¸º0 ï¼Œ æ¶ˆé™¤æŒæœ‰é”çš„çº¿ç¨‹ï¼Œä¿®æ”¹setStateçš„å€¼</span></span><br><span class="line">       <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">           free = <span class="keyword">true</span>;</span><br><span class="line">           setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       setState(c);</span><br><span class="line">       <span class="keyword">return</span> free;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong>3ã€unparkSuccessor(Node)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * If status is negative (i.e., possibly needing signal) try</span></span><br><span class="line"><span class="comment">     * to clear in anticipation of signalling.  It is OK if this</span></span><br><span class="line"><span class="comment">     * fails or if status is changed by waiting thread.</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="keyword">int</span> ws = node.waitStatus;</span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        ä¿®æ”¹ä¸ºåˆå§‹å€¼</span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Thread to unpark is held in successor, which is normally</span></span><br><span class="line"><span class="comment">     * just the next node.  But if cancelled or apparently null,</span></span><br><span class="line"><span class="comment">     * traverse backwards from tail to find the actual</span></span><br><span class="line"><span class="comment">     * non-cancelled successor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Node s = node.next; <span class="comment">// head.next æŒ‡å‘çš„å°±æ˜¯ é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªnodeï¼›</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹ waitStatus&gt;0 çº¿ç¨‹è¢«ä¸­æ–­ ç«å–æ¶ˆäº†ï¼Œéå†æ‰¾ æœ€è¿‘ä¸€ä¸ª å”¤é†’</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        s = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªè¢«å”¤é†’äº†ï¼Œå”¤é†’é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œéå†æŸ¥æ‰¾ æœ€å‰çš„ waitStatusä¸º&lt;= 0çš„èŠ‚ç‚¹ï¼Œå°†å…¶å”¤é†’ï¼Œè°ƒç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  è§£é™¤é˜»å¡</span></span><br><span class="line">    <span class="keyword">if</span> (s != <span class="keyword">null</span>)</span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ReentrantLock&quot;&gt;&lt;a href=&quot;#ReentrantLock&quot; class=&quot;headerlink&quot; title=&quot;ReentrantLock&quot;&gt;&lt;/a&gt;ReentrantLock&lt;/h1&gt;&lt;p&gt;&amp;emsp; &lt;code&gt;ReentrantLock&lt;/code&gt; åœ¨1.6 ä¹‹å‰ï¼Œæ€§èƒ½æ¯” &lt;code&gt;Synchronized&lt;/code&gt;ï¼Œå¥½å¾ˆå¤šï¼Œå› ä¸ºå®ç°åŒæ­¥ï¼Œä¸éœ€è¦åˆ°jvmçš„æ“ä½œç³»ç»Ÿä¸­å¤„ç†ï¼Œåœ¨javaä»£ç å±‚é¢å°±å¯ä»¥å¤„ç†æ‰ï¼Œè€ŒSynchronized æ˜¯éœ€è¦åˆ°æ“ä½œç³»ç»Ÿå¤„ç†ã€‚åœ¨1.6ä¹‹åï¼ŒSynchronized è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨æ€§ä¸Šæ²¡æœ‰å¤ªå¤šçš„å·®åˆ«ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="é”" scheme="http://lyj08.gitee.io/categories/%E9%94%81/"/>
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/%E9%94%81/java/"/>
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://lyj08.gitee.io/categories/%E9%94%81/java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="å¹¶å‘ç¼–ç¨‹" scheme="http://lyj08.gitee.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
      <category term="é”" scheme="http://lyj08.gitee.io/tags/%E9%94%81/"/>
    
      <category term="lock" scheme="http://lyj08.gitee.io/tags/lock/"/>
    
  </entry>
  
  <entry>
    <title>mysqlä¸»ä»åŒæ­¥ï¼ˆä¸€ä¸»ä¸€ä»æ­å»ºï¼‰</title>
    <link href="http://lyj08.gitee.io/posts/c357a4cf/"/>
    <id>http://lyj08.gitee.io/posts/c357a4cf/</id>
    <published>2020-02-03T15:27:40.000Z</published>
    <updated>2020-12-30T09:27:20.392Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ä¸»æœåŠ¡å™¨</strong><br>|è§’è‰²|ä¸»æœº|ç‰ˆæœ¬|<br>|-|-|-|<br>|ä¸»æœåŠ¡å™¨|centos 7 106.14.226.138|5.7.11|<br>|ä»æœåŠ¡å™¨ï¼ˆdockerå®‰è£…çš„mysqlï¼‰|centos 7 thisforyou.cn| 5.7.28|</p><h3 id="1ã€ä¸»æœåŠ¡å™¨-é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š"><a href="#1ã€ä¸»æœåŠ¡å™¨-é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š" class="headerlink" title="1ã€ä¸»æœåŠ¡å™¨:é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š"></a>1ã€ä¸»æœåŠ¡å™¨:é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š</h3><p>ç¼–è¾‘ä¸»æ•°æ®è‹¦çš„é…ç½®æ–‡ä»¶my.cnf</p><a id="more"></a><p>vim /etc/my.cnf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">basedir=/usr/local/mysql</span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line">port=<span class="number">3306</span></span><br><span class="line"></span><br><span class="line"># åœ¨åŸæœ‰åŸºç¡€ä¸Šå¢åŠ </span><br><span class="line">server_id=<span class="number">1</span></span><br><span class="line">log_bin=/usr/local/mysql/mysql-bin</span><br><span class="line">log_bin_index=/usr/local/mysql/mysql-bin-index</span><br><span class="line">binlog_format=mixed</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å‚æ•°è§£é‡Š</strong></p><ol><li>server-idï¼šç”¨æ¥æ ‡è¯†ä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹</li><li>log_binï¼šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œmysqlç”¨æˆ·å¯¹è¯¥è·¯å¾„å¿…é¡»å…·æœ‰è¯»å†™æƒé™.</li><li>log_bin_indexï¼šäºŒè¿›åˆ¶æ–‡ä»¶çš„ç´¢å¼•è·¯å¾„ï¼Œmysqlç”¨æˆ·å¯¹è¯¥è·¯å¾„å¿…é¡»å…·æœ‰è¯»å†™æƒé™.</li><li>binlog_formatï¼šè¡¨ç¤ºäºŒè¿›åˆ¶æ—¥å¿—å†…å®¹çš„è®°å½•æ–¹å¼ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼š<br> aã€row:åŸºäºè¡Œè®°å½•çš„æ–¹å¼ï¼ŒMySQLä¼šå°†çœŸå®å‘ç”Ÿå˜åŒ–çš„è¡Œè®°å½•è¿›æ—¥å¿—ï¼Œæ‰€ä»¥å¦‚æœæœ‰updateæ›´æ–°å…¨è¡¨çš„æ“ä½œï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¼šå˜å¾—éå¸¸å¤§ã€‚é€šå¸¸ç”¨äºSQLè¯­å¥å¤æ‚ä½†æ˜¯å½±å“çš„è¡Œæ¯”è¾ƒå°‘çš„åœºæ™¯<br> bã€statement:åŸºäºè¯­å¥çš„æ–¹å¼ï¼ŒMySQLä¼šå°†å¯¼è‡´æ•°æ®å‘ç”Ÿå˜åŒ–çš„SQLè¯­å¥è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€‚ç”¨äºä¸€æ¡è¯­å¥å½±å“å¾ˆå¤šè¡Œçš„åœºæ™¯ï¼Œä½†æ˜¯æ³¨æ„å½“åœ¨ä¸»åº“ä¸Šä½¿ç”¨åˆ°äº†UUIDï¼ŒSYSDATEï¼ŒFOUND_ROWSå‡½æ•°æ—¶ï¼Œä½¿ç”¨statementæ–¹å¼çš„å¤åˆ¶ä¼šå‡ºç°ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µï¼›<br> cã€mixed:æ··åˆè®°å½•æ¨¡å¼ï¼ŒMySQLä¼šè‡ªåŠ¨è¿›è¡Œåˆ¤æ–­å…·ä½“æ˜¯ä½¿ç”¨rowæ ¼å¼è¿˜æ˜¯statementæ ¼å¼ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½ä½¿ç”¨mixedï¼Œç”±MySQLæ¥è¿›è¡Œåˆ¤æ–­</li></ol><p>log_binã€log_bin_index æ‰€åœ¨è·¯å¾„æˆè¯»å†™æƒé™</p><p><code>chown 777 /usr/local/mysql/</code></p><h4 id="é‡å¯æ•°æ®åº“ï¼Œé…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚"><a href="#é‡å¯æ•°æ®åº“ï¼Œé…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚" class="headerlink" title="é‡å¯æ•°æ®åº“ï¼Œé…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚"></a>é‡å¯æ•°æ®åº“ï¼Œé…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚</h4><p><code>/etc/init.d/mysql restart</code></p><h4 id="ç™»é™†æ•°æ®åº“-æŸ¥çœ‹-binlogçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹"><a href="#ç™»é™†æ•°æ®åº“-æŸ¥çœ‹-binlogçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹" class="headerlink" title="ç™»é™†æ•°æ®åº“ æŸ¥çœ‹ binlogçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹"></a>ç™»é™†æ•°æ®åº“ æŸ¥çœ‹ binlogçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åŠä½ç½®ç‚¹</h4><p><code>show master status \G</code><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-03/1580712274877.png" alt="1.png"></p><p>è®°ä¸‹æ¥<br><strong>File:</strong>è¿™ä¸ªæ–‡ä»¶åç§°éœ€è¦åœ¨ä»æœåŠ¡å™¨ä¸Šç”¨åˆ°<br><strong>position:</strong> ä¹Ÿéœ€è¦ </p><h3 id="2ã€å°†ä¸»æ•°æ®åº“ä¸Šçš„åº“ï¼ŒåŒæ­¥ä¸€ä»½åˆ°ä»æ•°æ®åº“ä¸Šã€‚"><a href="#2ã€å°†ä¸»æ•°æ®åº“ä¸Šçš„åº“ï¼ŒåŒæ­¥ä¸€ä»½åˆ°ä»æ•°æ®åº“ä¸Šã€‚" class="headerlink" title="2ã€å°†ä¸»æ•°æ®åº“ä¸Šçš„åº“ï¼ŒåŒæ­¥ä¸€ä»½åˆ°ä»æ•°æ®åº“ä¸Šã€‚"></a>2ã€å°†ä¸»æ•°æ®åº“ä¸Šçš„åº“ï¼ŒåŒæ­¥ä¸€ä»½åˆ°ä»æ•°æ®åº“ä¸Šã€‚</h3><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-03/1580712475044.png" alt="1.png"></p><h3 id="3ã€ä»æœåŠ¡å™¨-ä¿®æ”¹ä¸Šçš„mysqlé…ç½®æ–‡ä»¶ã€‚"><a href="#3ã€ä»æœåŠ¡å™¨-ä¿®æ”¹ä¸Šçš„mysqlé…ç½®æ–‡ä»¶ã€‚" class="headerlink" title="3ã€ä»æœåŠ¡å™¨:ä¿®æ”¹ä¸Šçš„mysqlé…ç½®æ–‡ä»¶ã€‚"></a>3ã€ä»æœåŠ¡å™¨:ä¿®æ”¹ä¸Šçš„mysqlé…ç½®æ–‡ä»¶ã€‚</h3><p>mysqlå·²ç»å®‰è£…ï¼Œé…ç½®æ–‡ä»¶ä¸€æŒ‚è½½åˆ°å®¿ä¸»æœºç›®å½•ä¸­ã€‚<br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-03/1580712645558.png" alt="1.png"></p><p><strong>ä¿®æ”¹</strong><br>vim mysql.conf.d/mysqld.cnf</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port            = <span class="number">3307</span></span><br><span class="line">pid-file        = /<span class="keyword">var</span>/run/mysqld/mysqld.pid</span><br><span class="line">socket          = /<span class="keyword">var</span>/run/mysqld/mysqld.sock</span><br><span class="line">datadir         = /<span class="keyword">var</span>/lib/mysql</span><br><span class="line">max_connections=<span class="number">200</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">max_allowed_packet=1024M</span><br><span class="line">log-error      = /<span class="keyword">var</span>/log/mysql/error.log</span><br><span class="line">prevent assorted security risks</span><br><span class="line">symbolic-links=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"># æ–°å¢</span><br><span class="line">server-id=<span class="number">2</span></span><br><span class="line">relay_log=/<span class="keyword">var</span>/lib/mysql/mysql-replay-bin</span><br><span class="line">relay_log_index=/<span class="keyword">var</span>/lib/mysql/mysql-replay-bin-index</span><br></pre></td></tr></table></figure><p><strong>relay_logã€relay_log_index:</strong> è·¯å¾„æ˜¯å®¹å™¨ä¸­çš„ç›®å½•</p><ol><li>relay_logï¼š å°±æ˜¯ä»æœåŠ¡å™¨ä¸Šçš„binlogäºŒè¿›åˆ¶æ–‡ä»¶,å†…å®¹æ¥è‡ªäºï¼Œä¸»æœåŠ¡å™¨ä¸Šçš„bin_log å†…å®¹ã€‚</li></ol><p>é…ç½®å¥½åé‡å¯mysql</p><p><code>docker restart mysql/å®¹å™¨id</code></p><h4 id="è¿›å…¥mysqlå®¹å™¨"><a href="#è¿›å…¥mysqlå®¹å™¨" class="headerlink" title="è¿›å…¥mysqlå®¹å™¨"></a>è¿›å…¥mysqlå®¹å™¨</h4><p><code>docker exec -it mysql/å®¹å™¨id bash</code></p><p>å¯ä»¥çœ‹çœ‹ /var/lib/mysql/ æ˜¯ä¸æ˜¯å¤šäº† mysql-replay-bin.0000*;ç³»åˆ—æ–‡ä»¶</p><h5 id="ç™»é™†mysqlï¼Œå¹¶å¼€å¯ä¸»ä»æœåŠ¡"><a href="#ç™»é™†mysqlï¼Œå¹¶å¼€å¯ä¸»ä»æœåŠ¡" class="headerlink" title="ç™»é™†mysqlï¼Œå¹¶å¼€å¯ä¸»ä»æœåŠ¡"></a>ç™»é™†mysqlï¼Œå¹¶å¼€å¯ä¸»ä»æœåŠ¡</h5><p><code>mysql -uroot -p # ç™»é™†</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;CHANGE MASTER TO </span><br><span class="line">master_host=<span class="string">&#x27;106.14.226.138&#x27;</span>,</span><br><span class="line">master_port=<span class="number">3306</span>,</span><br><span class="line">master_user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000004&#x27;</span>,</span><br><span class="line">master_log_pos =<span class="number">1590</span>; </span><br><span class="line"></span><br><span class="line"># master_host: ä¸»æ•°æ®åº“çš„ä¸»æœº</span><br><span class="line"># master_user: ä¸»æ•°æ®çš„ç™»é™†å¯†ç ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯rootè´¦æˆ·ï¼‰</span><br><span class="line"># master_password: å¯†ç </span><br><span class="line"># master_log_file: binlogäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå‰é¢åœ¨ä¸»æ•°æ®çœ‹ä¸Šçœ‹åˆ°çš„ã€‚`show master status \G` å¯çœ‹</span><br><span class="line"># master_log_pos: äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½®ç‚¹ `show master status \G` å¯çœ‹ã€‚</span><br><span class="line"></span><br><span class="line"># æ•²ä¸‹å›è½¦</span><br><span class="line"># å¼€å¯slave</span><br><span class="line">&gt; start slave;</span><br><span class="line">&gt; SHOW SLAVE STATUS \G å¦‚ä¸‹å›¾ï¼š</span><br></pre></td></tr></table></figure><p><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-03/1580713776398.png" alt="1.png"></p><p>âš ï¸ï¼šSlave_IO_Runningä¸ºYesè¡¨ç¤ºä¸»ä»åŒæ­¥æˆåŠŸï¼Œå¦‚æœä¸ºConnectingâ€¦ï¼Œç­‰å¾…ä¸€ä¼šå†çœ‹çœ‹ï¼Œå¦‚æœä¸ºNoï¼Œè¡¨ç¤ºåŒæ­¥å¤±è´¥ï¼›<br>âš ï¸ï¼šå¤±è´¥çš„åŸå› æœ‰è‚¯èƒ½æ˜¯ï¼Œè´¦å·å¯†ç ä¸å¯¹ï¼Œä¸»æ•°æ®çœ‹çš„ç«¯å£ï¼Œæ²¡æœ‰å¤–æ”¾ï¼Œä¸å…è®¸å…¶ä»–ipç™»é™†ï¼Œæˆ–è€…è´¦å·æ²¡æœ‰æƒé™â€¦</p><p>æ­¤æ—¶ï¼Œå¯ä»¥å»ä¸»æ•°æ®åº“å½•å–ä¸€æ¡æ•°æ®æµ‹è¯•çœ‹çœ‹æ˜¯å¦æˆåŠŸï¼</p><p>å‚è€ƒï¼š<a href="https://segmentfault.com/a/1190000015282191">https://segmentfault.com/a/1190000015282191</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;ä¸»æœåŠ¡å™¨&lt;/strong&gt;&lt;br&gt;|è§’è‰²|ä¸»æœº|ç‰ˆæœ¬|&lt;br&gt;|-|-|-|&lt;br&gt;|ä¸»æœåŠ¡å™¨|centos 7 106.14.226.138|5.7.11|&lt;br&gt;|ä»æœåŠ¡å™¨ï¼ˆdockerå®‰è£…çš„mysqlï¼‰|centos 7 thisforyou.cn| 5.7.28|&lt;/p&gt;
&lt;h3 id=&quot;1ã€ä¸»æœåŠ¡å™¨-é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š&quot;&gt;&lt;a href=&quot;#1ã€ä¸»æœåŠ¡å™¨-é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š&quot; class=&quot;headerlink&quot; title=&quot;1ã€ä¸»æœåŠ¡å™¨:é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š&quot;&gt;&lt;/a&gt;1ã€ä¸»æœåŠ¡å™¨:é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š&lt;/h3&gt;&lt;p&gt;ç¼–è¾‘ä¸»æ•°æ®è‹¦çš„é…ç½®æ–‡ä»¶my.cnf&lt;/p&gt;
    
    </summary>
    
    
      <category term="mysql" scheme="http://lyj08.gitee.io/categories/mysql/"/>
    
    
      <category term="linux" scheme="http://lyj08.gitee.io/tags/linux/"/>
    
      <category term="mysql" scheme="http://lyj08.gitee.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å°†ç§æœ‰jar,ä¸Šä¼ åˆ°è‡ªå·±çš„nexusç§æœé‡Œé¢å»ï¼Ÿ</title>
    <link href="http://lyj08.gitee.io/posts/7bc7c52/"/>
    <id>http://lyj08.gitee.io/posts/7bc7c52/</id>
    <published>2020-01-29T21:33:26.000Z</published>
    <updated>2020-12-30T09:27:43.929Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å»ºç«‹ä¸€ä¸ªStarter"><a href="#å»ºç«‹ä¸€ä¸ªStarter" class="headerlink" title="å»ºç«‹ä¸€ä¸ªStarter"></a>å»ºç«‹ä¸€ä¸ªStarter</h3><p>ä¾‹å¦‚æˆ‘çš„ä¸€ä¸ª ç±»ä¼¼ jpa é‚£æ ·çš„æ­£å‘å·¥å…·ç”Ÿæˆstarter<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580188010950.png" alt="3.png"></p><a id="more"></a><h3 id="ä¸»è¦é…ç½®-pom-xml"><a href="#ä¸»è¦é…ç½®-pom-xml" class="headerlink" title="ä¸»è¦é…ç½® pom.xml"></a>ä¸»è¦é…ç½® pom.xml</h3><p>åœ¨pomæ–‡ä»¶ä¸­åŠ å…¥ ä¸ dependencies æ ‡ç­¾åŒçº§</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">          &lt;id&gt;releases&lt;/id&gt;</span><br><span class="line">          &lt;url&gt;http:<span class="comment">//thisforyou.cn:28081/repository/maven-releases/&lt;/url&gt;</span></span><br><span class="line">        &lt;/repository&gt;</span><br><span class="line">        &lt;snapshotRepository&gt;</span><br><span class="line">            &lt;id&gt;snapshots&lt;/id&gt;</span><br><span class="line">            &lt;url&gt;http:<span class="comment">//thisforyou.cn:28081/repository/maven-snapshots/&lt;/url&gt;</span></span><br><span class="line">        &lt;/snapshotRepository&gt;</span><br><span class="line">    &lt;/distributionManagement&gt;</span><br></pre></td></tr></table></figure><p>âš ï¸<br>1.idæ ‡ç­¾ï¼šéšä¾¿èµ·ï¼Œä½†æ˜¯mavenä»“åº“ä¸­çš„serversèŠ‚ç‚¹éœ€è¦ä¸è¿™ä¸ªä¸€è‡³<br>2.urlï¼šå°±æ˜¯ä½ çš„ä»“åº“åœ°å€ï¼š<a href="http://thisforyou.cn:28081/repository/maven-releases">http://thisforyou.cn:28081/repository/maven-releases</a><br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>ä¸¤ä¸ªurl:ä¸€ä¸ªæ˜¯ç‰ˆæœ¬å¸¦-SNAPSHOT çš„ä¸€ä¸ªæ˜¯ä¸å¸¦çš„</p><p><strong>maven-releases</strong>ï¼šå¦‚æœä½ çš„starterä¸versionä¸å¸¦SNAPSHOTï¼Œå°±ä¼šä¸Šä¼ åˆ°è¿™ä¸ªä»“åº“ä¸­ï¼Œä»£è¡¨çš„æ˜¯æ­£å¼ç¨³å®šå‘å¸ƒç‰ˆæœ¬ã€‚<br><strong>maven-snapshots</strong>ï¼šå¸¦SNAPSHOTï¼Œå°±æ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œå¼€å‘ä¸­çš„ã€‚</p><p>ä¸Šé¢è¿™ä¸¤ä¸ªä»“åº“æ˜¯è¦å¯¹åº” nexusä¸Šçš„ä¸ç„¶æ‰“åŒ…ä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ æ‰¾ä¸åˆ°å¯¹åº”çš„ä»“åº“çš„ã€‚</p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580188417971.png" alt="5.png"></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580188348263.png" alt="4.png"></p><p>pomæ–‡ä»¶é…ç½®å¥½åï¼Œå°±ç›´æ¥clean ç„¶å deploy;<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580188770288.png" alt="6.png"></p><p>æŸ¥çœ‹ä»“åº“æ˜¯å¦å·²ç»ä¸Šä¼ äº†ï¼š<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580188943240.png" alt="7.png"></p><p>ç‚¹å‡»è¿›å»çœ‹çœ‹ï¼Œmaven-public ä¼šåŒ…å«ä¸¤ä¸ª ä¸€ä¸ª ä¸å¸¦SNAPSHOTï¼Œä¸€ä¸ªå¸¦çš„ï¼Œå¦‚æœä¸¤ä¸ªéƒ½ä¸Šä¼ äº†ï¼Œå°±ä¼šæœ‰ä¸¤ä¸ªã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™çš„ maven çš„ settings.xmlé…ç½® å†™maven-publicå°±å¥½äº†ã€‚<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580189053221.png" alt="8.png"></p><h3 id="maven-settings-xmlé…ç½®"><a href="#maven-settings-xmlé…ç½®" class="headerlink" title="maven settings.xmlé…ç½®"></a>maven settings.xmlé…ç½®</h3><h4 id="servers-èŠ‚ç‚¹"><a href="#servers-èŠ‚ç‚¹" class="headerlink" title="servers èŠ‚ç‚¹"></a>servers èŠ‚ç‚¹</h4><p>æ‰¾åˆ°æˆ‘ä»¬çš„æœ¬åœ°å¼€å‘çš„mavené…ç½®æ–‡ä»¶ï¼Œ conf/settiings.xml</p><p>æ‰“å¼€ç¼–è¾‘ä»–ï¼š<br>æ‰¾åˆ° servers èŠ‚ç‚¹ï¼š å¡«å†™å¦‚ä¸‹ä¿¡æ¯<br>è®°ä½è¿™ä¸ª</p><p>*id è¦ä¸ pom.xml é‚£é‡Œçš„ idä¸€è‡³<br>*username å°±æ˜¯ä½ çš„è´¦å·<br>*password å°±æ˜¯å¯†ç </p><p>é…ç½®å¥½ä¸¤ä¸ªï¼šä¸€ä¸ªå¿«ç…§çš„ ä¸€ä¸ª ç¨³å®šç‰ˆæœ¬çš„ã€‚</p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580189212937.png" alt="9.png"></p><h4 id="mirrors-èŠ‚ç‚¹"><a href="#mirrors-èŠ‚ç‚¹" class="headerlink" title="mirrors èŠ‚ç‚¹"></a>mirrors èŠ‚ç‚¹</h4><p>id:éšä¾¿å†™<br>name:éšä¾¿å†™<br>url:å¡«å†™nexusçš„maven-publicåœ°å€å³å¯<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580189591641.png" alt="11.png"></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580189468996.png" alt="10.png"></p><h3 id="ä»ç§æœæ‹‰å–æˆ‘ä»¬çš„jaråŒ…"><a href="#ä»ç§æœæ‹‰å–æˆ‘ä»¬çš„jaråŒ…" class="headerlink" title="ä»ç§æœæ‹‰å–æˆ‘ä»¬çš„jaråŒ…"></a>ä»ç§æœæ‹‰å–æˆ‘ä»¬çš„jaråŒ…</h3><p>æ‰“å¼€å¦å¤–ä¸€ä¸ªé¡¹ç›®ï¼š<br>å¡«å†™å¥½ï¼Œåˆ·æ–°ä¸€ä¸‹å³å¯<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580189842062.png" alt="12.png"></p><p><strong><a href="http://github.com/memoryoverflow/forward-generation-starter">Starter æºç </a></strong> </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å»ºç«‹ä¸€ä¸ªStarter&quot;&gt;&lt;a href=&quot;#å»ºç«‹ä¸€ä¸ªStarter&quot; class=&quot;headerlink&quot; title=&quot;å»ºç«‹ä¸€ä¸ªStarter&quot;&gt;&lt;/a&gt;å»ºç«‹ä¸€ä¸ªStarter&lt;/h3&gt;&lt;p&gt;ä¾‹å¦‚æˆ‘çš„ä¸€ä¸ª ç±»ä¼¼ jpa é‚£æ ·çš„æ­£å‘å·¥å…·ç”Ÿæˆstarter&lt;br&gt;&lt;img src=&quot;http://www.memoryoverflow.cn/file/articleContentImg/2020-01-28/1580188010950.png&quot; alt=&quot;3.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Nexus" scheme="http://lyj08.gitee.io/categories/Nexus/"/>
    
    
      <category term="Nexus" scheme="http://lyj08.gitee.io/tags/Nexus/"/>
    
      <category term="maven" scheme="http://lyj08.gitee.io/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>åŠ å¯†æ–‡ç« æµ‹è¯•</title>
    <link href="http://lyj08.gitee.io/posts/7e709353/"/>
    <id>http://lyj08.gitee.io/posts/7e709353/</id>
    <published>2020-01-21T02:14:11.000Z</published>
    <updated>2020-12-30T06:48:54.543Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="ä¸å¥½æ„æ€ï¼Œå¯†ç æ²¡å¯¹å“¦ï¼Œåœ¨æ£€æŸ¥æ£€æŸ¥å‘¢ï¼" data-whm="ä¸å¥½æ„æ€ï¼Œä¿¡æ¯æ— æ³•éªŒè¯ï¼">  <script id="hbeData" type="hbeData" data-hmacdigest="f0f9c9cb2c90f3c8d8b638899d3e6bab0b7028795b0f7c3f96c9f31947f55a5b">4630436162ade97ba2718b7d0c4b3b63480c11f21f943edd569d93952dd2b428ca40d00edd08503bde446612a9b43ffa557648f22736556fdb8df232a70f5b62381872db0244c43c00526e1a08cf52221edf34128af95f6689fc9f8038d2d384d80553865a152ddd5e6208a870af3b5c9bc83d20b2dbb9eed9bf4345fcbd80740d0d96973b857ce18daf962a01b68ae1d5fbd8ee95919ff5e4e59e2389903324d011f36e647c7bfde1d377a277b639b7845f1864318dedde1881f738423184c1eda461211d6767b7282687bd23a77a8725cebce8f83995baff71092164b22479</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">å—¨ï¼Œè¯·å‡†ç¡®æ— è¯¯åœ°è¾“å…¥å¯†ç æŸ¥çœ‹å“Ÿï¼ˆå¯†ç ï¼š123456ï¼‰ï¼</span>      </label>    </div>  </div></div><script src="/blog/lib/hbe.js"></script><link href="/blog/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      å’¦ï¼Œè¿™æ˜¯ä¸€ç¯‡åŠ å¯†æ–‡ç« ï¼Œå¥½åƒéœ€è¦è¾“å…¥å¯†ç æ‰èƒ½æŸ¥çœ‹å‘¢ï¼
    
    </summary>
    
    
      <category term="private" scheme="http://lyj08.gitee.io/categories/private/"/>
    
    
      <category term="åŠ å¯†æ–‡ç« " scheme="http://lyj08.gitee.io/tags/%E5%8A%A0%E5%AF%86%E6%96%87%E7%AB%A0/"/>
    
  </entry>
  
  <entry>
    <title>å°†jaråŒ…åšæˆç³»ç»ŸæœåŠ¡-linux</title>
    <link href="http://lyj08.gitee.io/posts/180c3fe2/"/>
    <id>http://lyj08.gitee.io/posts/180c3fe2/</id>
    <published>2020-01-15T22:26:52.000Z</published>
    <updated>2020-12-30T09:27:52.365Z</updated>
    
    <content type="html"><![CDATA[<p>SpringBootçš„é¡¹ç›®éƒ¨ç½²æœ‰å¥½å‡ ç§ï¼Œæœ‰dockeræ–¹å¼ï¼Œæœ‰waråŒ…é€šè¿‡tomcatéƒ¨ç½²æ–¹å¼ï¼Œä¹Ÿæœ‰ java -jar çš„éƒ¨ç½²æ–¹å¼ã€‚</p><p><strong>æœ¬æ–‡ æ˜¯åŸºäº java -jar æ¥å¯åŠ¨éƒ¨ç½²é¡¹ç›®ï¼Œåšæˆç³»ç»ŸæœåŠ¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºå¼€æœºè‡ªå¯</strong></p><h2 id="1ã€è„šæœ¬ç¼–å†™"><a href="#1ã€è„šæœ¬ç¼–å†™" class="headerlink" title="1ã€è„šæœ¬ç¼–å†™"></a>1ã€è„šæœ¬ç¼–å†™</h2><p>ç›®å½•ï¼š/opt/project jaråŒ…å’Œå¯åŠ¨åœæ­¢è„šæœ¬éƒ½åŸºäºè¿™é‡Œæ“ä½œï¼Œ ä¸€ä¸‹çš„æ“ä½œå‘½ä»¤ éƒ½åŸºäº è¿™ä¸ªå‘½ä»¤ ä¹‹å <code>cd  /opt/project</code> </p><ol><li><p>å°†é¡¹ç›®æ‰“å¥½çš„jaråŒ…ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨çš„æŸä¸ªè·¯å¾„ä¸­ï¼Œæ¯”å¦‚ï¼š<code>/opt/project/boot-test.jar</code></p></li><li><p>åœ¨æœ¬ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª å¯åŠ¨è„šæœ¬ <code>start.sh</code><br> ç¼–å†™å¯åŠ¨è„šæœ¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!bin&#x2F;sh</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"># å¯åŠ¨å‘½ä»¤ </span><br><span class="line">nohup&gt;&#x2F;opt&#x2F;project&#x2F;log java -jar &#x2F;opt&#x2F;project&#x2F;jar&#x2F;boot-test.jar 2&gt;&amp; 1 &amp;</span><br><span class="line">           </span><br></pre></td></tr></table></figure><a id="more"></a></li><li><p>åœæ­¢è„šæœ¬ stop.sh</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!bin&#x2F;sh</span><br><span class="line">pid&#x3D;$(ps -ef | grep boot-test.jar | grep -v grep | awk &#39;&#123;print $2&#125;&#39;)</span><br><span class="line">kill -9 $pid</span><br><span class="line">echo $pid</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>æ–‡ä»¶æˆæƒ  </li></ol><p>å¦‚æœè„šæœ¬ä¸æˆæ‰§è¡Œæƒé™ä¼šå‡ºç° 203 çš„é”™è¯¯</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x start.sh</span><br><span class="line">chmod +x stop.sh</span><br><span class="line">chmod +x boot-test.jar</span><br></pre></td></tr></table></figure><ol start="5"><li><p>ç¼–å†™æœåŠ¡æ–‡ä»¶</p><p><code>vim /etc/systemd/system/boot-test.serivce</code></p><p>å¡«å†™å†…å®¹ï¼š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;blog-service</span><br><span class="line"></span><br><span class="line">After&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"></span><br><span class="line">Type&#x3D;forking</span><br><span class="line"></span><br><span class="line">ExecStart&#x3D;&#x2F;opt&#x2F;project&#x2F;blog&#x2F;start.sh</span><br><span class="line">ExecStop&#x3D;&#x2F;opt&#x2F;project&#x2F;stop.sh</span><br><span class="line"></span><br><span class="line">PrivateTmp&#x3D;true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"></span><br><span class="line"> WantedBy&#x3D;multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="2ã€ç‰¹åˆ«æ³¨æ„"><a href="#2ã€ç‰¹åˆ«æ³¨æ„" class="headerlink" title="2ã€ç‰¹åˆ«æ³¨æ„"></a>2ã€ç‰¹åˆ«æ³¨æ„</h2><p>  <strong>203 é”™è¯¯åŸå› :</strong></p><ol><li>start.sh å’Œ stop.sh ä¸æˆäºˆæ‰§è¡Œæƒé™ã€‚ è§£å†³ï¼š<code>chmod +x start.sh &amp;&amp; chmod +x stop.sh</code></li><li>è„šæœ¬å¤´éƒ¨æ²¡æœ‰å†™ <code>#!bin/sh</code>ã€‚vim åŠ ä¸Šå³å¯</li><li>jaråŒ…æ²¡æœ‰æ‰§è¡Œæƒé™ã€‚ <code>chmod +x boot-test.jar</code><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-26/1582702669438.png" alt="5.png"></li></ol><p><strong>å…¶å®ƒé”™è¯¯åŸå› ï¼š</strong><br> <img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-26/1582702532689.png" alt="1.png"><br>ä¾‹å¦‚æ‰§è¡Œå®Œå¯åŠ¨å‘½ä»¤ï¼ŒåæŸ¥çœ‹çŠ¶æ€ <code>systemctl status boot-test.service</code></p><p>å¯åŠ¨å‘½é¢˜æç¤ºæˆ <code>status=0/SUCCESS</code> ä½†æ˜¯å¤±è´¥ã€‚</p><p>è¿™ç§æƒ…å†µå¯èƒ½æ˜¯ï¼šæ‰§è¡Œçš„ jaråŒ…æ‰€éœ€è¦çš„ç¯å¢ƒæ²¡æœ‰ã€‚æ— æ³•å¯åŠ¨ï¼ŒjaråŒ…æ‰€éœ€è¦çš„ç¯å¢ƒæ˜¯ javaç¯å¢ƒã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><ol><li>åœ¨å¯åŠ¨è„šæœ¬ çš„ <code>#!bin/sh</code> ä¸‹é¢åŠ ä¸Š ç¯å¢ƒå˜é‡ <code>source /etc/profile</code> æ­¤å‘½ä»¤å‰ææ˜¯ Javaå·²ç»åœ¨è¿™æ–‡ä»¶ä¸­é…ç½®äº†ç¯å¢ƒå˜é‡ï¼›<br>æˆ–è€… export <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;java&#x2F;jdk</span><br><span class="line">export </span><br><span class="line">PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH:&#x2F;opt&#x2F;project&#x2F;Hexo&#x2F;node_modules&#x2F;.bin:$PATH</span><br></pre></td></tr></table></figure></li><li>åœ¨<code>/etc/systemd/system/boot-test.service</code>ä¸­åŠ å…¥ç¯å¢ƒå˜é‡ã€‚<br>æ›´å¤šé…ç½® <a href="http://www.jinbuguo.com/systemd/systemd.service.html">ç§»æ­¥ System.service é…ç½®è¯¦æƒ…è¯´æ˜</a></li></ol><p>äºŒè€…é€‰ä¸€å³å¯ã€‚</p><h2 id="3ã€è®¾ç½®å¼€æœºè‡ªå¯"><a href="#3ã€è®¾ç½®å¼€æœºè‡ªå¯" class="headerlink" title="3ã€è®¾ç½®å¼€æœºè‡ªå¯"></a>3ã€è®¾ç½®å¼€æœºè‡ªå¯</h2><p><code>systemctl enable boot-test</code></p><p>å¯åŠ¨ï¼š<br><code>system start boot-test</code></p><p>æŸ¥çœ‹çŠ¶æ€ï¼š<br><code>system stop boot-test</code><br><img src="http://thisforyou.cn:180/file/articleContentImg/2020-02-26/1582702506427.png" alt="start.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SpringBootçš„é¡¹ç›®éƒ¨ç½²æœ‰å¥½å‡ ç§ï¼Œæœ‰dockeræ–¹å¼ï¼Œæœ‰waråŒ…é€šè¿‡tomcatéƒ¨ç½²æ–¹å¼ï¼Œä¹Ÿæœ‰ java -jar çš„éƒ¨ç½²æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ¬æ–‡ æ˜¯åŸºäº java -jar æ¥å¯åŠ¨éƒ¨ç½²é¡¹ç›®ï¼Œåšæˆç³»ç»ŸæœåŠ¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºå¼€æœºè‡ªå¯&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;1ã€è„šæœ¬ç¼–å†™&quot;&gt;&lt;a href=&quot;#1ã€è„šæœ¬ç¼–å†™&quot; class=&quot;headerlink&quot; title=&quot;1ã€è„šæœ¬ç¼–å†™&quot;&gt;&lt;/a&gt;1ã€è„šæœ¬ç¼–å†™&lt;/h2&gt;&lt;p&gt;ç›®å½•ï¼š/opt/project jaråŒ…å’Œå¯åŠ¨åœæ­¢è„šæœ¬éƒ½åŸºäºè¿™é‡Œæ“ä½œï¼Œ ä¸€ä¸‹çš„æ“ä½œå‘½ä»¤ éƒ½åŸºäº è¿™ä¸ªå‘½ä»¤ ä¹‹å &lt;code&gt;cd  /opt/project&lt;/code&gt; &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å°†é¡¹ç›®æ‰“å¥½çš„jaråŒ…ï¼Œä¸Šä¼ è‡³æœåŠ¡å™¨çš„æŸä¸ªè·¯å¾„ä¸­ï¼Œæ¯”å¦‚ï¼š&lt;code&gt;/opt/project/boot-test.jar&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;åœ¨æœ¬ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª å¯åŠ¨è„šæœ¬ &lt;code&gt;start.sh&lt;/code&gt;&lt;br&gt; ç¼–å†™å¯åŠ¨è„šæœ¬&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#!bin&amp;#x2F;sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;source &amp;#x2F;etc&amp;#x2F;profile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# å¯åŠ¨å‘½ä»¤ &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nohup&amp;gt;&amp;#x2F;opt&amp;#x2F;project&amp;#x2F;log java -jar &amp;#x2F;opt&amp;#x2F;project&amp;#x2F;jar&amp;#x2F;boot-test.jar 2&amp;gt;&amp;amp; 1 &amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://lyj08.gitee.io/categories/linux/"/>
    
    
      <category term="linux" scheme="http://lyj08.gitee.io/tags/linux/"/>
    
      <category term="shell" scheme="http://lyj08.gitee.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>åå°„å®æˆ˜ï¼ŒåŸºäºæ³¨è§£çš„å½¢å¼ï¼Œå¸¦ä½ å®ç°ç±»ä¼¼jpaçš„æ­£å‘ç”Ÿæˆæ•°æ®åº“è¡¨çš„starter</title>
    <link href="http://lyj08.gitee.io/posts/740692cb/"/>
    <id>http://lyj08.gitee.io/posts/740692cb/</id>
    <published>2020-01-15T06:39:15.000Z</published>
    <updated>2020-12-30T09:27:39.930Z</updated>
    
    <content type="html"><![CDATA[<p>::: hljs-left</p><h1 id="åå°„-å®æˆ˜"><a href="#åå°„-å®æˆ˜" class="headerlink" title="åå°„-å®æˆ˜"></a>åå°„-å®æˆ˜</h1><p>:::</p><blockquote><p><strong>==è„±ç¦»å®æˆ˜çš„è®²è§£ éƒ½æ˜¯ æµæ°“ï¼Œæˆ‘ä»¬å³å°†è¿›è¡Œåå°„çš„å®æˆ˜==</strong></p></blockquote><blockquote><blockquote><p><strong>æˆ‘ä»¬å°†å®ç°ä¸€ä¸ª æ ¹æ® å®ä½“ bean åŠ ä¸Šæˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£ æ­£å‘ç”Ÿæˆå‘åº“é‡Œ ç”Ÿæˆå¯¹åº”çš„è¡¨çš„ä¸€ä¸ª starter (SpringBoot )</strong></p></blockquote></blockquote><p><strong>æˆ‘ä»¬çš„é¡¹ç›®å¾—å…ˆå¼•å…¥ä¾èµ–</strong></p><a id="more"></a><p>mysql é©±åŠ¨:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="1ã€å»ºç«‹å¥½æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆSpringBootï¼‰"><a href="#1ã€å»ºç«‹å¥½æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆSpringBootï¼‰" class="headerlink" title="1ã€å»ºç«‹å¥½æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆSpringBootï¼‰"></a>1ã€å»ºç«‹å¥½æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆSpringBootï¼‰</h1><p>  <img src="https://www.memoryoverflow.cn/file/articleContentImg/2019-09-20/1568957376173.png" alt="image.png"></p><p>  <img src="https://www.memoryoverflow.cn/file/articleContentImg/2019-09-20/1568955195605.png" alt="image.png"></p><p>  <strong>demo-test  æ˜¯æµ‹è¯•é¡¹ç›®</strong>\n<strong>forward-generation-starter å°±æ˜¯ä¸€ä¸ªè‡ªå·±é€ çš„ä¸€ä¸ªstarter,æ‰“äº†ä¸€ä¸ªjar å¯ä»¥è‡ªè¡Œå¼•å…¥</strong> </p><h1 id="2ã€è‡ªå®šä¹‰æ³¨è§£è¯´æ˜"><a href="#2ã€è‡ªå®šä¹‰æ³¨è§£è¯´æ˜" class="headerlink" title="2ã€è‡ªå®šä¹‰æ³¨è§£è¯´æ˜"></a>2ã€è‡ªå®šä¹‰æ³¨è§£è¯´æ˜</h1><p><img src="https://www.memoryoverflow.cn/file/articleContentImg/2019-09-20/1568957448890.png" alt="image.png"></p><ol><li><p><strong><code>@EnableAutoForwardGeneration</code></strong> æ˜¯å¦å¼€å¯ä¸»åŠ¨ç”Ÿæˆè¡¨æ“ä½œ æ”¾åœ¨Appå¯åŠ¨ç±»é‡Œé¢</p><p><code>OnOff()  true:å¼€å¯ï¼Œfalse:ä¸å¼€å¯</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * å¼€å¯æ­£å‘ç”Ÿæˆæ“ä½œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 14:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"> <span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"> <span class="meta">@Documented</span>\n<span class="meta">@Import(RegisterScaner.class)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoForwardGeneration</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="comment">// æŒ‡å®šå®ä½“ç±»æ‰€åœ¨çš„åŒ…</span></span><br><span class="line">     <span class="function">String <span class="title">entityPackages</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="comment">// æ˜¯å¦å¼€å¯è¡¨è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">     <span class="function"><span class="keyword">boolean</span>  <span class="title">OnOff</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">     &#125; </span><br></pre></td></tr></table></figure><p>2.<strong><code>@LColumn</code> åˆ—å±æ€§æ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * åˆ—æ³¨è§£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 14:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"> <span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"> <span class="meta">@Documented</span></span><br><span class="line"> <span class="keyword">public</span> <span class="meta">@interface</span> LColumn</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;br&gt;</span></span><br><span class="line"><span class="comment">     * åˆ—é•¿åº¦ String ç±»å‹çš„é»˜è®¤ä¸º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="function"><span class="keyword">int</span> <span class="title">width</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * &lt;br&gt;</span></span><br><span class="line"><span class="comment">      * æŒ‡å®šæ•°æ®åº“ç±»å‹</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="function">ColumnType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> ColumnType.FIELDTYPE</span>;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * &lt;br&gt;</span></span><br><span class="line"><span class="comment">    * åˆ—æ˜¯å¦é»˜è®¤ä¸ºç©º</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">boolean</span> <span class="title">isNull</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * &lt;br&gt;</span></span><br><span class="line"><span class="comment">    * æ˜¯å¦æœ‰é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">String <span class="title">defaultValue</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * &lt;br&gt;</span></span><br><span class="line"><span class="comment">    * æ³¨é‡Š</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">String <span class="title">comment</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>3.<strong><code>@LIncrement</code></strong></p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦è‡ªå¢</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 15:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LIncrement</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">IdType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> IdType.NONE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4.<strong><code>@LNotTableField</code> æ’é™¤éè¡¨ä¸­å­—æ®µ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * æ’é™¤éè¡¨ä¸­å­—æ®µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 15:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"> <span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"> <span class="meta">@Documented</span>\npublic <span class="meta">@interface</span> LNotTableField</span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>5.<strong><code>LTable</code> å®ä½“æ³¨è§£ æŒ‡å®šè¡¨å</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * å®ä½“æ³¨è§£ æŒ‡å®šè¡¨åå¦åˆ™è½¬ä¸‹åˆ’çº¿</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 15:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"> <span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"> <span class="meta">@Documented</span>\npublic <span class="meta">@interface</span> LTable</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>6.<strong><code>@LTableId ä¸»é”®æ³¨è§£</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * ä¸»é”®æ³¨è§£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 14:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"> <span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"> <span class="meta">@Documented</span></span><br><span class="line"> <span class="keyword">public</span> <span class="meta">@interface</span> LTableId\n&#123;</span><br><span class="line">   <span class="function">IdType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> IdType.NONE</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1 id="3ã€æ³¨è§£ä½¿ç”¨ä¾‹å­"><a href="#3ã€æ³¨è§£ä½¿ç”¨ä¾‹å­" class="headerlink" title="3ã€æ³¨è§£ä½¿ç”¨ä¾‹å­"></a>3ã€æ³¨è§£ä½¿ç”¨ä¾‹å­</h1><p><strong>å®ä½“ä¸Šçš„æ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;br&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019/5/7 17:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@LTable(name = &quot;tb_user&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">     <span class="meta">@LTableId(type = IdType.AUTO)</span></span><br><span class="line">     <span class="meta">@LColumn(width = 11,type = ColumnType.INT,isNull = false,comment = &quot;ä¸»é”®&quot;)</span></span><br><span class="line">     <span class="keyword">private</span> Integer id;</span><br><span class="line">     <span class="meta">@LColumn(width = 64,isNull = true,comment = &quot;å§“å&quot;,type = ColumnType.VARCHAR)</span></span><br><span class="line">     <span class="keyword">private</span> String name;</span><br><span class="line">     <span class="meta">@LColumn(width = 0,isNull = true,comment = &quot;å‡ºç”Ÿæ—¥æœŸ&quot;)</span></span><br><span class="line">     <span class="keyword">private</span> Date birthDay;</span><br><span class="line">     <span class="meta">@LNotTableField</span></span><br><span class="line">     <span class="keyword">private</span> Company company;</span><br><span class="line">     <span class="comment">// get set çœç•¥</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>App å¯åŠ¨ç±»åŠ ä¸Šæ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAutoForwardGeneration(entityPackages=&quot;com.example.demo.entity&quot;,OnOff = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>application.yml é…ç½®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">     driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">     url: jdbc:mysql:<span class="comment">//127.0.0.1:3307/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">     username: root</span><br><span class="line">     password: tiger</span><br><span class="line">     #update åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šæ›´æ–°,createï¼šåˆ é™¤åŸæ¥çš„è¡¨ æ ¹æ®å®ä½“ä¿¡æ¯é‡æ–°å»º</span><br><span class="line">     ddl-auto: create</span><br></pre></td></tr></table></figure><h1 id="4ã€æ€è·¯"><a href="#4ã€æ€è·¯" class="headerlink" title="4ã€æ€è·¯"></a>4ã€æ€è·¯</h1><p>&emsp;å…¶å®æˆ‘æ˜¯å­¦ mybatisçš„åˆå§‹åŒ–è¿‡ç¨‹çš„ï¼Œä¹‹å‰æœ‰çœ‹è¿‡mybatis æºç ï¼Œmybatis ä¹Ÿæ˜¯åˆ©ç”¨Springçš„æ‰«ææ¥å£ å»æ‰«æçš„ mappeer.java  æ–‡ä»¶ï¼›<a href="https://www.memoryoverflow.cn/blog/#/index/article/home/detail/4e5fbdf81f224085889eab51b06c6cc2">mybatis mappeæ¥å£æ‰«æ</a></p><p>&emsp;ä½¿ç”¨SpringBoot è‡ªå®šä¹‰ä¸€ä¸ªstarter,åˆ©ç”¨Springçš„ClassPathBeanDefinitionScanner.java çš„ doScanæ‰«ææ¥å£ï¼Œè‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯åŠ äº†@LTable æ³¨è§£çš„å®ä½“ï¼›</p><p>&emsp;åœ¨starter ä¸­çš„LyjAutoConfigure å®ç°äº <code>InitializingBean.java</code> ä¸­çš„<code>afterPropertiesSet</code> æ–¹æ³•ï¼Œåœ¨åˆå§‹åŒ–beançš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>ConfigurableListableBeanFactory.java</code> ä¸­çš„æ–¹æ³• <code>getBeansWithAnnotation(Class&lt;? extends Annotation&gt; var1)</code> æ‹¿åˆ°åŠ äº†æˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£çš„beanäº†ã€‚</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è·å–è‡ªå®šä¹‰ç±»æ³¨è§£çš„ç±»</span></span><br><span class="line">    List&lt;Class&lt;?&gt;&gt; classes = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Map&lt;String, Object&gt; map = beanFactory.getBeansWithAnnotation(LTable.class);</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : map.entrySet())</span><br><span class="line">    &#123;</span><br><span class="line">        classes.add(entry.getValue().getClass());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (classes.size()&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ConfigureEntityTable configureEntity = <span class="keyword">new</span> ConfigureEntityTable();</span><br><span class="line"></span><br><span class="line">    configureEntity.setProperties(<span class="keyword">this</span>.mySqlProperties);</span><br><span class="line">    <span class="comment">// è§£æå®ä½“</span></span><br><span class="line">    EntityParserHandler parserHandler = <span class="keyword">new</span> EntityParserHandler(configureEntity);</span><br><span class="line">    parserHandler.parser(classes);</span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®åº“ä¸­çš„è¡¨ä¿¡æ¯</span></span><br><span class="line">    TableParserHandler tableParserHandler = <span class="keyword">new</span> TableParserHandler(configureEntity,ddlExecutor);</span><br><span class="line">    tableParserHandler.parser();</span><br><span class="line">    DataBaseServiceHandler serviceHandler = <span class="keyword">new</span> DataBaseServiceHandler(<span class="keyword">this</span>.ddlExecutor,configureEntity);</span><br><span class="line">    serviceHandler.excute();</span><br><span class="line">    logger.info(<span class="string">&quot;è¡¨å·²æ›´æ–°--------&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°äº†æˆ‘ä»¬çš„beançš„ä¿¡æ¯ï¼Œè¿™ä¼šå°±å¯ä»¥é€šè¿‡åå°„ï¼Œå»è¯»å–ç±»çš„ç›¸å…³ä¿¡æ¯äº†ï¼Œæ¯”å¦‚ ç±»ä¸Šçš„æ³¨è§£å•Šï¼Œå±æ€§æ³¨è§£å•Šï¼Œç­‰ã€‚è¿™ä¼šå°±å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯ï¼Œå±æ€§åï¼Œè½¬é©¼å³°ï¼Œå’ŒåŠ ä¸Šæ³¨è§£çš„ä¸€äº›é…ç½®å€¼ï¼Œå°±å¯ä»¥ç”Ÿæˆ æˆ‘ä»¬çš„DDlè¯­å¥äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ è¿ä¸Šæ•°æ®åº“äº† æ‰§è¡Œæˆ‘ä»¬çš„sqlè¯­å¥å»è§è¡¨äº†ã€‚</p><p> <strong>âš ï¸ åªæ˜¯ä¸€ä¸ªdemo ï¼Œå¯¹åå°„çš„å®è·µæ“ä½œ</strong><br>é¡¹ç›®æºç  <a href="https://github.com/memoryoverflow/forward-generation-starter">github æºç </a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;::: hljs-left&lt;/p&gt;
&lt;h1 id=&quot;åå°„-å®æˆ˜&quot;&gt;&lt;a href=&quot;#åå°„-å®æˆ˜&quot; class=&quot;headerlink&quot; title=&quot;åå°„-å®æˆ˜&quot;&gt;&lt;/a&gt;åå°„-å®æˆ˜&lt;/h1&gt;&lt;p&gt;:::&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;==è„±ç¦»å®æˆ˜çš„è®²è§£ éƒ½æ˜¯ æµæ°“ï¼Œæˆ‘ä»¬å³å°†è¿›è¡Œåå°„çš„å®æˆ˜==&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬å°†å®ç°ä¸€ä¸ª æ ¹æ® å®ä½“ bean åŠ ä¸Šæˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£ æ­£å‘ç”Ÿæˆå‘åº“é‡Œ ç”Ÿæˆå¯¹åº”çš„è¡¨çš„ä¸€ä¸ª starter (SpringBoot )&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬çš„é¡¹ç›®å¾—å…ˆå¼•å…¥ä¾èµ–&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="åå°„" scheme="http://lyj08.gitee.io/tags/%E5%8F%8D%E5%B0%84/"/>
    
      <category term="SpringBoot starter" scheme="http://lyj08.gitee.io/tags/SpringBoot-starter/"/>
    
  </entry>
  
  <entry>
    <title>javaåå°„é‡ä¸­ä¹‹é‡ï¼Œé«˜çº§ç¼–ç¨‹ï¼ˆä½ ä¼šé€ è½®å­å—ï¼Œé€ è½®å­ï¼Œå¿…å¤‡çŸ¥è¯†ï¼Œä½ æ‡‚å¤šå°‘?ï¼‰</title>
    <link href="http://lyj08.gitee.io/posts/undefined/"/>
    <id>http://lyj08.gitee.io/posts/undefined/</id>
    <published>2019-12-23T00:04:12.000Z</published>
    <updated>2020-12-30T09:26:57.550Z</updated>
    
    <content type="html"><![CDATA[<p>::: hljs-center</p><h1 id="åå°„çš„ä½¿ç”¨"><a href="#åå°„çš„ä½¿ç”¨" class="headerlink" title="åå°„çš„ä½¿ç”¨"></a>åå°„çš„ä½¿ç”¨</h1><p>:::</p><p><strong>java å¼€å‘ä¸­ ä»»ä½•çš„ä¸€ä¸ªæ¡†æ¶ éƒ½ç¦»ä¸å¼€å‘å°„æœºåˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ æ¡†æ¶<code>Mybatis</code>ã€<code>Spring</code>â€¦</strong> å‡ ä¹æ‰€æœ‰å°è£…çš„  æ¡†æ¶ä¸­éƒ½ç¦»ä¸å¼€å®ƒï¼Œæƒ³è¦åšæ¶æ„ï¼Œåšå·¥å…·ã€å†™ä¸€ä¸ª starter éƒ½ç¦»ä¸å¼€åå°„æœºåˆ¶ã€‚ æ‰€ä»¥è¯´åœ¨å¼€å‘ä¸­ï¼Œåå°„æœºåˆ¶è¿ç”¨å¾—å½“å¯ä»¥çœä¸‹å¾ˆå¤šä»£ç ã€‚<br><strong>æ¥ä¸‹æ¥ä¸ªäººå­¦ä¹ çš„è§è§£</strong><br><strong>è·å–å½“å‰ç±»çš„ç›¸å…³ä¿¡æ¯</strong></p><h1 id="åå°„æœºåˆ¶"><a href="#åå°„æœºåˆ¶" class="headerlink" title="åå°„æœºåˆ¶"></a>åå°„æœºåˆ¶</h1><p> &emsp; åå°„åº”è¯¥æ˜¯ JVMè¯»å–ç›¸åº”ç±»çš„ å­—èŠ‚ç æ–‡ä»¶ï¼›åœ¨ç±»çš„è¿è¡ŒçŠ¶æ€ä¸­ï¼Œé€šè¿‡å­—èŠ‚ç æ–‡ä»¶ä¹Ÿå°±æ˜¯.classæ–‡ä»¶ï¼Œè·å–å½“å‰ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ æˆå‘˜å˜é‡ï¼Œç§æœ‰ã€å…±æœ‰çš„æ–¹æ³•ã€æ„é€ å‡½æ•°ã€ä»¥åŠç›¸å…³çš„æ³¨è§£ç­‰ã€‚</p><h1 id="åå°„çš„ä¸‰ç§æ–¹å¼"><a href="#åå°„çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="åå°„çš„ä¸‰ç§æ–¹å¼"></a>åå°„çš„ä¸‰ç§æ–¹å¼</h1><ol><li>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³• <code>User.class</code></li><li>å¯¹äºä»»æ„ä¸€ä¸ªç±»çš„å…¨è·¯å¾„åï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³• <code>class.forName(&quot;com.baidu.User&quot;)</code></li><li>å¯¹äºä»»æ„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ <code>(new User()).getClass()</code></li><li><h1 id="åå°„ä¹‹æ„é€ æ–¹æ³•"><a href="#åå°„ä¹‹æ„é€ æ–¹æ³•" class="headerlink" title="åå°„ä¹‹æ„é€ æ–¹æ³•"></a>åå°„ä¹‹æ„é€ æ–¹æ³•</h1><h2 id="1-getConstructor-Class-lt-gt-â€¦-parameterTypes"><a href="#1-getConstructor-Class-lt-gt-â€¦-parameterTypes" class="headerlink" title="1.getConstructor(Class&lt;?&gt;â€¦ parameterTypes)"></a>1.getConstructor(Class&lt;?&gt;â€¦ parameterTypes)</h2>&emsp; åå°„æœ‰ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±é‡‡ç”¨å…¶ä¸­ä¸€ç§  <code>(new User()).getClass()</code><br>é€šè¿‡ åå°„ æ‹¿åˆ°Userçš„æ„é€ å™¨ å®ä¾‹åŒ– ä¸€ä¸ªuser,</li></ol><a id="more"></a><p> <strong><code>ä¸€ä¸ªå®ä½“ç±» User.java</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Integer id;</span><br><span class="line">   <span class="keyword">private</span> String name;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id)</span></span></span><br><span class="line"><span class="function">   </span>&#123;        <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String name)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.id = id;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">               <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">               <span class="string">&quot;, name=&quot;</span> + name + â€œ</span><br><span class="line">               <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><strong><code>main() æ–¹æ³•ï¼š</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        System.out.println(<span class="string">&quot;new User():&quot;</span> + user);</span><br><span class="line">        Class&lt;? extends User&gt; aClass = user.getClass();</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Constructor&lt;? extends User&gt; constructor = aClass.getConstructor(Integer.class, String.class);</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                User newUser = constructor.newInstance(<span class="number">1</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;åå°„æ„é€ åˆ°çš„ newUser:&quot;</span>+newUser);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (InstantiationException e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (IllegalAccessException e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (InvocationTargetException e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (NoSuchMethodException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> User():User&#123;id=<span class="keyword">null</span>, name=<span class="string">&#x27;null&#x27;</span>&#125;</span><br><span class="line">åå°„æ‹¿åˆ°çš„ newUser:User&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;å¼ ä¸‰&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="2-getConstructors"><a href="#2-getConstructors" class="headerlink" title="2.getConstructors();"></a>2.getConstructors();</h2><p><strong>è·å–å½“å‰ç±»çš„æ‰€æœ‰publicæ„é€ å™¨</strong><br>è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ <code>User.class è·å–å­—èŠ‚ç æ–‡ä»¶</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;User&gt; aClass = User.class;</span><br><span class="line">Constructor&lt;?&gt;[] constructors = aClass.getConstructors();</span><br><span class="line"><span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructors)</span><br><span class="line">&#123;</span><br><span class="line">    System.out.println(constructor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š å…±æœ‰å››ä¸ªæ„é€ å™¨ï¼Œæ¯ä¸ªæ„é€ å™¨çš„å‚æ•°ï¼Œéƒ½ä¸ä¸€æ ·ï¼Œè¦è·å–æŒ‡å®šçš„æ„é€ å™¨ï¼Œå°±ä½¿ç”¨<code>getConstructor(Class&lt;?&gt;... parameterTypes)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> reflect.User(java.lang.String)</span><br><span class="line"><span class="keyword">public</span> reflect.User(java.lang.Integer,java.lang.String)</span><br><span class="line"><span class="keyword">public</span> reflect.User(java.lang.Integer)</span><br><span class="line"><span class="keyword">public</span> reflect.User()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><code>getDeclaredConstructors()</code></strong> è·å–ç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³• publicã€private</p><h1 id="åå°„ä¹‹è·å–ç±»ç›¸å…³æ–¹æ³•"><a href="#åå°„ä¹‹è·å–ç±»ç›¸å…³æ–¹æ³•" class="headerlink" title="åå°„ä¹‹è·å–ç±»ç›¸å…³æ–¹æ³•"></a>åå°„ä¹‹è·å–ç±»ç›¸å…³æ–¹æ³•</h1><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>getMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)</td><td>è·å–æŸä¸ªæ–¹æ³•</td></tr><tr><td>getMethods()</td><td>è·å–æ‰€æœ‰çš„publicæ–¹æ³•</td></tr><tr><td>getDeclaredMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)</td><td>è·å–æ‰€æœ‰çš„publicçš„æŸä¸ªæ–¹æ³•</td></tr><tr><td>getDeclaredMethods()</td><td>è·å–æ‰€æœ‰çš„public privateçš„æ–¹æ³•</td></tr></tbody></table><h2 id="1-getMethod-String-name-Classâ€¦-lt-gt-parameterTypes"><a href="#1-getMethod-String-name-Classâ€¦-lt-gt-parameterTypes" class="headerlink" title="1.getMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)"></a>1.getMethod(String name, Classâ€¦&lt;?&gt; parameterTypes)</h2><p>name:æ–¹æ³•åç§°ï¼›<br>parameterTypes:å½“å‰æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼›<br>æ¯”å¦‚æˆ‘è·å– setName() è¿™ä¸ªæ–¹æ³•,ç„¶åè°ƒç”¨ä»–setä¸€ä¸ªå€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;User&gt; aClass = User.class;</span><br><span class="line">Method method = aClass.getMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">Constructor&lt;User&gt; constructor = aClass.getConstructor();</span><br><span class="line">User user = constructor.newInstance();</span><br><span class="line">System.out.println(<span class="string">&quot;setå€¼å‰ï¼š&quot;</span> + user);</span><br><span class="line">method.invoke(user, <span class="string">&quot;åº“é‡Œ&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;setå€¼åï¼š&quot;</span> + user);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setå€¼å‰ï¼šUser&#123;id=<span class="keyword">null</span>, name=<span class="string">&#x27;null&#x27;</span>&#125;</span><br><span class="line">setå€¼åï¼šUser&#123;id=<span class="keyword">null</span>, name=<span class="string">&#x27;åº“é‡Œ&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="åå°„ä¹‹è·å–ç±»å±æ€§"><a href="#åå°„ä¹‹è·å–ç±»å±æ€§" class="headerlink" title="åå°„ä¹‹è·å–ç±»å±æ€§"></a>åå°„ä¹‹è·å–ç±»å±æ€§</h1><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>getField(String name)</td><td>è·å¾—å…·ä½“çš„publicå±æ€§å¯¹è±¡</td></tr><tr><td>getFields()</td><td>è·å¾—æ‰€æœ‰publicçš„å±æ€§å¯¹è±¡</td></tr><tr><td>getDeclaredField(String name)</td><td>è·å–æŸä¸ªå±æ€§</td></tr><tr><td>getDeclaredFields()</td><td>è·å–æ‰€æœ‰çš„public privateçš„æ–¹æ³•</td></tr></tbody></table><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568899199823.png" alt="image.png"></p><h2 id="1-getField-String-name"><a href="#1-getField-String-name" class="headerlink" title="1.getField(String name)"></a>1.getField(String name)</h2><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568899403696.png" alt="image.png"><strong><code>getField(String name)</code></strong>  æ–¹æ³• è·å–ç§æœ‰å±æ€§æ˜¯æŠ›å‡º æ‰¾ä¸åˆ°å±æ€§å¼‚å¸¸çš„ã€‚å› ä¸ºå½“å‰æ–¹æ³•æ˜¯ è·å–public ä¿®é¥°çš„å±æ€§ã€‚ name å±æ€§æ˜¯privateä¿®é¥°çš„ã€‚ </p><h2 id="2-getDeclaredField-String-name-n"><a href="#2-getDeclaredField-String-name-n" class="headerlink" title="2.getDeclaredField(String name)\n"></a>2.getDeclaredField(String name)\n<img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568899620184.png" alt="image.png"></h2><p><code>getDeclaredField(String name)</code> èƒ½è·å–æ‰€æœ‰å±æ€§è¾“å‡ºæ­£ç¡®ç»“æœã€‚</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>getAnnotation(Class<A> annotationClass)</td><td>è¿”å›è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„å…¬æœ‰æ³¨è§£å¯¹è±¡</td></tr><tr><td>getAnnotations()</td><td>è¿”å›è¯¥ç±»æ‰€æœ‰çš„å…¬æœ‰æ³¨è§£å¯¹è±¡</td></tr><tr><td>getDeclaredAnnotation(Class<A> annotationClass)</td><td>è¿”å›è¯¥ç±»ä¸­ä¸å‚æ•°ç±»å‹åŒ¹é…çš„æ‰€æœ‰æ³¨è§£å¯¹è±¡</td></tr><tr><td>getDeclaredAnnotations()</td><td>è¿”å›è¯¥ç±»æ‰€æœ‰çš„æ³¨è§£å¯¹è±¡</td></tr></tbody></table><h1 id="åå°„ä¹‹è·å–ç±»ä¸­ç›¸å…³æ³¨è§£"><a href="#åå°„ä¹‹è·å–ç±»ä¸­ç›¸å…³æ³¨è§£" class="headerlink" title="åå°„ä¹‹è·å–ç±»ä¸­ç›¸å…³æ³¨è§£"></a>åå°„ä¹‹è·å–ç±»ä¸­ç›¸å…³æ³¨è§£</h1><h2 id="1-ç±»æ³¨è§£-ClassAnotation-java"><a href="#1-ç±»æ³¨è§£-ClassAnotation-java" class="headerlink" title="1.ç±»æ³¨è§£ ClassAnotation.java"></a>1.ç±»æ³¨è§£ ClassAnotation.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *  ä¸€ä¸ªç±»æ³¨è§£</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ°¸å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2019-09-19 21:30</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>\n<span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ClassAnotation</span><br><span class="line">&#123;</span><br><span class="line">   <span class="function">String <span class="title">desrc</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-getAnnotation-Class-annotationClass"><a href="#1-getAnnotation-Class-annotationClass" class="headerlink" title="1.getAnnotation(Class annotationClass)"></a>1.getAnnotation(Class<A> annotationClass)</h3><p><strong>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£ç”¨æ¥è¯´æ˜è¿™ä¸ªç±»æ˜¯å¹²ä»€ä¹ˆçš„ï¼ŒæŠŠå®ƒæ”¾åœ¨ç±»ä¸Šé¢å»</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568900093273.png" alt="image.png"></p><p><strong>ç„¶åæˆ‘ä»¬ é€šè¿‡åå°„è·å–è¿™ä¸ªæ³¨è§£ç›¸å…³ä¿¡æ¯</strong></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568900207255.png" alt="image.png"></p><h3 id="2-FileAnnotation-java"><a href="#2-FileAnnotation-java" class="headerlink" title="2.FileAnnotation.java"></a>2.FileAnnotation.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>\n<span class="meta">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FileAnnotation</span><br><span class="line">&#123;</span><br><span class="line">   <span class="function">String <span class="title">desrc</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568900395313.png" alt="image.png"></p><p><strong>æ¨¡æ‹Ÿæ¨¡æ‹Ÿä¿®æ”¹åŠ äº†æ³¨è§£çš„å±æ€§å€¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡å¦‚ æˆ‘åœ¨åš user æ’å…¥æ“ä½œçš„æ—¶å€™ï¼Œid è¿™ä¸ªä¸»é”®çš„ ç”Ÿæˆç­–ç•¥ æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„id</span></span><br><span class="line"><span class="comment">     * æ¯”å¦‚ uuid ä¹‹ç±»çš„ ã€‚  æˆ‘ä»¬è¿™ä¸ªæ—¶å€™ åœ¨éœ€è¦çš„ç±» éœ€è¦çš„å­—æ®µä¸Š åŠ ä¸Šæˆ‘ä»¬çš„è‡ªå®šä¹‰æ³¨è§£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * åšä¸åŒçš„æ“ä½œï¼›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæˆ‘è¿™ä¸ªuser id ä¸æ˜¯è‡ªå¢çš„ æ˜¯æˆ‘è‡ªå®šä¹‰çš„ä¸»é”®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æˆ‘åœ¨ æ’å…¥çš„æ—¶å€™  å°±ä¸éœ€è¦è‡ªå·± setId(12328428342);äº† é€šè¿‡åå°„ ç»Ÿä¸€å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æˆ–è€… åˆ›å»ºæ—¶é—´ æ›´æ–°æ—¶é—´è¿™ç§æ“ä½œï¼Œæ¯æ¬¡æ›´æ–°éƒ½éœ€è¦æ‰‹åŠ¨æ“ä½œ çƒ¦æ­»äººäº†ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç”¨åå°„æ¥å¤„ç† åœ¨mybatis ä¸­ å°±å¯ä»¥ä½¿ç”¨æ‹¦æˆªå™¨ æ¥ä¿®æ”¹å‚æ•°å€¼ ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *    æ­¤å¤„æ¨¡æ‹Ÿä¸€ä¸‹ id çš„å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">    Class&lt;? extends User&gt; aClass = user.getClass();</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„å±æ€§</span></span><br><span class="line">    Field[] fields = aClass.getDeclaredFields();</span><br><span class="line">    System.out.println(<span class="string">&quot;ç»™ id set å€¼å‰ï¼š&quot;</span>+user);</span><br><span class="line">    <span class="comment">// çœ‹çœ‹å“ªä¸ªå±æ€§ åŠ äº† æˆ‘çš„æ³¨è§£</span></span><br><span class="line">    <span class="keyword">for</span> (Field field : fields)</span><br><span class="line">    &#123;</span><br><span class="line">        FileAnnotation annotation = field.getAnnotation(FileAnnotation.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è¿™æ˜¯id å±æ€§ æˆ‘éœ€è¦set å€¼</span></span><br><span class="line">            String desrc = annotation.desrc();</span><br><span class="line">            String fieldName = field.getName();</span><br><span class="line">            System.out.println(<span class="string">&quot;å±æ€§ï¼š&quot;</span> + fieldName + <span class="string">&quot; åŠ äº† FileAnnotation&quot;</span>);</span><br><span class="line">            System.out.println(desrc);</span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            field.set(user,<span class="number">100000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;ç»™ id set å€¼åï¼š&quot;</span>+ user);</span><br><span class="line">            <span class="comment">// ç»§ç»­æ’å…¥æ“ä½œ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç»™ id set å€¼å‰ï¼šUser&#123;id=<span class="keyword">null</span>, name=<span class="string">&#x27;å¼ ä¸‰&#x27;</span>&#125;</span><br><span class="line">å±æ€§ï¼šid åŠ äº† FileAnnotationè¿™æ˜¯ä¸€ä¸ªä¸»é”®ç»™ id set å€¼åï¼šUser&#123;id=<span class="number">100000</span>, name=<span class="string">&#x27;å¼ ä¸‰&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p><strong>å…¶å® Spring æ¡†æ¶çš„ @Autowired @Bean ç­‰æ³¨è§£ éƒ½æ˜¯åŸºäºåå°„æœºåˆ¶çš„ï¼›ä¾èµ–æ³¨å…¥ä¹Ÿæ˜¯è¿™ä¸ªåŸç†ï¼Œä¸ä¿¡æˆ‘å°±ç®€å•ç»™ä½ è¯•è¯•çœ‹ï¼›  @Autowired æ³¨è§£æ€ä¹ˆæ³¨å…¥ä¸€ä¸ªå¯¹åƒçš„ã€‚</strong></p><h3 id="3-åå°„å®ç°-Autowired-ä¾èµ–æ³¨å…¥"><a href="#3-åå°„å®ç°-Autowired-ä¾èµ–æ³¨å…¥" class="headerlink" title="3.åå°„å®ç° @Autowired ä¾èµ–æ³¨å…¥"></a>3.åå°„å®ç° @Autowired ä¾èµ–æ³¨å…¥</h3><p>1.<strong>å»ºä¸€ä¸ªservice<code>AppleService.java</code> å’Œ <code>@Autowired</code> è¿™ä¸ªæ³¨è§£ä¸æ˜¯Springä¸­çš„é‚£ä¸ª æ˜¯æˆ‘ä»¬è‡ªå·±çš„å“¦</strong></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568901534036.png" alt="image.png"> </p><p><strong><code>2.@Autowired</code></strong></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568901616028.png" alt="image.png"></p><p><strong>3.åŠ å…¥åˆ° User å±æ€§ä¸­</strong></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-09-19/1568901710453.png" alt="image.png"></p><p><strong>4.main æ–¹æ³•æ¨¡æ‹Ÿ Spring å¯åŠ¨ å°† AppleService å®ä¾‹æ³¨å…¥åˆ°Userä¸­çš„ appleService ä¸­ï¼Œå†è°ƒç”¨ eat() çš„æ–¹æ³•</strong></p><p><img src="1" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, NoSuchMethodException, InvocationTargetException, InstantiationException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">    Class&lt;? extends User&gt; aClass = user.getClass();</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„å±æ€§</span></span><br><span class="line">    Field[] fields = aClass.getDeclaredFields();</span><br><span class="line">    <span class="comment">// çœ‹çœ‹å“ªä¸ªå±æ€§ åŠ äº† æˆ‘çš„æ³¨è§£</span></span><br><span class="line">    <span class="keyword">for</span> (Field field : fields)</span><br><span class="line">    &#123;</span><br><span class="line">        Autowired annotation = field.getAnnotation(Autowired.class);</span><br><span class="line">        <span class="keyword">if</span> (annotation != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è·å¾—è¿™ä¸ªå±æ€§äº†å§</span></span><br><span class="line">            Class&lt;? extends Field&gt; appClass = field.getClass();</span><br><span class="line">            <span class="comment">// è·å–å±æ€§çš„ç±»å‹</span></span><br><span class="line">            Class&lt;?&gt; type = field.getType();</span><br><span class="line">            <span class="comment">// æ„é€ </span></span><br><span class="line">            Constructor&lt;?&gt; constructor = type.getConstructor();</span><br><span class="line">            <span class="comment">// new ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">            Object appleService = constructor.newInstance();</span><br><span class="line">           <span class="comment">// èµ‹å€¼ ä¾èµ–æ³¨å…¥</span></span><br><span class="line">            field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            field.set(user,appleService);</span><br><span class="line">            <span class="comment">// ç„¶åæˆ‘ä»¬è°ƒç”¨ getAppleService() æ¥è°ƒç”¨å®ƒçš„ eat()æ–¹æ³•</span></span><br><span class="line">            user.getAppleService().eat();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åƒè‹¹æœ</span><br></pre></td></tr></table></figure><p>**çœ‹å§ æˆ‘ä»¬çš„ä¾èµ–æ³¨å…¥å°±å®Œæˆäº†å§ï¼Œå…¶å®Springçš„ä¾èµ–æ³¨å…¥å°±æ˜¯ç”¨çš„åå°„ï¼Œå‰é¢è¯´äº†ï¼Œä¼˜ç§€çš„æ¡†æ¶ ç¦»ä¸å¼€åå°„æœºåˆ¶ã€‚é‡ç‚¹å­¦ä¹  åå°„å“¦ï¼Œæ¯”å¦‚æœ‰æ¯”å¦‚ mybatis çš„ ç»“æœé›†æ˜ å°„å¤„ç†â€¦; æ²¡æœ‰åå°„å°±æ²¡æœ‰è¿™ä¹ˆä¼˜ç§€çš„æ¡†æ¶ã€‚å…³äºSpring ä¾èµ–æ³¨å…¥ æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œå¾€åæˆ‘ä¹Ÿä¼šæ ¹æ®è‡ªå·±çš„è§è§£ï¼Œå†™åšå®¢ mybatis çš„è¿œç¦»åˆ†æ æºç ä¹Ÿçœ‹è¿‡äº†ï¼Œå¯ä»¥çœ‹æˆ‘çš„åšå®¢</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;::: hljs-center&lt;/p&gt;
&lt;h1 id=&quot;åå°„çš„ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#åå°„çš„ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;åå°„çš„ä½¿ç”¨&quot;&gt;&lt;/a&gt;åå°„çš„ä½¿ç”¨&lt;/h1&gt;&lt;p&gt;:::&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;java å¼€å‘ä¸­ ä»»ä½•çš„ä¸€ä¸ªæ¡†æ¶ éƒ½ç¦»ä¸å¼€å‘å°„æœºåˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ æ¡†æ¶&lt;code&gt;Mybatis&lt;/code&gt;ã€&lt;code&gt;Spring&lt;/code&gt;â€¦&lt;/strong&gt; å‡ ä¹æ‰€æœ‰å°è£…çš„  æ¡†æ¶ä¸­éƒ½ç¦»ä¸å¼€å®ƒï¼Œæƒ³è¦åšæ¶æ„ï¼Œåšå·¥å…·ã€å†™ä¸€ä¸ª starter éƒ½ç¦»ä¸å¼€åå°„æœºåˆ¶ã€‚ æ‰€ä»¥è¯´åœ¨å¼€å‘ä¸­ï¼Œåå°„æœºåˆ¶è¿ç”¨å¾—å½“å¯ä»¥çœä¸‹å¾ˆå¤šä»£ç ã€‚&lt;br&gt;&lt;strong&gt;æ¥ä¸‹æ¥ä¸ªäººå­¦ä¹ çš„è§è§£&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;è·å–å½“å‰ç±»çš„ç›¸å…³ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;åå°„æœºåˆ¶&quot;&gt;&lt;a href=&quot;#åå°„æœºåˆ¶&quot; class=&quot;headerlink&quot; title=&quot;åå°„æœºåˆ¶&quot;&gt;&lt;/a&gt;åå°„æœºåˆ¶&lt;/h1&gt;&lt;p&gt; &amp;emsp; åå°„åº”è¯¥æ˜¯ JVMè¯»å–ç›¸åº”ç±»çš„ å­—èŠ‚ç æ–‡ä»¶ï¼›åœ¨ç±»çš„è¿è¡ŒçŠ¶æ€ä¸­ï¼Œé€šè¿‡å­—èŠ‚ç æ–‡ä»¶ä¹Ÿå°±æ˜¯.classæ–‡ä»¶ï¼Œè·å–å½“å‰ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ æˆå‘˜å˜é‡ï¼Œç§æœ‰ã€å…±æœ‰çš„æ–¹æ³•ã€æ„é€ å‡½æ•°ã€ä»¥åŠç›¸å…³çš„æ³¨è§£ç­‰ã€‚&lt;/p&gt;
&lt;h1 id=&quot;åå°„çš„ä¸‰ç§æ–¹å¼&quot;&gt;&lt;a href=&quot;#åå°„çš„ä¸‰ç§æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;åå°„çš„ä¸‰ç§æ–¹å¼&quot;&gt;&lt;/a&gt;åå°„çš„ä¸‰ç§æ–¹å¼&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³• &lt;code&gt;User.class&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¯¹äºä»»æ„ä¸€ä¸ªç±»çš„å…¨è·¯å¾„åï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³• &lt;code&gt;class.forName(&amp;quot;com.baidu.User&amp;quot;)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¯¹äºä»»æ„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ &lt;code&gt;(new User()).getClass()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;h1 id=&quot;åå°„ä¹‹æ„é€ æ–¹æ³•&quot;&gt;&lt;a href=&quot;#åå°„ä¹‹æ„é€ æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;åå°„ä¹‹æ„é€ æ–¹æ³•&quot;&gt;&lt;/a&gt;åå°„ä¹‹æ„é€ æ–¹æ³•&lt;/h1&gt;&lt;h2 id=&quot;1-getConstructor-Class-lt-gt-â€¦-parameterTypes&quot;&gt;&lt;a href=&quot;#1-getConstructor-Class-lt-gt-â€¦-parameterTypes&quot; class=&quot;headerlink&quot; title=&quot;1.getConstructor(Class&amp;lt;?&amp;gt;â€¦ parameterTypes)&quot;&gt;&lt;/a&gt;1.getConstructor(Class&amp;lt;?&amp;gt;â€¦ parameterTypes)&lt;/h2&gt;&amp;emsp; åå°„æœ‰ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±é‡‡ç”¨å…¶ä¸­ä¸€ç§  &lt;code&gt;(new User()).getClass()&lt;/code&gt;&lt;br&gt;é€šè¿‡ åå°„ æ‹¿åˆ°Userçš„æ„é€ å™¨ å®ä¾‹åŒ– ä¸€ä¸ªuser,&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="java" scheme="http://lyj08.gitee.io/categories/java/"/>
    
    
      <category term="åå°„" scheme="http://lyj08.gitee.io/tags/%E5%8F%8D%E5%B0%84/"/>
    
  </entry>
  
  <entry>
    <title>dockeréƒ¨ç½²SprignBooté¡¹ç›®,æ³¨æ„äº‹é¡¹</title>
    <link href="http://lyj08.gitee.io/posts/b742af1/"/>
    <id>http://lyj08.gitee.io/posts/b742af1/</id>
    <published>2019-12-19T07:39:40.000Z</published>
    <updated>2020-12-30T09:26:35.079Z</updated>
    
    <content type="html"><![CDATA[<p>Docker ç¬”è®°</p><h3 id="Linux-CentOs-ä¸‹å®‰è£…-Docker"><a href="#Linux-CentOs-ä¸‹å®‰è£…-Docker" class="headerlink" title="Linux CentOs ä¸‹å®‰è£… Docker"></a>Linux CentOs ä¸‹å®‰è£… Docker</h3><h3 id="1ã€å®‰è£…ä¸å¯åŠ¨"><a href="#1ã€å®‰è£…ä¸å¯åŠ¨" class="headerlink" title="1ã€å®‰è£…ä¸å¯åŠ¨"></a>1ã€å®‰è£…ä¸å¯åŠ¨</h3><p>å‚è€ƒåœ°å€ï¼ˆ<a href="http://docs.docker.com/install/linux/docker-ce/centos/">å®˜ç½‘</a>ï¼‰ï¼›ä¾ç…§ç€ç½‘å€å³å¯å®‰è£…ã€‚</p><a id="more"></a><h3 id="2ã€Docker-å¸¸ç”¨å‘½ä»¤"><a href="#2ã€Docker-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2ã€Docker å¸¸ç”¨å‘½ä»¤"></a>2ã€Docker å¸¸ç”¨å‘½ä»¤</h3><blockquote><h4 id="2-1-æ‹‰å–é•œåƒ"><a href="#2-1-æ‹‰å–é•œåƒ" class="headerlink" title="2.1 æ‹‰å–é•œåƒ"></a>2.1 æ‹‰å–é•œåƒ</h4><p>é•œåƒåœ°å€ï¼š<a href="http://hub.docker.com/">http://hub.docker.com/</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker pull é•œåƒåœ°å€</span><br></pre></td></tr></table></figure><h4 id="2-2-æŸ¥çœ‹è¿è¡Œå®¹å™¨"><a href="#2-2-æŸ¥çœ‹è¿è¡Œå®¹å™¨" class="headerlink" title="2.2 æŸ¥çœ‹è¿è¡Œå®¹å™¨"></a>2.2 æŸ¥çœ‹è¿è¡Œå®¹å™¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker ps</span><br><span class="line"></span><br><span class="line">&gt;docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åŒ…æ‹¬ä¸è¿è¡Œçš„</span><br></pre></td></tr></table></figure><h4 id="2-3-è¿›å…¥å®¹å™¨"><a href="#2-3-è¿›å…¥å®¹å™¨" class="headerlink" title="2.3 è¿›å…¥å®¹å™¨"></a>2.3 è¿›å…¥å®¹å™¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker exec -it  å®¹é½id  bash</span><br></pre></td></tr></table></figure><h4 id="2-4-åˆ é™¤å®¹å™¨"><a href="#2-4-åˆ é™¤å®¹å™¨" class="headerlink" title="2.4 åˆ é™¤å®¹å™¨"></a>2.4 åˆ é™¤å®¹å™¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker rm å®¹å™¨id</span><br><span class="line">&gt;docker rm $(docker ps -aq) # åˆ é™¤æ‰€æœ‰å®¹å™¨</span><br><span class="line">&gt;docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq) #åœç”¨å¹¶åˆ é™¤å®¹å™¨</span><br></pre></td></tr></table></figure><h4 id="2-5-åˆ é™¤é•œåƒ"><a href="#2-5-åˆ é™¤é•œåƒ" class="headerlink" title="2.5 åˆ é™¤é•œåƒ"></a>2.5 åˆ é™¤é•œåƒ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker rmi é•œåƒID</span><br></pre></td></tr></table></figure><h4 id="2-6-æŸ¥çœ‹æ‰€æœ‰çš„é•œåƒ"><a href="#2-6-æŸ¥çœ‹æ‰€æœ‰çš„é•œåƒ" class="headerlink" title="2.6 æŸ¥çœ‹æ‰€æœ‰çš„é•œåƒ"></a>2.6 æŸ¥çœ‹æ‰€æœ‰çš„é•œåƒ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker images</span><br></pre></td></tr></table></figure><h4 id="2-7-è¿è¡Œé•œåƒ"><a href="#2-7-è¿è¡Œé•œåƒ" class="headerlink" title="2.7 è¿è¡Œé•œåƒ"></a>2.7 è¿è¡Œé•œåƒ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;docker run é•œåƒåç§° # æœ€ç®€å•çš„ å‰å°è¿è¡Œ</span><br><span class="line">&gt;docker run -d -p æœ¬æœºç«¯å£ï¼ˆè®¿é—®ç«¯å£ï¼‰ï¼šå®¹å™¨ç«¯å£ é•œåƒåç§°</span><br></pre></td></tr></table></figure><ul><li>-d: å®¹å™¨åå°è¿è¡Œ</li><li>-p:æŒ‡å®šæœ¬æœºè®¿é—®å†…éƒ¨ç«¯å£çš„æ˜ å°„</li></ul></blockquote><h3 id="3ã€docker-å®‰è£…tomcat"><a href="#3ã€docker-å®‰è£…tomcat" class="headerlink" title="3ã€docker å®‰è£…tomcat"></a>3ã€docker å®‰è£…tomcat</h3><p>è¿›å…¥ç½‘å€ <a href="http://hub.docker.com/">http://hub.docker.com/</a>  æœç´¢Tomcat</p><p><img src="/!%5Bimage20191210113639818.png%5D(http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085271709.png" alt="image-20191210113639818"></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085373244.png" alt="image20191210113725961.png"></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085403304.png" alt="image20191210113756463.png"></p><p>å¤åˆ¶å‘½ä»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat:jdk8</span><br></pre></td></tr></table></figure><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085436234.png" alt="image20191210120600033.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085459286.png" alt="image20191210120639682.png"></p><p><strong>å¯åŠ¨ Tomcat:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">1010</span>:<span class="number">8080</span> tomcat</span><br></pre></td></tr></table></figure><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085480792.png" alt="image20191210120917905.png"></p><p>å¯åŠ¨æˆåŠŸ è®¿é—®ï¼š<a href="http://www.memoryoverflow.cn:1010/">http://www.memoryoverflow.cn:1010/</a><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085491936.png" alt="image20191210121044795.png"></p><p>è¦ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it å®¹å™¨ID bash</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 594014aedf68 bash</span><br></pre></td></tr></table></figure><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085508954.png" alt="image20191210121327049.png"></p><p>è¿›å…¥ tomcat å†…éƒ¨ å¯ä»¥å¯¹ conf/server.xml æ–‡ä»¶=è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="4ã€docker-æ„å»ºå¹¶ä¸”å‘å¸ƒè‡ªå·±çš„SpringBooté¡¹ç›®"><a href="#4ã€docker-æ„å»ºå¹¶ä¸”å‘å¸ƒè‡ªå·±çš„SpringBooté¡¹ç›®" class="headerlink" title="4ã€docker æ„å»ºå¹¶ä¸”å‘å¸ƒè‡ªå·±çš„SpringBooté¡¹ç›®"></a>4ã€docker æ„å»ºå¹¶ä¸”å‘å¸ƒè‡ªå·±çš„SpringBooté¡¹ç›®</h3><ol><li></li><li><p>æ‰¾åˆ°ä¸€ä¸ªä½ç½® å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹</p><p>æ­¤å¤„åœ¨</p><p><code>mkdir /usr/local/docker/demo</code></p><p><code>cd /usr/local/docker/demo</code> </p><p>å»ºç«‹ä¸€ä¸ªæ–‡ä»¶Dockerfile</p><p><code>touch Dockerfile</code>  </p></li><li><p>è‡ªå·±å»ºç«‹ä¸€ä¸ªSpringBooté¡¹ç›®</p><p>å†™ä¸€ä¸ªController æµ‹è¯•</p></li></ol><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085589014.png" alt="image20191210144400363.png"></p><p>   åœ¨ pom.xml æ–‡ä»¶ä¸­åŠ å…¥ é…ç½®</p>   <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;docker.image.prefix&gt;springboot&lt;/docker.image.prefix&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure><p>   åœ¨è¿™ä¸­é—´åŠ å…¥ï¼š<build> <plugins>â€¦â€¦</plugins></build></p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br><span class="line">&lt;!-- Docker maven plugin --&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;imageName&gt;$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;&lt;/imageName&gt;</span><br><span class="line">        &lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class="line">                &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class="line">                &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br><span class="line">&lt;!-- Docker maven plugin --&gt;</span><br></pre></td></tr></table></figure><p>   ç„¶å å°†é¡¹ç›®æ‰“åŒ… æ¯”æˆ‘æˆ‘é¡¹ç›®åä¸ºï¼šdemo.jar </p><p>   æ¥ç€ <code>vim Dockerfile</code>        </p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ä¾èµ–äºjdk è¿è¡Œç¯å¢ƒ,å¦‚æœè¿˜æ²¡æœ‰å®‰è£… ç¬¬ä¸€æ¬¡æ„å»ºä¼šè‡ªåŠ¨å®‰è£…</span><br><span class="line">FROM java:<span class="number">8</span></span><br><span class="line"># ä½œè€…</span><br><span class="line">MAINTAINER æ°¸å¥&lt;memoryoverflow@<span class="number">163.</span>com&gt;</span><br><span class="line">#ä¸€ä¸ªç‰¹åˆ«æŒ‡å®šçš„ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®</span><br><span class="line">VOLUME /tmp</span><br><span class="line"></span><br><span class="line"># æ‹·è´æ–‡ä»¶å¹¶ä¸”é‡å‘½åä¸ºè‡ªå·±è¦å®šä¹‰çš„</span><br><span class="line">ADD demo.jar app.jar </span><br><span class="line"></span><br><span class="line"># å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥java -jar xxxx.jarï¼Œä¸ºäº†ç¼©çŸ­ Tomcat çš„å¯åŠ¨æ—¶é—´ï¼Œæ·»åŠ java.security.egdçš„ç³»ç»Ÿå±æ€§æŒ‡å‘/dev/urandomä½œä¸º ENTRYPOINT</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span><br></pre></td></tr></table></figure><p>   âš ï¸ æ‰“å¥½çš„é¡¹ç›®jar åŒ…è¦å’Œ Dockerfile æ–‡ä»¶åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œä¸ç„¶æ‰§è¡Œ build å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šå‡ºç° not fount jar é”™è¯¯ã€‚</p><ol start="4"><li><p>æ„å»ºé•œåƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t demo .</span><br></pre></td></tr></table></figure><p>demo:    å°±æ˜¯é•œåƒå è‡ªå®šä¹‰ æ³¨æ„ ç©ºæ ¼ <code>.</code> </p><p>æ„å»ºæˆåŠŸ</p></li></ol><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085629382.png" alt="image20191210143619972.png"></p><ol start="5"><li><p>æŸ¥çœ‹é•œåƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085640595.png" alt="image20191210143705344.png"></p></li><li><p>è¿è¡Œé•œåƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">1595</span>:<span class="number">1595</span> demo</span><br></pre></td></tr></table></figure><ul><li>-d: åå°è¿è¡Œ</li><li>-p:  ç«¯å£æ˜ å°„ å°†ç¬¬äºŒä¸ªä½ jar è¿è¡Œçš„ç«¯å£ï¼Œæ˜ å°„åˆ°ç¬¬ä¸€ä¸ªï¼Œç»™å¤–éƒ¨äº¤äº’è®¿é—®çš„ç«¯å£</li><li>demo:  å°±æ˜¯build çš„ é•œåƒåå­—</li></ul><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085740463.png" alt="image20191210144310783.png"></p><p>è¿è¡ŒæˆåŠŸï¼šæµè§ˆå™¨è®¿é—®ï¼š<a href="http://www.memoryoverflow.cn:1595/hello">http://www.memoryoverflow.cn:1595/hello</a></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085753760.png" alt="image20191210144441349.png"></p><p>åˆ°æ­¤ é¡¹ç›®éƒ¨ç½²æˆåŠŸã€‚</p></li><li><p>æ—¥å¿—æŸ¥çœ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail -f å®¹å™¨Id</span><br></pre></td></tr></table></figure></li></ol><h3 id="5ã€docker-JAR-é¡¹ç›®æ›´æ–°"><a href="#5ã€docker-JAR-é¡¹ç›®æ›´æ–°" class="headerlink" title="5ã€docker  JAR é¡¹ç›®æ›´æ–°"></a>5ã€docker  JAR é¡¹ç›®æ›´æ–°</h3><h4 id="5-1-docker-æ›¿æ¢-jar-æ›´æ–°ã€‚"><a href="#5-1-docker-æ›¿æ¢-jar-æ›´æ–°ã€‚" class="headerlink" title="5.1 docker æ›¿æ¢ jar æ›´æ–°ã€‚"></a>5.1 docker æ›¿æ¢ jar æ›´æ–°ã€‚</h4><p> æ¥ç€ä¸Šé¢çš„demoæ“ä½œã€‚<code>docker ps</code>  æŸ¥çœ‹å®¹å™¨id ï¼Œæ‰¾æˆ‘æˆ‘ä»¬éƒ¨ç½²çš„é¡¹ç›®ï¼ŒJar é¡¹ç›®ã€‚</p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085655051.png" alt="image20191210144310783.png"></p><p>æ‰§è¡Œå‘½ä»¤ï¼š<code>ps exce -it å®¹å™¨Id bash</code></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-23/1577085706610.png" alt="image20191217100359182.png"><br><code>ls -l</code></p><p>æŸ¥çœ‹é¡¹ç›®å†…éƒ¨ç»“æ„ï¼Œå®¹å™¨å†…éƒ¨çš„ç»“æ„ç›®å½•ï¼Œæ¯ä¸ªå®¹å™¨çš„ç»“æ„ï¼Œéƒ½æ˜¯ç‹¬ç«‹å¼€çš„ï¼Œä¸å®¿ä¸»æœºçš„ç»“æ„ç›®å½•ä¸å…³è”ï¼Œåœ¨é¡¹ç›®å†…æ˜¯ä¸èƒ½ç›´æ¥è®¿é—® å®¿ä¸»æœºç»“æ„ç›®å½•çš„ã€‚</p><p>æœ‰ä¸ª App.jar å°±æ˜¯Dockerfile é‡Œé¢çš„ add å‘½å è‡ªå®šä¹‰çš„ app.jar ; æœ€åå°±æ˜¯è¿è¡Œçš„è¿™ä¸€ä¸ª app.jar</p><p>åªè¦æ›¿æ¢æ‰è¿™ä¸ªapp.jar ç„¶åé‡å¯ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker restart å®¹å™¨Id</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ›¿æ¢å‘½åï¼šå°†å®¿ä¸»æœºçš„ jar æ›´æ–°æ›¿æ¢åˆ° å®¹å™¨ä¸­çš„ jar æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker cp æ–°jarçš„è·¯å¾„ å®¹å™¨ID:å®¹å™¨ä¸­çš„ç›®å½•app.jar</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">  docker cp /opt/docker/appNew.jar å®¹å™¨ID:/app.jar </span><br><span class="line">  è¿™æ ·å­å³å¯æ›¿æ¢æ›´æ–° jar æ–‡ä»¶ï¼Œç„¶åé‡å¯å³å¯ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å³å¯æ›´æ–°é¡¹ç›®ï¼Œä½†æ˜¯è¿™æ ·å­æ›´æ–°ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé¡¹ç›®æ˜¯åœ¨çº¿ä¸Šçš„è¯ï¼Œæ›´æ–°è¿‡ç¨‹é¡¹ç›®ä¼šåœ¨å¯åŠ¨æˆåŠŸå‰æ— æ³•è®¿é—®ã€‚è¿™æ ·å­ä¼šå½±å“ç”¨æˆ·ã€‚</p><h4 id="5-2-docker-éƒ¨ç½²-nginx-æ— ç¼æ›´æ–°"><a href="#5-2-docker-éƒ¨ç½²-nginx-æ— ç¼æ›´æ–°" class="headerlink" title="5.2 docker éƒ¨ç½² + nginx æ— ç¼æ›´æ–°"></a>5.2 docker éƒ¨ç½² + nginx æ— ç¼æ›´æ–°</h4><p>ä¸ºäº†èƒ½å¤Ÿå¹³æ»‘æ›´æ–°ï¼Œä¸è®©å®¢æˆ·æ‰€çŸ¥ï¼Œå¯ä»¥é€šè¿‡nginx å¤„ç†ã€‚</p><p>ä¹‹å‰å·²ç»æ‰“å¥½äº†ä¸€ä¸ª jar ç«¯å£ä¸º 1595ï¼Œç°åœ¨å°†æ›´æ–°åçš„ jar å†ç»§ç»­æ‰“ä¸€ä¸ª é•œåƒï¼Œå¹¶å°†è¯¥j a r çš„ç«¯å£æ”¹ä¸º1596ï¼Œé•œåƒåä¸º demo_1596ã€‚</p><p>ç„¶åå°±æœ‰äº†ä¸¤ä¸ª é•œåƒä¸€ä¸ªæ˜¯ demo  ä¸€ä¸ªæ˜¯demo_1596 å…¶ä¸­æœ€æ–°çš„æ˜¯åè€…ã€‚</p><p>Nginx  é…ç½®ç«¯å£æ‹¦æˆªï¼Œä¹‹å‰çš„é¡¹ç›® demo é¡¹ç›®ç«¯å£ä¸º 1595ï¼Œç°åœ¨å°†å…¶ç›‘å¬çš„é¡¹ç›® è½¬å‘åˆ° ip:1596ç«¯å£ä¸Šï¼Œä¿å­˜é€€å‡ºã€‚</p><p>é‡å¯æ–°çš„ jar demo_1596ã€‚ é‡å¯æˆåŠŸåï¼Œreload nginx è®©å…¶ä¿®æ”¹çš„é…ç½®ä¿¡æ¯ç”Ÿæ•ˆã€‚ç”Ÿæ•ˆåï¼Œå°±å¯ä»¥ <code>docker stop è€çš„å®¹å™¨Idäº†</code></p><h3 id="6ã€docker-å®¿ä¸»æœºç›®å½•ä¸å®¹å™¨ç›®å½•ï¼Œå…±äº«ã€‚"><a href="#6ã€docker-å®¿ä¸»æœºç›®å½•ä¸å®¹å™¨ç›®å½•ï¼Œå…±äº«ã€‚" class="headerlink" title="6ã€docker å®¿ä¸»æœºç›®å½•ä¸å®¹å™¨ç›®å½•ï¼Œå…±äº«ã€‚"></a>6ã€docker å®¿ä¸»æœºç›®å½•ä¸å®¹å™¨ç›®å½•ï¼Œå…±äº«ã€‚</h3><p>-v å®¿ä¸»æœºç›®å½•:å®¹å™¨ä¸­çš„ç›®å½•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">8080</span>:<span class="number">80</span> -v /home/file:/home/file app</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Docker ç¬”è®°&lt;/p&gt;
&lt;h3 id=&quot;Linux-CentOs-ä¸‹å®‰è£…-Docker&quot;&gt;&lt;a href=&quot;#Linux-CentOs-ä¸‹å®‰è£…-Docker&quot; class=&quot;headerlink&quot; title=&quot;Linux CentOs ä¸‹å®‰è£… Docker&quot;&gt;&lt;/a&gt;Linux CentOs ä¸‹å®‰è£… Docker&lt;/h3&gt;&lt;h3 id=&quot;1ã€å®‰è£…ä¸å¯åŠ¨&quot;&gt;&lt;a href=&quot;#1ã€å®‰è£…ä¸å¯åŠ¨&quot; class=&quot;headerlink&quot; title=&quot;1ã€å®‰è£…ä¸å¯åŠ¨&quot;&gt;&lt;/a&gt;1ã€å®‰è£…ä¸å¯åŠ¨&lt;/h3&gt;&lt;p&gt;å‚è€ƒåœ°å€ï¼ˆ&lt;a href=&quot;http://docs.docker.com/install/linux/docker-ce/centos/&quot;&gt;å®˜ç½‘&lt;/a&gt;ï¼‰ï¼›ä¾ç…§ç€ç½‘å€å³å¯å®‰è£…ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="http://lyj08.gitee.io/categories/Docker/"/>
    
    
      <category term="SpringBoot" scheme="http://lyj08.gitee.io/tags/SpringBoot/"/>
    
      <category term="linux" scheme="http://lyj08.gitee.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>mybatisä½¿ç”¨å­˜å‚¨è¿‡ç¨‹</title>
    <link href="http://lyj08.gitee.io/posts/baa6fbb5/"/>
    <id>http://lyj08.gitee.io/posts/baa6fbb5/</id>
    <published>2019-12-07T09:53:39.000Z</published>
    <updated>2020-12-30T09:27:05.973Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º"><a href="#1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º" class="headerlink" title="1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º"></a>1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º</h3><p>&emsp; åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">name</span><span class="params">([IN å‚æ•°<span class="number">1</span> INT,OUT å‚æ•°<span class="number">2</span>,OUT])</span></span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> -- ä¸šåŠ¡é€»è¾‘ </span></span><br><span class="line"><span class="function">END</span>;</span><br></pre></td></tr></table></figure><a id="more"></a><ol><li>CREATE PROCEDURE: åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„sqlè¯­æ³•</li><li>name: å­˜å‚¨è¿‡ç¨‹çš„åå­— è‡ªå®šä¹‰</li><li>(): æ‹¬å·å°±æ˜¯å‚æ•°ï¼Œå‚æ•°æ ¼å¼<br>1ã€IN ä»£è¡¨å…¥å‚  OUT ä»£è¡¨ è¾“å‡ºå‚æ•°ï¼ŒINTOUTï¼šè¾“å…¥ä¹Ÿè¾“å‡º<br>2ã€å‚æ•°1 å‚æ•°name<br>3ã€INT ç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨ å…¥å‚ æˆ–è€… å‡ºå‚çš„ç±»å‹ï¼Œå†™çš„æ˜¯æ•°æ®åº“çš„ç±»å‹ã€‚<br>4ã€bengin â€” end;  ä¸­é—´å°±æ˜¯ è¦å°è£…çš„ä¸šåŠ¡é€»è¾‘ã€‚</li></ol><p>&emsp; <strong>ä¾‹å­ï¼š</strong></p><p>&emsp; ä½¿ç”¨ navicat è½¯ä»¶æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">pp</span><span class="params">(OUT roleId INT,OUT cityId INT,IN ciName VARCHAR(<span class="number">64</span>)</span>)</span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function">  -- æ’å…¥ ä¸€æ¡æ•°æ®</span></span><br><span class="line"><span class="function">  INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(ciName)</span></span>; </span><br><span class="line">  </span><br><span class="line">  -- è·å–æœ€æ–°Id</span><br><span class="line">  <span class="function">SELECT <span class="title">max</span><span class="params">(tb_city.id)</span> INTO cityId FROM tb_city</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_role</span> <span class="params">(name,city_id)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;superman&quot;</span>,cityId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">SELECT <span class="title">max</span><span class="params">(tb_role.id)</span> INTO roleId FROM tb_role</span>;</span><br><span class="line"></span><br><span class="line">  SELECT roleId;</span><br><span class="line"></span><br><span class="line">  SELECT cityId;</span><br><span class="line">END;</span><br></pre></td></tr></table></figure><h3 id="2ã€å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨"><a href="#2ã€å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨" class="headerlink" title="2ã€å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨"></a>2ã€å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨</h3><p>&emsp; <code>call å­˜å‚¨è¿‡ç¨‹çš„åå­—(å‚æ•°)</code></p><p>ä»¥ä¸Šé¢ä¸ºä¾‹å­</p><p><code>call pp(@roleId,@cityId,&quot;å¹¿å·&quot;);</code></p><p>ç»“æœï¼š ä¸¤ä¸ªç»“æœ æ˜¯è¾“å‡ºçš„<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575706239100.png" alt="image.png"></p><h3 id="3ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹"><a href="#3ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹"></a>3ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE  å­˜å‚¨è¿‡ç¨‹åå­—;</span><br><span class="line">DROP PROCEDURE IF EXISTS è¿‡ç¨‹;</span><br></pre></td></tr></table></figure><h3 id="4ã€æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çŠ¶æ€"><a href="#4ã€æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çŠ¶æ€" class="headerlink" title="4ã€æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çŠ¶æ€"></a>4ã€æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çŠ¶æ€</h3><p><strong>æŸ¥çœ‹çŠ¶æ€</strong><br><code>SHOW PROCEDURE STATUS LIKE  &#39;pp&#39;</code></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575706699047.png" alt="image.png"></p><p><strong>æŸ¥çœ‹å®šä¹‰</strong><br><code>SHOW CREATE PROCEDURE pp</code></p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575706807277.png" alt="image.png"></p><h3 id="6ã€äº‹åŠ¡ä½¿ç”¨"><a href="#6ã€äº‹åŠ¡ä½¿ç”¨" class="headerlink" title="6ã€äº‹åŠ¡ä½¿ç”¨"></a>6ã€äº‹åŠ¡ä½¿ç”¨</h3><p>&emsp; ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸ºäº† å°è£…ä½ ä¸šåŠ¡é€»è¾‘åˆ°ä¸€å¥—sqlä¸­ï¼Œå‡å°‘ç½‘ç»œçš„å¼€é”€ï¼Œææ‰§è¡Œé€Ÿåº¦ã€‚ä½†æ˜¯ä¸€ç³»åˆ—çš„è¡¨æ“ä½œï¼Œå¿…å®šè¦ä¿è¯åŸå­æ€§ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p><p><strong>Mysqläº‹åŠ¡æ“ä½œè¯­å¥ï¼š</strong></p><ol><li>START TRANSACTION: å¼€å§‹äº‹åŠ¡ï¼Œautocommitè®¾ä¸º0ï¼Œå¦‚æœå·²ç»æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿è¡Œï¼Œåˆ™ä¼šè§¦å‘ä¸€ä¸ªéšè—çš„COMMIT  </li><li>COMMITï¼šæäº¤äº‹åŠ¡ï¼Œä¿å­˜æ›´æ”¹ã€‚</li><li>ROLLBACKï¼šå›æ»šæœ¬äº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ”¹ï¼Œç„¶åç»“æŸäº‹åŠ¡ã€‚</li><li>SAVEPOINT savepoint_nameï¼šåˆ›å»ºä¸€ä¸ªsavepointè¯†åˆ«ç¬¦æ¥ROLLBACK TO SAVEPOINTã€‚</li><li>ROLLBACK TO SAVEPOINT savepoint_nameï¼šå›æ»šåˆ°ä»savepoint_nameå¼€å§‹å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ”¹ï¼Œè¿™æ ·å°±å…è®¸å›æ»šäº‹åŠ¡ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¿è¯æ›´æ”¹çš„ä¸€ä¸ªå­é›†è¢«æäº¤ ã€‚</li><li>SET TRANSACTIONï¼šå…è®¸è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚</li><li>LOCK TABLESï¼šå…è®¸æ˜¾å¼çš„é”ä½ä¸€ä¸ªæˆ–å¤šä¸ªtableï¼Œä¼šéšå¼çš„å…³é—­å½“å‰æ‰“å¼€çš„äº‹åŠ¡ï¼Œå»ºè®®åœ¨æ‰§è¡ŒLOCK TABLESè¯­å¥ä¹‹å‰æ˜¾å¼çš„commitæˆ–rollbackã€‚æˆ‘ä»¬ä¸€èˆ¬æ‰€ä»¥ä¸€èˆ¬åœ¨äº‹åŠ¡ä»£ç é‡Œä¸ä¼šä½¿ç”¨LOCK TABLES</li></ol><p><strong>ä¾‹å­1:</strong><br>&emsp; ä½¿ç”¨ <code>set autocommit=0;</code> è®¾ç½® äº‹åŠ¡ä¸è‡ªåŠ¨æäº¤ï¼›<br>è¿˜ç”¨ä¸Šé¢çš„ä¾‹å­ï¼ŒåŠ ä¸Šäº‹åŠ¡æµ‹è¯•ï¼š</p><p>åˆ›å»ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">pp</span><span class="params">(OUT roleId INT,OUT cityId INT,IN ciName VARCHAR(<span class="number">64</span>)</span>) </span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  set autocommit</span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;å¹¿å·&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">SELECT <span class="title">max</span><span class="params">(tb_city.id)</span> INTO cityId FROM tb_city</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_role</span> <span class="params">(name,city_id)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;superman&quot;</span>,cityId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">SELECT <span class="title">max</span><span class="params">(tb_role.id)</span> INTO roleId FROM tb_role</span>;</span><br><span class="line"></span><br><span class="line">  SELECT roleId;</span><br><span class="line"></span><br><span class="line">  SELECT cityId;</span><br><span class="line"></span><br><span class="line">  -- è¿™æ¡è¯­å¥ä¼šæŠ¥é”™</span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(ciName)</span></span>;</span><br><span class="line"></span><br><span class="line">  COMMIT;</span><br><span class="line">END;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯¹ä¸¤å¼ è¡¨è¿›è¡Œæ“ä½œï¼Œå½“å‰ä¸¤å¼ è¡¨éƒ½æ˜¯ç©ºè¡¨ã€‚<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575707743604.png" alt="image.png">)<img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575707820829.png" alt="image.png">)<img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575707832131.png" alt="image.png"></p><p>å…¶ä¸­cityè¡¨çš„cityName å­—æ®µé•¿åº¦è®¾ä¸º 2ï¼›<br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575707806589.png" alt="image.png"></p><p>è°ƒç”¨ï¼š<code>call pp(@roleId,@cityId,&quot;æ·±åœ³å¸‚&quot;);</code> çœ‹ç»“æœï¼š</p><p><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575707980276.png" alt="image.png"></p><p><strong>æ·±åœ³å¸‚ï¼š</strong> å­—æ®µè¶…å‡ºé•¿åº¦ï¼› çœ‹çœ‹å‰é¢ä¸¤å¼ è¡¨æœ‰æ²¡æœ‰æ’å…¥æ•°æ®ã€‚ è‚¯å®šæ˜¯æ²¡æœ‰çš„ï¼Œäº‹åŠ¡æ²¡æœ‰æäº¤ã€‚</p><p><strong>äº‹åŠ¡ç¬¬äºŒç§æ–¹å¼</strong></p><p><strong>START TRANSACTION;</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">pp</span><span class="params">(OUT roleId INT,OUT cityId INT,IN ciName VARCHAR(<span class="number">64</span>)</span>) </span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  START TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;å¹¿å·&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">SELECT <span class="title">max</span><span class="params">(tb_city.id)</span> INTO cityId FROM tb_city</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_role</span> <span class="params">(name,city_id)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;superman&quot;</span>,cityId)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">SELECT <span class="title">max</span><span class="params">(tb_role.id)</span> INTO roleId FROM tb_role</span>;</span><br><span class="line"></span><br><span class="line">  SELECT roleId;</span><br><span class="line"></span><br><span class="line">  SELECT cityId;</span><br><span class="line"></span><br><span class="line">  -- è¿™æ¡è¯­å¥ä¼šæŠ¥é”™</span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(ciName)</span></span>;</span><br><span class="line"></span><br><span class="line">  COMMIT;</span><br><span class="line">END;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>äº‹åŠ¡ç¬¬ä¸‰ç§ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">pp</span><span class="params">()</span></span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  declare t_error <span class="keyword">int</span> <span class="keyword">default</span> 0</span>;  -- æ ‡å¿—æ‰§è¡Œå‡ºé”™</span><br><span class="line">declare <span class="keyword">continue</span> handler <span class="keyword">for</span> sqlexception set t_error=<span class="number">1</span>; -- å‡ºé”™ç»§ç»­æ‰§è¡Œ å¹¶ä¸”è®¾é”™è¯¯æ ‡å¿—ä¸º<span class="number">1</span></span><br><span class="line"></span><br><span class="line">START TRANSACTION; -- å¼€å¯äº‹ç‰©</span><br><span class="line"><span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;ç æµ·&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">INSERT INTO <span class="title">tb_role</span> <span class="params">(name)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;superman&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;æ¹›æ±Ÿ23&quot;</span>)</span></span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> t_error=<span class="number">1</span> THEN</span><br><span class="line">ROLLBACK; -- äº‹ç‰©å›æ»š</span><br><span class="line">ELSE</span><br><span class="line">COMMIT;</span><br><span class="line">END IF;</span><br><span class="line"></span><br><span class="line">END;</span><br></pre></td></tr></table></figure><h3 id="7ã€å˜é‡çš„ä½¿ç”¨"><a href="#7ã€å˜é‡çš„ä½¿ç”¨" class="headerlink" title="7ã€å˜é‡çš„ä½¿ç”¨"></a>7ã€å˜é‡çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">bianliang</span><span class="params">()</span></span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function">        declare count <span class="keyword">int</span></span>; -- å®šä¹‰å˜é‡</span><br><span class="line"></span><br><span class="line">select count; -- æŸ¥è¯¢ ç»“æœ <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">set count  = <span class="number">10</span>;  -- èµ‹å€¼</span><br><span class="line"></span><br><span class="line">select count; -- ç»“æœ <span class="number">10</span></span><br><span class="line">END;</span><br></pre></td></tr></table></figure><p><code>call bianliang();</code></p><h3 id="8ã€if-else-if"><a href="#8ã€if-else-if" class="headerlink" title="8ã€if-else-if"></a>8ã€if-else-if</h3><p>æ ¹æ®æ’å…¥id æ¥åˆ¤æ–­æ˜¯å¦æ’å…¥æˆåŠŸ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> CREATE PROCEDURE bianliang()</span><br><span class="line">BEGIN</span><br><span class="line">        declare count int; -- å®šä¹‰å˜é‡</span><br><span class="line"></span><br><span class="line">declare lastId int;</span><br><span class="line"></span><br><span class="line">SELECT MAX(tb_city.id) INTO count from tb_city;</span><br><span class="line"></span><br><span class="line">INSERT INTO tb_city (cityName) VALUES(&quot;ä½›å±±&quot;);</span><br><span class="line"></span><br><span class="line">SELECT MAX(tb_city.id) INTO lastId from tb_city;</span><br><span class="line"></span><br><span class="line">if (lastId&gt;count) THEN</span><br><span class="line">SELECT &#39;æ·»åŠ æˆåŠŸ&#39;;</span><br><span class="line">ELSE</span><br><span class="line">                SELECT &#39;æ“ä½œå¤±è´¥&#39;;</span><br><span class="line">END IF;</span><br><span class="line"></span><br><span class="line">END;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç»“æœ</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575709036986.png" alt="image.png"></p><h3 id="9ã€-while-Â·Â·Â·Â·-end-while"><a href="#9ã€-while-Â·Â·Â·Â·-end-while" class="headerlink" title="9ã€ while Â·Â·Â·Â· end while"></a>9ã€ while Â·Â·Â·Â· end while</h3><p><strong>æ‰¹é‡æ’å…¥æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE PROCEDURE <span class="title">whiles</span><span class="params">()</span></span></span><br><span class="line"><span class="function">BEGIN</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">declare <span class="keyword">var</span> <span class="keyword">int</span></span>;</span><br><span class="line">set <span class="keyword">var</span> =<span class="number">0</span>;</span><br><span class="line">WHILE <span class="keyword">var</span>&lt;<span class="number">5</span> DO</span><br><span class="line">  <span class="function">INSERT INTO <span class="title">tb_city</span> <span class="params">(cityName)</span> <span class="title">VALUES</span><span class="params">(<span class="string">&quot;æ¹›æ±Ÿ&quot;</span>)</span></span>;</span><br><span class="line">set <span class="keyword">var</span>=<span class="keyword">var</span>+<span class="number">1</span>;</span><br><span class="line">        END WHILE;</span><br><span class="line">END;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong><br><img src="http://www.memoryoverflow.cn/file/articleContentImg/2019-12-07/1575709661211.png" alt="image.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º&quot;&gt;&lt;a href=&quot;#1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º&quot; class=&quot;headerlink&quot; title=&quot;1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º&quot;&gt;&lt;/a&gt;1ã€å­˜å‚¨è¿‡ç¨‹åˆ›å»º&lt;/h3&gt;&lt;p&gt;&amp;emsp; åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨ &lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;CREATE PROCEDURE &lt;span class=&quot;title&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;([IN å‚æ•°&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; INT,OUT å‚æ•°&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,OUT])&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;BEGIN&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt; -- ä¸šåŠ¡é€»è¾‘ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;END&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="æ•°æ®åº“" scheme="http://lyj08.gitee.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="mybatis" scheme="http://lyj08.gitee.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mybatis/"/>
    
      <category term="å­˜å‚¨è¿‡ç¨‹" scheme="http://lyj08.gitee.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mybatis/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"/>
    
    
      <category term="mybatis" scheme="http://lyj08.gitee.io/tags/mybatis/"/>
    
      <category term="å­˜å‚¨è¿‡ç¨‹" scheme="http://lyj08.gitee.io/tags/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/"/>
    
  </entry>
  
</feed>
